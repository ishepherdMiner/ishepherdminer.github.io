{"pages":[{"title":"","text":"# éšç§åè®® @font-face { font-family: octicons-anchor; src: url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAAAYcAA0AAAAACjQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABGRlRNAAABMAAAABwAAAAca8vGTk9TLzIAAAFMAAAARAAAAFZG1VHVY21hcAAAAZAAAAA+AAABQgAP9AdjdnQgAAAB0AAAAAQAAAAEACICiGdhc3AAAAHUAAAACAAAAAj//wADZ2x5ZgAAAdwAAADRAAABEKyikaNoZWFkAAACsAAAAC0AAAA2AtXoA2hoZWEAAALgAAAAHAAAACQHngNFaG10eAAAAvwAAAAQAAAAEAwAACJsb2NhAAADDAAAAAoAAAAKALIAVG1heHAAAAMYAAAAHwAAACABEAB2bmFtZQAAAzgAAALBAAAFu3I9x/Nwb3N0AAAF/AAAAB0AAAAvaoFvbwAAAAEAAAAAzBdyYwAAAADP2IQvAAAAAM/bz7t4nGNgZGFgnMDAysDB1Ml0hoGBoR9CM75mMGLkYGBgYmBlZsAKAtJcUxgcPsR8iGF2+O/AEMPsznAYKMwIkgMA5REMOXicY2BgYGaAYBkGRgYQsAHyGMF8FgYFIM0ChED+h5j//yEk/3KoSgZGNgYYk4GRCUgwMaACRoZhDwCs7QgGAAAAIgKIAAAAAf//AAJ4nHWMMQrCQBBF/0zWrCCIKUQsTDCL2EXMohYGSSmorScInsRGL2DOYJe0Ntp7BK+gJ1BxF1stZvjz/v8DRghQzEc4kIgKwiAppcA9LtzKLSkdNhKFY3HF4lK69ExKslx7Xa+vPRVS43G98vG1DnkDMIBUgFN0MDXflU8tbaZOUkXUH0+U27RoRpOIyCKjbMCVejwypzJJG4jIwb43rfl6wbwanocrJm9XFYfskuVC5K/TPyczNU7b84CXcbxks1Un6H6tLH9vf2LRnn8Ax7A5WQAAAHicY2BkYGAA4teL1+yI57f5ysDNwgAC529f0kOmWRiYVgEpDgYmEA8AUzEKsQAAAHicY2BkYGB2+O/AEMPCAAJAkpEBFbAAADgKAe0EAAAiAAAAAAQAAAAEAAAAAAAAKgAqACoAiAAAeJxjYGRgYGBhsGFgYgABEMkFhAwM/xn0QAIAD6YBhwB4nI1Ty07cMBS9QwKlQapQW3VXySvEqDCZGbGaHULiIQ1FKgjWMxknMfLEke2A+IJu+wntrt/QbVf9gG75jK577Lg8K1qQPCfnnnt8fX1NRC/pmjrk/zprC+8D7tBy9DHgBXoWfQ44Av8t4Bj4Z8CLtBL9CniJluPXASf0Lm4CXqFX8Q84dOLnMB17N4c7tBo1AS/Qi+hTwBH4rwHHwN8DXqQ30XXAS7QaLwSc0Gn8NuAVWou/gFmnjLrEaEh9GmDdDGgL3B4JsrRPDU2hTOiMSuJUIdKQQayiAth69r6akSSFqIJuA19TrzCIaY8sIoxyrNIrL//pw7A2iMygkX5vDj+G+kuoLdX4GlGK/8Lnlz6/h9MpmoO9rafrz7ILXEHHaAx95s9lsI7AHNMBWEZHULnfAXwG9/ZqdzLI08iuwRloXE8kfhXYAvE23+23DU3t626rbs8/8adv+9DWknsHp3E17oCf+Z48rvEQNZ78paYM38qfk3v/u3l3u3GXN2Dmvmvpf1Srwk3pB/VSsp512bA/GG5i2WJ7wu430yQ5K3nFGiOqgtmSB5pJVSizwaacmUZzZhXLlZTq8qGGFY2YcSkqbth6aW1tRmlaCFs2016m5qn36SbJrqosG4uMV4aP2PHBmB3tjtmgN2izkGQyLWprekbIntJFing32a5rKWCN/SdSoga45EJykyQ7asZvHQ8PTm6cslIpwyeyjbVltNikc2HTR7YKh9LBl9DADC0U/jLcBZDKrMhUBfQBvXRzLtFtjU9eNHKin0x5InTqb8lNpfKv1s1xHzTXRqgKzek/mb7nB8RZTCDhGEX3kK/8Q75AmUM/eLkfA+0Hi908Kx4eNsMgudg5GLdRD7a84npi+YxNr5i5KIbW5izXas7cHXIMAau1OueZhfj+cOcP3P8MNIWLyYOBuxL6DRylJ4cAAAB4nGNgYoAALjDJyIAOWMCiTIxMLDmZedkABtIBygAAAA==) format('woff'); } body { background-color: white; } .markdown-body { min-width: 200px; max-width: 760px; margin: 0 auto; padding: 20px; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; color: #333; overflow: hidden; font-family: \"Helvetica Neue\", Helvetica, \"Segoe UI\", Arial, freesans, sans-serif; font-size: 16px; line-height: 1.6; word-wrap: break-word; } .markdown-body a { background: transparent;;word-wrap: break-word; word-break: break-all; } .markdown-body a:active, .markdown-body a:hover { outline: 0; } .markdown-body strong { font-weight: bold; } .markdown-body h1 { font-size: 2em; margin: 0.67em 0; } .markdown-body img { border: 0; } .markdown-body hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; } .markdown-body pre { overflow: auto; } .markdown-body code, .markdown-body kbd, .markdown-body pre { font-family: monospace, monospace; font-size: 1em; } .markdown-body input { color: inherit; font: inherit; margin: 0; } .markdown-body html input[disabled] { cursor: default; } .markdown-body input { line-height: normal; } .markdown-body input[type=\"checkbox\"] { -moz-box-sizing: border-box; box-sizing: border-box; padding: 0; } .markdown-body table { border-collapse: collapse; border-spacing: 0; } .markdown-body td, .markdown-body th { padding: 0; } .markdown-body * { -moz-box-sizing: border-box; box-sizing: border-box; } .markdown-body input { font: 13px/1.4 Helvetica, arial, freesans, clean, sans-serif, \"Segoe UI Emoji\", \"Segoe UI Symbol\"; } .markdown-body a { color: #4183c4; text-decoration: none; } .markdown-body a:hover, .markdown-body a:focus, .markdown-body a:active { text-decoration: underline; } .markdown-body hr { height: 0; margin: 15px 0; overflow: hidden; background: transparent; border: 0; border-bottom: 1px solid #ddd; } .markdown-body hr:before { display: table; content: \"\"; } .markdown-body hr:after { display: table; clear: both; content: \"\"; } .markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6 { margin-top: 15px; margin-bottom: 15px; line-height: 1.1; } .markdown-body h1 { font-size: 30px; } .markdown-body h2 { font-size: 21px; } .markdown-body h3 { font-size: 16px; } .markdown-body h4 { font-size: 14px; } .markdown-body h5 { font-size: 12px; } .markdown-body h6 { font-size: 11px; } .markdown-body blockquote { margin: 0; } .markdown-body ul, .markdown-body ol { padding: 0; margin-top: 0; margin-bottom: 0; } .markdown-body ol ol, .markdown-body ul ol { list-style-type: lower-roman; } .markdown-body ul ul ol, .markdown-body ul ol ol, .markdown-body ol ul ol, .markdown-body ol ol ol { list-style-type: lower-alpha; } .markdown-body dd { margin-left: 0; } .markdown-body code { font: 12px Consolas, \"Liberation Mono\", Menlo, Courier, monospace; } .markdown-body pre { margin-top: 0; margin-bottom: 0; font: 12px Consolas, \"Liberation Mono\", Menlo, Courier, monospace; } .markdown-body kbd { background-color: #e7e7e7; background-image: -webkit-linear-gradient(#fefefe, #e7e7e7); background-image: linear-gradient(#fefefe, #e7e7e7); background-repeat: repeat-x; border-radius: 2px; border: 1px solid #cfcfcf; color: #000; padding: 3px 5px; line-height: 10px; font: 11px Consolas, \"Liberation Mono\", Menlo, Courier, monospace; display: inline-block; } .markdown-body>*:first-child { margin-top: 0 !important; } .markdown-body>*:last-child { margin-bottom: 0 !important; } .markdown-body .anchor { position: absolute; top: 0; bottom: 0; left: 0; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; } .markdown-body .anchor:focus { outline: none; } .markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6 { position: relative; margin-top: 1em; margin-bottom: 16px; font-weight: bold; line-height: 1.4; } .markdown-body h1 .octicon-link, .markdown-body h2 .octicon-link, .markdown-body h3 .octicon-link, .markdown-body h4 .octicon-link, .markdown-body h5 .octicon-link, .markdown-body h6 .octicon-link { display: none; color: #000; vertical-align: middle; } .markdown-body h1:hover .anchor, .markdown-body h2:hover .anchor, .markdown-body h3:hover .anchor, .markdown-body h4:hover .anchor, .markdown-body h5:hover .anchor, .markdown-body h6:hover .anchor { height: 1em; padding-left: 8px; margin-left: -30px; line-height: 1; text-decoration: none; } .markdown-body h1:hover .anchor .octicon-link, .markdown-body h2:hover .anchor .octicon-link, .markdown-body h3:hover .anchor .octicon-link, .markdown-body h4:hover .anchor .octicon-link, .markdown-body h5:hover .anchor .octicon-link, .markdown-body h6:hover .anchor .octicon-link { display: inline-block; } .markdown-body h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid #eee; } .markdown-body h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid #eee; } .markdown-body h3 { font-size: 1.5em; line-height: 1.43; } .markdown-body h4 { font-size: 1.25em; } .markdown-body h5 { font-size: 1em; } .markdown-body h6 { font-size: 1em; color: #777; } .markdown-body p, .markdown-body blockquote, .markdown-body ul, .markdown-body ol, .markdown-body dl, .markdown-body table, .markdown-body pre { margin-top: 0; margin-bottom: 16px; } .markdown-body hr { height: 4px; padding: 0; margin: 16px 0; background-color: #e7e7e7; border: 0 none; } .markdown-body ul, .markdown-body ol { padding-left: 2em; } .markdown-body ul ul, .markdown-body ul ol, .markdown-body ol ol, .markdown-body ol ul { margin-top: 0; margin-bottom: 0; } .markdown-body li>p { margin-top: 16px; } .markdown-body dl { padding: 0; } .markdown-body dl dt { padding: 0; margin-top: 16px; font-size: 1em; font-style: italic; font-weight: bold; } .markdown-body dl dd { padding: 0 16px; margin-bottom: 16px; } .markdown-body blockquote { padding: 0 15px; color: #777; border-left: 4px solid #ddd; } .markdown-body blockquote>:first-child { margin-top: 0; } .markdown-body blockquote>:last-child { margin-bottom: 0; } .markdown-body table { display: block; width: 100%; overflow: auto; word-break: normal; word-break: keep-all; } .markdown-body table th { font-weight: bold; } .markdown-body table th, .markdown-body table td { padding: 6px 13px; border: 1px solid #ddd; } .markdown-body table tr { background-color: #fff; border-top: 1px solid #ccc; } .markdown-body table tr:nth-child(2n) { background-color: #f8f8f8; } .markdown-body img { max-width: 100%; -moz-box-sizing: border-box; box-sizing: border-box; } .markdown-body code { padding: 0; padding-top: 0.2em; padding-bottom: 0.2em; margin: 0; font-size: 85%; background-color: rgba(0,0,0,0.04); border-radius: 3px; } .markdown-body code:before, .markdown-body code:after { letter-spacing: -0.2em; content: \"\\00a0\"; } .markdown-body pre>code { padding: 0; margin: 0; font-size: 100%; word-break: normal; white-space: pre; background: transparent; border: 0; } .markdown-body .highlight { margin-bottom: 16px; } .markdown-body .highlight pre, .markdown-body pre { padding: 16px; overflow: auto; font-size: 85%; line-height: 1.45; background-color: #f7f7f7; border-radius: 3px; } .markdown-body .highlight pre { margin-bottom: 0; word-break: normal; } .markdown-body pre { word-wrap: normal; } .markdown-body pre code { display: inline; max-width: initial; padding: 0; margin: 0; overflow: initial; line-height: inherit; word-wrap: normal; background-color: transparent; border: 0; } .markdown-body pre code:before, .markdown-body pre code:after { content: normal; } .markdown-body .highlight { background: #fff; } .markdown-body .highlight .mf, .markdown-body .highlight .mh, .markdown-body .highlight .mi, .markdown-body .highlight .mo, .markdown-body .highlight .il, .markdown-body .highlight .m { color: #945277; } .markdown-body .highlight .s, .markdown-body .highlight .sb, .markdown-body .highlight .sc, .markdown-body .highlight .sd, .markdown-body .highlight .s2, .markdown-body .highlight .se, .markdown-body .highlight .sh, .markdown-body .highlight .si, .markdown-body .highlight .sx, .markdown-body .highlight .s1 { color: #df5000; } .markdown-body .highlight .kc, .markdown-body .highlight .kd, .markdown-body .highlight .kn, .markdown-body .highlight .kp, .markdown-body .highlight .kr, .markdown-body .highlight .kt, .markdown-body .highlight .k, .markdown-body .highlight .o { font-weight: bold; } .markdown-body .highlight .kt { color: #458; } .markdown-body .highlight .c, .markdown-body .highlight .cm, .markdown-body .highlight .c1 { color: #998; font-style: italic; } .markdown-body .highlight .cp, .markdown-body .highlight .cs { color: #999; font-weight: bold; } .markdown-body .highlight .cs { font-style: italic; } .markdown-body .highlight .n { color: #333; } .markdown-body .highlight .na, .markdown-body .highlight .nv, .markdown-body .highlight .vc, .markdown-body .highlight .vg, .markdown-body .highlight .vi { color: #008080; } .markdown-body .highlight .nb { color: #0086B3; } .markdown-body .highlight .nc { color: #458; font-weight: bold; } .markdown-body .highlight .no { color: #094e99; } .markdown-body .highlight .ni { color: #800080; } .markdown-body .highlight .ne { color: #990000; font-weight: bold; } .markdown-body .highlight .nf { color: #945277; font-weight: bold; } .markdown-body .highlight .nn { color: #555; } .markdown-body .highlight .nt { color: #000080; } .markdown-body .highlight .err { color: #a61717; background-color: #e3d2d2; } .markdown-body .highlight .gd { color: #000; background-color: #fdd; } .markdown-body .highlight .gd .x { color: #000; background-color: #faa; } .markdown-body .highlight .ge { font-style: italic; } .markdown-body .highlight .gr { color: #aa0000; } .markdown-body .highlight .gh { color: #999; } .markdown-body .highlight .gi { color: #000; background-color: #dfd; } .markdown-body .highlight .gi .x { color: #000; background-color: #afa; } .markdown-body .highlight .go { color: #888; } .markdown-body .highlight .gp { color: #555; } .markdown-body .highlight .gs { font-weight: bold; } .markdown-body .highlight .gu { color: #800080; font-weight: bold; } .markdown-body .highlight .gt { color: #aa0000; } .markdown-body .highlight .ow { font-weight: bold; } .markdown-body .highlight .w { color: #bbb; } .markdown-body .highlight .sr { color: #017936; } .markdown-body .highlight .ss { color: #8b467f; } .markdown-body .highlight .bp { color: #999; } .markdown-body .highlight .gc { color: #999; background-color: #EAF2F5; } .markdown-body .octicon { font: normal normal 16px octicons-anchor; line-height: 1; display: inline-block; text-decoration: none; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; } .markdown-body .octicon-link:before { content: '\\f05c'; } .markdown-body .task-list-item { list-style-type: none; } .markdown-body .task-list-item+.task-list-item { margin-top: 3px; } .markdown-body .task-list-item input { float: left; margin: 0.3em 0 0.25em -1.6em; vertical-align: middle; } table td{ word-wrap: break-word !important; word-break: break-all !important; } /* github.com style (c) Vasily Polovnyov */ .hljs { display: block; overflow-x: auto; padding: 0.5em; color: #333; background: #f8f8f8; -webkit-text-size-adjust: none; } .hljs-comment, .diff .hljs-header { color: #998; font-style: italic; } .hljs-keyword, .css .rule .hljs-keyword, .hljs-winutils, .nginx .hljs-title, .hljs-subst, .hljs-request, .hljs-status { color: #333; font-weight: bold; } .hljs-number, .hljs-hexcolor, .ruby .hljs-constant { color: #008080; } .hljs-string, .hljs-tag .hljs-value, .hljs-doctag, .tex .hljs-formula { color: #d14; } .hljs-title, .hljs-id, .scss .hljs-preprocessor { color: #900; font-weight: bold; } .hljs-list .hljs-keyword, .hljs-subst { font-weight: normal; } .hljs-class .hljs-title, .hljs-type, .vhdl .hljs-literal, .tex .hljs-command { color: #458; font-weight: bold; } .hljs-tag, .hljs-tag .hljs-title, .hljs-rule .hljs-property, .django .hljs-tag .hljs-keyword { color: #000080; font-weight: normal; } .hljs-attribute, .hljs-variable, .lisp .hljs-body, .hljs-name { color: #008080; } .hljs-regexp { color: #009926; } .hljs-symbol, .ruby .hljs-symbol .hljs-string, .lisp .hljs-keyword, .clojure .hljs-keyword, .scheme .hljs-keyword, .tex .hljs-special, .hljs-prompt { color: #990073; } .hljs-built_in { color: #0086b3; } .hljs-preprocessor, .hljs-pragma, .hljs-pi, .hljs-doctype, .hljs-shebang, .hljs-cdata { color: #999; font-weight: bold; } .hljs-deletion { background: #fdd; } .hljs-addition { background: #dfd; } .diff .hljs-change { background: #0086b3; } .hljs-chunk { color: #aaa; } @media print{ .hljs{overflow: visible; word-wrap: break-word !important;} } éšç§åè®® ç•ªèŒ„æ¸…å•(ä»¥ä¸‹ç®€ç§°æœ¬åº”ç”¨)å°Šé‡å¹¶ä¿æŠ¤æ‰€æœ‰ä½¿ç”¨æœåŠ¡ç”¨æˆ·çš„ä¸ªäººéšç§æƒã€‚ä¸ºäº†ç»™æ‚¨æä¾›æ›´å‡†ç¡®ã€æ›´æœ‰ä¸ªæ€§åŒ–çš„æœåŠ¡ï¼Œæœ¬åº”ç”¨ä¼šæŒ‰ç…§æœ¬éšç§æƒæ”¿ç­–çš„è§„å®šä½¿ç”¨å’ŒæŠ«éœ²æ‚¨çš„ä¸ªäººä¿¡æ¯ã€‚ä½†æœ¬åº”ç”¨å°†ä»¥é«˜åº¦çš„å‹¤å‹‰ã€å®¡æ…ä¹‰åŠ¡å¯¹å¾…è¿™äº›ä¿¡æ¯ã€‚é™¤æœ¬éšç§æƒæ”¿ç­–å¦æœ‰è§„å®šå¤–ï¼Œåœ¨æœªå¾å¾—æ‚¨äº‹å…ˆè®¸å¯çš„æƒ…å†µä¸‹ï¼Œæœ¬åº”ç”¨ä¸ä¼šå°†è¿™äº›ä¿¡æ¯å¯¹å¤–æŠ«éœ²æˆ–å‘ç¬¬ä¸‰æ–¹æä¾›ã€‚æœ¬åº”ç”¨ä¼šä¸æ—¶æ›´æ–°æœ¬éšç§æƒæ”¿ç­–ã€‚ æ‚¨åœ¨åŒæ„æœ¬åº”ç”¨æœåŠ¡ä½¿ç”¨åè®®ä¹‹æ—¶ï¼Œå³è§†ä¸ºæ‚¨å·²ç»åŒæ„æœ¬éšç§æƒæ”¿ç­–å…¨éƒ¨å†…å®¹ã€‚æœ¬éšç§æƒæ”¿ç­–å±äºæœ¬åº”ç”¨æœåŠ¡ä½¿ç”¨åè®®ä¸å¯åˆ†å‰²çš„ä¸€éƒ¨åˆ†ã€‚ 1. é€‚ç”¨èŒƒå›´ (a) åœ¨æ‚¨ä½¿ç”¨æœ¬åº”ç”¨ä½¿ç”¨ç½‘ç»œæœåŠ¡ï¼Œæˆ–è®¿é—®æœ¬åº”ç”¨å¹³å°ç½‘é¡µæ—¶ï¼Œæœ¬åº”ç”¨è‡ªåŠ¨æ¥æ”¶å¹¶è®°å½•çš„æ‚¨çš„æµè§ˆå™¨å’Œè®¡ç®—æœºä¸Šçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºæ‚¨çš„IPåœ°å€ã€æµè§ˆå™¨çš„ç±»å‹ã€ä½¿ç”¨çš„è¯­è¨€ã€è®¿é—®æ—¥æœŸå’Œæ—¶é—´ã€è½¯ç¡¬ä»¶ç‰¹å¾ä¿¡æ¯åŠæ‚¨éœ€æ±‚çš„ç½‘é¡µè®°å½•ç­‰æ•°æ®ï¼› (b) æœ¬åº”ç”¨é€šè¿‡åˆæ³•é€”å¾„ä»å•†ä¸šä¼™ä¼´å¤„å–å¾—çš„ç”¨æˆ·ä¸ªäººæ•°æ®ã€‚ æ‚¨äº†è§£å¹¶åŒæ„ï¼Œä»¥ä¸‹ä¿¡æ¯ä¸é€‚ç”¨æœ¬éšç§æƒæ”¿ç­–ï¼š (a) è¿åæ³•å¾‹è§„å®šæˆ–è¿åæœ¬åº”ç”¨è§„åˆ™è¡Œä¸ºåŠæœ¬åº”ç”¨å·²å¯¹æ‚¨é‡‡å–çš„æªæ–½ã€‚ 2.ä¿¡æ¯ä½¿ç”¨ (a)æœ¬åº”ç”¨ä¸ä¼šå‘ä»»ä½•æ— å…³ç¬¬ä¸‰æ–¹æä¾›ã€å‡ºå”®ã€å‡ºç§Ÿã€åˆ†äº«æˆ–äº¤æ˜“æ‚¨çš„ä¸ªäººä¿¡æ¯ï¼Œé™¤éäº‹å…ˆå¾—åˆ°æ‚¨çš„è®¸å¯ï¼Œæˆ–è¯¥ç¬¬ä¸‰æ–¹å’Œæœ¬åº”ç”¨ï¼ˆå«æœ¬åº”ç”¨å…³è”å…¬å¸ï¼‰å•ç‹¬æˆ–å…±åŒä¸ºæ‚¨æä¾›æœåŠ¡ï¼Œä¸”åœ¨è¯¥æœåŠ¡ç»“æŸåï¼Œå…¶å°†è¢«ç¦æ­¢è®¿é—®åŒ…æ‹¬å…¶ä»¥å‰èƒ½å¤Ÿè®¿é—®çš„æ‰€æœ‰è¿™äº›èµ„æ–™ã€‚ (b) æœ¬åº”ç”¨äº¦ä¸å…è®¸ä»»ä½•ç¬¬ä¸‰æ–¹ä»¥ä»»ä½•æ‰‹æ®µæ”¶é›†ã€ç¼–è¾‘ã€å‡ºå”®æˆ–è€…æ— å¿ä¼ æ’­æ‚¨çš„ä¸ªäººä¿¡æ¯ã€‚ä»»ä½•æœ¬åº”ç”¨å¹³å°ç”¨æˆ·å¦‚ä»äº‹ä¸Šè¿°æ´»åŠ¨ï¼Œä¸€ç»å‘ç°ï¼Œæœ¬åº”ç”¨æœ‰æƒç«‹å³ç»ˆæ­¢ä¸è¯¥ç”¨æˆ·çš„æœåŠ¡åè®®ã€‚ (c) ä¸ºæœåŠ¡ç”¨æˆ·çš„ç›®çš„ï¼Œæœ¬åº”ç”¨å¯èƒ½é€šè¿‡ä½¿ç”¨æ‚¨çš„ä¸ªäººä¿¡æ¯ï¼Œå‘æ‚¨æä¾›æ‚¨æ„Ÿå…´è¶£çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºå‘æ‚¨å‘å‡ºäº§å“å’ŒæœåŠ¡ä¿¡æ¯ï¼Œæˆ–è€…ä¸æœ¬åº”ç”¨åˆä½œä¼™ä¼´å…±äº«ä¿¡æ¯ä»¥ä¾¿ä»–ä»¬å‘æ‚¨å‘é€æœ‰å…³å…¶äº§å“å’ŒæœåŠ¡çš„ä¿¡æ¯ï¼ˆåè€…éœ€è¦æ‚¨çš„äº‹å…ˆåŒæ„ï¼‰ã€‚ 3. ä¿¡æ¯æŠ«éœ² åœ¨å¦‚ä¸‹æƒ…å†µä¸‹ï¼Œæœ¬åº”ç”¨å°†ä¾æ®æ‚¨çš„ä¸ªäººæ„æ„¿æˆ–æ³•å¾‹çš„è§„å®šå…¨éƒ¨æˆ–éƒ¨åˆ†çš„æŠ«éœ²æ‚¨çš„ä¸ªäººä¿¡æ¯ï¼š (a) ç»æ‚¨äº‹å…ˆåŒæ„ï¼Œå‘ç¬¬ä¸‰æ–¹æŠ«éœ²ï¼› (b)ä¸ºæä¾›æ‚¨æ‰€è¦æ±‚çš„äº§å“å’ŒæœåŠ¡ï¼Œè€Œå¿…é¡»å’Œç¬¬ä¸‰æ–¹åˆ†äº«æ‚¨çš„ä¸ªäººä¿¡æ¯ï¼› (c) æ ¹æ®æ³•å¾‹çš„æœ‰å…³è§„å®šï¼Œæˆ–è€…è¡Œæ”¿æˆ–å¸æ³•æœºæ„çš„è¦æ±‚ï¼Œå‘ç¬¬ä¸‰æ–¹æˆ–è€…è¡Œæ”¿ã€å¸æ³•æœºæ„æŠ«éœ²ï¼› (d) å¦‚æ‚¨å‡ºç°è¿åä¸­å›½æœ‰å…³æ³•å¾‹ã€æ³•è§„æˆ–è€…æœ¬åº”ç”¨æœåŠ¡åè®®æˆ–ç›¸å…³è§„åˆ™çš„æƒ…å†µï¼Œéœ€è¦å‘ç¬¬ä¸‰æ–¹æŠ«éœ²ï¼› (e) å¦‚æ‚¨æ˜¯é€‚æ ¼çš„çŸ¥è¯†äº§æƒæŠ•è¯‰äººå¹¶å·²æèµ·æŠ•è¯‰ï¼Œåº”è¢«æŠ•è¯‰äººè¦æ±‚ï¼Œå‘è¢«æŠ•è¯‰äººæŠ«éœ²ï¼Œä»¥ä¾¿åŒæ–¹å¤„ç†å¯èƒ½çš„æƒåˆ©çº çº·ï¼› (f) åœ¨æœ¬åº”ç”¨å¹³å°ä¸Šåˆ›å»ºçš„æŸä¸€äº¤æ˜“ä¸­ï¼Œå¦‚äº¤æ˜“ä»»ä½•ä¸€æ–¹å±¥è¡Œæˆ–éƒ¨åˆ†å±¥è¡Œäº†äº¤æ˜“ä¹‰åŠ¡å¹¶æå‡ºä¿¡æ¯æŠ«éœ²è¯·æ±‚çš„ï¼Œæœ¬åº”ç”¨æœ‰æƒå†³å®šå‘è¯¥ç”¨æˆ·æä¾›å…¶äº¤æ˜“å¯¹æ–¹çš„è”ç»œæ–¹å¼ç­‰å¿…è¦ä¿¡æ¯ï¼Œä»¥ä¿ƒæˆäº¤æ˜“çš„å®Œæˆæˆ–çº çº·çš„è§£å†³ã€‚ (g) å…¶å®ƒæœ¬åº”ç”¨æ ¹æ®æ³•å¾‹ã€æ³•è§„æˆ–è€…ç½‘ç«™æ”¿ç­–è®¤ä¸ºåˆé€‚çš„æŠ«éœ²ã€‚ 4. ä¿¡æ¯å­˜å‚¨å’Œäº¤æ¢ æœ¬åº”ç”¨æ”¶é›†çš„æœ‰å…³æ‚¨çš„ä¿¡æ¯å’Œèµ„æ–™å°†ä¿å­˜åœ¨æœ¬åº”ç”¨åŠï¼ˆæˆ–ï¼‰å…¶å…³è”å…¬å¸çš„æœåŠ¡å™¨ä¸Šï¼Œè¿™äº›ä¿¡æ¯å’Œèµ„æ–™å¯èƒ½ä¼ é€è‡³æ‚¨æ‰€åœ¨å›½å®¶ã€åœ°åŒºæˆ–æœ¬åº”ç”¨æ”¶é›†ä¿¡æ¯å’Œèµ„æ–™æ‰€åœ¨åœ°çš„å¢ƒå¤–å¹¶åœ¨å¢ƒå¤–è¢«è®¿é—®ã€å­˜å‚¨å’Œå±•ç¤ºã€‚ 5. Cookieçš„ä½¿ç”¨ (a) åœ¨æ‚¨æœªæ‹’ç»æ¥å—cookiesçš„æƒ…å†µä¸‹ï¼Œæœ¬åº”ç”¨ä¼šåœ¨æ‚¨çš„è®¡ç®—æœºä¸Šè®¾å®šæˆ–å–ç”¨cookies ï¼Œä»¥ä¾¿æ‚¨èƒ½ç™»å½•æˆ–ä½¿ç”¨ä¾èµ–äºcookiesçš„æœ¬åº”ç”¨å¹³å°æœåŠ¡æˆ–åŠŸèƒ½ã€‚æœ¬åº”ç”¨ä½¿ç”¨cookieså¯ä¸ºæ‚¨æä¾›æ›´åŠ å‘¨åˆ°çš„ä¸ªæ€§åŒ–æœåŠ¡ï¼ŒåŒ…æ‹¬æ¨å¹¿æœåŠ¡ã€‚ (b) æ‚¨æœ‰æƒé€‰æ‹©æ¥å—æˆ–æ‹’ç»æ¥å—cookiesã€‚æ‚¨å¯ä»¥é€šè¿‡ä¿®æ”¹æµè§ˆå™¨è®¾ç½®çš„æ–¹å¼æ‹’ç»æ¥å—cookiesã€‚ä½†å¦‚æœæ‚¨é€‰æ‹©æ‹’ç»æ¥å—cookiesï¼Œåˆ™æ‚¨å¯èƒ½æ— æ³•ç™»å½•æˆ–ä½¿ç”¨ä¾èµ–äºcookiesçš„æœ¬åº”ç”¨ç½‘ç»œæœåŠ¡æˆ–åŠŸèƒ½ã€‚ (c) é€šè¿‡æœ¬åº”ç”¨æ‰€è®¾cookiesæ‰€å–å¾—çš„æœ‰å…³ä¿¡æ¯ï¼Œå°†é€‚ç”¨æœ¬æ”¿ç­–ã€‚","link":"/private_protocol.html"},{"title":"åˆ†ç±»","text":"","link":"/categories/index.html"},{"title":"â˜ï¸ æ ‡ç­¾","text":"","link":"/tags/index.html"}],"posts":[{"title":"æ­å»ºWebæœåŠ¡å™¨(nginx)","text":"å‰è¨€ DNSPodåŸŸåè§£ææœ‰ä¸€å¤©å¤šéƒ½å¤±è´¥äº†,æœåŠ¡å™¨ä¹Ÿå®•æœºäº†,å…¬ä¼—å·ä¹Ÿæ²¡åŠæ³•è·å¾—æƒ…å†µ,æç¤ºæš‚æ—¶æ— æ³•æœåŠ¡,ä¸çŸ¥é“å‡ºä»€ä¹ˆé—®é¢˜äº†,ä¸Šç½‘æŸ¥äº†ä¸€ä¸‹,DNSPodå¦‚æœè§£æå¤±è´¥,å¯ä»¥æŒ‡å‘å¦ä¸€ä¸ªå¤‡ç”¨ip,æ­£å¥½VPSæä¾›ç‹¬ç«‹ip,æƒ³å°è¯•åœ¨VPSæä¾›çš„æœåŠ¡å™¨ä¸Šæ­å»ºWebæœåŠ¡å™¨ã€‚ Macè‡ªå¸¦äº†apacheæœåŠ¡å™¨,è€ƒè™‘æ¢ä¸€ç§æœåŠ¡å™¨æ¥è¯•è¯•,æ¯”å¦‚nginxã€‚ ç¯å¢ƒ CentOS release 6.6 (Final)macOS Sierra 10.12.3 æµç¨‹nginxå®‰è£…éå¸¸ç®€å• é…ç½®12$ cd /etc/yum.repos.d/$ vim nginx.repo å› ä¸ºæˆ‘ä¸æ˜¯ç”¨rootç™»é™†,æ‰€ä»¥åé¢åˆ›å»ºnginx.repoæ–‡ä»¶æ˜¯æ— æ³•å†™å…¥ç›®å½•çš„,ä¿®æ”¹ä¸€ä¸‹,å‰é¢æ·»åŠ sudo 1$ sudo vim nginx.repo åœ¨æ–°å»ºçš„nginx.repoæ–‡ä»¶ä¸­,æ·»åŠ  12345[nginx]name=nginx repobaseurl=http://nginx.org/packages/centos/$releasever/$basearch/gpgcheck=0enabled=1 ä¿å­˜åyum.repos.dç›®å½•ä¸‹ä¼šå‡ºç°nginx.repoæ–‡ä»¶ å®‰è£…ç„¶åæ‰§è¡Œ 1$ sudo yum install nginx -y å¯åŠ¨æœåŠ¡1$ sudo /etc/init.d/nginx start ç°åœ¨nginxå·²ç»å¯åŠ¨äº†ï¼Œç›´æ¥è®¿é—®æœåŠ¡å™¨å°±èƒ½çœ‹åˆ°nginxæ¬¢è¿é¡µé¢äº†çš„ã€‚ nginxçš„ç›®å½•ä¸Šé¢çš„æ•ˆæœå›¾çš„å®é™…é¡µé¢åœ¨ /usr/share/nginx/html/index.html æˆ‘ä½¿ç”¨çš„blogå¼•æ“æ˜¯Hexo,å®ƒæ˜¯æŠŠblogè·¯å¾„ä¸‹çš„publicç›®å½•çš„å†…å®¹æäº¤åˆ°æœåŠ¡å™¨,æ‰€ä»¥å…ˆæ…¢æ…¢æ¥,æˆ‘å…ˆæŠŠpublicç›®å½•çš„å†…å®¹ä¼ åˆ°è¿œç¨‹æœåŠ¡å™¨,æµ‹è¯•ä¸€ä¸‹æ•ˆæœ å¤±è´¥1Â» ~ (npm:0.0.0)scp -i ~/.ssh/id_vps -P xxxx ./public/* Jason@xxx.xxx.xxx.xxx:/usr/share/nginx/html/ ä¸èƒ½ä¼ é€’æ–‡ä»¶å¤¹ æƒé™é—®é¢˜ æˆåŠŸå¥½å§,å…ˆå‹ç¼© 1Â» ~ (npm:0.0.0) tar -cvzf blog.tar.gz ./public æƒé™é—®é¢˜,å› ä¸ºä¸æ˜¯root,æ‰€ä»¥è¦ä¹ˆä¿®æ”¹è¿œç¨‹æœåŠ¡å™¨çš„ç›®å½•æƒé™,æˆ–è€…æ˜¯æˆ‘å…ˆæŠŠåŒ…ä¼ åˆ°/tmpé€‰æ‹©äº†åè€… 1Â» ~ (npm:0.0.0)sudo scp -i ~/.ssh/id_vps -P xxxxx blog.tar.gz Jason@xxx.xxx.xxx.xxx:/tmp å‘é€æˆåŠŸ åˆ°è¿œç¨‹ç›®å½•,è§£å‹,å¤åˆ¶,ç²˜è´´åˆ°/usr/share/nginx/html/ 12$ tar -xvf blog.tar.gz$ sudo cp ./public/* /usr/share/nginx/html/ è®¿é—®è¿œç¨‹æœåŠ¡å™¨ DNSPodåˆšåˆšæµ‹è¯•äº†ä¸€ä¸‹,å±…ç„¶å·²ç»æ¢å¤äº†,ä¸è¿‡æ²¡äº‹å„¿,å®ƒæ¢å¤å®ƒçš„,æˆ‘è®¾ç½®æˆ‘çš„ã€‚ ç™»é™†DNSPodå®˜ç½‘ é€‰æ‹©Dç›‘æ§ é€‰æ‹©ç›‘æ§è®¾ç½®(å·²æ·»åŠ äº†Dç›‘æ§) ç‚¹å‡»ä¿®æ”¹è®¾ç½® ç‚¹å‡»ä¿®æ”¹æŒ‰é’® ä½†æ˜¯æ²¡åŠæ³•ç‚¹å‡»,æˆ‘ä»¥ä¸ºæ˜¯æˆ‘çš„æ“ä½œæœ‰é—®é¢˜ã€‚åœ¨ç½‘ä¸Šæ‰¾äº†ä¸€ä¸‹,DNSPODè®¾ç½®è‡ªåŠ¨åˆ‡æ¢IPä¹Ÿæ˜¯è¿™ä¹ˆæ“ä½œçš„,çœ‹Dç›‘æ§åˆ‡æ¢è§„åˆ™,ä¹Ÿæ²¡æœ‰æåˆ°è¿™ä¸€èŒ¬ã€‚ æŸ¥çœ‹äº†ä¸€ä¸‹ç½‘é¡µæºä»£ç  å»æ‰disabled=â€œdisabledâ€,é€‰ä¸­å,ç•Œé¢å˜æˆ å°±èƒ½è¾“å…¥äº†,ä¸çŸ¥é“å•¥æƒ…å†µ,è¾“å…¥è¿œç¨‹æœåŠ¡å™¨çš„ip,ç‚¹å‡»ç¡®å®š å¥½å§,çœ‹æ¥å…è´¹çš„ç”¨æˆ·æ˜¯ä¸å…è®¸è®¾ç½®å¤‡ç”¨ip,æ–‡æ¡£ä¸­ä¹Ÿæ²¡è¯´æ˜å·®è¯„ã€‚ å½“ç„¶ç°åœ¨è¿™æ ·çš„ä½“éªŒè¿˜ä¸å¥½,è¿˜éœ€è¦ç”¨sshæŠŠpublicç›®å½•æäº¤åˆ°è¿œç¨‹æœåŠ¡å™¨çš„æŒ‡å®šç›®å½•,æœ¬æ¥sudo hexo dä¸€å¥è¯çš„äº‹æƒ…,è¦å˜æˆå¥½å‡ ä»¶,ç•¥å¾®éº»çƒ¦äº›,è€Œä¸”å› ä¸ºåŸŸåè§£æçš„é—®é¢˜,ä¸èƒ½æµç•…çš„åˆ‡æ¢,æ‰“ç®—è¿‡äº›æ—¶é—´æ‰¾åˆ°åˆé€‚çš„DNSæœåŠ¡å™¨å†ç»§è€ƒè™‘ã€‚ å‚è€ƒ centos 6.5 nginxå®‰è£…ä¸é…ç½® Dç›‘æ§åˆ‡æ¢è§„åˆ™","link":"/2017/02/24/Technology-Building-a-Web-server-by-nginx/"},{"title":"ç†è§£HTTPSåè®®","text":"å®šä¹‰HTTPS*ï¼ˆä¹Ÿç§°ä¸º *HTTP over TLS ï¼ŒHTTP over SSL ï¼Œå’Œ HTTP Secure ï¼‰æ˜¯ç”¨äºåœ¨å› ç‰¹ç½‘ä¸Šå¹¿æ³›ä½¿ç”¨çš„è®¡ç®—æœºç½‘ç»œä¸Šçš„å®‰å…¨é€šä¿¡çš„åè®®ã€‚HTTPS é€šè¿‡ TLS æˆ–å…¶å‰èº«çš„ SSL å®ç°è¶…æ–‡æœ¬ä¼ è¾“â€‹â€‹åè®®ï¼ˆHTTPï¼‰çš„å®‰å…¨ä¼ è¾“ã€‚ åœ¨å¯†ç å­¦ä¸­ï¼ŒåŠ å¯†ï¼ˆè‹±è¯­ï¼šEncryption ï¼‰æ˜¯å°†æ˜æ–‡ä¿¡æ¯æ”¹å˜ä¸ºéš¾ä»¥è¯»å–çš„å¯†æ–‡å†…å®¹ï¼Œä½¿ä¹‹ä¸å¯è¯»ã€‚åªæœ‰æ‹¥æœ‰è§£å¯†æ–¹æ³•çš„å¯¹è±¡ï¼Œç»ç”±è§£å¯†è¿‡ç¨‹ï¼Œæ‰èƒ½å°†å¯†æ–‡è¿˜åŸä¸ºæ­£å¸¸å¯è¯»çš„å†…å®¹ã€‚ å¯¹ç§°åŠ å¯† &amp; éå¯¹ç§°åŠ å¯†åœ¨ç°ä»£åŠ å¯†ä½“åˆ¶ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼: å¯¹ç§°åŠ å¯†,å³åœ¨åŠ å¯†ä¸è§£å¯†çš„è¿‡ç¨‹ä¸­ä½¿ç”¨ç›¸åŒçš„åŠ å¯†å¯†é’¥ (cryptographic keys) çš„ç®—æ³•,æ¯”å¦‚ DESã€RC4ã€AESã€‚ éå¯¹ç§°/å…¬å¼€åŠ å¯†,ä¼šä½¿ç”¨ä¸€å¯¹å¯†é’¥ï¼Œåˆ†åˆ«å‘½åä¸ºå…¬é’¥ä¸ç§é’¥ï¼Œä¸¤ä¸ªå¯†é’¥å¯ä»¥äº’ç›¸åŠ è§£å¯†ã€‚å¤–éƒ¨å¯ä»¥è·å–å…¬é’¥ï¼Œä½†ç§é’¥ä¸€èˆ¬åªæœ‰æ‰€æœ‰è€…æ‰çŸ¥é“ã€‚æˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„éå¯¹ç§°åŠ å¯†åº”è¯¥å°±æ˜¯ RSA å§ã€‚ ä¼˜ç¼ºç‚¹å¯¹ç§°åŠ å¯†çš„ç¼ºç‚¹ä¸»è¦åœ¨äºå¯†é’¥å¿…é¡»åŒæ–¹å…±äº«ï¼Œå¦åˆ™æ— æ³•å®ç°åŠ è§£å¯†ï¼Œåªè¦å…¶ä¸­ä¸€æ–¹(ä¸»è¦æŒ‡å®¢æˆ·ç«¯)æš´éœ²äº†å¯†é’¥ï¼ŒåŠ å¯†è¿‡ç¨‹å°±ä¸å®‰å…¨äº†ï¼Œéå¯¹ç§°åŠ å¯†å…‹æœäº†è¿™ä¸€ç‚¹ï¼Œå®¢æˆ·ç«¯è·å¾—çš„æ˜¯æœåŠ¡å™¨çš„å…¬é’¥ï¼Œæœ¬æ¥å°±æ˜¯å…¬å¼€çš„ï¼Œè¢«äººè·å–ä¹Ÿä¸å½±å“ã€‚è™½ç„¶éå¯¹ç§°åŠ å¯†æœ‰è¿™ä¸ªå¥½å¤„,ä½†æ˜¯å®ƒçš„åŠ å¯†çš„æ•ˆç‡æ¯”å¯¹ç§°åŠ å¯†é€Šè‰²ã€‚æ‰€ä»¥åœ¨ HTTPS ä¸­ä¸¤è€…éƒ½è¢«ä½¿ç”¨åˆ°äº†ã€‚è®¤è¯è¿‡ç¨‹é‡‡ç”¨äº†éå¯¹ç§°åŠ å¯†ï¼Œè€Œå®é™…æ•°æ®çš„ä¼ è¾“ä½¿ç”¨äº†å¯¹ç§°åŠ å¯†ã€‚ éå¯¹ç§°åŠ å¯†çš„ç”¨é€” å…¬é’¥åŠ å¯† + ç§é’¥è§£å¯† ç”¨äºé€šä¿¡åŠ å¯†ç§é’¥åŠ å¯† + å…¬é’¥è§£å¯† ç”¨äºèº«ä»½è®¤è¯ å› æ­¤æœåŠ¡å™¨ç”¨ç§é’¥åŠ å¯†çš„å†…å®¹ï¼Œåªè¦æŒæœ‰å…¬é’¥ï¼Œéƒ½æ˜¯å¯ä»¥è§£å¯†çš„ SSL æ¡æ‰‹æµç¨‹ å›¾ç‰‡æ¥è‡ªwiki - ä¼ è¾“å±‚å®‰å…¨åè®®ï¼Œæè¿°çš„æ˜¯ SSL çš„æ¡æ‰‹æµç¨‹ã€‚ åå•†åŠ å¯†ç®—æ³• å®¢æˆ·ç«¯å‘é€ ClientHello æ¶ˆæ¯ï¼ŒåŒ…å«æ”¯æŒçš„åè®®ç‰ˆæœ¬ï¼ŒåŠ å¯†å’Œå‹ç¼©ç®—æ³•ç­‰ï¼Œä¸€ä¸ªå®¢æˆ·ç«¯ç”Ÿæˆçš„éšæœºæ•° RNcã€‚ æœåŠ¡å™¨æ”¶åˆ° ClientHello æ¶ˆæ¯åï¼Œå‘é€ ServerHello ç¡®å®šè¦é‡‡ç”¨çš„åè®®ç‰ˆæœ¬ï¼ŒåŠ å¯†å’Œå‹ç¼©ç®—æ³•ç­‰ï¼ŒåŒæ—¶ç”Ÿæˆä¸€ä¸ªéšæœºæ•° RNsã€‚ RNc ä¸ RNs å°†ç”¨äºå‚ä¸åé¢çš„ ç”Ÿæˆå¯¹ç§°åŠ å¯†å¯†é’¥ è¿‡ç¨‹ äº¤æ¢è¯ä¹¦ å…³äºè¯ä¹¦ï¼Œåœ¨æ­¤å¤„å¯ç†è§£ä¸ºä¸€ç§èº«ä»½è®¤è¯çš„æ–¹å¼ï¼Œåé¢è¯´æ˜ æœåŠ¡å™¨ä¼šå‘é€è¯ä¹¦(åŒ…å«è‡ªèº«çš„å…¬é’¥)å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå¹¶è¦æ±‚å®¢æˆ·ç«¯è¯ä¹¦ å®¢æˆ·ç«¯ä¼šæ ¡éªŒæœåŠ¡å™¨å‘é€çš„è¯ä¹¦æ˜¯å¦å¯ä¿¡ï¼Œå¦‚æœä¸å¯ä¿¡ï¼Œåˆ™å…³é—­è¿æ¥ï¼Œè‹¥å¯ä¿¡ï¼Œç»§ç»­æ‰§è¡Œ å®¢æˆ·ç«¯ä¼šå‘é€è¯ä¹¦(åŒ…å«è‡ªèº«çš„å…¬é’¥)åˆ°æœåŠ¡å™¨ï¼Œè¿™åœ¨åŒå‘è®¤è¯æ—¶è¦æ±‚ï¼Œä¸€èˆ¬æƒ…å†µä¸‹åªè¦å‘é€éšæœºç”Ÿæˆçš„å…¬é’¥å³å¯ï¼Œä¸»è¦è¿˜æ˜¯è¦ç¡®è®¤æœåŠ¡å™¨æ˜¯å®‰å…¨å¯ä¿¡çš„ã€‚ æœåŠ¡å™¨æ£€éªŒå®¢æˆ·ç«¯è¯ä¹¦ï¼Œè·å¾—å…¬é’¥ï¼Œç»§ç»­æ‰§è¡Œ å®¢æˆ·ç«¯ä¼šå°†åˆšæ‰å‘é€çš„ä¿¡æ¯è¿›è¡Œ hash å¹¶ç”¨è‡ªå·±çš„ç§é’¥è¿›è¡ŒåŠ å¯†/ç­¾åï¼Œ æœåŠ¡å™¨æ¥æ”¶åä¼šç”¨å¾—åˆ°çš„å®¢æˆ·ç«¯çš„å…¬é’¥å…ˆè§£å¯†å¹¶ç”¨ç›¸åŒçš„ç®—æ³•è¿›è¡Œ hash æ¯”è¾ƒç»“æœ æœ€åçš„ä¸¤æ­¥ï¼Œæˆ‘ä¸ç¡®å®šç”¨é€”ï¼Œåªèƒ½æ£æµ‹æ˜¯ä¸ºäº†è¯æ˜æœåŠ¡å™¨å·²ç»æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„å…¬é’¥åŒæ—¶ç®—æ³•éƒ½æ²¡æœ‰é—®é¢˜ã€‚ ç”Ÿæˆå¯¹ç§°åŠ å¯†å¯†é’¥åœ¨RFC 2246 - The TLS Protocol Version 1.0 ä¸­,æœ‰å¦‚ä¸‹çš„ä¸€æ®µè¯ 7.4.7.1. RSA encrypted premaster secret messageâ€¦Structure of this message: struct { ProtocolVersion client_version; opaque random[46]; } PreMasterSecret; client_version The latest (newest) version supported by the client. This is used to detect version roll-back attacks. Upon receiving the premaster secret, the server should check that this value matches the value transmitted by the client in the client hello message. random 46 securely-generated random bytes. å› æ­¤ pre master key çš„ç»“æ„ä¸º 2 å­—èŠ‚åè®®ç‰ˆæœ¬ï¼ŒåŒ¹é…å®¢æˆ·ç«¯ä¸€å¼€å§‹å‘é€ ClientHello æ—¶æ‰€æä¾›çš„ä¿¡æ¯ï¼Œ46 å­—èŠ‚éšæœºæ•°ã€‚å®ƒçš„ä½œç”¨æ˜¯ä¸ºäº†ä¸åå•†åŠ å¯†ç®—æ³•é˜¶æ®µä¸­éšæœºç”Ÿæˆçš„ä¸¤ä¸ªæ•° RNc å’Œ RNs ç»„åˆï¼Œæœ€ç»ˆç”Ÿæˆæœ¬æ¬¡ä¼šè¯ä¸­ç”¨äºå¯¹ç§°åŠ å¯†çš„å¯†é’¥( Master secret )ã€‚ Generate a master secret from the premaster secret and exchanged random values. å®¢æˆ·ç«¯ç”Ÿæˆ pre master keyï¼Œå¹¶é€šè¿‡æœåŠ¡å™¨çš„å…¬é’¥åŠ å¯†åå‘é€ç»™æœåŠ¡å™¨ æœåŠ¡å™¨ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†ï¼ŒåŒæ–¹ç°åœ¨éƒ½æœ‰ pre master key + RNc + RNs å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä½¿ç”¨ç›¸åŒçš„ç®—æ³•å°† pre master key + RNc + RNs å„è‡ªè¿›è¡Œè®¡ç®—ï¼Œç”Ÿæˆ Master secret å®¢æˆ·ç«¯é€šçŸ¥æœåŠ¡å™¨æ¥ä¸‹æ¥çš„é€šä¿¡ç”¨ Master secret åšä¸ºå¯¹ç§°åŠ å¯†çš„å¯†é’¥ï¼Œç»“æŸ SSL æ¡æ‰‹é€šä¿¡ æœåŠ¡å™¨æ”¶åˆ°æ¶ˆæ¯åï¼ŒåŒæ ·å‘é€æ¶ˆæ¯åˆ°å®¢æˆ·ç«¯ï¼Œç¡®è®¤ä½¿ç”¨ Master secret ä¸ºå¯¹ç§°åŠ å¯†çš„å¯†é’¥ï¼Œç»“æŸ SSL æ¡æ‰‹é€šä¿¡ã€‚ æ•°å­—è¯ä¹¦ä¸ºä»€ä¹ˆåœ¨ HTTPS ä¼šè¯ä¸­è¦ç”¨åˆ°æ•°å­—è¯ä¹¦ï¼Ÿ æˆ‘ä»¬çœ‹åˆ°äº¤æ¢è¯ä¹¦çš„è¿‡ç¨‹ä¸­æœåŠ¡å™¨å‘é€çš„è¯ä¹¦ä¸­åŒ…å«äº†å®ƒçš„å…¬é’¥ï¼Œè¯•æƒ³å¦‚æœæœ‰ä¸æ€€å¥½æ„çš„ä¸­é—´äººæ‹¦æˆªäº†è¯·æ±‚ï¼Œä¸å®¢æˆ·ç«¯åå•†äº†åŠ å¯†çš„ç®—æ³•ï¼Œæ¥æ”¶ RNc å¹¶å‘é€ RNs ,ç„¶åå°†è‡ªå·±çš„å…¬é’¥å‘é€ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯ä¸åšæ ¡éªŒå°±æ¥æ”¶äº†ï¼Œé‚£åé¢çš„æ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯ä¸å®‰å…¨çš„ã€‚æ‰€ä»¥éœ€è¦ä¸€ä¸ªå‡­è¯è®©å®¢æˆ·ç«¯æ¥éªŒè¯è¿™ä¸ªå…¬é’¥æ˜¯ä¸æ˜¯å±äºä¸å…¶é€šä¿¡çš„æœåŠ¡å™¨ã€‚ æ•°å­—è¯ä¹¦å°±å……å½“äº†è¿™ä¸ªæä¾›å‡­è¯çš„è§’è‰² å®šä¹‰åœ¨wiki-ç”µå­è¯ä¹¦ä¸­è¡¨æ˜äº†æ•°å­—è¯ä¹¦å¹¶éæ•°å­—èº«ä»½è¯ï¼Œè€Œæ˜¯èº«ä»½è®¤è¯æœºæ„ç›–åœ¨æ•°å­—èº«ä»½è¯ä¸Šçš„ä¸€ä¸ªç« æˆ–å°ï¼ˆæˆ–è€…è¯´åŠ åœ¨æ•°å­—èº«ä»½è¯ä¸Šçš„ä¸€ä¸ªç­¾åï¼‰ï¼Œè¿™ä¸€è¡Œä¸ºè¡¨ç¤ºèº«ä»½è®¤è¯æœºæ„å·²è®¤å®šè¿™ä¸ªæŒè¯äººã€‚ æ —å­æ‰“å¼€é’¥åŒ™ä¸²ï¼ŒæŸ¥çœ‹ä¸€ä¸ªæ•°å­—è¯ä¹¦ CACA (certificate authority) å°±æ˜¯ä¸€ä¸ªæä¾›èº«ä»½è®¤è¯çš„æœºæ„ï¼Œä¸ºä»€ä¹ˆä¿¡ä»» CA*ï¼Œè¯ä¹¦çš„ä¿¡ä»»æ˜¯é“¾å¼çš„å‘ä¸Šä¼ é€’ã€‚åœ¨ *mac ä¸Šå¼€å‘è€…è¯ä¹¦çš„ä¿¡ä»»é—®é¢˜æœ€ç»ˆä¼šèµ°åˆ°è‹¹æœçš„æ ¹è¯ä¹¦ä¸Šï¼Œå› ä¸ºæˆ‘ä»¬ä¿¡ä»»äº†è¿™ä¸ªè¯ä¹¦ï¼Œæ‰€ä»¥åé¢è‹¹æœæœåŠ¡å™¨( CA )ç­¾åçš„è¯ä¹¦æˆ‘ä»¬ä¹Ÿä¼šä¿¡ä»»ã€‚ è€Œå¯¹äº 12306 ç½‘ç«™æµè§ˆå™¨ä¹‹æ‰€ä»¥ä¼šå¼¹å‡º åŒæ ·æ˜¯å› ä¸ºç³»ç»Ÿä¸ä¿¡ä»» 12306 çš„æ ¹è¯ä¹¦ SRCA ,æ‰€ä»¥ç”±å®ƒç­¾å‘çš„ kyfw.12306.cn è¯ä¹¦ä¹Ÿæ˜¯ä¸å—ä¿¡ä»»çš„ã€‚ csr (Certificate Signing request) What is a CSR? A CSR or Certificate Signing request is a block of encoded text that is given to a Certificate Authority when applying for an SSL Certificate. It is usually generated on the server where the certificate will be installed and contains information that will be included in the certificate such as the organization name, common name (domain name), locality, and country. It also contains the public key that will be included in the certificate. A private key is usually created at the same time that you create the CSR, making a key pair. A CSR is generally encoded using ASN.1 according to the PKCS #10 specification. æˆ‘ä»¬é€šè¿‡é’¥åŒ™ä¸²åˆ›å»ºçš„ csr æ–‡ä»¶ä¼šåŒ…å«äº†ç»„ç»‡åï¼ŒåŸŸåï¼Œå›½å®¶ç­‰ä¿¡æ¯ï¼ŒåŒæ—¶è¿˜åŒ…å«äº†å…¬é’¥ã€‚åœ¨ç”Ÿæˆ csr æ–‡ä»¶æ—¶ä¹Ÿç”Ÿæˆäº†å¯¹åº”çš„ç§é’¥ï¼Œä¿å­˜åœ¨é’¥åŒ™ä¸²ä¸­ã€‚ æ€»ç»“æˆ‘ä»¬å¹³æ—¶é€šè¿‡é’¥åŒ™ä¸²é€šè¿‡åˆ›å»º csr è¯·æ±‚æ–‡ä»¶çš„è¡Œä¸ºï¼Œå®é™…ä¸Šæ˜¯å°†è‡ªèº«ä¿¡æ¯å’Œç”Ÿæˆçš„å…¬é’¥æ”¾åˆ°å…¶ä¸­ï¼Œå‘é€ç»™è‹¹æœæœåŠ¡å™¨åï¼Œè‹¹æœæœåŠ¡å™¨ä¼šä½¿ç”¨è‡ªå·±çš„ç§é’¥å¯¹å…¶è¿›è¡Œç­¾åï¼Œç”Ÿæˆ cer æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¸‹è½½åˆ°å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å‘ç°è¯¥è¯ä¹¦æ˜¯å¯ä¿¡çš„ï¼Œå°±ä»é’¥åŒ™ä¸²ä¸­æ‰¾åˆ°å¹¶ä¸å®ƒçš„ç§é’¥ä¸€èµ·è¿›è¡Œé…ç½®ã€‚ è‹¹æœæœåŠ¡å™¨åœ¨è¿™ä¸ªåœºæ™¯ä¸‹å®é™…å……å½“äº† CA çš„è§’è‰²ï¼Œè‹¥æ˜¯æœåŠ¡å™¨æœ¬èº«è‡ªå·±åš CA è¿›è¡Œç­¾åä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¿™ç§æƒ…å†µä¸‹ç§°ä¸ºè‡ªç­¾åï¼Œä½†æ˜¯åœ¨ HTTPS çš„ä¼šè¯ä¸­å¯¹è¯ä¹¦è¿›è¡Œæ ¡éªŒæ—¶ä¸€èˆ¬ä¼šå¤±è´¥ï¼Œå®¢æˆ·ç«¯éœ€è¦æ“ä½œä¿¡ä»»è¯¥è¯ä¹¦ã€‚ åˆ°è¿™é‡Œï¼Œå¤§è‡´å¯ä»¥æ€»ç»“å‡ºæ•°å­—è¯ä¹¦çš„äº§ç”Ÿè¿‡ç¨‹ åœ¨ HTTPS åè®®ä¸­ï¼Œå®¢æˆ·ç«¯çš„è¯ä¹¦éªŒè¯ä¸ä¸Šé¢çš„åœºæ™¯ç±»ä¼¼ï¼ŒæœåŠ¡å™¨é¢„å…ˆä» CA é‚£è·å¾—æ•°å­—è¯ä¹¦ï¼Œå½“å®¢æˆ·ç«¯è¦æ±‚è¯ä¹¦æ—¶ï¼Œå°†è¯¥è¯ä¹¦è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œåªè¦å®¢æˆ·ç«¯ä¿¡ä»» CA , å°±å¯ä»¥é€šè¿‡ CA çš„å…¬é’¥è§£å¯†å‡ºæœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦( CA ç”¨ç§é’¥ç­¾åæœåŠ¡å™¨çš„ä¸€äº›ä¿¡æ¯ä¸å…¬é’¥)ï¼Œä»è€Œå¾—åˆ°å…¬é’¥ï¼ŒåŒæ—¶åˆ¤å®šå…¬é’¥æ˜¯æ¥è‡ªæœåŠ¡å™¨çš„ã€‚ ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœä¸­é—´äººä¹Ÿè¯·æ±‚äº† CA ç”Ÿæˆäº†å¯¹åº”çš„è¯ä¹¦ï¼Œå®¢æˆ·ç«¯ä¾ç„¶æ— æ³•ç¡®å®šå…¬é’¥æ˜¯æ¥è‡ªæœåŠ¡å™¨çš„ï¼Œè¿˜æœ‰æ˜¯å¦æœ‰è¢«ä¿®æ”¹ã€‚ å‚è€ƒ ä¹Ÿè®¸ï¼Œè¿™æ ·ç†è§£HTTPSæ›´å®¹æ˜“ è¿™ç¯‡æ–‡ç« å¯çŸ¥ï¼Œè¦ç”±å®¢æˆ·ç«¯è´Ÿè´£å»æ ¡éªŒè¯ä¹¦æ˜¯å¦åˆæ³•ã€‚ å…·ä½“æ–¹å¼æ˜¯å®¢æˆ·ç«¯å¾—åˆ°è¯ä¹¦åï¼Œæ ¹æ®è¯ä¹¦çš„å†…å®¹(æ¯”å¦‚è¯´æœåŠ¡å™¨åŸŸå)å’Œç®—æ³•ï¼Œå®¢æˆ·ç«¯å†ç”Ÿæˆä¸€éç­¾åçš„è¿‡ç¨‹ï¼Œç„¶åä¸è¯ä¹¦ç¼–å·è¿›è¡Œæ¯”è¾ƒï¼Œå› ä¸ºæ¯ä¸ªè¯ä¹¦çš„ç¼–å·åº”è¯¥æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥ä¸­é—´äººä¸èƒ½åˆ›å»ºä¸€ä¸ªå’ŒåŸè¯ä¹¦å†…å®¹ä¸åŒï¼Œç„¶åç¼–å·å´ç›¸åŒã€‚å¦‚æœå‡ºç°äº†ï¼Œé‚£ä¹Ÿæ˜¯ç®—æ³•å‡ºçš„é—®é¢˜ï¼Œä¸æ˜¯è®¾è®¡æ€è·¯æœ‰æ¼æ´ã€‚å› æ­¤å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼éªŒè¯å½“å‰è·å¾—çš„è¯ä¹¦æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚ä»è€Œå¾—åˆ°å±äºæœåŠ¡å™¨çš„å…¬é’¥ï¼Œæ¥ç€å†ç»§ç»­ HTTPS ä¼šè¯ã€‚ å®è·µç°åœ¨æ¥åŠ¨æ‰‹æ“ä½œï¼Œé€šè¿‡ Wireshark æ•è· HTTPS è¯·æ±‚æ¥éªŒè¯æ•´ä¸ªæµç¨‹ã€‚å¦‚æœç›´æ¥æ‰‹åŠ¨æ‰“å¼€ Wireshark ç„¶åå°è¯•æ•è· eth0 ç½‘å¡ï¼Œå¯èƒ½ä¼šæŠ¥æƒé™ä¸è¶³çš„æ–¹æ³•ã€‚ç®€å•çš„æ–¹æ³•å°±æ˜¯ç”¨ç»ˆç«¯ç›´æ¥ sudo Wireshark æ‰“å¼€ å› ä¸ºç½‘ç»œçš„ä¿¡æ¯éå¸¸å¤šï¼Œéœ€è¿›è¡Œè¿‡æ»¤ tcp.srcport == 443 or tcp.dstport == 443 æˆ‘ä»¬åªå…³æ³¨èµ° 443 ç«¯å£çš„ tcp åè®® è®¿é—® https://www.baidu.com å‡ºç°äº† Client Hello , Server Hello ç­‰ info ä¾æ¬¡åˆ°é‡Œé¢çœ‹çœ‹ [å®è·µ]Client Hello åè®®ç‰ˆæœ¬ tls 1.2 (0x0303) 2 ä¸ªå­—èŠ‚ éšæœºæ•° RNc : 27ca27â€¦ å®¢æˆ·ç«¯æ”¯æŒçš„åŠ å¯†æ–¹å¼ : TLS_EMPTY_RENEGOTIATION_INFO_SCSV 0x00ffâ€¦ Extension : server_name ä¸‹æœ‰ www.baidu.com [å®è·µ]Server Hello æœåŠ¡å™¨ç¡®å®šäº†åè®®ç‰ˆæœ¬å·,ç”Ÿæˆäº† RNsï¼Œç¡®å®šäº†åŠ å¯†çš„æ–¹æ³• [å®è·µ]è¯ä¹¦äº¤æ¢ æœåŠ¡å™¨å°†åŒ…å«è‡ªå·±å…¬é’¥çš„æ•°å­—è¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ å®¢æˆ·ç«¯éªŒè¯è¯ä¹¦é€šè¿‡åï¼Œå°†å‘é€å…¬é’¥ç»™æœåŠ¡å™¨ [å®è·µ]ç”Ÿæˆå¯¹ç§°åŠ å¯†å¯†é’¥åŒæ–¹äº’ç›¸é€šçŸ¥å¯¹æ–¹ï¼Œå‡†å¤‡ç”¨åŠ å¯†ç®—æ³•å¯¹æ•°æ®åŠ å¯†äº†ï¼ŒåŒæ—¶ç»“æŸæ¡æ‰‹é€šä¿¡ ä½†æ˜¯å¥½åƒå°‘äº† SSL ä¸­æ‰€è°ˆåˆ°çš„ç”Ÿæˆå¯¹ç§°å¯†é’¥çš„è¿‡ç¨‹é¢ Google æœç´¢åå‘ç°åœ¨TLS Extended Master Secret, Breaking SSL Proxiesæåˆ°äº† Before extended master secret extension was introduced, parties communicating under TLS protocol (RFC 5246) would compute master secret with the following formula:master_secret = PRF(pre_master_secret, â€œmaster secretâ€, ClientHello.random + ServerHello.random) [0..47]; åœ¨RFC 5246 ä¸­ Master secret ç¡®å®æ˜¯ä½¿ç”¨ pre master secret + ClientHello.random + ServerHello.random è®¡ç®—ç”Ÿæˆçš„ï¼Œä½†æ˜¯åœ¨ RFC 7627ä¸­æè¿°äº†ä¸€ç§æ”»å‡»ã€‚ C sends a â€œClientHelloâ€ to A, and A forwards it to S. S sends a â€œServerHelloâ€ to A, and A forwards it to C. S sends a â€œCertificateâ€, containing its certificate chain, to A. A replaces it with its own certificate chain and sends it to C. S sends a â€œServerHelloDoneâ€ to A, and A forwards it to C. C sends a â€œClientKeyExchangeâ€ to A, containing the â€œpre_master_secretâ€, encrypted with Aâ€™s public key. A decrypts the â€œpre_master_secretâ€, re-encrypts it with Sâ€™s public key, and sends it on to S. C sends a â€œFinishedâ€ to A. A computes a â€œFinishedâ€ for its connection with S and sends it to S. S sends a â€œFinishedâ€ to A. A computes a â€œFinishedâ€ for its connection with C and sends it to C. è¢«æ”»å‡»çš„ä¸»è¦åŸå› æ˜¯ Master Secret åªä¾èµ–äº ClientHello.random , ServerHello.random ,è§£å†³æ–¹æ¡ˆæ˜¯æŠŠè¯ä¹¦å’Œä¼šè¯çš„ä¿¡æ¯éƒ½å‚ä¸åˆ° Master Secret çš„ç”Ÿæˆè¿‡ç¨‹ æ‰©å±•ç±»å‹ä¸º0x0017çš„æ‰©å±•ä¸»å¯†é’¥å‘å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é€šçŸ¥ä½¿ç”¨ä»¥ä¸‹å…¬å¼ç”Ÿæˆä¸»å¯†é’¥ï¼š master_secret = PRF(pre_master_secret, â€œextended master secretâ€, session_hash) [0..47]; é€šè¿‡æ€»ç»“ä¸å®è·µå°è¯•ï¼Œæˆ‘å¯¹ HTTPS åè®®çš„è®¤è¯†åˆæ·±åˆ»äº†ä¸€ç‚¹ Thatâ€™s all å‚è€ƒ wiki - HTTPS wiki - TLS wiki - åŠ å¯† TLS Handshake Protocol Premaster Secret RFC 2246 - The TLS Protocol Version 1.0 Certificate authority TLS Extended Master Secret, Breaking SSL Proxies Man-in-the-middle attack","link":"/2017/03/21/Technology-Analysis-of-Https-protocol/"},{"title":"è‡ªåŠ¨åŒ–Gitæäº¤","text":"ç›®æ ‡ åœ¨æ¯å¤©çš„å›ºå®šæ—¶é—´è‡ªåŠ¨å°†ä»Šå¤©ä¿®æ”¹çš„æœ¬åœ°ä»“åº“æäº¤åˆ°github,ç®—æ˜¯æé«˜ç”Ÿäº§åŠ›çš„ä¸€ç§æ–¹å¼å§ã€‚ shellè„šæœ¬ é¦–å…ˆè¦äº†è§£æ‰‹å·¥æäº¤çš„æ—¶å€™æ‰§è¡Œçš„æ“ä½œæ­¥éª¤ commite_repo.sh commite_repo.shç”¨äºæäº¤æœ¬åœ°ä»“åº“åˆ°github 12345678910111213141516171819202122232425262728293031#!/bin/bashDATE=$(date +%s)# è¦æäº¤åˆ°githubçš„å·¥ç¨‹åç§°CheckList=('Daily_knowledge_set','Daily_sh_set','Daily_ui_objc_set','Daily_ui_set','Daily_modules','Daily_leetcode_set')TARGET=\"ä½ çš„æœ¬åœ°ä»“åº“åœ°å€\"# echo ${DATE}cd ${TARGET}for file in ${TARGET}/*do cd ${file} echo ${file##*/} git remote -v | grep fetch | awk '{print $2}' | git pulldonefor file in ${TARGET}/*doif echo \"${CheckList[@]}\" | grep -w ${file##*/} &amp;&gt;/dev/null; then cd ${file} # echo ${file} git status | grep \"nothing to commit\" &gt; /dev/null 2&gt;&amp;1 if [ $? != 0 ]; then echo \"æäº¤æ–°çš„Commit:\"${file##*/}_${DATE} git add . git commit -m ${file##*/}_${DATE} git push else echo \"æ²¡æœ‰æ›´æ”¹:\"${file##*/} fifidone æäº¤åšå®¢åˆ°github 123Â» ~ ~/.blog_ssh-add.shÂ» ~ sudo hexo gÂ» ~ sudo hexo d ~/.blog_ssh-add.shæ˜¯ä¸ºäº†è§£å†³å› ä¸ºsshçš„è¯ä¹¦ä¸æ˜¯é»˜è®¤çš„id_rsa,æ¯æ¬¡é‡å¯Macæäº¤åšå®¢,hexoéƒ½ä¼šæŠ¥å…¬é’¥é”™è¯¯çš„é—®é¢˜ã€‚ å‰©ä¸‹ä¸¤ä¸ªæ˜¯ç”Ÿæˆé™æ€åšå®¢ä¸éƒ¨ç½²åˆ°githubçš„æŒ‡ä»¤ å› ä¸ºä½¿ç”¨äº†sudo,å…¶ä¸­æœ‰ä¸€ä¸ªå¯†ç éªŒè¯çš„è¿‡ç¨‹,åœ¨Hexoæäº¤å‡ºç°Permission denied (publickey)å·²ç»ä½¿ç”¨è¿‡expectæ¥è§£å†³äº†,ç…§è‘«èŠ¦ç”»ç“¢å†™äº†å¦‚ä¸‹è„šæœ¬ exec_hexo.sh1234567891011#!/usr/local/bin/expect -fspawn sudo hexo gexpect \"Password:\"send \"ä½ çš„å¯†ç \\n\"interactspawn sudo hexo dexpect \"Password:\"send \"ä½ çš„å¯†ç \\n\"interact å†åˆ›å»ºä¸€ä¸ªè„šæœ¬å»æ‰§è¡Œä¸Šé¢çš„ä¸¤ä¸ªè„šæœ¬ schedule_commit_rep.sh123456789101112131415#!/bin/bashexport PATH=è„šæœ¬å­˜æ”¾è·¯å¾„:$PATHrepo_path=\"ä½ çš„æœ¬åœ°ä»“åº“åœ°å€\"blog_path=\"ä½ çš„æœ¬åœ°åšå®¢åœ°å€\"# æäº¤æœ¬åœ°ä»“åº“cd ${repo_path}commit_repo.sh# æäº¤blogcd ${blog_path}~/.blog_ssh-add.shexec_hexo.sh æ‰§è¡Œæ•ˆæœ ç°åœ¨è„šæœ¬å·²ç»å‡†å¤‡å¥½äº†,éœ€è¦åšçš„æ˜¯åŠ å…¥å®šæ—¶ä»»åŠ¡ crontabæ ¹æ®è¿™ç¯‡æ–‡ç« OSXç³»ç»Ÿæ·»åŠ å®šæ—¶ä»»åŠ¡,å¯çŸ¥macOSæ·»åŠ å®šæ—¶ä»»åŠ¡è‡³å°‘æœ‰ä¸¤ç§æ–¹æ³•,è™½ç„¶ä½œè€…æ¨èç”¨launchctl, è¿™ä¸ªæ˜¯é€šè¿‡plisté…ç½®çš„æ–¹å¼æ¥å®ç°å®šæ—¶ä»»åŠ¡çš„ï¼Œå…¶ä¼˜ç‚¹å°±æ˜¯æœ€å°æ—¶é—´é—´éš”æ˜¯ä¸€ç§’ ä½†æ˜¯è¿™ä¸ªä¼˜ç‚¹åœ¨ç°åœ¨è¿™ä¸ªåœºæ™¯ä¸‹å¹¶ä¸é‡è¦,è€Œä¸”é…ç½®ä¸Šæ¯”ç›´æ¥ç”¨crontabéº»çƒ¦ä¸€äº›,å› æ­¤è¿˜æ˜¯é€‰æ‹©ç”¨crontabæ¥åˆ›å»ºå®šæ—¶ä»»åŠ¡ã€‚ 1234Â» ~ sudo crontab -ePassword:crontab: no crontab for root - using an empty onecrontab: installing new crontab è¿›å…¥åˆ›å»ºæ–°çš„è®¡åˆ’ä»»åŠ¡çš„é¡µé¢,å¹¶è®¾ç½®æˆæ¯åˆ†é’Ÿéƒ½æ‰§è¡Œ 1* * * * * /bin/bash è„šæœ¬è·¯å¾„/.schedule_commit_rep.sh ç­‰äº†å¥½å‡ åˆ†é’Ÿ,ä¼¼ä¹ä»€ä¹ˆéƒ½æ²¡æœ‰å‘ç”Ÿ,åˆæ‰¾äº†ä¸¤ç¯‡æ–‡ç« ,è¯´æ˜äº†crontabçš„åŸç†æ˜¯ å½“ç”¨æˆ·ä½¿ç”¨crontabå‘½ä»¤æ–°å»ºä»»åŠ¡è®¡åˆ’ä¹‹åï¼Œè¯¥é¡¹ jobs å°±ä¼šè¢« /var/spool/cron/ ç›®å½•ä¸‹ï¼Œè€Œä¸”ä»¥ç”¨æˆ·è´¦å·æ¥åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸€é¡¹ä»»åŠ¡è®¡åˆ’ä¸ºä¸€è¡Œã€‚ crond æ£€æµ‹çš„æ—¶é—´å‘¨æœŸæ˜¯ â€œåˆ†é’Ÿâ€ï¼Œ æ¯åˆ†é’Ÿä¼šè¯»å–ä¸€æ¬¡ /etc/crontabï¼Œ ä»¥åŠ /var/spool/cron é‡Œé¢çš„è®°å½•å¹¶æ‰§è¡Œã€‚ crond æ‰§è¡Œçš„æ¯ä¸€é¡¹ä»»åŠ¡è®¡åˆ’ï¼Œéƒ½ä¼šè¢«è®°å½•åˆ° /var/log/cron è¿™ä¸ªæ—¥å¿—æ–‡ä»¶ã€‚ å¦ä¸€ç¯‡è¯´æ˜çš„æ˜¯åœ¨macOSä¸Šå¦‚ä½•å¯ç”¨crontab,macOS*ä¸Šé»˜è®¤æ²¡æœ‰/etc/crontabæ–‡ä»¶,ç”¨sudo touch /etc/crontabåˆ›å»º,ç­‰äº†å‡ åˆ†é’Ÿåä¾ç„¶æ²¡æœ‰,æŸ¥çœ‹äº†å¹¶æ²¡æœ‰spool/cronç›®å½•,åœ¨/var/logä¹Ÿæ²¡æœ‰*cron,macOSä¸Šçš„crontabä¸ä¸€èˆ¬Linuxä¸Šå·®åˆ«è¿˜æ˜¯æœ‰ç‚¹å¤§ã€‚ æœç´¢ä¸‹stackoverflow,æ„Ÿè§‰æ¯”è¾ƒè¿‘çš„is crontab broken on OSX El Capitan?, æŒ‡å®šç¼–è¾‘å™¨?æˆ‘ä½¿ç”¨crontab -lå·²ç»èƒ½çœ‹åˆ°äº†æ·»åŠ çš„è®¡åˆ’ä»»åŠ¡äº†,æ„Ÿè§‰ä¸å¤ªç¬¦åˆæˆ‘çš„æƒ…å†µ æˆ‘å°è¯•äº†ä¸€ä¸‹ 1*/5 * * * * date &gt;&gt; /tmp/z.date ç¡®å®æ˜¯ç”Ÿæˆäº†,ä½†æ˜¯è§‰å¾—å¹¶ä¸èƒ½è§£å†³æˆ‘çš„é—®é¢˜ã€‚å¥½å§,æ¢ä¸ªæ€è·¯å§,æ—¢ç„¶åœ¨macOSä¸Šæ¨èç”¨launchctl,é‚£å°±æ¢ä¸ªæ€è·¯ç”¨å®ƒå§ launchctlcdåˆ°å®¶ç›®å½•ä¸‹çš„Library/LaunchAgents 1Â» ~ cd /Users/Jason/Library/LaunchAgents åˆ›å»ºå®šæ—¶ä»»åŠ¡çš„plistæè¿°æ–‡ä»¶,æ¯”å¦‚com.jason.launchctl.plist 1234567891011121314151617181920212223&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"&gt;&lt;plist version=\"1.0\"&gt;&lt;dict&gt; &lt;key&gt;Label&lt;/key&gt; &lt;string&gt;com.jason.launchctl.plist&lt;/string&gt; &lt;key&gt;ProgramArguments&lt;/key&gt; &lt;array&gt; &lt;string&gt;è„šæœ¬è·¯å¾„.sh&lt;/string&gt; &lt;/array&gt; &lt;key&gt;StartCalendarInterval&lt;/key&gt; &lt;dict&gt; &lt;key&gt;Minute&lt;/key&gt; &lt;integer&gt;30&lt;/integer&gt; &lt;key&gt;Hour&lt;/key&gt; &lt;integer&gt;22&lt;/integer&gt; &lt;/dict&gt; &lt;key&gt;StandardOutPath&lt;/key&gt;&lt;string&gt;è„šæœ¬æ‰§è¡Œè¾“å‡ºæ—¥å¿—è·¯å¾„.log&lt;/string&gt;&lt;key&gt;StandardErrorPath&lt;/key&gt;&lt;string&gt;è„šæœ¬æ‰§è¡Œé”™è¯¯æ—¥å¿—è·¯å¾„.err&lt;/string&gt;&lt;/dict&gt;&lt;/plist&gt; å‚è€ƒä»¥ä¸‹æŒ‡ä»¤å¯åŠ¨å®šæ—¶ä»»åŠ¡ 12345launchctl load com.jason.launchctl.plistlaunchctl unload com.jason.launchctl.plistlaunchctl start com.jason.launchctl.plistlaunchctl stop com.jason.launchctl.plistlaunchctl list è¦è®©ä»»åŠ¡ç”Ÿæ•ˆï¼Œå¿…é¡»å…ˆloadå‘½ä»¤åŠ è½½è¿™ä¸ªplist å¦‚æœä»»åŠ¡å‘—ä¿®æ”¹äº†ï¼Œé‚£ä¹ˆå¿…é¡»å…ˆunloadï¼Œç„¶åé‡æ–°load startå¯ä»¥æµ‹è¯•ä»»åŠ¡ï¼Œè¿™ä¸ªæ˜¯ç«‹å³æ‰§è¡Œï¼Œä¸ç®¡æ—¶é—´åˆ°äº†æ²¡æœ‰ æ‰§è¡Œstartå’Œunloadå‰ï¼Œä»»åŠ¡å¿…é¡»å…ˆloadè¿‡ï¼Œå¦åˆ™æŠ¥é”™ stopå¯ä»¥åœæ­¢ä»»åŠ¡ ProgramArgumentså†…ä¸èƒ½ç›´æ¥å†™å‘½ä»¤ï¼Œåªèƒ½é€šè¿‡shellè„šæœ¬æ¥æ‰§è¡Œ ç”¨load,ç„¶åç”¨startç›´æ¥æ‰§è¡Œä¸€ä¸‹ å·²ç»åœ¨æ‰§è¡Œäº†,ç»ˆäºå¯ä»¥äº†ã€‚ ä½†æ˜¯å‘ç°æäº¤åšå®¢è¾“å…¥å¯†ç é‚£æ­¥åœäº†,ä¿®æ”¹pliståªæ‰§è¡Œæäº¤blog*çš„é‚£ä¸€æ­¥,å‘ç°.err*æœ‰å†…å®¹,æ‰“å¼€ æˆ‘å…ˆè¯•è¯•æŠŠinteractæ³¨é‡Šçœ‹å½±å“æ“ä½œä¸ã€‚ å°è¯•åå‘ç°ä¼šå½±å“,æœç´¢åæ²¡æœ‰å‘ç°æ¯”è¾ƒæ»¡æ„çš„è§£å†³æ–¹æ¡ˆ,å¦‚ä½•ç”¨expecté…åˆlaunchctlå®ç°å®šæ—¶ä»»åŠ¡,å³è¯¥ä»»åŠ¡è¦è‡ªåŠ¨è¾“å…¥å¯†ç ? æˆ‘ä»¥ä¸ºæ˜¯zshç»ˆç«¯çš„å…³ç³»,æ¢æˆbashåœ¨ç»ˆç«¯ä¸‹æ‰§è¡Œä¹Ÿæ²¡æœ‰é—®é¢˜,è€Œç”¨launchctlæ‰§è¡Œé…ç½®æ–‡ä»¶ä¸ç®¡æ˜¯bashè¿˜æ˜¯zshéƒ½ä¸€æ ·æŠ¥é”™ã€‚ è§£å†³æ–¹æ¡ˆç”¨å†™çš„è„šæœ¬æäº¤åšå®¢ä¸æœ¬åœ°å·¥ç¨‹,è™½ç„¶æ— æ³•å®šæ—¶çš„è‡ªåŠ¨æ‰§è¡Œ,ä½†ä¸ä»¥å‰ç›¸æ¯”æ•ˆç‡è¿˜æ˜¯ç¨å¾®æé«˜äº†ä¸€äº›çš„ğŸ˜”ã€‚ å‚è€ƒ OSXç³»ç»Ÿæ·»åŠ å®šæ—¶ä»»åŠ¡ åœ¨MAC OS Xä¸Šå¦‚ä½•å¯ç”¨crontab crontab ä¸ crond mac os å®šæœŸä»»åŠ¡é…ç½® is crontab broken on OSX El Capitan? Mac crontab: Mac OS X startup jobs with crontab, er, launchd","link":"/2017/02/25/Technology-Automated-Git-Submitted/"},{"title":"Charles HTTPæŠ“åŒ…åŸç†","text":"å‰è¨€: Webä»£ç†æœåŠ¡å™¨ æ¥è‡ªå‚è€ƒé“¾æ¥2 å¯¹å®¢æˆ·ç«¯/æµè§ˆå™¨æ¥è¯´Webä»£ç†æœåŠ¡å™¨æ˜¯æœåŠ¡å™¨å¯¹æœåŠ¡å™¨æ¥è¯´Webä»£ç†æœåŠ¡å™¨æ˜¯å®¢æˆ·ç«¯ ç¯å¢ƒ WireSharkCharlesmacOS 10.13.6 è§£é‡Šæ ¹æ®å‚è€ƒé“¾æ¥1ä¸­çš„è¿™æ®µè¯ Web proxy serversWeb proxies forward HTTP requests. The request from the client is the same as a regular HTTP request except the full URL is passed, instead of just the path.[17] GET http://en.wikipedia.org/wiki/Proxy_server HTTP/1.1Proxy-Authorization: Basic encoded-credentialsAccept: text/html Webä»£ç†æœåŠ¡å™¨åœ¨è½¬å‘HTTPè¯·æ±‚æ—¶ä¸æ­£å¸¸çš„HTTPæ˜¯ä¸€æ ·çš„,é™¤äº†è¯·æ±‚å¤´æŸä¸ªå­—æ®µè¦ä¼ é€’å…¨è·¯å¾„(full URL)è€Œä¸æ˜¯ç®€å•çš„è·¯å¾„(path)ã€‚ç»§ç»­è¿½è¸ª,é€šè¿‡rfc7230,å°±èƒ½çŸ¥é“è¿™ä¸ªè¿™ä¸ªå­—æ®µå°±æ˜¯absolute-formã€‚ ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¸ªå˜åŒ–å‘¢? åŸæ¥åªè¦ä¼ è·¯å¾„æ˜¯å› ä¸º,æœåŠ¡å™¨çŸ¥é“è‡ªå·±çš„hostæ˜¯ä»€ä¹ˆ,ä½†æ˜¯ä»£ç†æœåŠ¡å™¨æ˜¯å……å½“äº†å®¢æˆ·ç«¯çš„æœåŠ¡å™¨å,æˆ‘ä»¬å¿…é¡»è¦å‘Šè¯‰ä»£ç†æœåŠ¡å™¨,æ¥ä¸‹å»è¦è®¿é—®è°,å…‰æä¾›è·¯å¾„æ˜¯ä¸å¤Ÿçš„ã€‚ è¯æ˜å‡†å¤‡iTerm ping Blogçš„åŸŸå,è·å¾—ip 1234% sudo ping www.iosugar.comPING ishepherdminer.github.io (185.199.111.153): 56 data bytes64 bytes from 185.199.111.153: icmp_seq=0 ttl=52 time=141.981 ms... æ‰“å¼€ WireShark ç›‘å¬ en0 ç½‘å¡,å½“å‰çŠ¶æ€ä¸‹å°±æ˜¯æ— çº¿ç½‘å¡ è®¾ç½®è¿‡æ»¤æ¡ä»¶http and ip.addr == 185.199.111.153 æœªè®¾ç½®ä»£ç†Chromeç›´æ¥è®¿é—®www.iosugar.com è®¾ç½®ä»£ç†æ‰‹æœºè®¾ç½®ä»£ç†,ç”¨Safariè®¿é—® è¿‡æ»¤æ¡ä»¶è®¾ç½®ä¸º http and ip.addr == 185.199.110.153 or ip.dst == 192.168.31.191 å…¶ä¸­192.168.31.191æ˜¯è®¡ç®—æœºçš„åœ°å€ å‚è€ƒ Web_proxy_servers Thick Client Proxying - Part 6: How HTTP(s) Proxies Work rfc7230","link":"/2019/01/09/Technology-Charles-capture-principle/"},{"title":"CentOSè¿œç¨‹ç™»é™†SSHé…ç½®","text":"å‰è¨€ æœ€è¿‘æŠ›å¼ƒäº†åŸæ¥çš„VPN,è½¬è€Œè´­ä¹°äº†VPS,é…ç½®ä¹ŸæŒºç®€å•,å·²ç»æä¾›äº†åœ¨æµè§ˆå™¨ä¸Šæä¾›shellå…¥å£çš„æ–¹å¼,ä½†æ˜¯è¿˜æ˜¯æƒ³ç®€å•è®°å½•ä¸‹å…³äºSSHè¿œç¨‹ç™»é™†çš„æµç¨‹(æ¯•ç«Ÿè¿˜æ˜¯è¦æ‰“å¼€æµè§ˆå™¨,æ²¡ç»ˆç«¯æ–¹ä¾¿,è€Œä¸”é€Ÿåº¦ä¹Ÿæ…¢),è™½ç„¶ç½‘ä¸Šè¿™æ–¹é¢çš„åšå®¢å¾ˆå¤š,ä½†æ˜¯çº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…,è¿˜æ˜¯æƒ³è‡ªå·±åŠ¨æ‰‹è®°å½•ä¸€ä¸‹ã€‚ ç¯å¢ƒ CentOS release 6.6 (Final)macOS Sierra 10.12.3 æµç¨‹ åœ¨Googleä¸ŠæŸ¥æ‰¾CentOSçš„sshé…ç½®æ–¹æ³•,ç»è¿‡ä¸€ç•ªæœç´¢ä¸æ¯”è¾ƒ,è¿˜æ˜¯å®˜æ–¹çš„wikiæ›´å¥½ä¸€äº› æ–‡æ¡£ä¸­æœ‰ æç¤ºæˆ‘ä»¬ä¸è¦ç”¨rootè´¦æˆ·è¿œç¨‹sshç™»é™†,å› æ­¤éœ€è¦åˆ›å»ºç”¨æˆ· åˆ›å»ºæ–°ç”¨æˆ·åˆ›å»ºæ–°ç”¨æˆ·çš„æŒ‡ä»¤ä¸ºadduser,å…ˆçœ‹çœ‹adduseræŒ‡ä»¤çš„ç”¨æ³• 1$ &gt; adduser --help åˆ›å»ºä¸€ä¸ªåä¸ºJasonçš„ç”¨æˆ· 1$ &gt; adduser -m Jason ä¸ºæ–°ç”¨æˆ·é‡æ–°è®¾ç½®å¯†ç  1$ &gt; passwd Jason è¾“å…¥æ–°å¯†ç ,ç¡®è®¤,å¯†ç è®¾ç½®æˆåŠŸã€‚å…³äºå¯†ç çš„å®‰å…¨æ€§,æ­£å¥½å‚è€ƒç¬¬ä¸€æ­¥ é…ç½®sshd_configæ–‡ä»¶ç„¶åæ ¹æ®æ–‡æ¡£æ“ä½œ/etc/ssh/sshd_configæ–‡ä»¶ ç¦æ­¢rootç”¨æˆ·SSHç™»é™† =&gt; PermitRootLogin no å…è®¸æŒ‡å®šç”¨æˆ·ä½¿ç”¨SSHç™»é™† =&gt; AllowUsers alice bob ä½¿ç”¨SSH 2.0 =&gt; Protocol 2 ä¿®æ”¹SSHç™»é™†ç«¯å£ Port 12345 å› ä¸ºè¿œç¨‹æœåŠ¡å™¨ç¯å¢ƒæ˜¯CentOS 6.6è€Œä¸”ä¹Ÿæ²¡æœ‰å¹¶æ²¡æœ‰selinux(æç¤ºæ‰¾ä¸åˆ°è¯¥æŒ‡ä»¤semanage),å¦‚æœæœ‰çš„è¯ç…§ç€æ“ä½œã€‚ é‡å¯sshdæœåŠ¡ 1$ &gt; service sshd restart å°è¯•sshè¿œç¨‹ç™»é™† 1$ &gt; ssh -p æŒ‡å®šç«¯å£å· ç”¨æˆ·å@æœåŠ¡å™¨ip æç¤ºæ·»åŠ è¿œç¨‹æœåŠ¡å™¨çš„æŒ‡çº¹ä¿¡æ¯ è¾“å…¥å¯†ç  æˆåŠŸç™»é™†è¿œç¨‹ä¸»æœº è¿›ä¸€æ­¥é…ç½® ä¸Šé¢é‚£äº›éƒ½åº”è¯¥æ²¡æœ‰é—®é¢˜,ä½†æ˜¯æ¯æ¬¡ç™»é™†éƒ½è¦è¾“å…¥å¯†ç ,ç•¥éº»çƒ¦,ç”¨è¯ä¹¦è®¤è¯çš„æ–¹å¼å»æ›¿ä»£å¯†ç ã€‚ åœ¨è¿œç¨‹æœåŠ¡å™¨çš„/etc/ssh/sshd_config By default, ssh will first try to authenticate using keys. If no keys are found or authentication fails, then ssh will fall back to conventional password authentication. ä¼šä¼˜å…ˆé€‰æ‹©è¯ä¹¦è®¤è¯çš„æ–¹å¼ ç…§ç€æ–‡æ¡£è¿›è¡Œæ“ä½œå§ åœ¨å®¢æˆ·ç«¯(macOS)ä¸Šç”Ÿæˆé’¥åŒ™å¯¹(å…¬é’¥ &amp; ç§é’¥) 1$ &gt; ssh-keygen -t rsa æˆ‘å°†è¯ä¹¦å‘½åä¸ºid_vps,æŒ‡ä»¤æ“ä½œåä¼šç”Ÿæˆid_vpså’Œid_vps.pub,åˆ†åˆ«ä»£è¡¨ç€ç§é’¥å’Œå…¬é’¥ å¯†ç ç•™ç©º,å¦‚æœä¸ç•™ç©º,åé¢sshè¿˜æ˜¯è¦è¾“å…¥è¯ä¹¦çš„å¯†ç  ä¿®æ”¹ç§é’¥çš„æƒé™ä¸ºä»…æ‰€æœ‰è€…å¯è¯»å¯å†™ 1$ &gt; chmod 600 id_vps éœ€è¦å¤åˆ¶å…¬é’¥åˆ°æœåŠ¡å™¨ç„¶åå†™å…¥åˆ°~/.ssh/authorized_keys ä½¿ç”¨SSH*è¿œç¨‹ç™»é™†åˆ°æœåŠ¡å™¨,å‘ç°å®¶ç›®å½•ä¸­è¿˜æ²¡æœ‰.sshç›®å½•,ä½¿ç”¨mkdir*åˆ›å»º 1$ &gt; mkdir .ssh å‘é€å…¬é’¥ 1$ &gt; scp -P ç«¯å£å· ./id_vps.pub Jason@æœåŠ¡å™¨ip:/home/Jason/.ssh åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šä½¿ç”¨ls,ç¡®å®šå…¬é’¥å·²ç»å‘é€æˆåŠŸäº† å°†å…¬é’¥è¿½åŠ å†™å…¥~/.ssh/authorized_keysä¸­,è‹¥authorized_keysä¸å­˜åœ¨,åˆ™ä¼šåˆ›å»ºå¹¶å†™å…¥ 1$ &gt; cat id_vps.pub &gt;&gt; ~/.ssh/authorized_keys åŒæ ·ä¿®æ”¹authorized_keysçš„æƒé™ä¸º600,å¹¶åˆ é™¤å…¬é’¥æ–‡ä»¶,ç»“æœå¦‚ä¸‹ ç”¨ssh-copy-idå¯ä»¥æ›´æ–¹ä¾¿ä¸€äº› æ·»åŠ ç”¨æˆ·åˆ°sudoersæ­¤æ—¶ä½¿ç”¨SSH*è¿œç¨‹ç™»é™†,è¿˜æ˜¯ä¸è¡Œçš„,å› ä¸ºåœ¨/etc/ssh/sshd_configé…ç½®æ–‡ä»¶ä¸­,è¿˜æ˜¯ä½¿ç”¨å¯†ç æ–¹å¼è¿›è¡Œè®¤è¯çš„,ä¸ºäº†èƒ½ä¿®æ”¹/etc/ssh/sshd_configåŒæ—¶ä¸ºäº†ä»¥åæ“ä½œçš„èƒ½æ–¹ä¾¿äº›,å°†Jasonæ·»åŠ åˆ°/etc/sudoers*ä¸­ ä»¥ä¸‹æ‘˜è‡ªCentOSä¸‹æ·»åŠ sudoç”¨æˆ· åœ¨ä½¿ç”¨sudoçš„æ—¶å€™ï¼Œå¦‚æœå‡ºç°â€xxx is not in the sudoers file. This incident will be reportedâ€è¯´æ˜å½“å‰ç”¨æˆ·åï¼šxxxæ˜¯æ²¡æœ‰æƒé™ä½¿ç”¨sudoçš„ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦ä¿®æ”¹/etc/sudoersæ¥ä¸ºå½“å‰ç”¨æˆ·xxxæ·»åŠ sudoæƒé™ã€‚ ä½¿ç”¨ â€œsu â€“â€ å‘½ä»¤ï¼Œè¿›å…¥è¶…çº§ç”¨æˆ·ï¼Œè¿›å…¥etcç›®å½• â€œcd /etcâ€ ä¸ºsudoersæ–‡ä»¶æ·»åŠ å†™å…¥çš„æƒé™ï¼šä½¿ç”¨å‘½ä»¤ â€œchmod u+w sudoersâ€ ä½¿ç”¨å‘½ä»¤â€œvim sudoersâ€ï¼ŒæŒ‰â€œiâ€è¿›å…¥ç¼–è¾‘æ¨¡å¼åï¼Œæ‰¾åˆ°â€œrootALL=(ALL) ALL â€ï¼Œåœ¨åé¢æ·»åŠ ï¼šâ€xxxALL=(ALL) ALLâ€(è¿™é‡Œçš„xxxæ˜¯ä½ çš„ç”¨æˆ·å)ï¼Œå†æŒ‰ä¸€ä¸‹â€œEscâ€é”®é€€å‡ºç¼–è¾‘ï¼Œè¾“å…¥â€œwqâ€ï¼ˆwrite quitï¼‰åï¼Œé€€å‡ºsudoersã€‚ è¾“å…¥â€œchmod u-w(v) sudoersâ€å°†æ–‡ä»¶çš„å†™å…¥å±æ€§æ’¤é”€ é€šè¿‡â€œsu xxxâ€åˆ‡æ¢å›è‡ªå·±çš„ç”¨æˆ·åï¼Œå†ä½¿ç”¨sudoå‘½ä»¤æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨äº† åœ¨/etc/ssh/ssh_configå°†å¯†ç è®¤è¯æ–¹å¼çš„yesä¿®æ”¹ä¸ºno SSHç™»é™†è¿œç¨‹ç™»é™† æŠ¥é”™ 1Permission denied (publickey,gssapi-keyex,gssapi-with-mic). åº”è¯¥æ˜¯è¯ä¹¦çš„é—®é¢˜,ä½†æ˜¯æ„Ÿè§‰æ“ä½œéƒ½æ²¡é—®é¢˜,ä¸å®˜æ–¹çš„æ­¥éª¤ä¸åŒçš„æ˜¯è¯ä¹¦çš„åç§° ssh*åŠ ä¸Š-v*å‚æ•°æ‰“å°å‡ºè¯¦ç»†è¿‡ç¨‹ 1$ &gt; ssh -vp xxx Jason@æœåŠ¡å™¨ip å¦‚æœæˆ‘ä¸æŒ‡å®š,é»˜è®¤æ‰¾~/.ssh/id_rsaæ‰€ä»¥è‚¯å®šä¼šå¤±è´¥ åŠ ä¸Š-iå‚æ•° 1$ &gt; ssh -vp xxx -i ~/Jason/.ssh/id_vps Jason@æœåŠ¡å™¨ip ç™»é™†æˆåŠŸ åŸç†SSHä¸ºä»€ä¹ˆå®‰å…¨?å…¬é’¥åŠ å¯† æ ¹æ®SSHåŸç†ä¸è¿ç”¨ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç™»å½• æ•´ä¸ªè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼šï¼ˆ1ï¼‰è¿œç¨‹ä¸»æœºæ”¶åˆ°ç”¨æˆ·çš„ç™»å½•è¯·æ±‚ï¼ŒæŠŠè‡ªå·±çš„å…¬é’¥å‘ç»™ç”¨æˆ·ã€‚ï¼ˆ2ï¼‰ç”¨æˆ·ä½¿ç”¨è¿™ä¸ªå…¬é’¥ï¼Œå°†ç™»å½•å¯†ç åŠ å¯†åï¼Œå‘é€å›æ¥ã€‚ï¼ˆ3ï¼‰è¿œç¨‹ä¸»æœºç”¨è‡ªå·±çš„ç§é’¥ï¼Œè§£å¯†ç™»å½•å¯†ç ï¼Œå¦‚æœå¯†ç æ­£ç¡®ï¼Œå°±åŒæ„ç”¨æˆ·ç™»å½•ã€‚ ä¸­é—´äººæ”»å‡»ä¼ªé€ è¿œç¨‹ä¸»æœº,æ ¹æ®sshç™»é™†æµç¨‹ç”¨æˆ·ä¼šæŠŠç™»é™†å¯†ç ç”¨ä¼ªé€ çš„è¿œç¨‹ä¸»æœºæä¾›çš„å…¬é’¥è¿›è¡ŒåŠ å¯†,å¯†ç è‡ªç„¶å°±æ³„éœ²äº† authorized_keysæ–‡ä»¶æœ‰ä»€ä¹ˆç”¨?åœ¨æŒ‡ä»¤sshçš„manæ‰‹å†Œä¸­æœ‰å¦‚ä¸‹è¯­å¥ The file ~/.ssh/authorized_keys lists the public keys that are permitted for logging in. When the user logs in, the ssh program tells the server which key pair it would like to use for authentication. The client proves that it has access to the private key and the server checks that the corresponding public key is authorized to accept the account. authorized_keysçš„æ–‡ä»¶ä¿å­˜ç€å¯ä»¥ç™»é™†çš„ç”¨æˆ·çš„å…¬é’¥,åœ¨sshç™»é™†æ—¶,åœ¨ç»è¿‡å»ºç«‹è¿æ¥,åå•†åŠ å¯†ç®—æ³•ç­‰è¿‡ç¨‹å,å®¢æˆ·ç«¯ä¼šæä¾›ç§é’¥ç”±æœåŠ¡å™¨æ£€æŸ¥æ˜¯å¦èƒ½åŒ¹é…ç›¸åº”çš„å…¬é’¥(å¯èƒ½æ˜¯æä¾›ä¸€æ®µå†…å®¹,ç”±å®¢æˆ·ç«¯ç§é’¥åŠ å¯†,ç„¶åçœ‹æœåŠ¡å™¨çš„authorized_keysä¸­çš„å…¬é’¥èƒ½å¦è§£å¼€) å‚è€ƒ CentOSä¸‹æ·»åŠ sudoç”¨æˆ· SSHåŸç†ä¸è¿ç”¨ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç™»å½• SecuringSSH","link":"/2017/02/14/Technology-CentOS-remote-login-SSH-configuration/"},{"title":"FFmpegå­¦ä¹ ç¬”è®°01(ç¯å¢ƒæ­å»º)","text":"å‰è¨€ å­¦ä¹ FFmpeg ç¯å¢ƒ macOS Sierra 10.12.3Xcode 8.2.1FFmpeg 3.2 æ˜¯ä»€ä¹ˆ? ä¸€ä¸ªç”¨äºå½•åˆ¶,è½¬æ¢å’Œæµå¼ä¼ è¾“éŸ³é¢‘å’Œè§†é¢‘çš„å®Œæ•´çš„è·¨å¹³å°è§£å†³æ–¹æ¡ˆã€‚ å¯é€šè¿‡gitæ–¹å¼ä¸‹è½½æºç  git clone https://git.ffmpeg.org/ffmpeg.git ffmpeg æµç¨‹ ç½‘ä¸Šæœç´¢äº†ä¸€ä¸‹,å…³äºFFmpegçš„ç¼–è¯‘ä¸»è¦æœ‰ä¸¤ç§ æ–¹æ¡ˆä¸€ é€šè¿‡FFmpeg-iOS-build-script,æ¥è¾“å‡ºarm*æ¶æ„ä¸‹çš„.a*æ–‡ä»¶,æ¯”è¾ƒæ—§çš„ç”¨iFrameExtractor,åŸç†ç±»ä¼¼ã€‚ æ–¹æ¡ˆäºŒ æ ¹æ®è¿™ç¯‡ç”¨xcodeè°ƒè¯•FFmpegçš„æ–¹æ³•,ä½†æ˜¯è¿™æ ·åªèƒ½åœ¨Macä¸Šè¿è¡Œå’Œè°ƒè¯•,å¦‚æœç”¨fileæŒ‡ä»¤ä¼šçŸ¥é“å‘ç°å¯æ‰§è¡Œæ–‡ä»¶çš„æ¶æ„æ˜¯x86_64çš„ã€‚ æˆ‘çš„å°è¯• æœ‰æ²¡æœ‰åŠæ³•åœ¨Xcodeçš„iOSé¡¹ç›®ä¸­ç›´æ¥ç¼–è¯‘FFmpegå·¥ç¨‹? å…ˆè¯´ç»“æœ,ç›®å‰æ²¡æœ‰åšæˆåŠŸ é˜…è¯»FFmpeg-iOS-build-scriptçš„build-ffmpeg.shè„šæœ¬è„šæœ¬å‰é¢ä¸‹è½½æºç åŠä¾èµ–è„šæœ¬çš„éƒ¨åˆ†,å°±ä¸è¯´äº† æœ€åçš„configureæŒ‡ä»¤å½¢å¼å¤§æ¦‚æ˜¯è¿™æ ·çš„ 1./configure --target-os=darwin --arch=arm64 --cc=\"xcrun -sdk iphoneos clang\" --enable-cross-compile --disable-debug --disable-programs --disable-doc --enable-pic --extra-cflags=\"-arch arm64 -mios-version-min=6.0 -fembed-bitcode\" --extra-ldflags=\"-arch arm64 -mios-version-min=6.0 -fembed-bitcode\" --prefix=/Users/Jason/Desktop/thin æŒ‡å®šäº†æ¶æ„,ç¼–è¯‘å™¨ç±»å‹,æœ€ä½ç‰ˆæœ¬ç­‰ä¿¡æ¯,make*ç¼–è¯‘,.o*æ–‡ä»¶ä¹Ÿå¯ä»¥æ­£å¸¸äº§ç”Ÿã€‚ 1find ./* -name \"*.o\" é€šè¿‡æŸ¥çœ‹ç¼–è¯‘äº†å“ªäº›.o,å°è¯•æ‰¾å‡ºæºç ä¸­çš„å“ªäº›.c*æ˜¯å‚ä¸ç¼–è¯‘çš„ã€‚ä¸»è¦æ˜¯å‡ ä¸ªåº“ä¸­çš„.c*æ–‡ä»¶å‚ä¸äº†ç¼–è¯‘ã€‚ Xcodeç¼–è¯‘æŒ‡ä»¤ç”¨Xcodeç¼–è¯‘æµç¨‹å¯é€šè¿‡ä¸‹å›¾æ–¹å¼è·çŸ¥ ç¼–è¯‘ä¸€ä¸ªViewController.mçš„æŒ‡ä»¤ ä¸»è¦æ€è·¯æ˜¯æŠŠç”Ÿæˆ.aé™æ€åº“çš„æºæ–‡ä»¶,æ‹·è´åˆ°å·¥ç¨‹ä¸­,ç„¶åç¼–è¯‘çš„æ—¶å€™éƒ½ç”¨clang,åªè¦ä¿è¯ç¼–è¯‘çš„å‚æ•°ä¸€è‡´,åº”è¯¥æ˜¯èƒ½è¿‡çš„ã€‚ æœ€åè¯´è¯´å¡åœ¨å“ªå„¿äº†å§,é‡åˆ°*&lt;OpenCL/cl.h&gt;å¤´æ–‡ä»¶æ²¡æœ‰æ‰¾åˆ°,Xcodeä¸­æ‰¾ä¸åˆ°,ç”¨findæŒ‡ä»¤åœ¨Xcodeçš„mac SDKä¸Šå€’æ˜¯æœ‰æŸ¥æ‰¾,æˆ‘ç°åœ¨ä¸å¤ªæ¸…æ¥šæ˜¯ä¸æ˜¯å› ä¸ºè¿™ä¸ªåŸå› å¯¼è‡´,ç½‘ä¸Šæ‰¾åˆ°çš„ç»“æœéƒ½æ˜¯ç¼–è¯‘æˆ.aå½¢å¼çš„,ç„¶åèƒ½è°ƒè¯•çš„éƒ½æ˜¯åœ¨mac*å¹³å°ä¸‹çš„,å¦‚æœæœ‰æ‡‚çš„,è¯·å‘Šè¯‰æˆ‘ã€‚ æˆ‘çš„è§£å†³æ–¹æ¡ˆå¯¹äºç›®å‰æ¥è¯´,æ˜¯å‡ºäºå­¦ä¹ çš„ç›®çš„,æ‰€ä»¥æ‰“ç®—æ•´3ä¸ªXcodeå·¥ç¨‹ ç¼–è¯‘FFmpegçš„é™æ€åº“å·¥ç¨‹,FFmpeg-iOS-build-script å¼•ç”¨äº†é™æ€åº“çš„iOSåº”ç”¨çš„å·¥ç¨‹,ååº”ç”¨æ–¹é¢çš„,æ¯”å¦‚æ€ä¹ˆä½¿ç”¨FFmpegçš„APIæ¥å®ç°éŸ³è§†é¢‘ç¼–ç è§£ç ä¹‹ç±»çš„ FFmpegæºç å¯è°ƒå¼å‘½ä»¤è¡Œå·¥ç¨‹,ç”¨äºè°ƒè¯•ç ”ç©¶FFmpegçš„åº•å±‚å®ç° ç¼–è¯‘é™æ€åº“å·¥ç¨‹12345678git clone https://github.com/kewlbear/FFmpeg-iOS-build-script# ç¼–è¯‘./build-ffmpeg.sh # åˆå¹¶./build-ffmpeg.sh lipo å¼•ç”¨é™æ€åº“å·¥ç¨‹ä½¿ç”¨å¼•ç”¨æ–¹å¼å°†ç¼–è¯‘åçš„FFmpeg-iOSç›®å½•(åŒ…å«é™æ€åº“å’Œå¤´æ–‡ä»¶)æ·»åŠ åˆ°å·¥ç¨‹ä¸­ æ ¹æ®å½“å‰ç›®å½•ç»“æ„ç»™Build Settingsä¸­çš„Library Search Paths,æ·»åŠ  1$(PROJECT_DIR)/../FFmpeg-iOS-build-script/FFmpeg-iOS/lib æŒ‡å‘é™æ€åº“çš„è·¯å¾„ å¼•ç”¨ä¾èµ–çš„åŠ¨æ€åº“ libz.dylib libbz2.dylib libiconv.dylib æ·»åŠ kxmovieå·¥ç¨‹,ä¸€ä¸ªåŸºäºFFmpegçš„æ’­æ”¾å™¨ gitä¸‹å·¥ç¨‹,å¹¶å°†kxmovieç›®å½•æ‹–æ‹½å¹¶å¤åˆ¶åˆ°å·¥ç¨‹ä¸­,å› ä¸ºç›®å½•ä¸­æœ‰pchæ–‡ä»¶, ç®€å•åœ¨Main.storyboardä¸­æ·»åŠ ä¸€ä¸ªå¯¼èˆªæ§åˆ¶å™¨,å¹¶åœ¨å·¥ç¨‹çš„æ ¹æ§åˆ¶å™¨æ·»åŠ å¦‚ä¸‹ä»£ç  123456789#import \"KxMovieViewController.h\"...- (void)viewDidLoad { [super viewDidLoad]; ViewController *vc; NSString *path = @\"\"; vc = [KxMovieViewController movieViewControllerWithContentPath:path parameters:nil]; [self presentViewController:vc animated:YES completion:nil];} åœ¨Build settingsçš„Prefix Header,æ·»åŠ å¦‚ä¸‹å­—æ®µ,æŒ‡å‘pchæ–‡ä»¶ 1Learn-FFmpeg/kxmovie/kxmovie-Prefix.pch âŒ˜ + B æç¤º å¤´æ–‡ä»¶è·¯å¾„çš„é—®é¢˜,åŒæ ·åœ¨Build Settingsçš„Header Search Pathsæ·»åŠ  1$(PROJECT_DIR)/../FFmpeg-iOS-build-script/FFmpeg-iOS/include âŒ˜ + B æç¤º ä¸Šé¢ä¸¤ä¸ªç›´æ¥æ ¹æ®æç¤ºä¿®æ”¹,ä¸‹é¢é‚£ä¸ª,æ ¹æ®iOSç¼–è¯‘FFmpegã€kxmovieå®ç°è§†é¢‘æ’­æ”¾å°†å…¶æ³¨é‡Š âŒ˜ + B æç¤º æ·»åŠ VideoToolbox.frameworkå³å¯ âŒ˜ + B æˆåŠŸ ä¿®æ”¹ä»£ç ,è®¾ç½®pathä¸ºæœ¬åœ°éŸ³é¢‘åœ°å€ 1234ViewController *vc;NSString *path = @\"http://192.168.5.101/~Jason/TestMusic.mp3\";vc = [KxMovieViewController movieViewControllerWithContentPath:path parameters:nil];[self presentViewController:vc animated:YES completion:nil]; é¡ºä¾¿è®¾ç½®info.plistä»¥æ”¯æŒhttpè®¿é—® 1234&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;&lt;dict&gt; &lt;key&gt;NSAllowsArbitraryLoads&lt;/key&gt;&lt;true/&gt;&lt;/dict&gt; æˆªå›¾ è§†é¢‘æˆªå›¾ æºç å·¥ç¨‹å‚è€ƒç”¨xcodeè°ƒè¯•FFmpegçš„æ–¹æ³•é“¾æ¥å³å¯,åœ¨ä¸€äº›å°åœ°æ–¹æ³¨æ„ä¸€ä¸‹å³å¯,æ¯”å¦‚ç¬¬ä¸€æ­¥ç”Ÿæˆffmpeg_g*å¯æ‰§è¡Œæ–‡ä»¶â€“disable-optimizations &amp;&amp; make -j3,å–æ¶ˆä¼˜åŒ–,ä¸ç„¶è°ƒè¯•çš„æ—¶å€™å¾ˆå¤šå˜é‡å€¼æ— æ³•è¾“å‡º,-jå‚æ•°æ˜¯job*æ˜¯ç¼–è¯‘çš„çº¿ç¨‹æ•°çš„æ„æ€ è®¾ç½®æ–­ç‚¹,è°ƒè¯•FFmpeg æœ€ç»ˆç›®å½•ç»“æ„ æœ€ç»ˆå·¥ç¨‹ç»“æ„ DEMO Update 170309å› ä¸ºFFmpeg-iOS-build-scriptæ²¡æœ‰æ·»åŠ åˆ°gitä¸­ç®¡ç†,æ•´ä¸ªç›®å½•æ–‡ä»¶,å°†è¿‘1ä¸ªG,å¤ªå¤§äº†,æ²¡æœ‰æäº¤,ç®€å•å†™äº†ä¸ªè„šæœ¬æ¥å¤„ç† 123456789101112#!/bin/shversion=3.2if [ ! -d \"./FFmpeg-iOS-build-script\" ]; then git clone https://github.com/kewlbear/FFmpeg-iOS-build-script cd ./FFmpeg-iOS-build-script ./build-ffmpeg.sh ./build-ffmpeg.sh lipo cd ffmpeg-${version} ./configure --disable-optimizations &amp;&amp; make -j3fi å‚è€ƒ FFMPEG â€“ ç·¨è­¯ ffmpeg library for iOS llvm - UsersManual Build Settingsä¸­çš„å˜é‡@rpath,@loader_path,@executable_path Xcode Build Search Pathsè®¾ç½® FFmpegæ¡†æ¶åœ¨iOSå¹³å°ä¸Šçš„ç¼–è¯‘å’Œä½¿ç”¨ FFmpeg-user Need to debug the ffmpeg with gdb â€“enable-debug=3 FFmpeg-iOS-build-script","link":"/2017/03/06/Technology-FFmpeg-study-notes-01-environmental-building/"},{"title":"FFmpegæŒ‡ä»¤-è§†é¢‘æˆªå–","text":"åœºæ™¯ sdk éœ€è¦è§†é¢‘ç´ æ,æˆ‘è‡ªå·±æ‰¾çš„è§†é¢‘ç´ æå¤ªå¤§ä¸èƒ½ä½œä¸ºç´ æèµ„æº(150Kä»¥å†…)ã€‚ æ“ä½œ è®°å¾— FFmpeg èƒ½å¤„ç†,ç”¨ man æŸ¥äº†ä¸‹ï¼Œå½“æ—¶å†™æ–‡æ¡£çš„äººè¿˜çœŸæ˜¯å¾ˆè®²ç©¶ã€‚æ¯”å¦‚ä¸‹é¢çš„å›¾ æ–‡æ¡£å¤ªé•¿ï¼Œè¿˜æ˜¯ â€“help å§ 1usage: ffmpeg [options] [[infile options] -i infile]... {[outfile options] outfile}... æŒ‡ä»¤æ‰§è¡Œæ ¼å¼ä¸º ffmpeg + å‚æ•° + è¾“å…¥æ–‡ä»¶å‚æ•° + -i è¾“å…¥æ–‡ä»¶ ... è¾“å‡ºæ–‡ä»¶å‚æ•° è¾“å‡ºæ–‡ä»¶,ä¸­æ‹¬å·è¡¨ç¤ºå¯é€‰ï¼Œå¤§æ‹¬å·ä»£è¡¨å¿…é€‰ã€‚å½“å‰è¦åšçš„æ˜¯è¦æˆªå–ä¸€æ®µæ—¶é—´ã€‚ 12345678910111213-t duration record or transcode \"duration\" seconds of audio/video-t duration (input/output) When used as an input option (before \"-i\"), limit the duration of data read from the input file. When used as an output option (before an output url), stop writing the output after its duration reaches duration. duration must be a time duration specification, see the Time duration section in the ffmpeg-utils(1) manual. -to and -t are mutually exclusive and -t has priority. -t åœ¨ -i ä¹‹å‰ï¼Œduration è¯¥ç”¨ä»€ä¹ˆæ ¼å¼å¡«å†™å‘¢? ä» man ä¸­æ‰¾ä¾‹å­ 1ffmpeg -filter_complex 'color=c=red' -t 5 out.mkv ç”Ÿæˆäº† 5s çš„çº¯çº¢è‰²çš„è§†é¢‘ 1-ss time_off set the start time offset è®¾ç½®å¼€å§‹æ—¶é—´çš„åç§»é‡ åˆ°è¿™é‡Œå¦‚ä½•æˆªå–è§†é¢‘åº”è¯¥æ¯”è¾ƒæ¸…æ¥šäº†ã€‚è¯•ä¸€ä¸‹ 1234ffmpeg -t 5 -ss 0 -i sample_iPod.m4v shot_sample_iPod.m4v -rwxrwxrwx@ 1 Jason staff 2236480 Jun 4 2016 sample_iPod.m4v-rw-r--r-- 1 Jason staff 76820 Apr 21 20:31 shot_sample_iPod.m4v è§†é¢‘è¢«é¡ºåˆ©æˆªæˆ 5s ã€‚ ä¸€ç‚¹æ„Ÿæ‚Ÿ ffmpeg å¾ˆå¼ºå¤§ï¼Œçœ‹ç€å¥½åƒæŒºéº»çƒ¦çš„äº‹æƒ…ï¼Œæ‰¾åˆ°åˆé€‚çš„å·¥å…·ï¼Œç¬é—´å°±è½»æ¾ä¸å°‘ã€‚ä¸€å¼€å§‹æ²¡å¤ªæ³¨æ„ï¼ŒåªçŸ¥é“çš„æ˜¯ [] è¡¨ç¤ºå¯é€‰çš„æ„æ€ï¼Œç°åœ¨åˆçŸ¥é“äº† {} è¡¨ç¤ºå¿…é€‰ï¼Œæ€»ç»“ï¼Œæ€»æ˜¯ä¼šæœ‰æ‰€æ”¶è·çš„ã€‚ å‚è€ƒ æ‹¬å·ä¸­çš„å¯é€‰ã€å¿…é€‰è¡¨ç¤º","link":"/2017/04/21/Technology-FFmpeg-video-interception-command/"},{"title":"å…¨è§’ç©ºæ ¼åœ¨Markdownä¸­çš„ä½¿ç”¨","text":"å¯¼è¯­ Markdown æ˜¯ä¸€ç§è½»é‡çº§çš„æ ‡è®°è¯­è¨€ã€‚å®ƒå…³æ³¨å†…å®¹è€Œä¸æ˜¯æ ·å¼ã€‚å› ä¸ºå…¨è§’ç©ºæ ¼åœ¨æ’ç‰ˆä¸Šä¼šæœ‰ä¸€äº›ç”¨å¤„ï¼Œè€Œä¸”ä¹Ÿç¡®å®ç¢°åˆ°äº†ï¼Œå› æ­¤è¿›è¡Œç®€å•çš„è®°å½•ã€‚ æ®µé¦–ç©ºæ ¼ åˆ‡æ¢åˆ°å…¨è§’çŠ¶æ€ï¼Œè¾“å…¥ç©ºæ ¼ï¼Œå³å¯ã€‚å› ä¸º Markdown æœ€åè¿˜æ˜¯è¢« hexo-renderer-marked è½¬æ¢æˆ html ã€‚æ‰€ä»¥ä¹Ÿå¯ä»¥ä½¿ç”¨ &amp;nbsp;ã€&amp;emsp; è¿™ç§è½¬ä¹‰å­—ç¬¦ï¼Œä½†æ˜¯è¿˜æ˜¯å…¨è§’ç©ºæ ¼æ„Ÿè§‰ä¸Šä¼šæ›´çº¯ç²¹ä¸€äº›ã€‚ ç©ºè¡Œ 123 456 è™½ç„¶æˆ‘ç•™äº†ä¸¤è¡Œï¼Œä½†æ˜¯æ˜¾ç¤ºæ—¶ 123 ä¸ 456 ä¾ç„¶åªæœ‰ä¸€è¡Œçš„é—´éš”ã€‚ è§£å†³æ–¹æ¡ˆ è®¾ç½® margin / padding ä½¿ç”¨ &lt;br/&gt; &amp;emsp;ã€&amp;ensp; ä½¿ç”¨å…¨è§’ç©ºæ ¼ 123 456 Thatâ€™s all","link":"/2017/04/07/Technology-Full-width-spaces-used-in-Markdown/"},{"title":"HexoåŸŸåç»‘å®š","text":"å‰è¨€å‡ºäºâ€æŠ˜è…¾â€çš„ç›®çš„,åœ¨ä½¿ç”¨github+hexoæ­å»ºblog*å,å°†åŸæ¥.io*çš„åŸŸåç»‘å®šä¸ºä¸ªäººç”³è¯·çš„åŸŸå å‡†å¤‡ åŸŸå DNSæœåŠ¡å™¨ æµç¨‹å½“å‰çš„éœ€æ±‚æ˜¯å°†githubåˆ†é…çš„åŸŸå,é‡æ–°æŒ‡å‘ç»™æ–°ç”³è¯·çš„åŸŸå ç”±ä¸Šå›¾å¯çŸ¥,CNAMEèƒ½å°†åŸŸåæŒ‡å‘å¦ä¸€ä¸ªæä¾›ipçš„åŸŸå,ç¬¦åˆå½“å‰çš„éœ€æ±‚ã€ å…³äºDNSæœåŠ¡å™¨,æˆ‘é€‰æ‹©äº†DNSPod,å®ƒç°åœ¨å¯ä»¥ç”³è¯·åŸŸå,ä¸€äº‹ä¸çƒ¦äºŒä¸»,æ‰€ä»¥ç”³è¯·åŸŸåæˆ‘ä¹Ÿäº¤ç»™äº†å®ƒã€‚ åœ¨æ§åˆ¶å° &gt; åŸŸåè§£æä¸­æ·»åŠ ç”³è¯·æˆåŠŸçš„åŸŸå,æ¯”å¦‚iosugar.com,ç„¶åå»ºç«‹ä¸¤æ¡dnsè®°å½• ä¸¤è€…åªæœ‰ä¸»æœºè®°å½•ä¸ä¸€æ ·,ä¸»è¦æ˜¯ä¸ºäº†è®¿é—®www.iosugar.comå’Œiosugar.comæ•ˆæœèƒ½ä¸€è‡´ è®¿é—®é…ç½®å¥½çš„æ–°åŸŸå,ä¼šå‡ºç°githubçš„404é”™è¯¯,åˆ°blogçš„sourceç›®å½•ä¸‹,æ–°å»ºCNAMEæ–‡ä»¶,å†™å…¥www.iosugar.com,hexo dåˆ°githubä¸Š,ç„¶åç‚¹å‡»å·¥ç¨‹çš„setting,å¯ä»¥çœ‹åˆ° é…ç½®è‡ªå®šä¹‰åŸŸåå·²ç»æˆåŠŸäº† ç­‰ä¸€æ®µæ—¶é—´,è®¿é—®iosugar.comæˆåŠŸäº† æ³¨æ„ dnsæ›´æ–°ä¼šæœ‰å»¶è¿Ÿ,è‹¥æ˜¯è¦æƒ³å°½å¿«æµ‹è¯•æ•ˆæœ,å¯ä»¥å°†DNSPodçš„dnsåŸŸåæœåŠ¡å™¨ip(é€šè¿‡pingæŒ‡ä»¤)æ·»åŠ åˆ°æœ¬æœºçš„dnsæœåŠ¡å™¨çš„æŸ¥è¯¢åˆ—è¡¨(ç½‘ç»œ&gt;é«˜çº§&gt;DNS) 12345678910111213$ ping f1g1ns1.dnspod.netPING f1g1ns1.dnspod.net (180.163.19.15): 56 data bytes64 bytes from 180.163.19.15: icmp_seq=0 ttl=50 time=131.329 ms64 bytes from 180.163.19.15: icmp_seq=1 ttl=50 time=135.907 ms64 bytes from 180.163.19.15: icmp_seq=2 ttl=50 time=133.248 ms64 bytes from 180.163.19.15: icmp_seq=3 ttl=50 time=136.791 ms$ ping f1g1ns2.dnspod.netPING f1g1ns2.dnspod.net (101.226.30.224): 56 data bytes64 bytes from 101.226.30.224: icmp_seq=0 ttl=51 time=58.310 ms64 bytes from 101.226.30.224: icmp_seq=1 ttl=51 time=55.261 ms64 bytes from 101.226.30.224: icmp_seq=2 ttl=51 time=56.218 ms64 bytes from 101.226.30.224: icmp_seq=3 ttl=51 time=65.365 ms å› ä¸ºä½¿ç”¨äº†è‡ªå®šä¹‰çš„åŸŸå,æ‰€ä»¥åœ¨githubä¸Šæ­å»ºçš„blogæ— æ³•æ”¯æŒhttps å‚è€ƒ æˆ‘çš„åšå®¢æ˜¯å¦‚ä½•æ­å»ºçš„ï¼ˆgithub pages + HEXO + åŸŸåç»‘å®šï¼‰ ä¸ºéƒ¨ç½²åœ¨Githubä¸Šçš„Hexoåšå®¢ç»‘å®šä¸ªæ€§åŸŸå","link":"/2017/01/01/Technology-Hexo-domain-binding/"},{"title":"Hexoæäº¤å‡ºç°Permission denied (publickey)","text":"ç¯å¢ƒè¯´æ˜ macOS Sierra 10.12.1node v6.5.0 é—®é¢˜å‚è€ƒ hexo-doc æ­å»ºå¥½blogå ä¸ºéƒ¨ç½²åˆ°githubä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤,å»å®‰è£…hexo-deployer-gitæ’ä»¶ 1$ npm install hexo-deployer-git --save å¦‚æœä½¿ç”¨ssh-keygenç”ŸæˆRSAè¯ä¹¦ä¸é€‰æ‹©é»˜è®¤çš„id_rsaåæ—¶,æäº¤æœ‰æ—¶ä¼šæŠ¥å…¬é’¥é”™è¯¯ 123FATAL Error: Permission denied (publickey). fatal: Could not read from remote repository.... è§£å†³æ–¹æ³•æ­¥éª¤ 112// adds private key identities to the authentication agent$ ssh-add path/to/rsa_private_key ç„¶åå†è¿›è¡Œæäº¤ æ­¥éª¤ 2åŸå› : é‡å¯å,åˆä¼šæç¤ºè¯¥é”™è¯¯ é™åˆ¶: æ‰§è¡Œssh-addä¼šæœ‰ä¸€ä¸ªè¦æ±‚è¾“å…¥å¯†ç çš„äº¤äº’è¿‡ç¨‹ brewå®‰è£… expect 1$ brew install homebrew/dupes/expect æ–°å»ºä¸€ä¸ªshellè„šæœ¬ å‘½åä¸º .blog_ssh-add.sh 12345#!/usr/local/bin/expect -fspawn /usr/bin/ssh-add /Users/Jason/.ssh/github_homeexpect \"Enter passphrase for /Users/Jason/.ssh/github_home:\"send \"111111\\n\\n\" ## å¯†ç interact æ·»åŠ å¯æ‰§è¡Œæƒé™ 1$ sudo chmod +x .blog_ssh-add.sh å½“æŠ¥é”™å°±ä¼šæ‰§è¡Œ~/.blog_ssh-add.sh ä¼šè‡ªåŠ¨è¾“å…¥å¯†ç ,ç„¶åå†æäº¤ å‚è€ƒ Shellè„šæœ¬äº¤äº’ä¹‹ï¼šè‡ªåŠ¨è¾“å…¥å¯†ç  ssh keys ssh-agent bash and ssh-add Automating an ssh connection with crontab How to avoid being asked passphrase each time I push to Bitbucket","link":"/2016/11/24/Technology-Hexo-commit-exists-Permission-denied-publickey/"},{"title":"hexo deploy å‘½ä»¤æ‰§è¡Œå¤±è´¥","text":"å‰è¨€å¾ˆä¹…æ²¡å†™åšå®¢,é‡æ–°æ¢å¤å†™ä½œå,å‘ç°hexo deploy æ— æ³•æ¨é€äº†,ä¸€ç›´æŠ¥æ— æƒé™,æ£€æŸ¥äº†~/.gitconfigè´¦å·æ˜¯å¯¹çš„,æŒ‰å‚è€ƒä¸€åœ¨~/.ssh/configä¸­åŠ äº†å…¬é’¥ æŒ‰è¦æ±‚eval \"$(ssh-agent -s)\" 1234Host *.github.com AddKeysToAgent yes UseKeychain yes IdentityFile ~/.ssh/whz1992gt_github_home æŒ‡å®šgithub.comä½¿ç”¨è¯¥å…¬é’¥,ä½†æ˜¯è¿˜æ˜¯å¤±è´¥ã€‚ è§£å†³æ–¹æ¡ˆåŸæ¥æ˜¯æˆ‘ä»¥å‰å®‰è£…è¿‡githubåé¢æ¨å‡ºçš„å®¢æˆ·ç«¯å·¥å…·,ä¼šåœ¨~/.config/gh/config.yml é‡Œé¢è¿˜å­˜ç€å¦ä¸€ä¸ªè´¦å·,åˆ é™¤å,å…³é—­iTermè¿˜æ˜¯ä¸è¡Œ,é‡å¯åç»ˆäºèƒ½æ­£å¸¸æ¨é€äº†ã€‚ å‚è€ƒ generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent","link":"/2022/12/11/Technology-Hexo-push-error/"},{"title":"macOSä¸Šå¦‚ä½•åˆ›å»ºç½‘å€å¿«æ·æ–¹å¼","text":"å¯¼è¯­mac ä¸Šè£…äº†å¾ˆå¤šæµè§ˆå™¨ã€‚å› ä¸ºå–œæ¬¢ Safari çš„ Pin Tab çš„åŠŸèƒ½ï¼Œæ‰€ä»¥ä¸»åŠ›çš„æµè§ˆå™¨é€‰æ‹©çš„æ˜¯å®ƒï¼Œä½†æ˜¯å¤ªå¤šçš„ Pin Tab ä¼¼ä¹æ‹–ç´¯äº†æµè§ˆå™¨çš„é€Ÿåº¦ï¼Œä»Šå¤©è¦æ‰“å¼€è‹¹æœå¼€å‘è€…åå°æ—¶ï¼Œç”±äºç½‘é€Ÿä¸ç»™åŠ›ï¼Œæœ€åæ¢æˆ Firefox æ‰é¡ºåˆ©æ‰“å¼€ã€‚æ„Ÿè§‰æœ‰å¿…è¦æ•´ç†ä¸€ä¸‹ã€‚åˆä¸æƒ³æ”¾åˆ°æ”¶è—å¤¹ä¸­ï¼Œæ”¾åˆ°é‚£å„¿ï¼Œä¼¼ä¹å°±å¾ˆéš¾å†è®°èµ·å®ƒäº†ã€‚ é—²è¯ç‚¹åˆ°ä¸ºæ­¢å³å¯ï¼Œè®²è®²å¦‚ä½•åˆ¶ä½œç½‘å€å¿«æ·æ–¹å¼ï¼Œéå¸¸ç®€å•ï¼Œåªæ˜¯å› ä¸ºä»¥å‰æ²¡æ³¨æ„è¿‡è¿™ä¸ªè§’è½ï¼Œå› æ­¤æ‰è€ƒè™‘èŠ±ç‚¹æ—¶é—´è®°å½•ä¸€ä¸‹ã€‚ æµç¨‹ åˆ‡æ¢åˆ° Safari æµè§ˆå™¨ä¸­ ç§»åŠ¨åˆ°åœ°å€æ  é•¿æŒ‰é¼ æ ‡/è§¦æ‘¸æ¿ï¼Œä»¥æ‹–æ‹½çš„æ–¹å¼å°†å…¶ç§»åŠ¨åˆ°ç›®æ ‡è·¯å¾„,æ¯”å¦‚ Finder/Desktop é¡ºåˆ©çš„è¯åº”è¯¥ä¼šç”Ÿæˆç±»ä¼¼è¿™æ ·çš„å›¾æ ‡ Thatâ€™s all","link":"/2017/03/28/Technology-How-to-create-URL-shortcuts-on-macOS/"},{"title":"iTunes Store ä¸å¯ç”¨ (æ²¡è§£å†³)","text":"å‰è¨€æœ€è¿‘å‘ç° Mac ä¸Šçš„ iTunes ä¸­çš„ AppStore æ€»æ˜¯æ— æ³•è®¿é—®ï¼Œå‡ºç°å¦‚ä¸‹ä¸‰ç§é”™è¯¯ 400 Bad Request 502 Your iTunes Store Session has expired (å†æ¬¡ç™»é™†è¿˜æ˜¯æŠ¥è¿™ä¸ªé”™) ) å°è¯•è¿‡ä¸‹é¢çš„æ–¹æ¡ˆClear CookieSafari &gt; é¦–é€‰é¡¹(Preference) &gt; Privacy &gt; Manage Website Dataä¸­å°† apple.com çš„ cookie åˆ é™¤ å¤±è´¥ é‡æ–°å®‰è£… iTuneså®‰è£…äº† 12.6.1.27 å¤±è´¥ é‡æ–°ç™»é™† Apple IDç³»ç»Ÿè®¾ç½® &gt; iCloud å¤±è´¥ é‡æ–°å®‰è£…ç³»ç»Ÿæ²¡æ“¦é™¤ç¡¬ç›˜,ç„¶åé‡æ–°å®‰è£…äº† 10.12.5 å¤±è´¥ ç”³è¯· Contact Apple Supportå› ä¸ºè‹±è¯­å£è¯­ä¸å¥½,é€‰æ‹©äº†èŠå¤©çš„æ–¹å¼ï¼Œè¾¹å¼€ google ç¿»è¯‘ï¼Œè¾¹èŠï¼Œå¯èƒ½èŠçš„ä¸å¤ªå¥½ï¼Œå¯¹æ–¹çš„é¡¾é—®æ€åº¦å¾ˆå¥½ï¼Œå½“æˆ‘è¯´å‡ºç°äº† Your iTunes Store Session has expired é—®é¢˜æ—¶,è®©æˆ‘æ£€æŸ¥äº†æ—¶é—´ï¼Œç³»ç»Ÿç‰ˆæœ¬ï¼Œé˜²ç«å¢™çš„è®¾ç½®ï¼Œåˆ‡æ¢ç½‘ç»œè¯•è¯•ï¼Œæœ€åè®©æˆ‘è¿›å…¥å®‰å…¨æ¨¡å¼è¯•ä¸€è¯•(å¼€æœºæŒ‰ä½ shift) æœ€åè¿˜æ˜¯æ²¡æœ‰è§£å†³ã€‚ å¯¹æ–¹å¾€é‚®ç®±ä¸­å‘äº†ä¸€å°é‚®ä»¶ï¼Œæˆ‘æƒ³çœ‹çœ‹è®°å½•çš„è¯¦æƒ… Contact Apple Support å½“è¾“å…¥ CaseID å ä¸‹é¢é‚£ä¸ªè¾“å…¥æ¡†æœ¬æ¥æ²¡æœ‰ï¼Œæ—¢ç„¶éƒ½æ˜¯å¿…é¡»è¾“å…¥çš„ï¼Œä¸ºä»€ä¹ˆè¦éšè—èµ·æ¥å‘¢? ä¹Ÿè®¸æœ‰å…¶ä»–ç”¨å¤„ è¾“å…¥åç•™äº†å‡ºç°äº† We're Sorry å’Œä¸€æ®µ ç¥ç§˜ä»£ç  å¯èƒ½è¦ç­‰ä¸€æ®µæ—¶é—´æ‰ä¼šå‡ºç°å§ã€‚ æœ€åå‘ç°åœ¨ Apple - ç³»ç»ŸçŠ¶æ€ æåˆ° ä¸çŸ¥é“å’Œè¿™ä¸ªæœ‰æ²¡æœ‰å…³ç³»â€¦â€¦ å‚è€ƒ Apple - ç³»ç»ŸçŠ¶æ€","link":"/2017/06/25/Technology-ITunes-Store-unavailable-not-resolved/"},{"title":"IntelliJ IDEA Mainå‡½æ•°ä¼ å‚","text":"å‰è¨€ å•çº¯åšä¸ªè®°å½• ç¨‹åºä¼ å‚CCç¨‹åºçš„å…¥å£ä¸ºmain,å‡½æ•°å£°æ˜ä¸€èˆ¬ä¸º 1int main(int argc,char *argv[]); argæ˜¯å‚æ•°ç¼©å†™,cæ˜¯count,argcä»£è¡¨å¤–éƒ¨å‚æ•°çš„ä¸ªæ•°,argvæ˜¯ä¸€ä¸ªæŒ‡å‘å­—ç¬¦æ•°ç»„çš„æŒ‡é’ˆã€‚ç®€è€Œè¨€ä¹‹å¤–éƒ¨å¯ä»¥ç»™mainä¼ é€’ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„,ä¸ªæ•°ç”±argcç¡®å®š Java1public static void main(String[] args) å­—ç¬¦ä¸²æ˜¯ä¸ªå¯¹è±¡,å¸¦äº†é•¿åº¦å±æ€§,ä¹Ÿå°±ä¸ç”¨å†å¤šä¼ ä¸€ä¸ªå‚æ•°é•¿åº¦äº† ShellShellçœ‹ä¸Šå»æœ‰ç‚¹ä¸åŒ,ä½†æ˜¯ä¹Ÿå¾ˆå¥½ç†è§£,æ¯”å¦‚ä¸‹é¢çš„æŒ‡ä»¤ 1ls ~/Desktop ls*ä¼šè¢«ä¿å­˜åœ¨$0*~/Desktop*ä¿å­˜åœ¨$1*ä»¥æ­¤ç±»æ¨ åœºæ™¯åœ¨ç”¨IntelliJ IDEAè°ƒè¯•ä¸€æ®µJavaä»£ç æ—¶,éœ€è¦åœ¨æ‰§è¡Œæ—¶ç»™Mainä¼ ä¸ªå‚ æµç¨‹ å°±è¿™æ ·","link":"/2017/03/12/Technology-IntelliJ-IDEA-main-function-pass/"},{"title":"å­¦ä¹  CocoaAsyncSocket","text":"Socketå¥—æ¥å­—ï¼ˆsocketï¼‰æ˜¯ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡å®ƒå‘é€æˆ–æ¥æ”¶æ•°æ®ï¼Œå¯å¯¹å…¶è¿›è¡Œåƒå¯¹æ–‡ä»¶ä¸€æ ·çš„æ‰“å¼€ã€è¯»å†™å’Œå…³é—­ç­‰æ“ä½œã€‚å¥—æ¥å­—å…è®¸åº”ç”¨ç¨‹åºå°†I/Oæ’å…¥åˆ°ç½‘ç»œä¸­ï¼Œå¹¶ä¸ç½‘ç»œä¸­çš„å…¶ä»–åº”ç”¨ç¨‹åºè¿›è¡Œé€šä¿¡ã€‚ç½‘ç»œå¥—æ¥å­—æ˜¯IPåœ°å€ä¸ç«¯å£çš„ç»„åˆã€‚ å¤§éƒ¨åˆ†ç³»ç»Ÿéƒ½æä¾›äº†ä¸€ç»„åŸºäºTCPæˆ–è€…UDPçš„åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼ˆAPIï¼‰ï¼Œè¯¥æ¥å£é€šå¸¸ä»¥ä¸€ç»„å‡½æ•°çš„å½¢å¼å‡ºç°ï¼Œä¹Ÿç§°ä¸ºå¥—æ¥å­—ï¼ˆSocket) ç¯å¢ƒè¯´æ˜ python2.7macOS CatalinaXcode 11.3.1CocoaAsyncSocket ea517e0cc1b33b4f706a20f521ed298adbb05378 å®éªŒä½¿ç”¨pythonåˆ†åˆ«åˆ›å»ºSocketæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯[2] æœåŠ¡ç«¯socket_service.py 123456789101112131415161718# -*- coding: utf-8 -*-import socketip_port = ('192.168.31.136', 9999)sk = socket.socket() # åˆ›å»ºå¥—æ¥å­—sk.bind(ip_port) # ç»‘å®šæœåŠ¡åœ°å€sk.listen(5) # ç›‘å¬è¿æ¥è¯·æ±‚print('å¯åŠ¨socketæœåŠ¡ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥...')conn, address = sk.accept() # ç­‰å¾…è¿æ¥ï¼Œæ­¤å¤„è‡ªåŠ¨é˜»å¡while True: # ä¸€ä¸ªæ­»å¾ªç¯ï¼Œç›´åˆ°å®¢æˆ·ç«¯å‘é€â€˜exitâ€™çš„ä¿¡å·ï¼Œæ‰å…³é—­è¿æ¥ client_data = conn.recv(1024).decode('utf-8') # æ¥æ”¶ä¿¡æ¯ if client_data == \"exit\": # åˆ¤æ–­æ˜¯å¦é€€å‡ºè¿æ¥ exit(\"é€šä¿¡ç»“æŸ\") print(\"æ¥è‡ª%sçš„å®¢æˆ·ç«¯å‘ä½ å‘æ¥ä¿¡æ¯ï¼š%s\" % (address, client_data.encode('utf-8'))) conn.sendall('recv:'+client_data.encode('utf-8')) # å›é¦ˆä¿¡æ¯ç»™å®¢æˆ·ç«¯conn.close() # å…³é—­è¿æ¥ ç”¨æˆ·ç«¯socket_client.py 123456789101112131415161718192021222324# -*- coding: utf-8 -*-import socketip_port = ('192.168.31.136', 9999) # 192.168.31.136ä¸ºæœ¬æœºåœ°å€ ifconfig æŸ¥çœ‹s = socket.socket() # åˆ›å»ºå¥—æ¥å­—s.connect(ip_port) # è¿æ¥æœåŠ¡å™¨while True: # é€šè¿‡ä¸€ä¸ªæ­»å¾ªç¯ä¸æ–­æ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼Œå¹¶å‘é€ç»™æœåŠ¡å™¨ inp = input(\"è¯·è¾“å…¥è¦å‘é€çš„ä¿¡æ¯ï¼š \").strip() if not inp: # é˜²æ­¢è¾“å…¥ç©ºä¿¡æ¯ï¼Œå¯¼è‡´å¼‚å¸¸é€€å‡º continue s.sendall(inp.encode()) if inp == \"exit\": # å¦‚æœè¾“å…¥çš„æ˜¯â€˜exitâ€™ï¼Œè¡¨ç¤ºæ–­å¼€è¿æ¥ print(\"ç»“æŸé€šä¿¡ï¼\") break server_reply = s.recv(1024).decode() print(server_reply)s.close() # å…³é—­è¿æ¥ åœ¨ç»ˆç«¯ä¸­å¯åŠ¨socket_service.py 12-&gt; python socket_service.pyå¯åŠ¨socketæœåŠ¡ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥... å¯åŠ¨socket_client.py è¾“å…¥\"hello\" 12345678# å®¢æˆ·ç«¯-&gt; python socket_client.pyè¯·è¾“å…¥è¦å‘é€çš„ä¿¡æ¯ï¼š \"hello\"recv:helloè¯·è¾“å…¥è¦å‘é€çš„ä¿¡æ¯ï¼š# æœåŠ¡å™¨æ¥è‡ª('192.168.31.136', 58160)çš„å®¢æˆ·ç«¯å‘ä½ å‘æ¥ä¿¡æ¯ï¼šhello æ–°å¼€ä¸€ä¸ªæœåŠ¡ç«¯socketçª—å£,ä½¿ç”¨æµè§ˆå™¨è®¿é—® 1234567891011# æœåŠ¡å™¨æ¥è‡ª('192.168.31.136', 58258)çš„å®¢æˆ·ç«¯å‘ä½ å‘æ¥ä¿¡æ¯ï¼šGET / HTTP/1.1Host: 192.168.31.136:9999Connection: keep-aliveCache-Control: max-age=0Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9Accept-Encoding: gzip, deflateAccept-Language: en-US,en;q=0.9,zh-CN;q=0.8,zh;q=0.7 ä½¿ç”¨æµè§ˆå™¨è®¿é—®,ä½¿ç”¨HTTPåè®®è®¿é—®,ä¼ è¾“å±‚å®ç°äº†ç«¯åˆ°ç«¯çš„ä¼ è¾“(èƒ½åŠ›),ä½†æ˜¯ä¿¡æ¯è¦è¢«æ­£ç¡®çš„ç†è§£,éœ€è¦ä¸€äº›è¯´æ˜,æ¯”å¦‚ä¸Šé¢HTTP è¯·æ±‚å¤´,æ“ä½œç³»ç»Ÿæ‹¥æœ‰ä¼ è¾“å±‚çš„èƒ½åŠ›,å¹¶åŒ…è£…äº†ä¸€ç»„æŠ½è±¡çš„ç¼–ç¨‹æ¥å£(Socket),åº”ç”¨å±‚åè®®é€šè¿‡è°ƒç”¨Socketå®ç°ä¿¡æ¯çš„ä¼ è¾“å¹¶åˆ¶å®šæ ¼å¼ç”¨äºç†è§£ä¿¡æ¯ã€‚ Socketçš„æµç¨‹ æ¥è‡ªç½‘ç»œ CocoaAsyncSocketCocoaAsyncSocketä¸ºmacOSï¼ŒiOSå’ŒtvOSæä¾›äº†æ˜“äºä½¿ç”¨ä¸”åŠŸèƒ½å¼ºå¤§çš„å¼‚æ­¥å¥—æ¥å­—åº“ã€‚ å®¢æˆ·ç«¯Socketå®ç°å®¢æˆ·ç«¯socket,å‚è€ƒä¸Šå›¾,ä¸»è¦ä¸ºåˆ›å»ºsocket,è¿æ¥,å‘é€,æ¥æ”¶,å…³é—­æµç¨‹ 12345678910111213141516171819/// åˆ›å»º``Socket``/// æŒ‡å®šä»£ç†åŠä»£ç†å›è°ƒçš„é˜Ÿåˆ—_socket = [[GCDAsyncSocket alloc] initWithDelegate:self delegateQueue:dispatch_get_main_queue()];// è¿æ¥NSError *err = nil;if (![_socket connectToHost:@\"192.168.31.136\" onPort:9999 error:&amp;err]) { // If there was an error, it's likely something like \"already connected\" or \"no delegate set\" NSLog(@\"I goofed: %@\", err);}// å‘é€NSString *requestString = @\"AsyncSocket request string 1\";NSData *requestData = [requestString dataUsingEncoding:NSUTF8StringEncoding]; [_socket writeData:requestData withTimeout:-1 tag:1];// æ¥æ”¶[_socket readDataWithTimeout:10 tag:1]; ä»£ç†å›è°ƒè¿æ¥æˆåŠŸ 123- (void)socket:(GCDAsyncSocket *)sock didConnectToHost:(NSString *)host port:(uint16_t)port { NSLog(@\"%@ - %@ - %hu\",sock,host,port);} å‘é€æˆåŠŸ 1234567- (void)socket:(GCDAsyncSocket *)sock didWriteDataWithTag:(long)tag { if (tag == 1) { NSLog(@\"First request sent\"); }else if(tag == 2) { NSLog(@\"Second request sent\"); }} æ¥æ”¶æˆåŠŸ 12345678- (void)socket:(GCDAsyncSocket *)sender didReadData:(NSData *)data withTag:(long)tag{ if (tag == 1) { NSLog(@\"%@\",[[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding]); }else if (tag == 2) { NSLog(@\"%@\",[[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding]); }} ç¡®ä¿çœŸæœºå’Œmacå¤„äºåŒä¸€å±€åŸŸç½‘,è¾“å‡ºæ•ˆæœå¦‚ä¸‹: èƒ½æˆåŠŸè¿æ¥,å‘é€ä¿¡æ¯ç»™æœåŠ¡ç«¯ä¸”æ¥æ”¶æœåŠ¡ç«¯è¿”å›çš„ä¿¡æ¯ è¿æ¥åœ¨è¿æ¥çš„å›è°ƒä¸­è®¾ç½®æ–­ç‚¹,å¹¶è¿›è¡Œè¿½è¸ª å¯¹äºè¿æ¥æ“ä½œ,é‡‡ç”¨å¼‚æ­¥çš„å¹¶å‘é˜Ÿåˆ—è¿›è¡Œç®¡ç†,æé«˜è¿æ¥æ•ˆç‡,è°ƒç”¨ç³»ç»Ÿæä¾›socket.hä¸­çš„connectæ–¹æ³• 1int connect(int, const struct sockaddr *, socklen_t) __DARWIN_ALIAS_C(connect); 12345678connect - initiate a connection on a socketThe connect() system call connects the socket referred to by the file descriptor sockfd to the address specified by addr. The addrlen argument specifies the size of addr. If the connection or binding succeeds, zero is returned. On error, -1 is returned, and errno is set appropriately. è¿æ¥å®Œæˆå,ç»Ÿä¸€å›è°ƒåˆ°socketQueueé˜Ÿåˆ—,è°ƒç”¨didConnect:æ–¹æ³• SetupStreamPart1() ç»è¿‡ä¸€äº›å®¹é”™åˆ¤æ–­å,è°ƒç”¨CFStreamCreatePairWithSocket åˆ›å»ºè¿æ¥åˆ°å¥—æ¥å­—çš„å¯è¯»å’Œå¯å†™æµ includeReadWriteå‚æ•°ä¸ºNO,å¯¹Streamåœ¨è¯»å†™æ“ä½œä¸­å‘ç”Ÿé”™è¯¯å’Œå®Œæˆæ³¨å†Œå›è°ƒå‡½æ•° dispatch_async(delegateQueue,... å¼‚æ­¥å›è°ƒåˆ°ä»£ç†é˜Ÿåˆ—(åˆå§‹åŒ–æ—¶å¯æŒ‡å®š,æ­¤å¤„ä¸ºä¸»é˜Ÿåˆ—)æ‰§è¡Œä»£ç†æ–¹æ³• SetupStreamsPart2() å›åˆ°socketQueue åœ¨startCFStreamThreadIfNeededæ–¹æ³•ä¸­åˆ›å»ºä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—,ä»¥åŒæ­¥çš„æ–¹å¼æ–°å»ºä¸€æ¡å­çº¿ç¨‹å¹¶å¼€å¯è¿è¡Œå¾ªç¯ åŒæ—¶åœ¨addStreamsToRunLoopä¸­,å°†åˆ›å»ºçš„è¯»å†™æµä½œä¸ºäº‹ä»¶æºé¡ºåºæ·»åŠ åˆ°åˆšåˆ›å»ºçš„å­çº¿ç¨‹çš„runloopä¸­,ç¡®ä¿å‘ç”Ÿå¯¹åº”äº‹ä»¶æ—¶,runloopèƒ½é¡ºåˆ©æ´¾å‘ã€‚ å›åˆ°didConnect:æ–¹æ³•ä¸­, socketå¼€å¯éé˜»å¡IO,æ³¨å†Œè¯»å†™æ“ä½œçš„å›è°ƒ,åŒæ—¶å°è¯•è¿›è¡Œè¯»å†™æ“ä½œ æ‰§è¡ŒåŸæ¥çš„ä¸¤ä¸ªè¯»æ“ä½œ å‚è€ƒ ç™¾ç§‘ - å¥—æ¥å­— socketç¼–ç¨‹ connect2 iOSç½‘ç»œç¼–ç¨‹ä¹‹CFNetwork Introduction to non-blocking I/O","link":"/2020/03/05/Technology-Learn-CocoaAsyncSocket/"},{"title":"MWebå›¾åºŠé…ç½®","text":"é—²è¯ å°è¯•è¿‡å‡ ä¸ªæ”¯æŒmarkdownçš„ç¼–è¾‘å™¨,æ¯”å¦‚MacDown,Ulysses,è¿˜æ˜¯è§‰å¾—MWebæ¯”è¾ƒåˆæˆ‘çš„å¿ƒæ„,åŸæ¥å°±çŸ¥é“MWebæœ‰å›¾åºŠçš„åŠŸèƒ½,ä½†æ˜¯ä¸€ç›´æ²¡æœ‰ç”¨,ä¸»è¦æ˜¯å› ä¸ºè§‰å¾—æœ‰äº›éº»çƒ¦,MWebæ”¯æŒGoogle photos(åº”è¯¥ä¸ä¼šä½¿ç”¨è¿™ä¸ª),imgur,ä¸ƒç‰›(è¿™ä¸¤ä¸ªéƒ½è¦æ³¨å†Œ,æˆ‘ç”¨sm.msç›´æ¥å°±OKäº†,æ„Ÿè§‰ä¹ŸæŒºæ–¹ä¾¿çš„),è¯´ç™½äº†ä¸»è¦å°±æ˜¯å› ä¸ºæ‡’,ä¸æƒ³è‡ªå®šä¹‰é…ç½®,å½“ç„¶ä¹Ÿä¸‹è¿‡iPicè¿™æ ·çš„å°å·¥å…·,åŒæ ·ä¹Ÿæœªæ›¾ä½¿ç”¨,å› ä¸ºæˆ‘è§‰å¾—å½“æˆ‘é…ç½®å¥½MWebåè‡ªç„¶ä¹Ÿå¯ä»¥ä¸ç”¨è¿™æ ·çš„å·¥å…·ã€‚å¶ç„¶ä»è®¢é˜…çš„RSSä¸­çœ‹åˆ°å¹•å-ä¸“è®¿MWeb,å†³å®šæ²»æ²»è‡ªå·±çš„æ‹–å»¶ç—‡ã€‚ imgur å¥½å§,é—²è¯å°±ä¸æ‰¯äº†,è¯´æ­£é¢˜å§,ä¸€å¼€å§‹è€ƒè™‘,æ—¢ç„¶å·²ç»æœ‰æ”¯æŒçš„äº†,å°±ç”¨imgur,ç„¶åå°±æœç´¢imgurå®˜ç½‘,æ³¨å†Œ,æŠ¥é”™äº† é”™è¯¯ä¿¡æ¯ Imgur is temporarily over capacity. Please try again later æœç´¢å,å‘ç°è¯´è¿™å’Œç½‘ç»œè¿˜æ˜¯æœ‰å…³ç³»,ä¸ºäº†é¿å…ä»¥åå‡ºé—®é¢˜,æˆ‘é€‰æ‹©æ¢ä¸€å®¶ ä¸ƒç‰› é‚£æˆ‘å°±æ¢ä¸€ç§,æ¢æˆä¸ƒç‰›çš„,æœäº†ä¸€ç¯‡çŸ¥ä¹ä¸Šçš„å›½å†…æœ‰ä»€ä¹ˆæ–¹ä¾¿çš„å›¾åºŠï¼Ÿ,é‡Œé¢è¯´è¦ä»˜è´¹,æˆ‘æ²¡å»è¯•,æ‰€ä»¥ä¸çŸ¥é“ç°åœ¨æ˜¯ä¸æ˜¯éœ€è¦ä»˜è´¹ã€‚ è‡ªå®šä¹‰ å‰é¢é‚£äº›éƒ½åªæ˜¯é“ºå«,ä¸€å¼€å§‹æˆ‘å°±æƒ³è‡ªå®šä¹‰é…ç½®å›¾åºŠã€‚æ­£å¥½å‘ç°sm.msæä¾›äº†API å‚è€ƒå›¾ç‰‡ä¸Šä¼ çš„æ¥å£,è¦å¡«å†™çš„å­—æ®µä¸»è¦æœ‰Name,å¡«sm.msæˆ–å…¶ä»–ä½ å–œæ¬¢çš„åç§°å°±å¥½äº†,API URL,æ¥å£ä¸­æœ‰å¡«https://sm.ms/api/upload,POST File Nameå­—æ®µæ ¹æ® å¯çŸ¥,å¡«å†™smfileå³å¯,Response URL PATH,ä¸€å¼€å§‹ä¸çŸ¥é“å¡«ä»€ä¹ˆ,æœç´¢å,å‘ç°iOS ç‰ˆ MWeb å›¾åºŠåŠŸèƒ½ä¸­è‡ªå®šä¹‰å›¾åºŠçš„ä½¿ç”¨æŒ‡å—,å¥½å§,MWebä½œè€…å·²ç»å†™äº†å¦‚ä½•é…ç½®å›¾åºŠğŸ˜‚,è¿™ä¸ªå­—æ®µå¡«å†™çš„å°±æ˜¯è¿”å›çš„JSONç»“æœä¸­çš„å›¾ç‰‡çš„è·¯å¾„,æ ¹æ® å¡«data/urlå°±å¥½äº†,æœ€åä¸€ä¸ªæ˜¯å¯é€‰,æˆ‘æ²¡å¡«,ç„¶åValidate,è¿™é‡Œå‡ºç°ä¸€ä¸ªé—®é¢˜,åœ¨macOS 10.12.3ä¸Š,MWeb 2.1.4(257)ä¸­,å…¨å±æ¡ä»¶ä¸‹ä¼šå‡ºç° æˆ‘å¿…é¡»é€‰ä¸­å¼¹çª—,ç„¶ååˆ‡åˆ°å…¶ä»–çª—å£,ç„¶åå†åˆ‡å›æ¥é€‰æ‹©å›¾ç‰‡,ä¸Šä¼ æµ‹è¯• æœ€ååœ¨å®Œæˆä¹‹å ä¸Šä¼ æœ¬åœ°å›¾ç‰‡ é€‰æ‹©Copy Markdownå°±å¯ä»¥å¾—åˆ°åŒ…å«ä¸Šä¼ å›¾ç‰‡è·¯å¾„åçš„åšå®¢å†…å®¹,æ•ˆç‡æé«˜äº†ä¸å°‘,è€Œä¸”å¤‡ä»½ä¹Ÿå®¹æ˜“äº†ä¸€ç‚¹ã€‚èŠ±ç‚¹æ—¶é—´æŠ¬å¤´çœ‹çœ‹å¤©,æ¯”ä¸€ç›´è€è€å®å®çš„å¹²æ´»,æœ‰ç”¨ä¸€äº›ã€‚","link":"/2017/02/04/Technology-MWeb-map-bed-configuration/"},{"title":"Macç»ˆç«¯ç¯å¢ƒèµ°ä»£ç†","text":"å‰è¨€ ä½œä¸ºç¨‹åºå‘˜,æœ‰æ—¶å€™åœ¨ç»ˆç«¯ç¯å¢ƒä¸‹ä¹Ÿéœ€è¦ç¿»å¢™çš„èƒ½åŠ›,å› æ­¤ç»§ç»­æŠ˜è…¾ä¸€ä¸‹ã€‚ ç¯å¢ƒ macOS Sierra 10.12.3 æµç¨‹å®‰è£…privoxy é€šè¿‡Wiki-Shadowsockså¯çŸ¥,ssä½¿ç”¨çš„æ˜¯Socks5ä»£ç†æ–¹å¼ã€‚ç½‘ä¸Šæœç´¢çš„å¾—åˆ°çš„ç»“æœæ˜¯åœ¨macç¯å¢ƒä¸‹æ¨èä½¿ç”¨privoxyè¿™ä¸ªçš„å·¥å…·ã€‚ ä½¿ç”¨brewå®‰è£…privoxy 1Â» ~ brew install privotxy ä¼šæç¤ºæƒé™é—®é¢˜ install: /usr/local/etc/â€¦: Permission denied å¯ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ä¿®æ”¹/usr/localç›®å½•çš„æ‰€æœ‰è€…ä¸ç»„ 1Â» ~ sudo chown -R \"$USER\":admin /usr/local ä½†è¿™ä¹ˆåšåˆé€‚å—? æ ¹æ®Unixç›®å½•ç»“æ„çš„æ¥å† å› ä¸º/usr/localæ˜¯ç”¨æ¥å­˜æ”¾ç”¨æˆ·è‡ªå·±å®‰è£…çš„ç¨‹åº,æˆ‘è®¤ä¸ºåº”è¯¥æ²¡é—®é¢˜ é‡æ–°æ‰§è¡Œå®‰è£…privoxyçš„æŒ‡ä»¤ã€‚ å®‰è£…æˆåŠŸ é…ç½®privoxyæ‰“å¼€é…ç½®æ–‡ä»¶/usr/local/etc/privoxy/config åˆ°æ·»åŠ ä»¥ä¸‹ä¸¤è¡Œé…ç½® 12listen-address 0.0.0.0:8118forward-socks5 / localhost:1080 . æ³¨æ„ä¸è¦å¿˜äº†åé¢çš„ . , ssçš„é»˜è®¤ç«¯å£ä¸º1080 ä¸ºä»€ä¹ˆæ˜¯8118 ä»ä¸Šå›¾å¯çŸ¥privoxyçš„é»˜è®¤ç«¯å£ä¸º8118 å¼€å¯privoxy1Â» ~ /usr/local/sbin/privoxy /usr/local/etc/privoxy/config æŸ¥çœ‹æ˜¯å¦æˆåŠŸå¼€å¯8118ç«¯å£è¿›è¡Œç›‘å¬ 12Â» ~ netstat -na | grep 8118tcp4 0 0 *.8118 *.* LISTEN è®¾ç½®ä»£ç†æœåŠ¡å™¨12export http_proxy='http://localhost:8118'export https_proxy='http://localhost:8118' ä¸ºäº†é¿å…æ¯æ¬¡å¼€æœºéƒ½èƒ½ç”Ÿæ•ˆ,å¯ä»¥å°†ä¸Šé¢ä¸¤å¥é…ç½®æ·»åŠ åˆ°.zshrc/.bashrc_profileä¸­ æ•ˆæœå›¾ç”¨curlè®¿é—®google å…³äºåŸç† Socks5ä»£ç†è½¬åŒ–æˆhttpä»£ç†ç»™å‘½ä»¤è¡Œç»ˆç«¯ä½¿ç”¨? æ ¹æ®æ•´ä¸ªæµç¨‹çš„é…ç½®ä¸‹æ¥,æˆ‘è§‰å¾—è¿™æ ·çš„æè¿°å¥½åƒæœ‰å“ªå„¿è¯´ä¸é€šã€‚ ç”¨ç»ˆç«¯curl www.google.com,ç»ˆç«¯èµ°çš„æ˜¯httpsè¯·æ±‚ å› ä¸ºé…ç½®https_proxyæ‰€ä»¥ä¼šèµ°æœ¬æœºçš„8118ç«¯å£ è€Œprivoxyç›‘å¬äº†8118åˆä¼šæŠŠè¯·æ±‚æ´¾å‘(Forwarding)ç»™1080çš„ss,è®©sså»è¯·æ±‚ é€šè¿‡privoxyå°†åŸæ¥èµ°httpçš„è¯·æ±‚å˜æˆäº†èµ°Socks5ä»£ç† å‰¯äº§å“ åœ¨/usr/local/etc/privoxy/configé…ç½®æ–‡ä»¶ä¸­æœ‰listen-address 0.0.0.0:8118,è¡¨æ˜ipæ˜¯ä¸é™åˆ¶çš„,æ‰‹æœºåªè¦è®¾ç½®äº†ä»£ç†,ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚ å‚è€ƒ Wiki-Shadowsocks How to fix homebrew permissions? Macå‘½ä»¤è¡Œç»ˆç«¯ä¸‹ä½¿ç”¨shadowsocksç¿»å¢™ Unixç›®å½•ç»“æ„çš„æ¥å† Mac OSä¸‹ä½¿ç”¨Privoxyåšä¸­è½¬ä»£ç† Mac OSä¸‹ä½¿ç”¨Privoxyåšä¸­è½¬ä»£ç†","link":"/2017/02/19/Technology-Mac-terminal-environment/"},{"title":"ReactNative å…¥é—¨ä½“éªŒ","text":"ç¯å¢ƒ macOS Mojave Version 10.14.3Xcode 10.1iPhone 5s 10.0.1node v11.10.0npm 6.7.0React Native 0.58react 16.6.3 æ–°å»ºReactNativeé¡¹ç›®12brew install nodebrew install watchman å®‰è£…React Nativeå‘½ä»¤è¡Œå·¥å…·1npm install -g react-native-cli å®‰è£…XcodeåŠå‘½ä»¤è¡Œç›¸å…³å·¥å…·æˆ–è€… 1234567## man xcode-select## xcode-select - Manages the active developer directory for Xcode and BSD## tools.## --install## Opens a user interface dialog to request automatic installation## of the command line developer tools.xcode-select --install è¯¦æƒ…å‚è€ƒè‹±æ–‡-doc é“¾æ¥2/ä¸­æ–‡-doc é“¾æ¥11 åˆ›å»ºæ–°åº”ç”¨å‘½ä»¤è¡Œ1react-native init AwesomeProject WebStorm è‹¥nodeç‰ˆæœ¬è¿‡ä½å¯èƒ½å‡ºç°Command yarn add react-native --exact` failed.,å¯å‚è€ƒUpgrade Node.js to the latest version on Mac OSå‡çº§node è§‚å¯Ÿæ—¥å¿—çš„è¾“å‡ºç”Ÿæˆå·¥ç¨‹æ‰§è¡Œçš„æ˜¯ 1/Users/`userName`/.nvm/versions/node/v11.10.0/bin/node /Users/`userName`/.nvm/versions/node/v11.10.0/lib/node_modules/react-native-cli/index.js init AwesomeProject æŸ¥çœ‹react-nativeä½ç½® 123which react-native## è¾“å‡º/Users/`userName`/.nvm/versions/node/v11.10.0/bin/react-native è¿è¡ŒReact Nativeåº”ç”¨åŒæ ·æ ¹æ®çª—å£æ—¥å¿—çš„è¾“å‡º,iOSè¿è¡Œçš„æ–¹æ³•å¯ä»¥ç”¨å‘½ä»¤è¡Œæˆ–ç›´æ¥ä½¿ç”¨Xcodeæ‰“å¼€è¿è¡Œ ä½¿ç”¨å‘½ä»¤è¡Œæ–¹å¼ 12345678## cdåˆ°å·¥ç¨‹ç›®å½•ä¸‹cd /Users/`userName`/WebstormProjects/AwesomeProject## æ‰§è¡Œreact-native run-iosFound Xcode project AwesomeProject.xcodeproj... bla bla bla&gt; Running script 'Install Third Party' å¯åŠ¨æ¨¡æ‹Ÿå™¨,ç„¶åå®‰è£…ä¸‹è½½ç¬¬ä¸‰æ–¹çš„ç»„ä»¶,ä¸‹è½½çš„è„šæœ¬æ˜¯scripts/ios-install-third-party.sh 12345678if [ -d \"$HOME/.rncache\" ]; then cachedir=\"$HOME/.rncache\" # react-native 0.57.8 and olderelse cachedir=\"$HOME/Library/Caches/com.facebook.ReactNativeBuild\"fimkdir -p \"$cachedir\"... ç¼“å­˜ç›®å½•æ—§ç‰ˆåœ¨å®¶ç›®å½•çš„.rncache,å¦‚æœå­˜åœ¨è¯¥ç›®å½•,åˆ™ä¸‹è½½çš„åº“å°±ä¼šå®‰è£…åœ¨æ­¤å¤„,è‹¥ç½‘ç»œåŸå› æ— æ³•ä¸‹è½½,å¯å‚è€ƒiOS RN 0.45ä»¥ä¸Šç‰ˆæœ¬æ‰€éœ€çš„ç¬¬ä¸‰æ–¹ç¼–è¯‘åº“(boostç­‰),æ‰‹åŠ¨ä¸‹è½½å³å¯ ä½†æ˜¯,è¿è¡Œå¤±è´¥äº† 123456789101112131415161718Installing build/Build/Products/Debug-iphonesimulator/AwesomeProject.appAn error was encountered processing the command (domain=NSPOSIXErrorDomain, code=22):Failed to install the requested applicationThe bundle identifier of the application could not be determined.Ensure that the application's Info.plist contains a value for CFBundleIdentifier.Print: Entry, \":CFBundleIdentifier\", Does Not ExistCommand failed: /usr/libexec/PlistBuddy -c Print:CFBundleIdentifier build/Build/Products/Debug-iphonesimulator/AwesomeProject.app/Info.plistPrint: Entry, \":CFBundleIdentifier\", Does Not ExistError: Command failed: /usr/libexec/PlistBuddy -c Print:CFBundleIdentifier build/Build/Products/Debug-iphonesimulator/AwesomeProject.app/Info.plistPrint: Entry, \":CFBundleIdentifier\", Does Not Exist at checkExecSyncError (child_process.js:637:11) at Object.execFileSync (child_process.js:655:13) at Promise.then (/Users/Jason/WebstormProjects/AwesomeProject/node_modules/react-native/local-cli/runIOS/runIOS.js:208:5) at processTicksAndRejections (internal/process/next_tick.js:81:5) å†å¾€ä¸Šçœ‹,ç¼–è¯‘æ—¶å°±å·²ç»å¤±è´¥äº† 1234âŒ /Users/Jason/WebstormProjects/AwesomeProject/node_modules/react-native/third-party/folly-2018.10.22.00/folly/detail/RangeCommon.h:22:10: 'glog/logging.h' file not found#include &lt;glog/logging.h&gt; ^ ç”¨Xcode çš„æ–¹å¼è¯•è¯• é€‰æ‹©æ¨¡æ‹Ÿå™¨å¹¶ç¼–è¯‘ é™¤äº†jsiä¸­RangeCommon.hçš„glog/logging.hæ‰¾ä¸åˆ°ä»¥å¤–,è¿™ä¸ªä¸ä½¿ç”¨å‘½ä»¤è¡Œè¿è¡Œæ—¶æ˜¯ä¸€æ ·,åˆå¤šäº†ä¸‰ä¸ªé”™è¯¯,å‰©ä¸‹çš„3ä¸ªé”™è¯¯,å‚è€ƒSupporting Xcode 10 and the new Xcode build system,RNçš„ä¸€ä¸ªissue,è°ƒæ•´å·¥ç¨‹çš„ç¼–è¯‘ç³»ç»Ÿ,å†æ¬¡ç¼–è¯‘ ç°åœ¨é”™è¯¯å˜æˆä¸€æ ·äº†,éƒ½æ˜¯æ–‡ä»¶æ‰¾ä¸åˆ°,æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆæ‰¾ä¸åˆ°,React.xcodeproj &gt; ThirdParty &gt; glog &gt; glogä¸‹,ç¡®å®ç¼ºå°‘æ–‡ä»¶ jsiä¾èµ–äºdouble-conversiondouble-conversionæ‰§è¡Œäº†ios-install-third-party.sh,å¹¶æœªèƒ½æˆåŠŸè¾“å‡ºéœ€è¦çš„å¤´æ–‡ä»¶ 1234567891011121314151617181920212223242526272829## ios-install-third-party.shfunction fetch_and_unpack () { file=$1 url=$2 hash=$3 cmd=$4 ... if [ \"$fetched\" = \"yes\" ] || [ ! -f \"third-party/$dir/.installed\" ]; then (cd third-party; ## &lt;2&gt; rm -rf \"$dir\" echo Unpacking \"$cachedir/$file\"... if ! tar zxf \"$cachedir/$file\"; then file_fail \"$cachedir/$file\" \"Unpacking '$cachedir/$file' failed\" fi cd \"$dir\" eval \"${cmd:-true}\" &amp;&amp; touch .installed) fi}## &lt;1&gt;mkdir -p third-partySCRIPTDIR=$(dirname \"$0\")fetch_and_unpack glog-0.3.5.tar.gz https://github.com/google/glog/archive/v0.3.5.tar.gz 61067502c5f9769d111ea1ee3f74e6ddf0a5f9cc \"\\\"$SCRIPTDIR/ios-configure-glog.sh\\\"\"... cdåˆ°third-partyç›®å½•,å°†ç¼“å­˜ç›®å½•ä¸‹çš„åŒ…è§£å‹ç¼©,å¹¶æ‰§è¡Œå¯¹åº”çš„æŒ‡ä»¤,æ¯”å¦‚glog-0.3.5å°±æ‰§è¡Œ 1$SCRIPTDIR/ios-configure-glog.sh 123456789101112131415### ios-configure-glog.sh./configure --host arm-apple-darwin# Fix build for tvOScat &lt;&lt; EOF &gt;&gt; src/config.h...# Prepare exported header includeEXPORTED_INCLUDE_DIR=\"exported/glog\"mkdir -p exported/glogcp -f src/glog/log_severity.h \"$EXPORTED_INCLUDE_DIR/\"cp -f src/glog/logging.h \"$EXPORTED_INCLUDE_DIR/\"cp -f src/glog/raw_logging.h \"$EXPORTED_INCLUDE_DIR/\"cp -f src/glog/stl_logging.h \"$EXPORTED_INCLUDE_DIR/\"cp -f src/glog/vlog_is_on.h \"$EXPORTED_INCLUDE_DIR/\" æ‰§è¡Œè¯¥è„šæœ¬æ‰§è¡Œconfigureå¹¶åˆ›å»ºexported/glogç›®å½•,ç„¶åå°†configureè¿‡ç¨‹ä¸­ç”Ÿæˆçš„æ–‡ä»¶cpåˆ°è¯¥ç›®å½•,æ‰§è¡Œios-configure-glog.shå ç»“æœå¦‚ä¸‹: è¿™æ˜¯æ­£å¸¸çš„,ä½†æ˜¯âŒ˜ + Bå†æ¬¡ç¼–è¯‘ååˆæŠ¥äº†ç›¸åŒçš„é”™è¯¯,å¯¹æ¯”Xcodeä¸ç»ˆç«¯æ‰§è¡Œçš„æ—¥å¿—ç»“æœå‘ç°,Xcodeæ‰§è¡Œæ—¶checking whether the C compiler works... å¤±è´¥äº† æŸ¥æ‰¾å…³äº'glog/logging.h' file not found,æ ¹æ®â€˜glog/logging.hâ€™ file not foundå¾—åˆ°çš„è§£å†³æ–¹æ¡ˆæ˜¯ 12cd node_modules/react-native/third-party/glog-0.3.5sh ../../scripts/ios-configure-glog.sh ä¸Šé¢å·²ç»æ‰§è¡Œè¿‡äº†,ç”¨Xcodeé‡æ–°ç¼–è¯‘è¿˜ä¼šå‡ºç°é—®é¢˜ å‚è€ƒreact-native/pull/23511 æ‰‹åŠ¨ä¿®æ”¹ios-configure-glog.shæ–‡ä»¶ 123...export CXX=\"$(xcrun -find -sdk $PLATFORM_NAME cc) -arch $CURRENT_ARCH -isysroot $(xcrun -sdk $PLATFORM_NAME --show-sdk-path)\"... è¯•äº†ä»¥å,ç”¨Xcodeç¼–è¯‘ä¾ç„¶æŠ¥é”™ã„Ÿ( â–”, â–” )ã„ ä¸ºä»€ä¹ˆæœ‰../../åœ¨ä¸Šé¢çš„ä»£ç çš„&lt;1&gt;å¤„å¯çŸ¥,../..å,å½“å‰ä½ç½®ä¼šåœ¨.../react-nativeç›®å½•ä¸‹,è¦åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºthird-partyç›®å½•,åŒæ—¶åˆè¦ä¿è¯SCRIPTDIRèƒ½æ­£ç¡®å®šä½åˆ°ios-configure-glog.shå»æ‰§è¡Œã€‚ è¿™æ ·åšåè¿˜æ˜¯å¤±è´¥,å› ä¸º&lt;2&gt;å¤„ç§»é™¤å,é‡æ–°æ‰§è¡Œ,åŒæ ·å› ä¸ºconfigureå¤±è´¥å¯¼è‡´æ— æ³•ç”Ÿæˆ.hæ–‡ä»¶ã€‚ è§£å†³æ–¹æ³•åœ¨ç»ˆç«¯æ ¹æ®ä¸Šé¢æåˆ°çš„æ–¹æ³•æ‰§è¡Œios-install-third-party.shå 12# æ³¨é‡Šä¸‹é¢è¿™å¥# fetch_and_unpack glog-0.3.5.tar.gz https://github.com/google/glog/archive/v0.3.5.tar.gz 61067502c5f9769d111ea1ee3f74e6ddf0a5f9cc \"\\\"$SCRIPTDIR/ios-configure-glog.sh\\\"\" é¿å…å»åˆ é™¤glogè¿™ä¸ªåŒ…,ç„¶åå†ç”¨Xcodeè¿›è¡Œç¼–è¯‘å°±æ­£å¸¸äº†,è¿è¡Œæ—¶æ¨¡æ‹Ÿå™¨ä¸‹è¿˜æ˜¯ä¼šå´©æºƒ,çœŸæœºèƒ½æ­£å¸¸è¿è¡Œã€‚ èµ„æºåœ°å€è·å–ä¸æ­£ç¡®,æœ‰ç½‘ç»œä»£ç†å·¥å…·çš„æƒ…å†µæ—¶,æ¯”å¦‚SS,å°†å…¶è°ƒæˆè‡ªåŠ¨ä»£ç†æˆ–å…³é—­ Hello worldä¿®æ”¹App.js 12345678910111213141516export default class App extends Component&lt;Props&gt; { render() { // return ( // &lt;View style={styles.container}&gt; // &lt;Text style={styles.welcome}&gt;Welcome to React Native!&lt;/Text&gt; // &lt;Text style={styles.instructions}&gt;To get started, edit App.js&lt;/Text&gt; // &lt;Text style={styles.instructions}&gt;{instructions}&lt;/Text&gt; // &lt;/View&gt; // ); return ( &lt;View style={{ flex: 1, justifyContent: \"center\", alignItems: \"center\",backgroundColor: '#F5FCFF', }}&gt; &lt;Text&gt;Hello world!&lt;/Text&gt; &lt;/View&gt; ); }} è¦ä½¿ç”¨backgroundColor: '#F5FCFF'è®¾ç½®èƒŒæ™¯è‰² é›†æˆReactNativeåˆ°å·²æœ‰é¡¹ç›®å»ºç«‹ç›®å½•ç»“æ„æ–°å»ºä¸€ä¸ªç›®å½•å»é›†æˆRNå·¥ç¨‹,å°†Xcodeå·¥ç¨‹å¤åˆ¶åˆ°RNä¸‹çš„ioså­ç›®å½• å®‰è£…JavaScriptä¾èµ–åº“åœ¨RNå·¥ç¨‹æ ¹ç›®å½•ä¸‹,åˆ›å»ºpackage.jsonæ–‡ä»¶ 12345678{ \"name\": \"AnNativeApp\", \"version\": \"0.0.1\", \"private\": true, \"scripts\": { \"start\": \"node node_modules/react-native/local-cli/cli.js start\" }} 12345678910111213## è‹¥ yarn ä¸å­˜åœ¨,å®‰è£…## brew install yarnyarn add react-native## å®‰è£…React# warning \" &gt; react-native@0.58.5\" has unmet peer dependency \"react@16.6.3\".# è€Œä¸”åŸæ¥ä½¿ç”¨``WebStorm``ç”Ÿæˆçš„``package.json``ä¸­åŒ…å«çš„``react``å’Œ``react-native``,æ‰€ä»¥``react``ä¹Ÿé€‰16.6.3# \"dependencies\": {# \"react\": \"16.6.3\",# \"react-native\": \"0.58.5\"# },yarn add react@version_printed_above æŠŠnode_modulesæ·»åŠ åˆ°.gitignoreæ–‡ä»¶ä¸­ 12# å°†``WebStorm``ç”Ÿæˆçš„.gitignoreå¤åˆ¶åˆ°``RN``æ ¹ç›®å½•ä¸‹å³å¯cp .gitignore ~/Desktop/AnNativeApp/ ä½¿ç”¨CocoaPodsé›†æˆåœ¨iosç›®å½•ä¸‹,åˆå§‹åŒ–pod inité…ç½® 1pod init 123456789101112131415161718192021222324252627282930313233343536platform :ios, '9.0'target 'AnNativeApp' do # Uncomment the next line if you're using Swift or would like to use dynamic frameworks # use_frameworks! # Your 'node_modules' directory is probably in the root of your project, # but if not, adjust the `:path` accordingly pod 'React', :path =&gt; '../node_modules/react-native', :subspecs =&gt; [ 'Core', 'CxxBridge', # Include this for RN &gt;= 0.47 'DevSupport', # Include this to enable In-App Devmenu if RN &gt;= 0.43 'RCTText', 'RCTNetwork', 'RCTWebSocket', # Needed for debugging 'RCTAnimation', # Needed for FlatList and animations running on native UI thread # Add any other subspecs you want to use in your project ] # Explicitly include Yoga if you are using RN &gt;= 0.42.0 pod 'yoga', :path =&gt; '../node_modules/react-native/ReactCommon/yoga' # Third party deps podspec link pod 'DoubleConversion', :podspec =&gt; '../node_modules/react-native/third-party-podspecs/DoubleConversion.podspec' pod 'glog', :podspec =&gt; '../node_modules/react-native/third-party-podspecs/glog.podspec' pod 'Folly', :podspec =&gt; '../node_modules/react-native/third-party-podspecs/Folly.podspec' target 'AnNativeAppTests' do inherit! :search_paths # Pods for testing end target 'AnNativeAppUITests' do inherit! :search_paths # Pods for testing endend 1pod install å¯èƒ½ä¼šç¢°åˆ°å¦‚ä¸‹çš„é”™è¯¯ 1234567891011...Installing boost-for-react-native (1.63.0)[!] Error installing boost-for-react-native[!] /usr/local/bin/git clone https://github.com/react-native-community/boost-for-react-native.git /var/folders/lk/znn1qp4925j412wt4t_qkplc0000gn/T/d20190222-11171-yp7x2 --template= --single-branch --depth 1 --branch v1.63.0-0Cloning into '/var/folders/lk/znn1qp4925j412wt4t_qkplc0000gn/T/d20190222-11171-yp7x2'...error: RPC failed; curl 18 transfer closed with outstanding read data remainingfatal: The remote end hung up unexpectedlyfatal: early EOFfatal: index-pack failed å› ä¸ºä»“åº“å¤ªå¤§äº†,æœç´¢åå¤§è‡´æœ‰ä¸¤ç§åŠæ³• æ–¹å¼ä¸€ 1234567## man git-config## http.postBuffer## Maximum size in bytes of the buffer used by smart HTTP transports when POSTing data to the remote system. For requests larger than## this buffer size, HTTP/1.1 and Transfer-Encoding: chunked is used to avoid creating a massive pack file locally. Default is 1 MiB,## which is sufficient for most requests.git config --global http.postBuffer 524288000 æ–¹å¼äºŒ 123git clone http://github.com/large-repository --depth 1cd large-repositorygit fetch --unshallow ä½¿ç”¨äº†æ–¹å¼ä¸€æ­£å¸¸è§£å†³äº†ã€‚å› ä¸ºæ ¹æ®é”™è¯¯ä¿¡æ¯è¯´æ˜å·²ç»æ˜¯ç”¨--depth 1å»ä¸‹è½½äº†,ä½†æ˜¯å¯ä»¥å»äº†è§£ä¸€ä¸‹ é€šè¿‡[!] Error installingä½œä¸ºå…³é”®è¯å»CocoaPodsæœç´¢ CocoaPods/lib/cocoapods/downloader/cache.rb 1234567891011121314# Downloads the Pod from the given `request`## @param [Request] request# the request to be downloaded.## @return [Response] the response from downloading `request`#def download_pod(request) cached_pod(request) || uncached_pod(request)rescue Informative raiserescue raiseend è°ƒç”¨ 12345678def cached_pod(request) cached_spec = cached_spec(request) path = path_for_pod(request) return unless cached_spec &amp;&amp; path.directory? spec = request.spec || cached_spec Response.new(path, spec, request.params)end å› ä¸ºæ˜¯ç”¨gemå®‰è£…çš„ 1gem env è·å¾—gemåŒ…çš„å®‰è£…ä½ç½®,å®šä½åˆ°cache.rb,ç»è¿‡ä¸€äº›æ­¥éª¤ä¹‹å, cocoapods-downloader/lib/cocoapods-downloader/git.rb 123456789101112131415161718192021222324252627282930# Clones the repo. If possible the repo will be shallowly cloned.## @note The `:commit` option requires a specific strategy as it is not# possible to specify the commit to the `clone` command.## @note `--branch` command line option can also take tags and detaches# the HEAD.## @param [Bool] force_head# If any specific option should be ignored and the HEAD of the# repo should be cloned.## @param [Bool] shallow_clone# Whether a shallow clone of the repo should be attempted, if# possible given the specified {#options}.#def clone(force_head = false, shallow_clone = true) ui_sub_action('Git download') do begin git! clone_arguments(force_head, shallow_clone) update_submodules rescue DownloaderError =&gt; e if e.message =~ /^fatal:.*does not support (--depth|shallow capabilities)$/im clone(force_head, false) else raise end end endend ä»£ç é›†æˆåˆ›å»ºindex.js &amp;&amp; æ·»åŠ RNä»£ç å¯ä»¥å‚è€ƒWebStormåˆ›å»ºçš„index.jså’ŒApp.js 123456789101112131415161718192021222324252627282930313233343536import React, {Component} from 'react';import {Platform, StyleSheet, Text, View} from 'react-native';// &lt;1&gt;class RNHighScores extends React.Component { render() { var contents = this.props['scores'].map((score) =&gt; ( &lt;Text key={score.name}&gt; {score.name}:{score.value} {'\\n'} &lt;/Text&gt; )); return ( &lt;View style={styles.container}&gt; &lt;Text style={styles.highScoresTitle}&gt;2048 High Scores!&lt;/Text&gt; // &lt;2&gt; &lt;Text style={styles.scores}&gt;{contents}&lt;/Text&gt; &lt;/View&gt; ); }}const styles = StyleSheet.create({ container: { flex: 1, ... }, highScoresTitle: { fontSize: 20, ... }, scores: { textAlign: 'center', ... },}); æ·»åŠ RCTRootViewåœ¨Xcodeçš„ViewControllerä¸­ 1234567891011121314151617181920212223// &lt;3&gt; NSURL *jsCodeLocation = [NSURL URLWithString:@\"http://192.168.31.191:8081/index.bundle?platform=ios\"]; // [[RCTBundleURLProvider sharedSettings] jsBundleURLForBundleRoot:@\"index\" fallbackResource:nil]; RCTRootView *rootView = [[RCTRootView alloc] initWithBundleURL: jsCodeLocation moduleName: @\"AnNativeApp\" // &lt;4&gt; initialProperties: @{ @\"scores\" : @[ @{ @\"name\" : @\"Alex\", @\"value\": @\"42\" }, @{ @\"name\" : @\"Joel\", @\"value\": @\"10\" } ] } launchOptions: nil];// &lt;5&gt; [self.view addSubview:rootView]; å…è®¸ç½‘ç»œè®¿é—®1234567891011&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;&lt;dict&gt; &lt;key&gt;NSExceptionDomains&lt;/key&gt; &lt;dict&gt; &lt;key&gt;localhost&lt;/key&gt; &lt;dict&gt; &lt;key&gt;NSTemporaryExceptionAllowsInsecureHTTPLoads&lt;/key&gt; &lt;true/&gt; &lt;/dict&gt; &lt;/dict&gt;&lt;/dict&gt; è¿è¡Œå¼€å‘æœåŠ¡å™¨1npm start ç„¶åå°±å¯ä»¥è¿è¡ŒXcodeé¡¹ç›®,è§‚å¯Ÿæ•ˆæœäº† æ³¨æ„äº‹é¡¹&lt;1&gt; æ•™ç¨‹ä¸­æ˜¯æŠŠæ‰€æœ‰çš„éƒ½å†™åœ¨index.jsä¸­çš„,è€Œç›®å‰æ˜¯å‚è€ƒWebStormåˆ›å»ºçš„å·¥ç¨‹,é™¤äº†index.jsè¿˜æœ‰App.js,ä¼šæŠ¥é”™,ä¿®æ”¹ 1export default class RNHighScores extends React.Component { &lt;2&gt; è·å–å˜é‡çš„æ–¹æ³•å¯ä»¥ç”¨{} &lt;3&gt; When you build a React Native application, you use the React Native packager to create an index.bundle that will be served by the React Native server. Inside index.bundle will be our RNHighScore module. So, we need to point our RCTRootView to the location of the index.bundle resource (via NSURL) and tie it to the module. å¦‚æœåœ¨çœŸæœºçš„ç¯å¢ƒä¸‹,è¦æ›¿æ¢æˆå¯¹åº”çš„mac(æœåŠ¡å™¨)çš„IP &lt;4&gt; è¦ä¿è¯ package.json, moduleName: åé¢çš„å‚æ•° AppRegistry.registerComponent(appName, () =&gt; App); 1234567891011121314151617181920cat package.json{ \"name\": \"AnNativeApp\",// &lt;= è¿™é‡Œ \"version\": \"0.0.1\", \"private\": true, \"scripts\": { \"start\": \"node node_modules/react-native/local-cli/cli.js start\" }, \"dependencies\": { \"react\": \"^16.6.3\", \"react-native\": \"^0.58.5\" }}## import {name as appName} from './app.json';cat app.json{ \"name\": \"AnNativeApp\", &lt;= è¿™é‡Œ \"displayName\": \"AnNativeApp\"}% è¿™ä¸‰è€…æ˜¯ä¸€è‡´çš„ &lt;5&gt; RCTRootViewç»§æ‰¿è‡ªUIView,è¦è®¾ç½®frame å‚è€ƒ ç»™æ‰€æœ‰å¼€å‘è€…çš„React Nativeè¯¦ç»†å…¥é—¨æŒ‡å—ï¼ˆç¬¬ä¸€é˜¶æ®µï¼‰ React Native 0.58 Getting-started Upgrade Node.js to the latest version on Mac OS iOS RN 0.45ä»¥ä¸Šç‰ˆæœ¬æ‰€éœ€çš„ç¬¬ä¸‰æ–¹ç¼–è¯‘åº“(boostç­‰) Supporting Xcode 10 and the new Xcode build system â€˜glog/logging.hâ€™ file not found [iOS] Fix pod install error in configure: C compiler cannot create executables React Native Config.h not found ReactNative iOSè¿è¡Œå†æ¬¡å‡ºé”™ï¼šNo bundle URL present integration-with-existing-apps æ­å»ºå¼€å‘ç¯å¢ƒ","link":"/2019/02/22/Technology-ReactNative-Intro/"},{"title":"Charlesä½¿ç”¨äºŒä¸‰äº‹","text":"æ¦‚è§ˆ httpsä»£ç† æœ¬åœ°å’Œè¿œç¨‹æ˜ å°„ æ–­ç‚¹è°ƒè¯• ç¯å¢ƒ macOS Sierra 10.12.3Charles 4.0 httpsä»£ç†å…³äºå¦‚ä½•ç”¨Charleså®ç°ä»£ç†httpsè¯·æ±‚,ç½‘ä¸Šæœ‰å¾ˆå¤š,ç®€å•è¯´è¯´ macOSä¸Šä¸‹è½½å¹¶åœ¨é’¥åŒ™ä¸²ä¸­é€‰æ‹©ä¿¡ä»»Charlesè¯ä¹¦ iOSè®¾å¤‡ä»¥macOSä¸ºä»£ç†,è®¿é—®http://www.charlesproxy.com/getssl Charlesä¸Šé…ç½®httpsä»£ç†çš„ç›¸å…³å†…å®¹(Proxy &gt; SSL Proxying Settings) è¯¦ç»†çš„å¯ä»¥å‚è€ƒSSL Certificates ä¸‹é¢æ¥è¯´è¯´åŸç† ä»€ä¹ˆæ˜¯httpä»£ç† HTTP ä»£ç†å­˜åœ¨ä¸¤ç§å½¢å¼ç¬¬ä¸€ç§æ˜¯ RFC 7230 - HTTP/1.1: Message Syntax and Routingï¼ˆå³ä¿®è®¢åçš„ RFC 2616ï¼ŒHTTP/1.1 åè®®çš„ç¬¬ä¸€éƒ¨åˆ†ï¼‰æè¿°çš„æ™®é€šä»£ç†ã€‚è¿™ç§ä»£ç†æ‰®æ¼”çš„æ˜¯ã€Œä¸­é—´äººã€è§’è‰²ï¼Œå¯¹äºè¿æ¥åˆ°å®ƒçš„å®¢æˆ·ç«¯æ¥è¯´ï¼Œå®ƒæ˜¯æœåŠ¡ç«¯ï¼›å¯¹äºè¦è¿æ¥çš„æœåŠ¡ç«¯æ¥è¯´ï¼Œå®ƒæ˜¯å®¢æˆ·ç«¯ã€‚å®ƒå°±è´Ÿè´£åœ¨ä¸¤ç«¯ä¹‹é—´æ¥å›ä¼ é€ HTTP æŠ¥æ–‡ã€‚ å¦‚æœç”¨CharlesæŠ“åŒ…æŸ¥çœ‹è¯·æ±‚å¤´ä¸€èˆ¬åº”è¯¥éƒ½æ˜¯è¿™ä¸ª,æ‰€ä»¥è¿™å„¿åªå…³æ³¨è¿™ç§æ–¹å¼çš„,å¦ä¸€ç§çš„è¯¦æƒ…å¯å‚è€ƒæ–‡ç« æœ«å°¾çš„é“¾æ¥ç½‘ç«™ ä¸‹é¢è¿™å¼ å›¾ç‰‡æ¥è‡ªäºã€ŠHTTP æƒå¨æŒ‡å—ã€‹ï¼Œç›´è§‚åœ°å±•ç¤ºäº†ä¸Šè¿°è¡Œä¸ºï¼š ç®€å•è¯´å¾—å‡ºçš„ç»“è®ºå°±æ˜¯: å¦‚æœç”¨Charlesåšä»£ç†,é‚£ä¹ˆå®‰è£…äº†Charlesçš„è®¾å¤‡(æ¯”å¦‚æˆ‘çš„mac)å°±å……å½“äº†æœåŠ¡å™¨ã€‚ httpsçš„så…ˆè´´ä¸¤å¼ å°è¯•è¯´æ˜ä»€ä¹ˆæ˜¯httpsçš„å›¾ æ¥è‡ªWiki-ä¼ è¾“å±‚å®‰å…¨åè®® æ¥è‡ªä¸‹é¢çš„å‚è€ƒé“¾æ¥ å¯ä»¥çŸ¥é“ç»“æŸssléªŒè¯å,è¿˜æ˜¯å‘é€httpæ˜æ–‡,åªè¦èƒ½è®©ssléªŒè¯é€šè¿‡å³å¯,è€Œè¦é€šè¿‡éªŒè¯ä¸»è¦å°±çœ‹å®¢æˆ·ç«¯ä¿¡ä¸ä¿¡ä»»æœåŠ¡å™¨çš„è¯ä¹¦ã€‚æŸ¥çœ‹ä¸Šé¢ç¬¬ä¸€ä¸ç¬¬äºŒæ­¥ä¸­å¾—åˆ°çš„è¯ä¹¦,åºåˆ—å·æ˜¯ä¸€æ ·çš„,ä¸»è¦ç›®çš„å°±æ˜¯ä¸ºäº†è®©å®¢æˆ·ç«¯(iOS)èƒ½ä¿¡ä»»æœåŠ¡å™¨(macOS)çš„è¯ä¹¦,ä»è€Œé€šè¿‡ssléªŒè¯,å¾—åˆ°httpçš„å†…å®¹ã€‚ æœ¬åœ°å’Œè¿œç¨‹æ˜ å°„æœ¬åœ°æ˜ å°„å’Œè¿œç¨‹æ˜ å°„å¯ç”¨äºæµ‹è¯•,ç®€å•è¯´å°±æ˜¯æ›¿æ¢è¯·æ±‚çš„å“åº”ç»“æœ,è¿™é‡Œçº¯ç²¹ä¸ºäº†æµ‹è¯•,ç®€å•åˆ›å»ºä¸€ä¸ªåœºæ™¯ å¦‚æœä½ ä½¿ç”¨æŸäº›åº”ç”¨å‡ºç°äº†ä¸‹é¢è¿™ç§æƒ…å†µ åº”ç”¨æœ‰ä¸€ç§ç±»ä¼¼è¦æ±‚å¼ºåˆ¶æ›´æ–°çš„ç­–ç•¥,å¯ä»¥ç®€å•ä½¿ç”¨Charlesæœ¬åœ°æ˜ å°„Pass ç»è¿‡ä¸€äº›ç®€å•çš„å°è¯•,å¤§è‡´çŸ¥é“äº†åº”ç”¨å¼¹çª—çš„å®ç°è§„åˆ™ åœ¨æŸä¸ªè¯·æ±‚çš„å“åº”ç»“æœçš„,ä¸€ä¸ªå­—æ®µæ ‡è¯†æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬,æœ‰åˆ™å‘é€æ–°ç‰ˆæœ¬çš„iTunesä¸‹è½½åœ°å€(ç»™buttonç‚¹å‡»ä½¿ç”¨),å¼¹çª—çš„å†…å®¹ã€‚æ‰€ä»¥åªè¦é€šè¿‡æœ¬åœ°æ˜ å°„,ä¿®æ”¹è¿”å›çš„å†…å®¹,è®©å®¢æˆ·ç«¯è®¤ä¸ºæ²¡æœ‰æ–°ç‰ˆæœ¬å³å¯ã€‚ ä¿®æ”¹è¿”å›çš„å¼¹çª—ä¿¡æ¯ å¦‚æœæ¯æ¬¡è¯·æ±‚,æœåŠ¡å™¨éƒ½ä¼šéªŒè¯ç‰ˆæœ¬çš„è¯,é‚£ä¹ˆæ”¹è¿™ä¸ªä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ„ä¹‰,åªæ˜¯ä¸ºäº†å½¢è±¡çš„è¯´æ˜æœ¬åœ°æ˜ å°„æ˜¯ä»€ä¹ˆ,è¿œç¨‹æ˜ å°„åŠŸèƒ½ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚æœ¬åœ°æ˜ å°„å’Œè¿œç¨‹æ˜ å°„åœ¨Charlesçš„Toolsèœå•é¡¹ä¸‹å¯ä»¥æ‰¾åˆ° æ–­ç‚¹è°ƒè¯•åœ¨å°‘æ•°Ï€çš„è¿™ç¯‡æ–‡ç« ä¸­åˆ©ç”¨Charles Proxyä¸‹è½½æ—§ç‰ˆæœ¬iOS App,å…¶ä¸­å°±åˆ©ç”¨åˆ°äº†æ–­ç‚¹è°ƒè¯•ã€‚è·å–äº†å¾®ä¿¡çš„äº§å“å·åé€šè¿‡è®¾ç½®æ–­ç‚¹,å†æ¬¡è¯·æ±‚,ä¸­æ–­,ä¿®æ”¹è¯·æ±‚çš„å‚æ•°,ä»è€Œå®ç°ä¸‹è½½æ—§ç‰ˆæœ¬çš„åº”ç”¨ã€‚ æ€»ç»“:Charlesè¿˜æœ‰å…¶ä»–å¾ˆå¤šçš„ç”¨å¤„,æ¯”å¦‚æ¨¡ä»¿ä½é€Ÿçš„ç½‘ç»œçŠ¶æ€,è®¾ç½®DNSè§£æç­‰ 170413 æ›´æ–°è¦ä½¿ç”¨ Charles éœ€è¦è®¾ç½®ä»£ç†ï¼Œå¯ä»¥ç”¨ macOS ä¸Šçš„ â€œé€šç”¨å‰ªè´´æ¿â€ï¼Œè¿™æ ·å¯ä»¥é¿å…åœ¨ iPhone è¾“å…¥ ip çš„éº»çƒ¦ã€‚ å‚è€ƒ åˆ˜å¤çš„æŠ€æœ¯åšå®¢ - æ•°å­—è¯ä¹¦ Wiki - ä»£ç†æœåŠ¡å™¨ HTTP ä»£ç†åŸç†åŠå®ç°ï¼ˆä¸€ï¼‰ Wiki - Chain of trust","link":"/2017/03/11/Technology-Something-about-Charles/"},{"title":"WoSign CA ç­¾åçš„æ•°å­—è¯ä¹¦å¤±æ•ˆ","text":"å¯¼è¯­ ä»Šå¤©æœåŠ¡å™¨å—åˆ°åé¦ˆï¼ŒåŠ è½½å¹³å°å›¾ç‰‡èµ„æºå¤±è´¥ã€‚åŸå› æ˜¯ä¸ä¿¡ä»»çš„æ•°å­—è¯ä¹¦ï¼Œå…¬å¸çš„æœåŠ¡å™¨è¯ä¹¦æ˜¯ç”¨ WoSign ç­¾åçš„ã€‚ åœ¨è¯ä¹¦äº¤æ¢é˜¶æ®µæ—¶æŠ¥é”™äº†ï¼ŒGoogle åæ‰¾åˆ°ä¸€ç¯‡ Apple å®˜æ–¹çš„å£°æ˜ã€‚ PKI å…¬é’¥åŸºç¡€è®¾æ–½ï¼ˆPKIï¼‰æ˜¯åˆ›å»ºï¼Œç®¡ç†ï¼Œåˆ†å‘ï¼Œä½¿ç”¨ï¼Œå­˜å‚¨å’Œæ’¤é”€æ•°å­—è¯ä¹¦å’Œç®¡ç†å…¬é’¥åŠ å¯†æ‰€éœ€çš„ä¸€ç³»åˆ—è§’è‰²ï¼Œç­–ç•¥å’Œè¿‡ç¨‹ã€‚ cross-certification æ¥è‡ª Wiki - cross-certification å½“å‰çš„åœºæ™¯ åç§° å«ä¹‰ cert 1.1 åŸ StartCom è¯ä¹¦ cert 2.1 åŸ WoSign è¯ä¹¦ cert 1 ç”± WoSign ç”Ÿæˆçš„è¯ä¹¦ cert 2 ç”± StartCom ç”Ÿæˆçš„è¯ä¹¦ cert 2.2 StartCom æ•°å­—ç­¾åçš„ç”¨æˆ· cert 1.2 WoSign æ•°å­—ç­¾åçš„ç”¨æˆ· ç›®æ ‡ StartCom ç­¾åçš„ cert 2.2 æ•°å­—è¯ä¹¦è¦è¢« PKI 1 ä¿¡ä»» æ¡ä»¶ Apple ä¿¡ä»» StartCom çš„æ ¹è¯ä¹¦ï¼Œè€Œä¸ä¿¡ä»» WoSign çš„æ ¹è¯ä¹¦ åŸç† StartCom ç”Ÿæˆä¸€ä¸ªåŒ…å« WoSign å…¬é’¥çš„è¯ä¹¦ (cert 2) cert 2.2 è¯ä¹¦é“¾ä¼šæœ‰ä¸¤æ¡è·¯å¾„ (â€œcert2.2â†’cert2â€ å’Œ â€œcert2.2â†’cert2.1â†’cert1â€ ),ä¹Ÿå°±ä¼šæ‰¾åˆ° cert 1.1 å› ä¸º cert 1.1 æ ¹è¯ä¹¦æ˜¯è¢«ä¿¡ä»»çš„ï¼Œæ‰€ä»¥ cert 2.2 ä¹Ÿä¼šè¢«ä¿¡ä»»ã€‚è¿™æ˜¯ä¸€ä¸ªå¯ä»¥å¯¹ç§°çš„è¿‡ç¨‹ã€‚ å…³äºåŸå› ï¼ŒApple çš„å£°æ˜ä¸­å¯ä»¥ç•¥çŸ¥ä¸€äºŒã€‚ åè®° ä¸ºä»€ä¹ˆæœ‰äº›ä¼šæœ‰äº›ä¸ä¼šå‘¢? æˆ‘è§‰å¾—ä¸»è¦æœ‰ä¸¤ä¸ªåŸå› : To avoid disruption to existing WoSign certificate holders and to allow their transition to trusted roots, Apple products trust individual existing certificates that were issued from this intermediate CA and published to public Certificate Transparency log servers by 2016-09-19. They will continue to be trusted until they expire, are revoked, or are untrusted at Appleâ€™s discretion. å£°æ˜ä¸­è¯´ä¸ºäº†å¹³ç¨³çš„è¿‡æ¸¡ï¼Œè¯¥ CA ç­¾åçš„éƒ¨åˆ†è¯ä¹¦åœ¨çŸ­æœŸå†…è¿˜æ˜¯å¯ç”¨çš„ã€‚ è¢«ä¿¡ä»»çš„æ ¹è¯ä¹¦æ˜¯æ”¾åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ä¸­çš„ï¼Œè¯ä¹¦è¿™ä¸ªåº”è¯¥ä¿æŠ¤çš„æ¯”è¾ƒå¥½ï¼Œéœ€è¦ SDK å‡çº§è¿›è¡Œç»Ÿä¸€å¤„ç†å¯èƒ½ä¼šæ¯”è¾ƒåˆé€‚çš„ã€‚ å‚è€ƒ Wiki - cross-certification Wiki - Public_key_infrastructure","link":"/2017/04/10/Technology-WoSign-CA-signed-digital-certificate-is-invalid/"},{"title":"å­¦ä¹ ç¬”è®° - Flask - 01","text":"å‰è¨€4æœˆå°±è¦å¾…ä¸šå®¶ä¸­,ç»è¿‡ä¸€ä¸¤å¤©çš„è¸Œèº‡,è§‰ç€è¿™å…¶å®æ˜¯ä¸€ä¸ªè›®å¥½çš„å­¦ä¹ ä¸é‡æ–°è°ƒæ•´çš„æœºä¼š,åé¢å­¦ä¹ æ˜¯ä¸ä¼šæœ‰äººæä¾›è–ªæ°´äº†ï¼Œé‚£è‡ªç„¶å¯ä»¥æ›´è‡ªç”±äº›ã€‚ä¸è¿‡æ¼«æ— ç›®çš„çš„å­¦ä¹ çš„æ•ˆç‡æ¯”è¾ƒä½ï¼Œå¯ä»¥æ ¹æ®BOSSä¸Šçš„å²—ä½çš„å…³é”®è¯å»äº†è§£ç›¸å…³çš„æŠ€æœ¯ã€‚ è‡ªå·±å–œæ¬¢æŠ˜è…¾,å¯¹Pythonä¹Ÿè›®æœ‰å…´è¶£,å…ˆå­¦ä¹ ä¸‹Flask å®‰è£…1pip3 install Flask å¦‚æœé‡åˆ°ç½‘çš„é—®é¢˜,å¯ä»¥Googleæœç´¢pip æ¢æº,ç°åœ¨å®‰è£…ä¸€äº›å·¥å…·ç¡®å®æ˜¯æ²¡æœ‰ä»€ä¹ˆé—¨æ§› æ˜¾ç¤ºä¸‹å®‰è£…åçš„æ•ˆæœ 1pip3 show Flask IDEå®‰è£… Trae ç¼–è¾‘å™¨å¦å¤–æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸‹è½½æœ¬åœ°çš„å¼€å‘ç¯å¢ƒ Traeï¼ŒTrae æ˜¯å­—èŠ‚è·³åŠ¨æ¨å‡ºçš„ä¸€æ¬¾é¢å‘å¼€å‘è€…çš„ AI é©±åŠ¨çš„é›†æˆå¼€å‘ç¯å¢ƒï¼ˆIDEï¼‰ã€‚ è®¿é—® Trae å®˜ç½‘ https://www.trae.com.cné»˜è®¤æƒ…å†µï¼Œä¸‹è½½æŒ‰é’®ä¼šè‡ªåŠ¨åŒ¹é…æˆ‘ä»¬çš„ç”µè„‘ç³»ç»Ÿï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰¾åˆ°é€‚åˆè‡ªå·±ç”µè„‘æ“ä½œç³»ç»Ÿçš„ Trae å®‰è£…åŒ…ï¼Œè¿›è¡Œä¸‹è½½ã€‚ Hello worldAI è‡ªåŠ¨è¡¥é½ 12345678from flask import Flaskapp = Flask(__name__)@app.route('/')def index(): return 'Hello, World!'if __name__ == '__main__': app.run(debug=True) èµ·ä¸ªæœ¬åœ°æœåŠ¡ 1python app.py Flask åŸºæœ¬æ¦‚å¿µè¿™éƒ¨åˆ†ç…§æ¬åŸæ–‡,æ¦‚å¿µä¸Šçš„ä¸œè¥¿å¤§åŒå°å¼‚,ä¸»è¦çœ‹ä¸‹è¯­æ³• è·¯ç”±: URL åˆ° Python å‡½æ•°çš„æ˜ å°„ è§†å›¾å‡½æ•°: å¤„ç†è¯·æ±‚å¹¶è¿”å›å“åº”çš„ Python å‡½æ•° è¯·æ±‚å¯¹è±¡: åŒ…å«äº†å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ä¿¡æ¯,å¦‚è¯·æ±‚æ–¹æ³•ã€URLã€è¯·æ±‚å¤´ã€è¡¨å•æ•°æ®ç­‰ å“åº”å¯¹è±¡: åŒ…å«äº†å‘é€ç»™å®¢æˆ·ç«¯çš„å“åº”ä¿¡æ¯ï¼Œå¦‚çŠ¶æ€ç ã€å“åº”å¤´ã€å“åº”ä½“ç­‰ æ¨¡æ¿ï¼šFlask ä½¿ç”¨ Jinja2 æ¨¡æ¿å¼•æ“æ¥æ¸²æŸ“ HTML æ¨¡æ¿ã€‚æ¨¡æ¿å…è®¸ä½ å°† Python ä»£ç åµŒå…¥åˆ° HTML ä¸­ï¼Œä»è€ŒåŠ¨æ€ç”Ÿæˆç½‘é¡µã€‚ åº”ç”¨å·¥å‚ï¼šåº”ç”¨å·¥å‚æ˜¯ä¸€ä¸ª Python å‡½æ•°ï¼Œå®ƒåˆ›å»ºå¹¶è¿”å›ä¸€ä¸ª Flask åº”ç”¨å®ä¾‹ã€‚è¿™å…è®¸ä½ é…ç½®å’Œåˆå§‹åŒ–ä½ çš„åº”ç”¨ï¼Œå¹¶ä¸”å¯ä»¥åˆ›å»ºå¤šä¸ªåº”ç”¨å®ä¾‹ã€‚ é…ç½®å¯¹è±¡ï¼šFlask åº”ç”¨æœ‰ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥è®¾ç½®å„ç§é…ç½®é€‰é¡¹ï¼Œå¦‚æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€è°ƒè¯•æ¨¡å¼ç­‰ã€‚ è“å›¾ï¼šè“å›¾æ˜¯ Flask ä¸­çš„ä¸€ä¸ªç»„ç»‡ä»£ç çš„æ–¹å¼ï¼Œå®ƒå…è®¸ä½ å°†ç›¸å…³çš„è§†å›¾å‡½æ•°ã€æ¨¡æ¿å’Œé™æ€æ–‡ä»¶ç»„ç»‡åœ¨ä¸€èµ·ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å¤šä¸ªåº”ç”¨ä¸­é‡ç”¨ã€‚ é™æ€æ–‡ä»¶ï¼šé™æ€æ–‡ä»¶æ˜¯ä¸ä¼šè¢«æœåŠ¡å™¨ç«¯æ‰§è¡Œçš„æ–‡ä»¶ï¼Œå¦‚ CSSã€JavaScript å’Œå›¾ç‰‡æ–‡ä»¶ã€‚Flask æä¾›äº†ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ¥æœåŠ¡è¿™äº›æ–‡ä»¶ã€‚ æ‰©å±•ï¼šFlask æœ‰è®¸å¤šæ‰©å±•ï¼Œå¯ä»¥æ·»åŠ é¢å¤–çš„åŠŸèƒ½ï¼Œå¦‚æ•°æ®åº“é›†æˆã€è¡¨å•éªŒè¯ã€ç”¨æˆ·è®¤è¯ç­‰ã€‚ ä¼šè¯ï¼šFlask ä½¿ç”¨å®¢æˆ·ç«¯ä¼šè¯æ¥å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™å…è®¸ä½ åœ¨ç”¨æˆ·æµè§ˆä½ çš„åº”ç”¨æ—¶è®°ä½ä»–ä»¬çš„çŠ¶æ€ã€‚ é”™è¯¯å¤„ç†ï¼šFlask å…è®¸ä½ å®šä¹‰é”™è¯¯å¤„ç†å‡½æ•°ï¼Œå½“ç‰¹å®šçš„é”™è¯¯å‘ç”Ÿæ—¶ï¼Œè¿™äº›å‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚ è·¯ç”± (Routing)1234567891011121314151617from flask import Flaskapp = Flask(__name__)@app.route('/')def index(): return 'Hello, World!'@app.route('/router/about')def about(): return 'About Page'@app.route('/router/contact')def contact(): return 'Contact Page'if __name__ == '__main__': app.run(debug=True) è§†å›¾å‡½æ•° (View Functions)123@app.route('/greet/&lt;name&gt;')def greet(name): return f'Hello, {name}!' greet å°±æ˜¯è§†å›¾å‡½æ•° è¯·æ±‚å¯¹è±¡ (Request Object)123456from flask import request@app.route('/submit', methods=['POST'])def submit(): username = request.form.get('username') return f'Hello, {username}!' è¦æœ‰ä¸ªæäº¤è¡¨å•çš„æ“ä½œæ‰èƒ½ä¸²èµ·æ¥,çœ‹ä¸‹é¢æ¶‰åŠåˆ°flaské‡Œpythonå’Œhtmlæ··åˆçš„å¤„ç†é€»è¾‘ å“åº”å¯¹è±¡ (Response Object)å“åº”å¯¹è±¡åŒ…å«äº†å‘é€ç»™å®¢æˆ·ç«¯çš„å“åº”ä¿¡æ¯ï¼ŒåŒ…æ‹¬çŠ¶æ€ç ã€å“åº”å¤´å’Œå“åº”ä½“ã€‚Flask é»˜è®¤ä¼šå°†å­—ç¬¦ä¸²ã€HTML ç›´æ¥ä½œä¸ºå“åº”ä½“ã€‚ 12345678from flask import make_response@app.route('/custom_response')def custom_response(): # make_response åˆ›å»ºä¸ªå“åº”å¯¹è±¡,ç„¶åå¡«å……è¯·æ±‚å¤´ response = make_response('This is a custom response!') response.headers['X-Custom-Header'] = 'Value' return response æ¨¡æ¿ (Templates)Flask ä½¿ç”¨ Jinja2 æ¨¡æ¿å¼•æ“æ¥æ¸²æŸ“ HTML æ¨¡æ¿ã€‚æ¨¡æ¿å…è®¸ä½ å°† Python ä»£ç åµŒå…¥åˆ° HTML ä¸­ï¼Œä»è€ŒåŠ¨æ€ç”Ÿæˆç½‘é¡µå†…å®¹ã€‚ 12345from flask import render_template@app.route('/render/&lt;name&gt;')def render(name): return render_template('render_name.html', name=name) 123456789&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt; &lt;title&gt;Hello&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;h1&gt;Hello, {{ name }}!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt; ç›´æ¥è®¿é—® http://127.0.0.1:5000/render/Wang æŠ¥æ‰¾ä¸åˆ°æ¨¡æ¿ çœ‹äº†ä¸‹æ¨¡æ¿æ–‡ä»¶è¦æ”¾åœ¨templates ç›®å½•ä¸‹,æ–°å»ºå,å°†render_name.htmlç§»åŠ¨åˆ°è¯¥ç›®å½•ä¸‹,é‡æ–°åˆ·æ–°é¡µé¢ï¼Œæ­£å¸¸æ˜¾ç¤º åº”ç”¨å·¥å‚ (Application Factory)åº”ç”¨å·¥å‚æ˜¯ä¸€ä¸ª Python å‡½æ•°ï¼Œç”¨äºåˆ›å»ºå’Œé…ç½® Flask åº”ç”¨å®ä¾‹ã€‚è¿™ç§æ–¹æ³•å…è®¸ä½ åˆ›å»ºå¤šä¸ªåº”ç”¨å®ä¾‹ï¼Œæˆ–è€…åœ¨ä¸åŒé…ç½®ä¸‹åˆå§‹åŒ–åº”ç”¨ã€‚ 12345678910from flask import Flaskdef create_app(config_name): app = Flask(__name__) app.config.from_object(config_name) from . import routes app.register_blueprint(routes.bp) return app åº”è¯¥æ˜¯é’ˆå¯¹ä¸åŒç¯å¢ƒ é…ç½®å¯¹è±¡ (Configuration Objects)é…ç½®å¯¹è±¡ç”¨äºè®¾ç½®åº”ç”¨çš„å„ç§é…ç½®é€‰é¡¹ï¼Œå¦‚æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€è°ƒè¯•æ¨¡å¼ç­‰ã€‚å¯ä»¥é€šè¿‡ç›´æ¥è®¾ç½®æˆ–åŠ è½½é…ç½®æ–‡ä»¶æ¥é…ç½® Flask åº”ç”¨ã€‚ 1234class Config: DEBUG = True SECRET_KEY = 'mysecretkey' SQLALCHEMY_DATABASE_URI = 'sqlite:///mydatabase.db' è“å›¾ (Blueprints)è“å›¾æ˜¯ Flask ä¸­çš„ç»„ç»‡ä»£ç çš„æ–¹å¼ã€‚å®ƒå…è®¸ä½ å°†ç›¸å…³çš„è§†å›¾å‡½æ•°ã€æ¨¡æ¿å’Œé™æ€æ–‡ä»¶ç»„ç»‡åœ¨ä¸€èµ·ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å¤šä¸ªåº”ç”¨ä¸­é‡ç”¨ã€‚ 1234567from flask import Blueprintbp = Blueprint('main', __name__)@bp.route('/')def home(): return 'Home Page' æ³¨å†Œè“å›¾ (app/__init__.py)ï¼š 1234567from flask import Flaskfrom .routes import bp as main_bpdef create_app(): app = Flask(__name__) app.register_blueprint(main_bp) return app é™æ€æ–‡ä»¶ (Static Files)é™æ€æ–‡ä»¶æ˜¯ä¸ä¼šè¢«æœåŠ¡å™¨ç«¯æ‰§è¡Œçš„æ–‡ä»¶ï¼Œå¦‚ CSSã€JavaScript å’Œå›¾ç‰‡æ–‡ä»¶ã€‚Flask æä¾›äº†ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ¥æœåŠ¡è¿™äº›æ–‡ä»¶ã€‚ 1&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"{{ url_for('static', filename='style.css') }}\"&gt; é™æ€æ–‡ä»¶ç›®å½•ï¼šå°†é™æ€æ–‡ä»¶æ”¾åœ¨ static æ–‡ä»¶å¤¹ä¸­ï¼ŒFlask ä¼šè‡ªåŠ¨æä¾›æœåŠ¡ã€‚ æ‰©å±• (Extensions)Flask æœ‰è®¸å¤šæ‰©å±•ï¼Œå¯ä»¥æ·»åŠ é¢å¤–çš„åŠŸèƒ½ï¼Œå¦‚æ•°æ®åº“é›†æˆã€è¡¨å•éªŒè¯ã€ç”¨æˆ·è®¤è¯ç­‰ã€‚è¿™äº›æ‰©å±•æä¾›äº†æ›´é«˜çº§çš„åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹é›†æˆã€‚ 1234from flask_sqlalchemy import SQLAlchemyapp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///mydatabase.db'db = SQLAlchemy(app) ä¼šè¯ (Sessions)Flask ä½¿ç”¨å®¢æˆ·ç«¯ä¼šè¯æ¥å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œä»¥ä¾¿åœ¨ç”¨æˆ·æµè§ˆåº”ç”¨æ—¶è®°ä½ä»–ä»¬çš„çŠ¶æ€ã€‚ä¼šè¯æ•°æ®å­˜å‚¨åœ¨å®¢æˆ·ç«¯çš„ cookie ä¸­ï¼Œå¹¶åœ¨æœåŠ¡å™¨ç«¯è¿›è¡Œç­¾åå’ŒåŠ å¯†ã€‚ 1234567891011121314from flask import session# è‡ªåŠ¨ç”Ÿæˆçš„å¯†é’¥app.secret_key = 'your_secret_key_here'@app.route('/set_session/&lt;username&gt;')def set_session(username): session['username'] = username return f'Session set for {username}'@app.route('/get_session')def get_session(): username = session.get('username') return f'Hello, {username}!' if username else 'No session data' é”™è¯¯å¤„ç† (Error Handling)Flask å…è®¸ä½ å®šä¹‰é”™è¯¯å¤„ç†å‡½æ•°ï¼Œå½“ç‰¹å®šçš„é”™è¯¯å‘ç”Ÿæ—¶ï¼Œè¿™äº›å‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚å¯ä»¥è‡ªå®šä¹‰é”™è¯¯é¡µé¢æˆ–å¤„ç†é€»è¾‘ã€‚ 1234567@app.errorhandler(404)def page_not_found(e): return 'Page not found', 404@app.errorhandler(500)def internal_server_error(e): return 'Internal server error', 500 å‚è€ƒFlask æ•™ç¨‹","link":"/2025/03/27/Technology-learn-flask/"},{"title":"lldbè°ƒè¯•OCçš„è‹¥å¹²è¾…åŠ©æ–¹æ³•ä¸æ³¨æ„","text":"è¾“å‡º UIView çš„å±‚çº§ç»“æ„è¾“å‡º UIViewController çš„å±‚çº§ç»“æ„è¾“å‡ºç±»çš„å±æ€§ä¸æ–¹æ³•åˆ—è¡¨å½¢å¦‚[0xAbc â€¦]è°ƒç”¨æ—¶å¦‚ä½•å‡ºç°æ–¹æ³•æç¤º [161129æ›´æ–°]lldb å¦‚ä½•æ”¯æŒ frame ç±»å‹çš„è¾“å‡º [161204æ›´æ–°] UIViewçš„å±‚çº§ç»“æ„UIView+JAlldb.h1234567891011121314#import &lt;UIKit/UIKit.h&gt;@interface UIView (JAlldb)#if DEBUG/** * è¾“å‡ºviewçš„å±‚çº§ç»“æ„ */- (void)p_recursiveView;#endif@end UIView+JAlldb.m12345678910111213141516171819#import \"UIView+JAlldb.h\"@implementation UIView (lldb)#if DEBUG- (void)p_recursiveView{ #pragma clang diagnostic push#pragma clang diagnostic ignored \"-Wundeclared-selector\" // ç§æœ‰æ–¹æ³• NSLog(@\"%@\",[self performSelector:@selector(recursiveDescription)]); #pragma clang diagnostic pop}#endif@end UIViewControllerçš„å±‚çº§ç»“æ„UIViewController+JAlldb.h1234567891011121314#import &lt;UIKit/UIKit.h&gt;@interface UIViewController (JAlldb)#if DEBUG/** * è¾“å‡ºæŒ‡å®švcçš„å±‚çº§ç»“æ„ */- (void)p_recursiveController;#endif@end UIViewController+JAlldb.m12345678910111213141516171819#import \"UIViewController+JAlldb.h\"@implementation UIViewController (JAlldb)#if DEBUG- (void)p_recursiveController{#pragma clang diagnostic push#pragma clang diagnostic ignored \"-Wundeclared-selector\" // ç§æœ‰æ–¹æ³• NSLog(@\"%@\",[self performSelector:@selector(_printHierarchy)]); #pragma clang diagnostic pop}#endif@end ç±»çš„å±æ€§ä¸æ–¹æ³•åˆ—è¡¨NSObject+JAlldb.h123456789101112131415161718192021222324252627282930313233343536#import &lt;Foundation/Foundation.h&gt;@interface NSObject (JAlldb)/** å±æ€§åˆ—è¡¨ @param recursive æ˜¯å¦é€’å½’ @return å±æ€§åˆ—è¡¨ */- (NSArray *)p_propertyList:(BOOL)recursive;/** å˜é‡åˆ—è¡¨ @param recursive æ˜¯å¦é€’å½’ @return å˜é‡åˆ—è¡¨ */- (NSArray *)p_ivarList:(BOOL)recursive;/** * æ–¹æ³•åˆ—è¡¨ * * @param recursive æ˜¯å¦é€’å½’ */- (NSArray *)p_methodList:(BOOL)recursive;/** æ¸…ç©ºç¼“å­˜åˆ—è¡¨ */- (void)p_cleanCacheList;@end NSObject+JAlldb.m123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108#import \"NSObject+JAlldb.h\"#import &lt;objc/message.h&gt;@implementation NSObject (JAlldb)const void* propertiesKey = \"com.coder.lldb-exclusive.propertiesKey\";const void* ivarKey = \"com.coder.lldb-exclusive.ivarKey\";const void* methodKey = \"com.coder.lldb-exclusive.methodKey\";- (NSArray *)p_propertyList:(BOOL)recursive { NSArray *glist = objc_getAssociatedObject([self class], propertiesKey); return glist == nil ? ^{ unsigned int count = 0; NSMutableArray *plistM = [NSMutableArray arrayWithCapacity:count]; Class cls = [self class]; do { objc_property_t *list = class_copyPropertyList(cls, &amp;count); for (int i = 0; i &lt; count; ++i) { objc_property_t pty = list[i]; const char *pname = property_getName(pty); [plistM addObject:[NSString stringWithUTF8String:pname]]; } free(list); cls = [cls superclass]; } while (cls &amp;&amp; recursive); objc_setAssociatedObject([self class],propertiesKey, plistM, OBJC_ASSOCIATION_COPY_NONATOMIC); NSLog(@\"Found %ld properties on %@\",plistM.count,[self class]); return plistM.copy; }() : glist;}- (NSArray *)p_ivarList:(BOOL)recursive{ NSArray *glist = objc_getAssociatedObject([self class], ivarKey); return glist == nil ? ^{ unsigned int count = 0; NSMutableArray *plistM = [NSMutableArray arrayWithCapacity:count]; Class cls = [self class]; do { Ivar *list = class_copyIvarList(cls, &amp;count); for (int i = 0; i &lt; count; ++i) { Ivar ity = list[i]; const char *iname = ivar_getName(ity); [plistM addObject:[NSString stringWithUTF8String:iname]]; } free(list); cls = [cls superclass]; } while (cls &amp;&amp; recursive); NSLog(@\"Found %ld ivar on %@\",plistM.count,[self class]); objc_setAssociatedObject([self class],ivarKey, plistM, OBJC_ASSOCIATION_COPY_NONATOMIC); return plistM.copy; }() : glist;}- (NSArray *)p_methodList:(BOOL)recursive { NSArray *glist = objc_getAssociatedObject([self class], methodKey); return glist == nil ? ^{ unsigned int methodCount = 0; NSMutableArray *plistM = [NSMutableArray arrayWithCapacity:methodCount]; Class cls = [self class]; do { Method *methods = class_copyMethodList(cls, &amp;methodCount); for (unsigned int i = 0; i &lt; methodCount; i++) { Method method = methods[i]; /* printf(\"\\t'%s'|'%s' of encoding '%s'\\n\", class_getName(cls), sel_getName(method_getName(method)), method_getTypeEncoding(method)); */ [plistM addObject:[NSString stringWithUTF8String:sel_getName(method_getName(method))]]; } free(methods); cls = [cls superclass]; }while (cls &amp;&amp; recursive); printf(\"Found %d methods on '%s'\\n\", methodCount, class_getName([self class])); objc_setAssociatedObject([self class],ivarKey, plistM, OBJC_ASSOCIATION_COPY_NONATOMIC); return plistM.copy; }() : glist; }- (void)p_cleanCacheList { objc_removeAssociatedObjects([self class]);}@end [0xAbc â€¦]è°ƒç”¨å¦‚ä½•å‡ºç°æ–¹æ³•æç¤º ç±»åœ°å€å‰åŠ ç±»å‹å¼ºè½¬ 12(lldb) po [(UIView *)0x117e09e80 backgroundColor] UIExtendedSRGBColorSpace 1 1 1 1 lldbå¦‚ä½•æ”¯æŒframeç±»å‹çš„è¾“å‡º123$ touch ~/.lldbinit$ echo display @import UIKit &gt;&gt; ~/.lldbinit$ echo target stop-hook add -o \\â€target stop-hook disable\\â€ &gt;&gt; ~/.lldbinit å‚è€ƒ iOS-Runtime-Headers","link":"/2016/11/20/Technology-lldb-debugging-OC-a-number-of-auxiliary-methods-and-attention/"},{"title":"è·¯ç”±å™¨çº§è”æ”¾å¤§Wifiä¿¡å·","text":"å‰è¨€ Wifi ä¿¡å·åˆä¸è¡Œäº†,æˆ¿é—´çš„åœ°ç†ä½ç½®ä¸å¥½,è”é€šçš„è·¯ç”±å™¨ä¿¡å·åˆç‰¹åˆ«å·®,æ ¹æœ¬ä¸èƒ½ç©¿å¢™ã€‚å¥½ä¹…ä¸å†™äº†åšå®¢äº†,ä¸€æ”¾æ¾å°±ä¸€ç›´ä¸æƒ³å†™ã€‚æ¯•ç«Ÿä»å–„å¦‚ç™»,ä»æ¶å¦‚å´©å•¦ã€‚åŸæ¥åšçº§è”çš„è€æ—§è·¯ç”±å™¨éœ€è¦å¤ä½,å†æŠ¢æ•‘ä¸‹,çœ‹æœ‰æ²¡æœ‰æŒ½æ•‘çš„å¸Œæœ›ã€‚æ‰€ä»¥æ­£å¥½æŠŠæµç¨‹ç®€å•è®°å½•ä¸€ä¸‹,è™½ç„¶æ²¡å•¥å­ç”¨ã€‚ ç¯å¢ƒ MERCURY xxx è·¯ç”±å™¨macOS Sierra 10.12.6 åŸç†ç½‘ä¸Šæœäº†ä¸‹,å°±æ˜¯ä¸‹é¢çš„å‚è€ƒé“¾æ¥,æä¾›äº†3ç§æ–¹æ¡ˆ WDS æ— çº¿æ¡¥æ¥ å½“ AP (æ— çº¿äº¤æ¢æœº) ä½¿ç”¨ æ­å»ºæ–°ç½‘ç»œ (å­ç½‘ç»œ) å› ä¸ºæ²¡æœ‰è”é€šè·¯ç”±å™¨çš„ç™»é™†çš„ç”¨æˆ·åå¯†ç ,å°±é€‰ç¬¬ 3 ç§æ–¹æ¡ˆ é€‚ç”¨ç¯å¢ƒ,ç»„ç½‘åçš„æ•ˆæœ,ç„¶åæ“ä½œä¹‹ç±»çš„,æˆªå›¾å¦‚ä¸‹ æµç¨‹å‡†å¤‡æŠŠæˆ‘çš„è·¯ç”±å™¨çš„ WAN å£ä¸è”é€šè·¯ç”±å™¨çš„ LAN ç”¨ç½‘çº¿è¿æ¥ å¤ä½è·¯ç”±å™¨æ—è¾¹ä¸€èˆ¬æœ‰ä¸ªå¤ä½é”®(reset),é•¿æŒ‰å‡ ç§’,å½“æŒ‡ç¤ºç¯å…¨äº®çš„æ—¶å€™,å°±ä»£è¡¨å¤ä½æˆåŠŸäº†ã€‚ åŠ å…¥å­ç½‘ å°±æ˜¯ä¸Šé¢è¿™ä¸ª é…ç½®è·¯ç”±å™¨ è¿œç¨‹ç™»é™†ä¸Šå»,ä¸€èˆ¬ä¸º 192.168.1.1 è·¯ç”±å™¨ä¸Šä¸€èˆ¬ä¼šå†™ è¦è®¤è¯,ä¸€èˆ¬è·¯ç”±å™¨ä¸Šä¼šå†™ å› ä¸ºæ˜¯é…ç½®å­ç½‘,æ¯”å¦‚è”é€šçš„è·¯ç”±å™¨çš„ç½‘æ®µæ˜¯ 192.168.1.x çš„,é‚£æˆ‘çš„è·¯ç”±å™¨çš„ç½‘æ®µä¸èƒ½ä¸€æ ·,æ”¹æˆ 192.168.5.x ç‚¹ä¿å­˜å,é¡µé¢ä¼šå¤±æ•ˆ,å› ä¸ºå½“å‰çš„ 192.168.1.1 å·²ç»ä¸æ˜¯å½“å‰è·¯ç”±å™¨çš„ IP åœ°å€äº†ã€‚å…³é—­ wifi å†æ¬¡è¿æ¥,ç„¶åç”¨ 192.168.5.1 è®¿é—®ä¸€ä¸‹ã€‚å¥½äº†,å­ç½‘ç»œå·²ç»æˆåŠŸäº†ã€‚ æ”¶å°¾: æ·»åŠ  WAP2 å¯†ç , ä¿®æ”¹è¿œç¨‹ç™»é™†å¯†ç â€¦ æ·»åŠ  WAP2 å¯†ç  æ¯ç§å“ç‰Œçš„è·¯ç”±å™¨éƒ½ä¼šæœ‰ç‚¹å·®å¼‚,éšä¾¿ç‚¹ç‚¹æ‰¾æ‰¾å°±è¡Œã€‚ å› ä¸º wifi å·²ç»å¯†ç äº†,æ‰€ä»¥ç½‘ç»œåˆæ‰çº¿äº†,ç”¨æ–°å¯†ç é‡æ–°ç™»é™† ä¿®æ”¹ç®¡ç†å‘˜è´¦æˆ· ä¿®æ”¹ wifi çƒ­ç‚¹åç§° æ”¹å®Œä¿å­˜å³å¯ æ€»ç»“è®¿é—®åˆå˜å¾—æµç•…äº†äº›ã€‚æœºå™¨å’Œäººä¸€æ ·,ä¸€ç›´ä¸ä¼‘æ¯,ä¹Ÿä¼šå®•æœºçš„,å› ä¸ºç–²åŠ³ä¼šä¸æ–­ç´¯ç§¯,æ€»ä¼šæœ‰æ ¹ç¨»è‰å‹å®é‚£åªéª†é©¼,æ„Ÿè§‰å†™å†™ä¹Ÿæ˜¯è›®å¼€å¿ƒçš„,è™½ç„¶æ²¡ä»€ä¹ˆå†…å®¹ã€‚ å‚è€ƒå¤šå°è·¯ç”±å™¨å¦‚ä½•çº§è”","link":"/2017/09/24/Technology-router-cascade-magnified-wifi/"},{"title":"Clangå­¦ä¹ å†ç¨‹ æ¦‚è¿°","text":"ClangClangæ˜¯LLVM(Low Level Virtual Machine)é¡¹ç›®æä¾›çš„å·¥å…·é“¾ä¸­çš„ç¼–è¯‘å™¨çš„å‰ç«¯éƒ¨åˆ† LLVMé¡¹ç›®æ˜¯æ¨¡å—åŒ–å’Œå¯é‡ç”¨çš„ç¼–è¯‘å™¨å’Œå·¥å…·é“¾æŠ€æœ¯çš„é›†åˆ,LLVMçš„ä¸€å¤§ç‰¹è‰²å°±æ˜¯ï¼Œæœ‰ç€ç‹¬ç«‹çš„ã€å®Œå–„çš„ã€ä¸¥æ ¼çº¦æŸçš„ä¸­é—´ä»£ç è¡¨ç¤ºã€‚è¿™ç§ä¸­é—´ä»£ç ï¼Œå°±æ˜¯LLVMçš„å­—èŠ‚ç ï¼Œæ˜¯LLVMæŠ½è±¡çš„ç²¾é«“ï¼Œå‰ç«¯ç”Ÿæˆè¿™ç§ä¸­é—´ä»£ç ï¼Œåç«¯è‡ªåŠ¨è¿›è¡Œå„ç±»ä¼˜åŒ–åˆ†æï¼Œè®©ç”¨LLVMå¼€å‘çš„ç¼–è¯‘å™¨ï¼Œéƒ½èƒ½ç”¨ä¸Šæœ€å…ˆè¿›çš„åç«¯ä¼˜åŒ–æŠ€æœ¯ã€‚ ç¼–è¯‘å™¨ç¼–è¯‘æµç¨‹å¦‚ä¸‹ æ¥è‡ªã€Šç¼–è¯‘åŸç†ã€‹ ç¼–è¯‘å™¨åˆ†æˆå‰ç«¯ä¸åç«¯ä¸¤éƒ¨åˆ† å‰ç«¯è´Ÿè´£å¤„ç†æºä»£ç ï¼Œåç«¯è´Ÿè´£ç”Ÿæˆç›®æ ‡ä»£ç  æ¥è‡ªå‚è€ƒé“¾æ¥3 ç¯å¢ƒ macOS Hign Sierra 10.13.6Xcode10.1 ç¼–è¯‘è·å–llvmæºä»£ç  1% git clone https://git.llvm.org/git/llvm.git/ è·å–Clangæºä»£ç  12% cd llvm/tools% git clone https://git.llvm.org/git/clang.git/ è·å–compiler-rtæºä»£ç  123## å®šä½åˆ°llvmå·¥ç¨‹ç›®å½•ä¸‹% cd llvm% git clone https://git.llvm.org/git/compiler-rt.git/ è·å–libompæºä»£ç  12% cd llvm% git clone https://git.llvm.org/git/openmp.git/ è·å–libcxxå’Œlibcxxabiæºä»£ç  123% cd llvm% git clone https://git.llvm.org/git/libcxx.git/% git clone https://git.llvm.org/git/libcxxabi.git/ è·å–æµ‹è¯•ç”¨ä¾‹ 12% cd llvm% git clone https://git.llvm.org/git/test-suite.git/ Clang ä½¿ç”¨CMake(ä¸€ä¸ªç”¨äºæ„å»ºï¼Œæµ‹è¯•å’Œæ‰“åŒ…è½¯ä»¶çš„å¼€æºè·¨å¹³å°å·¥å…·ç³»åˆ—)è¿›è¡Œæ„å»º 12345678910111213141516171819202122232425262728293031323334353637# LLVM ç¦æ­¢æºç å†…ç¼–è¯‘(in-tree build is not supported),åˆ›å»ºä¸€ä¸ªä¸llvmå·¥ç¨‹åŒçº§çš„buildç›®å½•% cd src/% mkdir build% cd build ## å®‰è£…cmake% brew install cmake## -G &lt;generator-name&gt;## Specify a build system generator.## cmake [{-D &lt;var&gt;=&lt;value&gt;}...] -P &lt;cmake-script-file&gt;## Create or update a cmake cache entry.## When cmake is first run in an empty build tree, it ## creates a CMakeCache.txt file and populates it with customizable settings for## the project. This option may be used to specify a setting that takes priority over the projectas default value. The option may## be repeated for as many cache entries as desired.## ä¼šè¢«å­˜åœ¨buildç›®å½•ä¸‹çš„CMakeCache.txtä¸­## -Wno-dev å¿½ç•¥å¼€å‘è­¦å‘Š% cmake -G Ninja ../llvm/ \\ -DCMAKE_INSTALL_PREFIX=/opt/llvm \\ -DCMAKE_BUILD_TYPE=Release \\ -DLLVM_ENABLE_FFI=ON \\ -DLLVM_BUILD_LLVM_DYLIB=ON \\ -DCMAKE_EXPORT_COMPILE_COMMANDS=ON \\ -DLLVM_TARGETS_TO_BUILD=\"host;AMDGPU\" \\ -Wno-dev## å®‰è£… ninja## Ninja is a small build system with a focus on speed. ## It differs from other build systems in two major respects: it is designed to have its input files generated by a higher-level build system, and it is designed to run builds as fast as possible.% brew install ninja## -j N run N jobs in parallel [default=6, derived from CPUs available]## CMake Error at cmake_install.cmake:36 (file):## file INSTALL cannot set permissions on \"/opt/llvm/include/llvm\"## åŠ ä¸Šsudo% sudo ninja -j4 install æ›¿æ¢Clang123456789## æŸ¥çœ‹ç³»ç»Ÿçš„Clangçš„ä½ç½®~% which clang/usr/bin/clang~% clang -v Apple LLVM version 10.0.0 (clang-1000.11.45.5)Target: x86_64-apple-darwin17.7.0Thread model: posixInstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin æ ¹æ®å‚è€ƒé“¾æ¥7 æ–°å»ºXcodeå·¥ç¨‹ åˆ›å»ºç”¨æˆ·è‡ªå®šä¹‰é…ç½®CC,å¹¶è®¾ç½®DEBUGæ—¶çš„å€¼ä¸ºç¼–è¯‘å®ŒæˆåClangäºŒè¿›åˆ¶çš„ä½ç½®ã€‚ âŒ˜ B ç¼–è¯‘,æŸ¥çœ‹ç¼–è¯‘è¾“å‡ºçš„æ—¥å¿—,è¯æ˜å·²ç»ä½¿ç”¨äº†ç¼–è¯‘çš„Clang é”™è¯¯åŸå› : 1Unknown argument: '-index-store-path' æ ¹æ®å‚è€ƒé“¾æ¥10,åœ¨Build Setting ä¸­æœç´¢indexå¹¶å°†Enable Index-While-Building Functionalityé€‰é¡¹è®¾ç½®ä¸ºNO âŒ˜ B é”™è¯¯åŸå› : 123456fatal error: error in backend: No available targets are compatible with triple \"arm64-apple-ios9.0.0\"clang-8: error: clang frontend command failed with exit code 70 (use -v to see invocation)clang version 8.0.0 (https://git.llvm.org/git/clang.git/ a6eb16ed631365f3bbadd0450ab52746c151794d) (https://git.llvm.org/git/llvm.git/ 1c98a2b870d058132698ae4d67ef954b13dc41b4)Target: aarch64-apple-darwin17.7.0Thread model: posixInstalledDir: /opt/llvm/bin åˆ†æ: å› ä¸ºè¯¥æ‰‹æœºæ¶æ„æ˜¯arm64è€Œcmakeç¼–è¯‘æ—¶æŒ‡å®šçš„æ˜¯ -DLLVM_TARGETS_TO_BUILD=\"host;AMDGPU\",å¹¶æ²¡æœ‰å¯¹åº”çš„æ¶æ„ HowToBuildOnARM cmake $LLVM_SRC_DIR -DCMAKE_BUILD_TYPE=Release -DLLVM_TARGETS_TO_BUILD=â€ARM;X86;AArch64â€ æ“ä½œ 12345678910111213141516## é‡æ–°ç¼–è¯‘% cmake -G Ninja ../llvm/ \\ -DCMAKE_INSTALL_PREFIX=/opt/llvm \\ -DCMAKE_BUILD_TYPE=Release \\ -DLLVM_ENABLE_FFI=ON \\ -DLLVM_BUILD_LLVM_DYLIB=ON \\ -DCMAKE_EXPORT_COMPILE_COMMANDS=ON \\ -DLLVM_TARGETS_TO_BUILD=\"host;ARM;X86;AArch64\" \\ -Wno-dev## ç¡®è®¤% grep -r \"LLVM_TARGETS_TO_BUILD\" CMakeCache.txtCMakeCache.txt:LLVM_TARGETS_TO_BUILD:STRING=host;ARM;X86;AArch64## å®‰è£… åªä¼šå¤„ç†æœ‰å˜æ›´çš„éƒ¨åˆ†% sudo ninja -j4 install âŒ˜ B æˆåŠŸ ä»£ç TryLLVM å‚è€ƒ llvm.org ç»“æ„åŒ–ç¼–è¯‘å™¨å‰ç«¯ Clang ä»‹ç» ç¼–è¯‘å™¨æ¶æ„çš„ç‹è€…LLVM cmake.org wiki-XcodeVersionInfo ä¸‹è½½æ ‡å‡†åº“libcxxå‡ºç°svn: E000104: Error running context: Connection reset by peerçš„è§£å†³æ–¹æ¡ˆ å®‰è£… LLVM + Clang å¦‚ä½•è®©Xcodeä½¿ç”¨clangçš„æ›¿ä»£ç‰ˆæœ¬ Why canâ€™t I create a directory under /opt without sudo compilation-error-when-using-xcode-9-0-with-clang-cannot-specify-o-when-genera","link":"/2018/12/24/Topic-Clang-Learn-Clang-01/"},{"title":"Clangå­¦ä¹ å†ç¨‹ ç¼–è¯‘è¿‡ç¨‹-è¯æ³•åˆ†æ","text":"å‰è¨€ã€Šç¼–è¯‘åŸç†ã€‹ä¸­æåˆ° ç¼–è¯‘å™¨çš„ç¬¬ä¸€ä¸ªæ­¥éª¤æ˜¯è¯æ³•åˆ†æ(Lexical Analysis)æˆ–æ‰«æã€‚è¯æ³•åˆ†æå™¨è¯»å…¥ç»„æˆæºç¨‹åºçš„å­—ç¬¦æµ,å¹¶ä¸”å°†å®ƒä»¬ç»„ç»‡æˆä¸ºæœ‰æ„ä¹‰çš„è¯ç´ (lexeme)çš„åºåˆ—ã€‚å¯¹äºæ¯ä¸ªè¯ç´ ,è¯æ³•åˆ†æäº§ç”Ÿå¦‚ä¸‹å½¢å¼çš„è¯æ³•å•å…ƒ(token)ä½œä¸ºè¾“å‡º:&lt;token-name,attribute-value&gt;token-name æ˜¯ä¸€ä¸ªè¯­æ³•åˆ†ææ­¥éª¤è¦ä½¿ç”¨çš„æŠ½è±¡ç¬¦å·attribute-valueæŒ‡å‘ç¬¦å·è¡¨ä¸­å…³äºè¿™ä¸ªè¯æ³•å•å…ƒçš„æ¡ç›® å®éªŒ1234567891011int main(){ @autoreleasepool { int initial = 8; int six = 6; NSString* site = [[NSString alloc] initWithUTF8String:\"starming\"]; int rank = initial + six; int position = initial + rank * 60; NSLog(@\"%@ rank %d\", site, position); } return 0;} 123456789101112131415161718192021222324252627282930## ä½¿ç”¨æ‰‹å·¥ç¼–è¯‘çš„clangæ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤## -fmodules Enable the 'modules' language feature## This will make any modules-enabled software libraries available as modules as well as introducing any modules-specific syntax.## -E Only run the preprocessor## åªè¿è¡Œé¢„å¤„ç†å™¨## -Xclang &lt;arg&gt; Pass &lt;arg&gt; to the clang compiler## -dump-tokens -- man clang/ clang --help éƒ½æ²¡ä¸åˆ°## å‚è€ƒ1## http://clang.llvm.org/doxygen/namespaceclang_1_1driver_1_1options.html## enum clang::driver::options::ClangFlags## Flags specifically for clang options.## å‚è€ƒ2## Running the plugin## Using the cc1 command line## To run a plugin, the dynamic library containing the plugin registry # must be loaded via the -load command line option. This will load all plugins that are registered, and you can select the plugins to run by specifying the -plugin option. Additional parameters for the plugins can be passed with -plugin-arg-&lt;plugin-name&gt;.## Note that those options must reach clangâ€™s cc1 process. There are two ways to do so:## grep -r \"dump-tokens\" src/llvm/tools/clang## src/llvm/tools/clang/include/clang/Driver/CC1Options.td:def dump_tokens : Flag&lt;[\"-\"], \"dump-tokens\"&gt;,## æ ¹æ®ä¸Šé¢çš„ä¸¤ä¸ªå‚è€ƒé“¾æ¥ + grepçš„ç»“æœç¡®å®š-dump-tokensåº”è¯¥å°±æ˜¯è¿™ä¹ˆæ¥çš„## grep -r \"dump_tokens\" src/llvm/tools/clang## src/llvm/tools/clang/lib/Frontend/CompilerInvocation.cpp: case OPT_dump_tokens:## static InputKind ParseFrontendArgs(FrontendOptions &amp;Opts, ArgList &amp;Args,## DiagnosticsEngine &amp;Diags,## bool &amp;IsHeaderFile) {## ...## case OPT_dump_tokens:## Opts.ProgramAction = frontend::DumpTokens; break; ~% /opt/llvm/bin/clang -fmodules -E -Xclang -dump-tokens main.m ç»“æœå¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879annot_module_include '#import &lt;Foundation/Foundation.h&gt;int main(int argc, const char * argv[]) { @autoreleasepool { int initial = 8; ' Loc=&lt;main.m:9:1&gt;int 'int' [StartOfLine] Loc=&lt;main.m:11:1&gt;identifier 'main' [LeadingSpace] Loc=&lt;main.m:11:5&gt;l_paren '(' Loc=&lt;main.m:11:9&gt;int 'int' Loc=&lt;main.m:11:10&gt;identifier 'argc' [LeadingSpace] Loc=&lt;main.m:11:14&gt;comma ',' Loc=&lt;main.m:11:18&gt;const 'const' [LeadingSpace] Loc=&lt;main.m:11:20&gt;char 'char' [LeadingSpace] Loc=&lt;main.m:11:26&gt;star '*' [LeadingSpace] Loc=&lt;main.m:11:31&gt;identifier 'argv' [LeadingSpace] Loc=&lt;main.m:11:33&gt;l_square '[' Loc=&lt;main.m:11:37&gt;r_square ']' Loc=&lt;main.m:11:38&gt;r_paren ')' Loc=&lt;main.m:11:39&gt;l_brace '{' [LeadingSpace] Loc=&lt;main.m:11:41&gt;at '@' [StartOfLine] [LeadingSpace] Loc=&lt;main.m:12:5&gt;identifier 'autoreleasepool' Loc=&lt;main.m:12:6&gt;l_brace '{' [LeadingSpace] Loc=&lt;main.m:12:22&gt;int 'int' [StartOfLine] [LeadingSpace] Loc=&lt;main.m:13:9&gt;identifier 'initial' [LeadingSpace] Loc=&lt;main.m:13:13&gt;equal '=' [LeadingSpace] Loc=&lt;main.m:13:21&gt;numeric_constant '8' [LeadingSpace] Loc=&lt;main.m:13:23&gt;semi ';' Loc=&lt;main.m:13:24&gt;int 'int' [StartOfLine] [LeadingSpace] Loc=&lt;main.m:14:9&gt;identifier 'six' [LeadingSpace] Loc=&lt;main.m:14:13&gt;equal '=' [LeadingSpace] Loc=&lt;main.m:14:17&gt;numeric_constant '6' [LeadingSpace] Loc=&lt;main.m:14:19&gt;semi ';' Loc=&lt;main.m:14:20&gt;identifier 'NSString' [StartOfLine] [LeadingSpace] Loc=&lt;main.m:15:9&gt;star '*' Loc=&lt;main.m:15:17&gt;identifier 'site' [LeadingSpace] Loc=&lt;main.m:15:19&gt;equal '=' [LeadingSpace] Loc=&lt;main.m:15:24&gt;l_square '[' [LeadingSpace] Loc=&lt;main.m:15:26&gt;l_square '[' Loc=&lt;main.m:15:27&gt;identifier 'NSString' Loc=&lt;main.m:15:28&gt;identifier 'alloc' [LeadingSpace] Loc=&lt;main.m:15:37&gt;r_square ']' Loc=&lt;main.m:15:42&gt;identifier 'initWithUTF8String' [LeadingSpace] Loc=&lt;main.m:15:44&gt;colon ':' Loc=&lt;main.m:15:62&gt;string_literal '\"starming\"' Loc=&lt;main.m:15:63&gt;r_square ']' Loc=&lt;main.m:15:73&gt;semi ';' Loc=&lt;main.m:15:74&gt;int 'int' [StartOfLine] [LeadingSpace] Loc=&lt;main.m:16:9&gt;identifier 'rank' [LeadingSpace] Loc=&lt;main.m:16:13&gt;equal '=' [LeadingSpace] Loc=&lt;main.m:16:18&gt;identifier 'initial' [LeadingSpace] Loc=&lt;main.m:16:20&gt;plus '+' [LeadingSpace] Loc=&lt;main.m:16:28&gt;identifier 'six' [LeadingSpace] Loc=&lt;main.m:16:30&gt;semi ';' Loc=&lt;main.m:16:33&gt;int 'int' [StartOfLine] [LeadingSpace] Loc=&lt;main.m:17:9&gt;identifier 'position' [LeadingSpace] Loc=&lt;main.m:17:13&gt;equal '=' [LeadingSpace] Loc=&lt;main.m:17:22&gt;identifier 'initial' [LeadingSpace] Loc=&lt;main.m:17:24&gt;plus '+' [LeadingSpace] Loc=&lt;main.m:17:32&gt;identifier 'rank' [LeadingSpace] Loc=&lt;main.m:17:34&gt;star '*' [LeadingSpace] Loc=&lt;main.m:17:39&gt;numeric_constant '60' [LeadingSpace] Loc=&lt;main.m:17:41&gt;semi ';' Loc=&lt;main.m:17:43&gt;identifier 'NSLog' [StartOfLine] [LeadingSpace] Loc=&lt;main.m:18:9&gt;l_paren '(' Loc=&lt;main.m:18:14&gt;at '@' Loc=&lt;main.m:18:15&gt;string_literal '\"%@ rank %d\"' Loc=&lt;main.m:18:16&gt;comma ',' Loc=&lt;main.m:18:28&gt;identifier 'site' [LeadingSpace] Loc=&lt;main.m:18:30&gt;comma ',' Loc=&lt;main.m:18:34&gt;identifier 'position' [LeadingSpace] Loc=&lt;main.m:18:36&gt;r_paren ')' Loc=&lt;main.m:18:44&gt;semi ';' Loc=&lt;main.m:18:45&gt;r_brace '}' [StartOfLine] [LeadingSpace] Loc=&lt;main.m:19:5&gt;return 'return' [StartOfLine] [LeadingSpace] Loc=&lt;main.m:20:5&gt;numeric_constant '0' [LeadingSpace] Loc=&lt;main.m:20:12&gt;semi ';' Loc=&lt;main.m:20:13&gt;r_brace '}' [StartOfLine] Loc=&lt;main.m:21:1&gt;eof '' Loc=&lt;main.m:21:2&gt; 1234## ã€Šç¼–è¯‘åŸç†ã€‹ç»™çš„ä¾‹å­position = initial + rate * 60## å¯¹åº”è¯æ³•åºåˆ—&lt;id,1&gt; &lt; = &gt; &lt;id,2&gt; &lt; + &gt; &lt;id,3&gt; &lt; * &gt;&lt;60&gt; 12345678910111213## int position = initial + rank * 60;int 'int' [StartOfLine] [LeadingSpace] Loc=&lt;main.m:17:9&gt;identifier 'position' [LeadingSpace] Loc=&lt;main.m:17:13&gt;equal '=' [LeadingSpace] Loc=&lt;main.m:17:22&gt;identifier 'initial' [LeadingSpace] Loc=&lt;main.m:17:24&gt;plus '+' [LeadingSpace] Loc=&lt;main.m:17:32&gt;identifier 'rank' [LeadingSpace] Loc=&lt;main.m:17:34&gt;star '*' [LeadingSpace] Loc=&lt;main.m:17:39&gt;numeric_constant '60' [LeadingSpace] Loc=&lt;main.m:17:41&gt;semi ';' Loc=&lt;main.m:17:43&gt;## å¯ä»¥è·å¾—æ¯ä¸ª token çš„ç±»å‹ï¼Œå€¼è¿˜æœ‰ç±»ä¼¼ StartOfLine çš„ä½ç½®ç±»å‹å’Œ Loc=main.m:11:1 è¿™ä¸ªæ ·çš„å…·ä½“ä½ç½®ã€‚## å’Œã€Šç¼–è¯‘åŸç†ã€‹æœ‰ç‚¹ä¸åŒ,attribute-valueæ²¡æœ‰æŒ‡å‘ç¬¦å·è¡¨ä¸­å…³äºè¿™ä¸ªè¯æ³•å•å…ƒçš„æ¡ç›® å®ç° å®šä¹‰è¯å…ƒ éå†å­—ç¬¦æµ &amp;&amp; è¾“å‡ºè¯å…ƒ æ¡ˆä¾‹å®šä¹‰è¯å…ƒå…¥é—¨æ•™ç¨‹ä¸­ä¸­çš„Kaleidoscopeè¯­è¨€ 12345678910111213141516171819//===----------------------------------------------------------------------===//// Lexer//===----------------------------------------------------------------------===//// The lexer returns tokens [0-255] if it is an unknown character, otherwise one// of these for known things.// å­—ç¬¦æµè§£æè¯å…ƒè§„åˆ™,è¦ä¹ˆæ˜¯å¦‚ä¸‹5ç§ç±»å‹,è¦ä¹ˆè¿”å›å¯¹åº”çš„ASCIIå€¼enum Token { tok_eof = -1, // commands tok_def = -2, tok_extern = -3, // primary tok_identifier = -4, tok_number = -5};static std::string IdentifierStr; // Filled in if tok_identifierstatic double NumVal; // Filled in if tok_number éå†å­—ç¬¦æµ &amp;&amp; è¾“å‡ºè¯å…ƒ1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253/// gettok - Return the next token from standard input.static int gettok() { static int LastChar = ' '; // Skip any whitespace. /// å¿½ç•¥ç©ºæ ¼ while (isspace(LastChar)) LastChar = getchar(); /// åˆ¤å®šæ˜¯å¦æ˜¯identifier æ»¡è¶³æ­£åˆ™æ¡ä»¶[a-zA-Z][a-zA-Z0-9]* if (isalpha(LastChar)) { // identifier: [a-zA-Z][a-zA-Z0-9]* IdentifierStr = LastChar; while (isalnum((LastChar = getchar()))) IdentifierStr += LastChar; /// æ’é™¤ä¿ç•™çš„å…³é”®å­— if (IdentifierStr == \"def\") return tok_def; if (IdentifierStr == \"extern\") return tok_extern; return tok_identifier; } /// åˆ¤å®šæ˜¯å¦æ˜¯æ•°å­— æ»¡è¶³æ­£åˆ™æ¡ä»¶ [0-9.]+ if (isdigit(LastChar) || LastChar == '.') { // Number: [0-9.]+ std::string NumStr; do { NumStr += LastChar; LastChar = getchar(); } while (isdigit(LastChar) || LastChar == '.'); NumVal = strtod(NumStr.c_str(), 0); return tok_number; } /// åˆ¤å®šæ˜¯å¦æ˜¯æ³¨é‡Š if (LastChar == '#') { // Comment until end of line. do LastChar = getchar(); while (LastChar != EOF &amp;&amp; LastChar != '\\n' &amp;&amp; LastChar != '\\r'); if (LastChar != EOF) return gettok(); } // Check for end of file. Don't eat the EOF. if (LastChar == EOF) return tok_eof; // Otherwise, just return the character as its ascii value. /// è¿”å›å­—ç¬¦çš„asciiå€¼ int ThisChar = LastChar; LastChar = getchar(); return ThisChar;} ç†è®ºæ­£åˆ™è¡¨è¾¾å¼æ­£åˆ™è¡¨è¾¾å¼ï¼ˆRegular Expressionï¼ŒREï¼‰æ˜¯ä¸€ç§ç”¨æ¥æè¿°æ­£åˆ™è¯­è¨€çš„æ›´ç´§å‡‘çš„è¡¨è¾¾æ–¹å¼ã€‚ æ¯ä¸ªæ­£åˆ™è¡¨è¾¾å¼ r å®šä¹‰ï¼ˆè¡¨ç¤ºï¼‰ä¸€ä¸ªè¯­è¨€ï¼Œè®°ä¸º Lï¼ˆrï¼‰ã€‚è¿™ä¸ªè¯­è¨€ä¹Ÿæ˜¯æ ¹æ® r çš„å­è¡¨è¾¾å¼æ‰€è¡¨ç¤ºçš„è¯­è¨€é€’å½’å®šä¹‰çš„ã€‚ Î£ æ˜¯ç»™å®šçš„æœ‰é™å­—ç¬¦é›†Îµ æ˜¯ç©ºä¸²(empty string) å½’çº³åŸºç¡€: Îµæ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼,L(Îµ) = {Îµ},å³è¯¥è¯­è¨€åªåŒ…å«ç©ºä¸² å¦‚æœ a âˆˆ Î£,é‚£ä¹ˆaæ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼,ä¸”L(a) = {a}ã€‚å³è¿™ä¸ªè¯­è¨€ä»…åŒ…å«ä¸€ä¸ªé•¿åº¦ä¸º1çš„ç¬¦å·ä¸²aã€‚ å½’çº³æ­¥éª¤:å‡è®¾ r å’Œ s éƒ½æ˜¯æ­£åˆ™è¡¨è¾¾å¼,è¡¨ç¤ºçš„è¯­è¨€åˆ†åˆ«æ˜¯L(r)å’ŒL(s) r|s æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼,L(r|s) = L(r)âˆªL(s) rs(r å’Œ s çš„è¿æ¥)æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼,L(rs)=L(r)L(s) r* æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼,L(r*) = (L(r))* (r)æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼,L((r)) = L(r),è¡¨æ˜è¡¨è¾¾å¼çš„ä¸¤è¾¹åŠ ä¸Šæ‹¬å·å¹¶ä¸å½±å“è¡¨è¾¾å¼æ‰€è¡¨ç¤ºçš„è¯­è¨€ è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§: * , è¿æ¥ , |* å·ä»£è¡¨å­—ç¬¦å¯ä»¥ä¸å‡ºç°ï¼Œä¹Ÿå¯ä»¥å‡ºç°ä¸€æ¬¡æˆ–è€…å¤šæ¬¡ æœ‰ç©·è‡ªåŠ¨æœºæ­£åˆ™è¡¨è¾¾å¼æè¿°çš„è§„åˆ™äººå®¹æ˜“ç†è§£,ä½†æ˜¯è¦è§£æå­—ç¬¦ä¸²,è¿˜éœ€è¦å°†å…¶è½¬åŒ–ä¸ºè®¡ç®—æœºç¨‹åºèƒ½ç†è§£çš„æ¨¡å‹ã€‚ æœ‰ç©·è‡ªåŠ¨æœº(Finite Automataï¼ŒFA)æ˜¯å¯¹ä¸€ç±»å¤„ç†ç³»ç»Ÿå»ºç«‹çš„æ•°å­¦æ¨¡å‹ã€‚è¿™ç±»ç³»ç»Ÿå…·æœ‰ä¸€ç³»åˆ—ç¦»æ•£çš„è¾“å…¥è¾“å‡ºä¿¡æ¯å’Œæœ‰ç©·æ•°ç›®çš„å†…éƒ¨çŠ¶æ€ã€‚ æ•°å­¦è¡¨è¾¾: M = (S,Î£,Î´,s0,F) S: æœ‰ç©·çŠ¶æ€é›†Î£: å­—ç¬¦è¡¨Î´: è½¬æ¢å‡½æ•°s0: åˆå§‹çŠ¶æ€F: ç»“æŸ/å¯æ¥å—çŠ¶æ€é›† è¡¨ç¤ºæ–¹æ³•æœ‰ç©·è‡ªåŠ¨æœºå¯ä»¥ç”¨è½¬æ¢å›¾æ¥è¡¨ç¤ºã€‚ åˆå§‹çŠ¶æ€(å¼€å§‹çŠ¶æ€):åªæœ‰ä¸€ä¸ªï¼Œæœ‰ start ç®­å¤´æŒ‡å‘ ç»ˆæ­¢çŠ¶æ€/å¯æ¥å—çŠ¶æ€:å¯ä»¥æœ‰å¤šä¸ª,ç”¨åŒåœˆè¡¨ç¤º åˆ†ç±» ç¡®å®šçš„æœ‰ç©·è‡ªåŠ¨æœºï¼ˆDFAï¼‰ ä¸ç¡®å®šçš„æœ‰ç©·è‡ªåŠ¨æœºï¼ˆNFAï¼‰ éç¡®å®šæœ‰ç©·è‡ªåŠ¨æœºNFA å’Œç¡®å®šçš„æœ‰ç©·è‡ªåŠ¨æœºDFA å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼šä»çŠ¶æ€ s å‡ºå‘ï¼Œèƒ½åˆ°è¾¾çš„çŠ¶æ€å¯èƒ½æœ‰å¤šä¸ªã€‚ï¼ˆå¹¶ä¸æ˜¯å”¯ä¸€ç¡®å®šçš„ï¼‰ å› æ­¤ï¼Œè½¬æ¢å‡½æ•°ä¸ºé›†åˆï¼Œè€Œä¸æ˜¯å…ƒç´ ã€‚ DFA NFA å¯¹åº”çš„æ­£åˆ™è¡¨è¾¾å¼æ˜¯ (a|b)*abb ä»æ­£åˆ™è¡¨è¾¾å¼åˆ°æœ‰ç©·è‡ªåŠ¨æœºå› ä¸ºNFA åŒä¸€è¾“å…¥å¯¼å‡ºå¤šç§çŠ¶æ€,åˆ¤å®šæ¥å—æ¯”è¾ƒéº»çƒ¦,å› æ­¤,ä¸€èˆ¬ä¼šå°†NFAè½¬æ¢ä¸ºDFAæ¥å®ç° ç®€è€Œè¨€ä¹‹,è¦åšçš„å°±æ˜¯ RE -&gt; NFA -&gt; DFA Thompson ç®—æ³• (RE åˆ° NFA)æ­£åˆ™è¡¨è¾¾å¼æ˜¯é€’å½’å®šä¹‰çš„,é€šè¿‡ä¸åœçš„åˆ†è§£å­è¡¨è¾¾å¼ï¼Œå³å¯æ±‚å¾—æœ€ç»ˆçš„ NFAã€‚ æ¯”å¦‚ r=ï¼ˆa|bï¼‰*abb å¯¹åº”çš„ NFA å­é›†æ„é€ æ³• (NFA åˆ° DFA)å­é›†æ„é€ æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯è®©æ„é€ å¾—åˆ°çš„DFAçš„æ¯ä¸ªçŠ¶æ€å¯¹åº”äºNFAçš„ä¸€ä¸ªçŠ¶æ€é›†åˆ æ­£åˆ™è¡¨è¾¾å¼ (a|b)*abb 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960çŠ¶æ€0 è®°ä¸º s0s0 è¾“å…¥ a å¯åˆ°è¾¾çŠ¶æ€{0,1} è®°ä¸ºs1s0 -&gt; a = {0,1} = s1s0 è¾“å…¥ b å¯åˆ°åˆ°çŠ¶æ€{0} å³s0s0 -&gt; b = {0} = s0s1 è¾“å…¥ a å½“å¤„äºçŠ¶æ€0æ—¶,å¯åˆ°è¾¾{0,1}å½“å¤„äºçŠ¶æ€1æ—¶,å¯åˆ°è¾¾âˆ… ä¸¤è€…å–å¹¶é›†å¯åˆ°è¾¾çŠ¶æ€{0,1} å³s1(s1,a) -&gt; {0,1} = s1s1 è¾“å…¥ b å¯åˆ°è¾¾çŠ¶æ€{0,2} è®°ä¸ºs2(s1,b) -&gt; {0,2} = s2s2 è¾“å…¥ aå½“å¤„äºçŠ¶æ€0æ—¶,å¯åˆ°è¾¾{0,1}å½“å¤„äºçŠ¶æ€2æ—¶,å¯åˆ°è¾¾âˆ…,ä¸¤è€…å–å¹¶é›†å¯åˆ°è¾¾çŠ¶æ€{0,1} å³s1s2 è¾“å…¥ a å¯åˆ°è¾¾{0,1}(s2,a) -&gt; {0,1} = s1s2 è¾“å…¥ b å½“å¤„äºçŠ¶æ€0æ—¶,å¯åˆ°è¾¾{0}å½“å¤„äºçŠ¶æ€2æ—¶,å¯åˆ°è¾¾{3},ä¸¤è€…å–å¹¶é›†å¯åˆ°è¾¾çŠ¶æ€{0,3},è®°ä¸ºs3(s2,b) -&gt; {0,3} = s3s3 è¾“å…¥ a0 -&gt; {0,1}3 -&gt; âˆ…{0,1} U âˆ… =&gt; {0,1} = s1(s3,a) -&gt; {0,1} = s1s3 è¾“å…¥ b0 -&gt; {0}3 -&gt; âˆ…{0} U âˆ… =&gt; {0} = s0(s3,b) -&gt; s0åˆ°s3ç»§ç»­è¾“å…¥a|b,å›åˆ°s0/s1,æ²¡æœ‰æ–°çš„çŠ¶æ€,å†è¾“å…¥åªä¼šé‡æ–°æ‰§è¡Œä¸Šé¢çš„è¿‡ç¨‹,å› æ­¤æ„é€ ç»“æŸ,åŒ…å«çŠ¶æ€3çš„æ˜¯ç»ˆæ­¢èŠ‚ç‚¹å¯¹ä¸Šé¢çš„è¿‡ç¨‹è¿›è¡Œæ¢³ç†å¯å¾—s0 æ˜¯åˆå§‹çŠ¶æ€s0 è¾“å…¥ b åˆ° s0 çŠ¶æ€s0 è¾“å…¥ a åˆ° s1 çŠ¶æ€s1 è¾“å…¥ a åˆ° s1 çŠ¶æ€s1 è¾“å…¥ b åˆ° s2 çŠ¶æ€s2 è¾“å…¥ a åˆ° s1 çŠ¶æ€s2 è¾“å…¥ b åˆ° s3 çŠ¶æ€s3 è¾“å…¥ a åˆ° s1 çŠ¶æ€s3 è¾“å…¥ b åˆ° s0 çŠ¶æ€ æ•´ä¸ªæ€è€ƒè¿‡ç¨‹å¤„ç†æˆè¡¨æ ¼çš„å½¢å¼ çŠ¶æ€é›†\\æ¡ä»¶ a b 0 {0,1} =&gt; s1 {0} =&gt; s0 1 {0,1} =&gt; s1 {2} =&gt; s2 2 {0,1} =&gt; s1 {0,3} =&gt; s3 3 {0,1} =&gt; s1 {0} =&gt; s0 å¦å¤–ä¸€ç§æƒ…å†µ NFA ä¸­åŒ…å« Îµ è¾¹æ¯”å¦‚å‚è€ƒé“¾æ¥9ä¸­ä¸¾çš„ä¾‹å­ æ­£åˆ™è¡¨è¾¾å¼ä¸º a (b|c)* 123456789101112131415161718192021222324å­—ç¬¦é›†ä¸º{a,b,c}è®¾s0 = n0s0 è¾“å…¥aå¯åˆ°è¾¾çŠ¶æ€{n1} ``Îµ`` ä¸æ¶ˆè€—ä»£ä»·,å¯ä»¥ç•¥è¿‡,å› æ­¤å®é™…å¯åˆ°è¾¾ä¸º {n1,n2,n3,n4,n6,n9} è®°ä¸º s1çŠ¶æ€s0 é€šè¿‡Îµè½¬æ¢åˆ°è¾¾çš„NFAçŠ¶æ€é›†åˆÎµ.closure(s0) = {n1,n2,n3,n4,n6,n9} = s1 ç»ˆæ­¢çŠ¶æ€(åŒ…å«äº†n9)è§‚å¯Ÿä¸Šé¢çš„å›¾+æ€è€ƒæ¯”è¾ƒå®¹æ˜“åˆ¤æ–­å‡º,å“ªäº›æƒ…å†µä¸‹è¾“å…¥b,cå¾—åˆ°çš„ç»“æœä¸ä¼šæ˜¯âˆ… ,å³æœ‰æ•ˆçš„s1 è¾“å…¥bÎµ.closure(Move(s1,b)) = {n5,n8,n9,n3,n4,n6} = s2 ç»ˆæ­¢çŠ¶æ€s1 è¾“å…¥cÎµ.closure(Move(s1,c)) = {n7,n8,n9,n3,n4,n6} = s3 ç»ˆæ­¢çŠ¶æ€s2 è¾“å…¥bÎµ.closure(Move(s2,b)) = {n5,n8,n9,n3,n4,n6} = s2s2 è¾“å…¥ cÎµ.closure(Move(s2,c)) = {n7,n8,n9,n3,n4,n6} = s3s3 è¾“å…¥ bÎµ.closure(Move(s3,b)) = {n5,n8,n9,n3,n4,n6} = s2s3 è¾“å…¥ cÎµ.closure(Move(s3,c)) = {n5,n8,n9,n3,n4,n6} = s3 çŠ¶æ€é›†\\æ¡ä»¶ a b c s0 {n1,n2,n3,n4,n6,n9} =&gt; s1 âˆ… âˆ… s1 âˆ… {n5,n8,n9,n3,n4,n6} =&gt; s2 {n7,n8,n9,n3,n4,n6} =&gt; s3 s2 âˆ… {n5,n8,n9,n3,n4,n6} =&gt; s2 {n7,n8,n9,n3,n4,n6} =&gt; s3 s3 âˆ… {n5,n8,n9,n3,n4,n6} =&gt; s2 {n7,n8,n9,n3,n4,n6} =&gt; s3 å‚è€ƒé“¾æ¥9 12345678910111213141516171819202122/// å­é›†æ„é€ ç®—æ³•: å·¥ä½œè¡¨ç®—æ³• /// åˆå§‹çŠ¶æ€s0 &lt;- eps_closure(n0)Q &lt;- {s0}/// å°†åˆå§‹çŠ¶æ€æ·»åŠ åˆ°å·¥ä½œè¡¨ä¸­workList &lt;- s0while (workList != []) /// å°†è¯¥çŠ¶æ€æ·»åŠ åˆ° remove s from workList foreach (character c) /** 1.éå†çŠ¶æ€é›†såœ¨è¾“å…¥æ¡ä»¶cä¸‹å¾—åˆ°çš„çŠ¶æ€é›†åˆ 2.é€šè¿‡e-closureæ‰©å±•è¾¹ç•Œ,ç„¶åå–å¹¶é›†,å¾—åˆ°æœ€ç»ˆçš„çŠ¶æ€é›† */ t &lt;- e-closure(delta(s,c)) D[s,c] &lt;- t /** åˆ¤æ–­æ ‡å‡†: ç»è¿‡e-closure è½¬æ¢,å‘ç°æ–°çš„çŠ¶æ€,ç»§ç»­è¿›è¡Œå­é›†æ„é€ æ“ä½œ, å¦åˆ™è¯æ˜è¿™æ¡åˆ†æ”¯çš„è½¬æ¢ç»“æŸ,ç»§ç»­åˆ¤æ–­å·¥ä½œåˆ—è¡¨ä¸­æ˜¯å¦ä¸ºç©º */ if (t not in Q) add t to Q and workList å› ä¸ºæœ‰é™é›†åˆçš„å­é›†æ˜¯æœ‰é™çš„,Nä¸ªå…ƒç´ çš„é›†åˆ,æœ€å¤šæœ‰2^Nä¸ªå­é›†,æ¯æ¬¡éå†éƒ½ä¼šå°†çŠ¶æ€åŠ å…¥åˆ°Qä¸­,æ‰€ä»¥å¾ªç¯æœ€ç»ˆä¼šç»“æŸã€‚ DFAçš„çŠ¶æ€æ•°æœ‰å¯èƒ½æ˜¯NFAçŠ¶æ€æ•°çš„æŒ‡æ•°,åœ¨è¿™ç§æƒ…å†µä¸‹,æˆ‘ä»¬åœ¨è¯•å›¾å®ç°è¿™ä¸ªDFAæ—¶ä¼šé‡åˆ°å›°éš¾ã€‚ç„¶è€Œ,åŸºäºè‡ªåŠ¨æœºçš„è¯æ³•åˆ†ææ–¹æ³•çš„å¤„ç†éƒ¨åˆ†æºäºå¦‚ä¸‹äº‹å®:å¯¹äºä¸€ä¸ªçœŸå®çš„è¯­è¨€,å®ƒçš„NFAå’ŒDFAçš„çŠ¶æ€æ•°é‡å¤§è‡´ç›¸åŒ,çŠ¶æ€æ•°é‡å‘ˆæŒ‡æ•°å…³ç³»çš„æƒ…å½¢å°šæœªåœ¨å®è·µä¸­å‡ºç°è¿‡â€” ã€Šç¼–è¯‘åŸç†ã€‹ Hopcroft ç®—æ³• (æœ€å°åŒ– DFA)ç»è¿‡å‰é¢ä¸¤æ­¥,å·²ç»å°† RE,è½¬æ¢æˆDFA,ä½†æ˜¯è¿˜éœ€è¦è¿›è¡Œæœ€å°åŒ–çš„æ“ä½œ å‚è€ƒé“¾æ¥9 123456789101112131415split(s) foreach(character c) /** è¾“å…¥å­—ç¬¦cåˆ°çŠ¶æ€é›†åˆsä¸­,æ¯ç§çŠ¶æ€è¾“å‡ºçš„çŠ¶æ€é›†å­˜åœ¨ä¸ä¸€è‡´çš„æƒ…å†µ,è¯æ˜å­—ç¬¦cå¯ä»¥åˆ‡å‰²è¿™ä¸ªçŠ¶æ€é›†åˆs */ if (c can split s) split s into T1,...,Tk hopcroft() /** é¦–æ¬¡åˆ’åˆ†: Néç»“æŸçŠ¶æ€,Aç»“æŸçŠ¶æ€ */ split all nodes into N,A while (set is still changes) split(s) å°†æ‰€æœ‰ç»ˆæ­¢çŠ¶æ€åˆå¹¶ä¸ºçŠ¶æ€s4 è¯¥çŠ¶æ€s4æ¥æ”¶å­—ç¬¦b,c 123456789ç”¨å­—ç¬¦bå°è¯•åˆ‡å‰²çŠ¶æ€1 è¾“å…¥ b å¾—åˆ°çŠ¶æ€2 åœ¨çŠ¶æ€s4ä¸­çŠ¶æ€2 è¾“å…¥ b å¾—åˆ°çŠ¶æ€2 åœ¨çŠ¶æ€s4ä¸­çŠ¶æ€3 è¾“å…¥ b ç©ºé›† å¿½ç•¥æ— æ³•é€šè¿‡å­—ç¬¦bæ‰¾åˆ°ä¸€ä¸ªä¸å±äºçŠ¶æ€s4çš„çŠ¶æ€å¯¹å­—ç¬¦cåŒç†,å› æ­¤å¯ä»¥åˆå¹¶ Clang ä¸­çš„å®ç°è¦è§£å†³çš„é—®é¢˜æ˜¯: Clang æ˜¯å¦‚ä½•è¿›è¡Œè¯æ³•åˆ†æçš„? å¦‚ä½•ä½¿ç”¨lldb è°ƒè¯•Clang å·¥ç¨‹åœ¨ä¸Šé¢çš„å®éªŒåˆ†æ,å‘ç°ç»ˆç«¯åœ¨æ‰§è¡Œclang æŒ‡ä»¤æ—¶,æœ€ç»ˆä¼šä¼ é€’åˆ°CompilerInvocation.cpp è¿™ä¸ªæ–‡ä»¶çš„ParseFrontendArgsæ–¹æ³•ä¸­ã€‚æŒ‡ä»¤çš„å®Œæˆå,è¿›ç¨‹å°±ç»“æŸäº†,å¹¶ä¸åƒiOS åº”ç”¨ä¼šæœ‰è¿è¡Œå¾ªç¯ã€‚ å› æ­¤åœ¨CompilerInvocation.cppæ–‡ä»¶ä¸­ 123456789å¼•å…¥ #include &lt;unistd.h&gt; å¤´æ–‡ä»¶æ·»åŠ å»¶æ—¶çš„æ“ä½œcase OPT_dump_tokens: Opts.ProgramAction = frontend::DumpTokens; sleep(20); break;é‡æ–°sudo ninja -j4 install çª—å£Aæ‰§è¡Œ 12## å®šä½åˆ°å·¥ç¨‹ç›®å½•ä¸­/opt/llvm/bin/clang-8 -fmodules -E -Xclang -dump-tokens main.mm çª—å£Bæ‰§è¡Œ 123456~ % ps -ef | grep clang## ä¼šæœ‰ç±»ä¼¼ä¸‹é¢çš„è¾“å‡º% ps -ef | grep clang-8 501 497 3105 0 11:11AM ttys000 0:00.01 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn clang-8 501 384 13315 0 11:11AM ttys001 0:00.06 /opt/llvm/bin/clang-8 -fmodules -E -Xclang -dump-tokens main.mm 501 392 384 0 11:11AM ttys001 0:00.01 /opt/llvm/bin/clang-8 -cc1 -triple x86_64-apple-macosx10.13.0 -Wdeprecated-objc-isa-usage -Werror=deprecated-objc-isa-usage -E -disable-free -disable-llvm-verifier -discard-value-names -main-file-name main.mm -mrelocation-model pic -pic-level 2 -mthread-model posix -mdisable-fp-elim -masm-verbose -munwind-tables -target-cpu penryn -dwarf-column-info -debugger-tuning=lldb -ggnu-pubnames -target-linker-version 409.12 -resource-dir /opt/llvm/lib/clang/8.0.0 -stdlib=libc++ -internal-isystem /opt/llvm/include/c++/v1 -fdeprecated-macro -fdebug-compilation-dir /Users/Jason/Desktop/TryLLVM/prj/LLVM_02/LLVM_02 -ferror-limit 19 -fmessage-length 158 -stack-protector 1 -fblocks -fencode-extended-block-signature -fmodules -fimplicit-module-maps -fmodules-cache-path=/var/folders/lk/znn1qp4925j412wt4t_qkplc0000gn/C/org.llvm.clang.Jason/ModuleCache -fmodules-validate-system-headers -fregister-global-dtors-with-atexit -fobjc-runtime=macosx-10.13.0 -fobjc-exceptions -fcxx-exceptions -fexceptions -fmax-type-align=16 -fdiagnostics-show-option -fcolor-diagnostics -dump-tokens -o - -x objective-c++ main.mm çª—å£Cæ‰§è¡Œ 123456## è¿›å…¥lldb äº¤äº’ç¯å¢ƒ~% lldb ## attachåˆ°å¯¹åº”çš„è¿›ç¨‹ä¸Š é€‰å¸¦cc1çš„é‚£ä¸ªè¿›ç¨‹~% process attach --pid 392## æŸ¥çœ‹è°ƒç”¨æ ˆ~% bt all æŸ¥çœ‹æºä»£ç ,ç»è¿‡æ•´ç†å,å¤§è‡´æ˜¯è¿™æ ·çš„ 12345## CompilerInvocation.cppCompilerInvocation::CreateFromArgs è°ƒç”¨ParseFrontendArgs è°ƒç”¨## FrontendAction.cppDumpTokensAction::ExecuteAction 1234567891011void DumpTokensAction::ExecuteAction() { Preprocessor &amp;PP = getCompilerInstance().getPreprocessor(); // Start preprocessing the specified input file. Token Tok; PP.EnterMainSourceFile(); do { PP.Lex(Tok); PP.DumpToken(Tok, true); llvm::errs() &lt;&lt; \"\\n\"; } while (Tok.isNot(tok::eof));} 123456789101112131415161718192021222324252627282930313233void Preprocessor::Lex(Token &amp;Result) { // We loop here until a lex function returns a token; this avoids recursion. bool ReturnedToken; do { switch (CurLexerKind) { case CLK_Lexer: ReturnedToken = CurLexer-&gt;Lex(Result); break; case CLK_TokenLexer: ReturnedToken = CurTokenLexer-&gt;Lex(Result); break; case CLK_CachingLexer: CachingLex(Result); ReturnedToken = true; break; case CLK_LexAfterModuleImport: LexAfterModuleImport(Result); ReturnedToken = true; break; } } while (!ReturnedToken); if (Result.is(tok::code_completion) &amp;&amp; Result.getIdentifierInfo()) { // Remember the identifier before code completion token. setCodeCompletionIdentifierInfo(Result.getIdentifierInfo()); setCodeCompletionTokenRange(Result.getLocation(), Result.getEndLoc()); // Set IdenfitierInfo to null to avoid confusing code that handles both // identifiers and completion tokens. Result.setIdentifierInfo(nullptr); } LastTokenWasAt = Result.is(tok::at);} 1234567891011121314151617181920212223void Preprocessor::DumpToken(const Token &amp;Tok, bool DumpFlags) const { llvm::errs() &lt;&lt; tok::getTokenName(Tok.getKind()) &lt;&lt; \" '\" &lt;&lt; getSpelling(Tok) &lt;&lt; \"'\"; if (!DumpFlags) return; llvm::errs() &lt;&lt; \"\\t\"; if (Tok.isAtStartOfLine()) llvm::errs() &lt;&lt; \" [StartOfLine]\"; if (Tok.hasLeadingSpace()) llvm::errs() &lt;&lt; \" [LeadingSpace]\"; if (Tok.isExpandDisabled()) llvm::errs() &lt;&lt; \" [ExpandDisabled]\"; if (Tok.needsCleaning()) { const char *Start = SourceMgr.getCharacterData(Tok.getLocation()); llvm::errs() &lt;&lt; \" [UnClean='\" &lt;&lt; StringRef(Start, Tok.getLength()) &lt;&lt; \"']\"; } llvm::errs() &lt;&lt; \"\\tLoc=&lt;\"; DumpLocation(Tok.getLocation()); llvm::errs() &lt;&lt; \"&gt;\";} åœ¨CompilerInvocation::CreateFromArgs æ–¹æ³•ä¸Šä¹Ÿåšç±»ä¼¼å»¶æ—¶çš„æ“ä½œ,ç„¶åè®¾ç½®æ–­ç‚¹ 1(lldb) br set --name ParseFrontendArgs å‚æ•°Tokençš„ç»“æ„å¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354namespace clang {class IdentifierInfo;/// Token - This structure provides full information about a lexed token./// It is not intended to be space efficient, it is intended to return as much/// information as possible about each returned token. This is expected to be/// compressed into a smaller form if memory footprint is important.////// The parser can create a special \"annotation token\" representing a stream of/// tokens that were parsed and semantically resolved, e.g.: \"foo::MyClass&lt;int&gt;\"/// can be represented by a single typename annotation token that carries/// information about the SourceRange of the tokens and the type object.class Token { /// The location of the token. This is actually a SourceLocation. unsigned Loc; // Conceptually these next two fields could be in a union. However, this // causes gcc 4.2 to pessimize LexTokenInternal, a very performance critical // routine. Keeping as separate members with casts until a more beautiful fix // presents itself. /// UintData - This holds either the length of the token text, when /// a normal token, or the end of the SourceRange when an annotation /// token. /// token çš„é•¿åº¦ unsigned UintData; /// PtrData - This is a union of four different pointer types, which depends /// on what type of token this is: /// Identifiers, keywords, etc: /// This is an IdentifierInfo*, which contains the uniqued identifier /// spelling. /// Literals: isLiteral() returns true. /// This is a pointer to the start of the token in a text buffer, which /// may be dirty (have trigraphs / escaped newlines). /// Annotations (resolved type names, C++ scopes, etc): isAnnotation(). /// This is a pointer to sema-specific data for the annotation token. /// Eof: // This is a pointer to a Decl. /// Other: /// This is null. /// tokençš„å†…å®¹ void *PtrData; /// Kind - The actual flavor of token this is. /// tokençš„ç±»å‹ tok::TokenKind Kind; /// Flags - Bits we track about this token, members of the TokenFlags enum. unsigned short Flags;public: ... tok::TokenKind çš„å£°æ˜ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576TokenKinds.hnamespace tok {/// Provides a simple uniform namespace for tokens from all C languages.enum TokenKind : unsigned short {#define TOK(X) X,#include \"clang/Basic/TokenKinds.def\" NUM_TOKENS};/// Provides a namespace for preprocessor keywords which start with a/// '#' at the beginning of the line.enum PPKeywordKind {#define PPKEYWORD(X) pp_##X,#include \"clang/Basic/TokenKinds.def\" NUM_PP_KEYWORDS};/// Provides a namespace for Objective-C keywords which start with/// an '@'.enum ObjCKeywordKind {#define OBJC_AT_KEYWORD(X) objc_##X,#include \"clang/Basic/TokenKinds.def\" NUM_OBJC_KEYWORDS};// clang/Basic/TokenKinds.def...// C99 6.4.2: Identifiers.TOK(identifier) // abcde123TOK(raw_identifier) // Used only in raw lexing mode.// C99 6.4.4.1: Integer Constants// C99 6.4.4.2: Floating ConstantsTOK(numeric_constant) // 0x123// C99 6.4.4: Character ConstantsTOK(char_constant) // 'a'TOK(wide_char_constant) // L'b'// C++17 Character ConstantsTOK(utf8_char_constant) // u8'a'// C++11 Character ConstantsTOK(utf16_char_constant) // u'a'TOK(utf32_char_constant) // U'a'// C99 6.4.5: String Literals.TOK(string_literal) // \"foo\"TOK(wide_string_literal) // L\"foo\"TOK(angle_string_literal)// &lt;foo&gt;// C++11 String Literals.TOK(utf8_string_literal) // u8\"foo\"TOK(utf16_string_literal)// u\"foo\"TOK(utf32_string_literal)// U\"foo\"// C99 6.4.6: Punctuators.PUNCTUATOR(l_square, \"[\")PUNCTUATOR(r_square, \"]\")PUNCTUATOR(l_paren, \"(\")PUNCTUATOR(r_paren, \")\")PUNCTUATOR(l_brace, \"{\")PUNCTUATOR(r_brace, \"}\")PUNCTUATOR(period, \".\")PUNCTUATOR(ellipsis, \"...\")PUNCTUATOR(amp, \"&amp;\")PUNCTUATOR(ampamp, \"&amp;&amp;\")PUNCTUATOR(ampequal, \"&amp;=\")PUNCTUATOR(star, \"*\")PUNCTUATOR(starequal, \"*=\")PUNCTUATOR(plus, \"+\")PUNCTUATOR(plusplus, \"++\")PUNCTUATOR(plusequal, \"+=\")... 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374/// Lexer.cpp/// LexTokenInternal - This implements a simple C family lexer. It is an/// extremely performance critical piece of code. This assumes that the buffer/// has a null character at the end of the file. This returns a preprocessing/// token, not a normal token, as such, it is an internal interface. It assumes/// that the Flags of result have been cleared before calling this./// è¯æ³•åˆ†æçš„æ–¹æ³•bool Lexer::LexTokenInternal(Token &amp;Result, bool TokAtPhysicalStartOfLine)...// Read a character, advancing over it. char Char = getAndAdvanceChar(CurPtr, Result); tok::TokenKind Kind;/// éå†å­—ç¬¦ switch (Char) {...case '\\n': // If we are inside a preprocessor directive and we see the end of line, // we know we are done with the directive, so return an EOD token. if (ParsingPreprocessorDirective) { // Done parsing the \"line\". ParsingPreprocessorDirective = false; // Restore comment saving mode, in case it was disabled for directive. if (PP) resetExtendedTokenMode(); // Since we consumed a newline, we are back at the start of a line. IsAtStartOfLine = true; IsAtPhysicalStartOfLine = true; /// æ¯”å¦‚\\nç±»å‹å°±åˆ¤æ–­tok::endç±»å‹ Kind = tok::eod; break; }... // C99 6.4.4.1: Integer Constants. // C99 6.4.4.2: Floating Constants. // æ•´å½¢å¸¸é‡ case '0': case '1': case '2': case '3': case '4': case '5': case '6': case '7': case '8': case '9': // Notify MIOpt that we read a non-whitespace/non-comment token. MIOpt.ReadToken(); return LexNumericConstant(Result, CurPtr);... // C99 6.4.2: Identifiers. æ˜¯ä¸æ˜¯æ ‡è¯†ç¬¦ case 'A': case 'B': case 'C': case 'D': case 'E': case 'F': case 'G': case 'H': case 'I': case 'J': case 'K': /*'L'*/case 'M': case 'N': case 'O': case 'P': case 'Q': /*'R'*/case 'S': case 'T': /*'U'*/ case 'V': case 'W': case 'X': case 'Y': case 'Z': case 'a': case 'b': case 'c': case 'd': case 'e': case 'f': case 'g': case 'h': case 'i': case 'j': case 'k': case 'l': case 'm': case 'n': case 'o': case 'p': case 'q': case 'r': case 's': case 't': /*'u'*/ case 'v': case 'w': case 'x': case 'y': case 'z': case '_': // Notify MIOpt that we read a non-whitespace/non-comment token. MIOpt.ReadToken(); return LexIdentifier(Result, CurPtr);/// LexNumericConstant - Lex the remainder of a integer or floating point/// constant. From[-1] is the first character lexed. Return the end of the/// constant.bool Lexer::LexNumericConstant(Token &amp;Result, const char *CurPtr) {.../// ç±»å‹è®¾ç½®ä¸º tok::numeric_constantFormTokenWithChars(Result, CurPtr, tok::numeric_constant);.../// åˆ¤æ–­æ˜¯å¦æ˜¯æ ‡è¯†ç¬¦bool Lexer::LexIdentifier(Token &amp;Result, const char *CurPtr) { // Match [_A-Za-z0-9]*, we have already matched [_A-Za-z$] unsigned Size; unsigned char C = *CurPtr++;... å‚è€ƒ LLVM Tutorial ç¬¬ä¸€ç«  æ•™ç¨‹ç®€ä»‹ä¸è¯æ³•åˆ†æå™¨ æ·±å…¥å‰–æ iOS ç¼–è¯‘ Clang LLVM Lexical_analysis ç¼–è¯‘åŸç†ï¼ˆ3ï¼‰ï¼šè¯æ³•åˆ†æ Wiki Regular expression ç¼–è¯‘åŸç†ï¼šæœ‰ç©·è‡ªåŠ¨æœºï¼ˆDFAä¸NFAï¼‰ ã€ç¼–è¯‘åŸç†ã€‘:NFAè½¬å˜ä¸ºDFAçš„å­é›†æ„é€ æ³• ç½‘æ˜“äº‘è¯¾å ‚ - ç¼–è¯‘åŸç† çŠ¶æ€å›¾åˆ¶ä½œç½‘ç«™ 64ä½æ±‡ç¼–å‚æ•°ä¼ é€’","link":"/2018/12/28/Topic-Clang-Learn-Clang-02/"},{"title":"iOSå´©æºƒæ—¥å¿—åˆ†æ","text":"ç¯å¢ƒ macOS Mojave 10.14.3Xcode10.1iPhone6S 10.0.1 è·å¾—å´©æºƒæ—¥å¿—æ–¹å¼ä¸€:Xcodeèœå• &gt; Window &gt; Devices and Simulators é€‰æ‹©è®¾å¤‡å¹¶æŸ¥çœ‹è®¾å¤‡æ—¥å¿—(View Device Logs) æ–¹å¼äºŒ:æ‰‹æœºè®¾ç½® &gt; éšç§ &gt; è¯Šæ–­ä¸ç”¨é‡ &gt; è¯Šæ–­ä¸ç”¨é‡æ•°æ® å´©æºƒæ—¥å¿—çš„ç»“æ„å¤´éƒ¨(Header) Incident Identifier: å´©æºƒæ—¥å¿—çš„å”¯ä¸€æ ‡è¯† CrashReporter Key: åŒ¿åçš„è®¾å¤‡æ ‡è¯† Process:è¿›ç¨‹å Path:äºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„ Identifier:åŒ…å Version:åº”ç”¨ç‰ˆæœ¬å· Code Type: ç›®æ ‡æ¶æ„ Role:è¿›ç¨‹ç»ˆæ­¢æ—¶è¿›ç¨‹è¢«èµ‹äºˆçš„task_roleæšä¸¾å€¼â€¦ 1234567891011121314151617Incident Identifier: F21EC10C-018D-494F-997D-E9C9D82B2F7FCrashReporter Key: ab7fcdf6938542fd82446362e0481f7fddba141fHardware Model: iPhone6,2Process: JACrash [27195]Path: /private/var/containers/Bundle/Application/EDDDCB8E-75CE-4638-84CA-5B7971F6EFE0/JACrash.app/JACrashIdentifier: com.ishepherdme.JACrashVersion: 1 (1.0)Code Type: ARM-64 (Native)Role: ForegroundParent Process: launchd [1]Coalition: com.ishepherdme.JACrash [4182]Date/Time: 2019-02-08 13:03:58.7771 +0800Launch Time: 2019-02-08 13:03:58.3811 +0800OS Version: iPhone OS 10.0.1 (14A403)Report Version: 104 å¼‚å¸¸ä¿¡æ¯(Exception Information) Triggered by Thread: äº§ç”Ÿå´©æºƒçš„çº¿ç¨‹ Exception Type: å´©æºƒç±»å‹â€¦ 1234Exception Type: EXC_CRASH (SIGABRT)Exception Codes: 0x0000000000000000, 0x0000000000000000Exception Note: EXC_CORPSE_NOTIFYTriggered by Thread: 0 å…¶ä»–è¯Šæ–­ä¿¡æ¯ Application Specific Information:åœ¨è¿›ç¨‹ç»ˆæ­¢æ—¶æ¡†æ¶æ•è·çš„é”™è¯¯ä¿¡æ¯â€¦ 12345Application Specific Information:abort() calledFiltered syslog:None found çº¿ç¨‹å›æº¯ç½—åˆ—å´©æºƒæ—¶æ¯ä¸ªçº¿ç¨‹çš„è°ƒç”¨æ ˆæƒ…å†µ 12345678910111213141516Thread 0 name: Dispatch queue: com.apple.main-threadThread 0 Crashed:0 libsystem_kernel.dylib 0x000000018af0e014 __pthread_kill + 81 libsystem_pthread.dylib 0x000000018afd5460 pthread_kill + 1122 libsystem_c.dylib 0x000000018ae823f4 abort + 1403 libc++abi.dylib 0x000000018a94d2d4 __cxa_bad_cast + 04 libc++abi.dylib 0x000000018a96acc0 default_unexpected_handler+ 126144 () + 05 libobjc.A.dylib 0x000000018a978844 _objc_terminate+ 34884 () + 1246 libc++abi.dylib 0x000000018a96766c std::__terminate(void (*)+ 112236 ()) + 167 libc++abi.dylib 0x000000018a967234 __cxa_rethrow + 1448 libobjc.A.dylib 0x000000018a97871c objc_exception_rethrow + 449 CoreFoundation 0x000000018be1a0bc CFRunLoopRunSpecific + 56010 UIKit 0x0000000191df37cc -[UIApplication _run] + 60811 UIKit 0x0000000191dee550 UIApplicationMain + 20812 JACrash 0x000000010007de90 0x100078000 + 2420813 libdyld.dylib 0x000000018adfc5b8 start + 4 çº¿ç¨‹çŠ¶æ€åˆ—å‡ºå´©æºƒçº¿ç¨‹çš„çº¿ç¨‹çŠ¶æ€ã€‚è¿™æ˜¯ä¸€ä¸ªå¯„å­˜å™¨åˆ—è¡¨åŠå…¶æ‰§è¡Œåœæ­¢æ—¶çš„å€¼ã€‚åœ¨é˜…è¯»å´©æºƒæŠ¥å‘Šæ—¶ï¼Œæ— éœ€äº†è§£çº¿ç¨‹çŠ¶æ€ï¼Œä½†å¯ä»¥ä½¿ç”¨æ­¤ä¿¡æ¯æ›´å¥½åœ°äº†è§£å´©æºƒçš„æƒ…å†µã€‚ 12345678910Thread 0 crashed with ARM Thread State (64-bit): x0: 0x0000000000000000 x1: 0x0000000000000000 x2: 0x0000000000000000 x3: 0x00000001740e9737 x4: 0x000000018a96bbc3 x5: 0x000000016fd87520 x6: 0x000000000000006e x7: 0xffffffffffffffec x8: 0x0000000008000000 x9: 0x0000000004000000 x10: 0x000000000000000b x11: 0x0000000000000010 x12: 0x000000018ae99792 x13: 0x0000000000000000 x14: 0x0000030000000300 x15: 0x0000000000000000 x16: 0x0000000000000148 x17: 0x0000000000000000 x18: 0x0000000000000000 x19: 0x0000000000000006 x20: 0x00000001b0bf8c40 x21: 0x000000016fd87520 x22: 0x00000001b0bffbb8 x23: 0x0000000000000001 x24: 0x0000000170011110 x25: 0x0000000000000000 x26: 0x0000000000000001 x27: 0x0000000000000000 x28: 0x000000016fd87b80 fp: 0x000000016fd87480 lr: 0x000000018afd5460 sp: 0x000000016fd87460 pc: 0x000000018af0e014 cpsr: 0x00000000 äºŒè¿›åˆ¶é•œåƒè¿›ç¨‹äºŒè¿›åˆ¶æ–‡ä»¶åŠ è½½çš„åœ°å€åŒºé—´,åŠ¨æ€åº“åŠ è½½çš„åœ°å€åŒºé—´ 1234567Binary Images:0x100078000 - 0x10007ffff JACrash arm64 &lt;2fd461c16e7239489a037c6c1141c134&gt; /var/containers/Bundle/Application/A55333A1-CD62-41A2-AE96-F3411ECD3447/JACrash.app/JACrash0x10009c000 - 0x10009ffff MobileSubstrate.dylib arm64 &lt;3134cfb2f722310ea2c742ae4dc131ab&gt; /Library/MobileSubstrate/MobileSubstrate.dylib0x1000a8000 - 0x1000affff libswiftCoreFoundation.dylib arm64 &lt;47deeaa1967b3e339dfcb48535a994e1&gt; /var/containers/Bundle/Application/A55333A1-CD62-41A2-AE96-F3411ECD3447/JACrash.app/Frameworks/libswiftCoreFoundation.dylib0x1000bc000 - 0x1000cbfff libswiftCoreGraphics.dylib arm64 &lt;25fe91aa901b3cf6a443b498012ab5af&gt; /var/containers/Bundle/Application/A55333A1-CD62-41A2-AE96-F3411ECD3447/JACrash.app/Frameworks/libswiftCoreGraphics.dylib0x1000f0000 - 0x1000f7fff libswiftCoreImage.dylib arm64 .... å…³äºå¼‚å¸¸ç±»å‹(Exception Type)é‡æŒ‡é’ˆ(Bad Memory Access [EXC_BAD_ACCESS // SIGSEGV // SIGBUS])å°è¯•è®¿é—®äº†éæ³•çš„å†…å­˜åœ°å€,æˆ–è®¿é—®äº†å—ä¿æŠ¤çš„åœ°å€ 123456Exception Type: EXC_BAD_ACCESS (SIGSEGV)Exception Subtype: KERN_INVALID_ADDRESS at 0x000000064229beb8Termination Signal: Segmentation fault: 11Termination Reason: Namespace SIGNAL, Code 0xbTerminating Process: exc handler [0]Triggered by Thread: 0 æ¯”å¦‚åœ¨MRCç¯å¢ƒä¸‹å°è¯•å‘é€æ¶ˆæ¯ç»™å·²é‡Šæ”¾çš„å¯¹è±¡,è°ƒç”¨æ ˆçš„ç‰¹ç‚¹æ˜¯objc_msgSend/objc_releaseåœ¨è°ƒç”¨æ ˆé¡¶ å¼‚å¸¸é€€å‡º(Abnormal Exit [EXC_CRASH // SIGABRT])1234567891011121314151617@implementation ViewController- (void)viewDidLoad { [super viewDidLoad]; [self callCrashMethod];}- (void)callCrashMethod { [self arrayOutOfBounds];}- (void)arrayOutOfBounds { NSArray *arr = @[@\"0\",@\"1\"]; NSLog(@\"%@\",arr[2]);}@end 1234Exception Type: EXC_CRASH (SIGABRT)Exception Codes: 0x0000000000000000, 0x0000000000000000Exception Note: EXC_CORPSE_NOTIFYTriggered by Thread: 0 å´©æºƒä¼šç›´æ¥åˆ°main,å› ä¸ºè°ƒç”¨æ ˆä¸­åŒ…å«objc_exception_rethrowæ ˆå¸§,æ ¹æ®å‚è€ƒ1,è¿›è¡Œå¦‚ä¸‹çš„é…ç½®,è®¾ç½®å¼‚å¸¸çš„æ–­ç‚¹ The Exception BreakpointSo how do you find the line in the code that made the app crash? Well, whenever you get a stacktrace like this, an exception was thrown by the app. (You can tell because one of the functions in the call stack is named objc_exception_rethrow.) è¿½è¸ªé™·é˜±(Trace Trap [EXC_BREAKPOINT // SIGTRAP])è¿™ä¸ªå¼‚å¸¸æ˜¯ä¸ºè°ƒè¯•å™¨æä¾›åœ¨è¿›ç¨‹æ‰§è¡Œçš„ç‰¹å®šç‚¹ä¸­æ–­è¿›ç¨‹çš„æœºä¼šã€‚ 123456Exception Type: EXC_BREAKPOINT (SIGTRAP)Exception Codes: 0x0000000000000001, 0x000000010006e588Termination Signal: Trace/BPT trap: 5Termination Reason: Namespace SIGNAL, Code 0x5Terminating Process: exc handler [0]Triggered by Thread: 0 éæ³•æŒ‡ä»¤(Illegal Instruction)è¿›ç¨‹è¯•å›¾æ‰§è¡Œéæ³•æˆ–æœªå®šä¹‰æŒ‡ä»¤ã€‚è¿™ä¸ªè¿›ç¨‹å¯èƒ½è¯•å›¾é€šè¿‡ä¸€ä¸ªé…ç½®é”™è¯¯çš„å‡½æ•°æŒ‡é’ˆï¼Œè·³åˆ°ä¸€ä¸ªæ— æ•ˆçš„åœ°å€ã€‚ 1234567Exception Type: EXC_CRASH (SIGILL)Exception Codes: 0x0000000000000000, 0x0000000000000000Exception Note: EXC_CORPSE_NOTIFYTermination Signal: Illegal instruction: 4Termination Reason: Namespace SIGNAL, Code 0x4Terminating Process: neteasemusic [6562]Triggered by Thread: 0 è¢«æ€æ­»(Killed[SIGKILL])12345Exception Type: EXC_CRASH (SIGKILL)Exception Codes: 0x0000000000000000, 0x0000000000000000Exception Note: EXC_CORPSE_NOTIFYTermination Reason: Namespace SPRINGBOARD, Code 0x8badf00dTriggered by Thread: 0 èµ„æºé™åˆ¶(Resource Limit [EXC_RESOURCE])è¿™ä¸ªè¿›ç¨‹è¶…å‡ºäº†èµ„æºæ¶ˆè€—çš„é™åˆ¶ã€‚ ç¬¦å·åŒ– æ¥è‡ªå‚è€ƒ3 æ–¹å¼ä¸€:dSYMæ–‡ä»¶DWARF å³Debugging with Attributed Record Formats,Xcodeä½¿ç”¨å®ƒæ¥ç”Ÿæˆç¬¦å·è¡¨,ç”Ÿæˆçš„ç¬¦å·è¡¨æ”¾åœ¨.dSYMæ–‡ä»¶ä¸­,åœ¨Debugæ¨¡å¼ä¸‹,é»˜è®¤ä¸ä¼šç”Ÿæˆ.dSYMæ–‡ä»¶,å¯ä»¥åœ¨Build Settingsä¸­è¿›è¡Œè®¾ç½® ç¼–è¯‘å,åœ¨å·¥ç¨‹ä¸­Productç›®å½•ä¸‹,é€‰æ‹©åº”ç”¨ç¨‹åº,Show in Finder,ä¼šå‘ç°ç”Ÿæˆäº†åº”ç”¨çš„.dSYMæ–‡ä»¶ è·å–UUID12Binary Images:0x1000f8000 - 0x1000fffff JACrash arm64 &lt;2fd461c16e7239489a037c6c1141c134&gt; /var/containers/Bundle/Application/7B72F18F-930E-42CB-B69C-FED75161A03F/JACrash.app/JACrash UUID:2fd461c16e7239489a037c6c1141c134 123% dwarfdump --uuid path/to/Your.app.dSYM/Contents/Resources/DWARF/JACrash...UUID: 2FD461C1-6E72-3948-9A03-7C6C1141C134 (arm64) /Users/Jason/Library/Developer/Xcode/DerivedData/JACrash-bntjxfwsvrraeuevozrbvraorxqv/Build/Products/Debug-iphoneos/JACrash.app.dSYM/Contents/Resources/DWARF/JACrash ä¸¤è€…UDIDä¸€è‡´å³å¯ å®šä½å´©æºƒåœ°å€123% atos -o path/to/Your.app.dSYM/Contents/Resources/DWARF/Your -arch arm64 -l 0x1000f8000 0x1000fdda8-[ViewController arrayOutOfBounds] (in JACrash) (ViewController.m:33) 0x1000f8000: è¿è¡Œæ—¶åº”ç”¨åŸºåœ°å€0x1000fdda8: è¿è¡Œæ—¶å´©æºƒåœ°å€(å¾…ç¬¦å·åŒ–çš„åœ°å€) æ”¯æŒbitcode æ”¯æŒbitcodeçš„æƒ…å†µä¸‹,å› ä¸ºæœ€ç»ˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ç”±Apple Storeåå°ç”Ÿæˆ,æœ¬åœ°æ˜¯æ²¡æœ‰å¯¹åº”çš„.dSYMæ–‡ä»¶,å¯ä»¥ä»Xcodeæˆ–iTunes Connectä¸Šä¸‹è½½ æ–¹å¼äºŒ:å´©æºƒæ—¥å¿— + Hopperå¦‚æœæ²¡æœ‰.dSYMæ–‡ä»¶,ä½†æœ‰å´©æºƒæ—¥å¿—çš„æƒ…å†µæ—¶ å´©æºƒåœ°å€ = åŸºåœ°å€ + ASLR + æ–¹æ³•åç§»åœ°å€ æ–¹æ³•ç›¸å¯¹åŸºåœ°å€çš„åç§»åœ°å€æ˜¯ä¸å˜çš„,å› æ­¤åªè¦æŠŠASLRä»å´©æºƒåœ°å€ä¸­ç§»é™¤,å†åŠ ä¸Šæ–¹æ³•çš„åç§»åœ°å€å³å¯ ç”¨hopperæ‰¾å‡ºåŸºåœ°å€,å†åŠ ä¸Šæ–¹æ³•åç§»åœ°å€ å¼‚å¸¸æ•è·ç›‘å¬12345/// å‡½æ•°æŒ‡é’ˆ,ç”¨äºè‡ªå®šä¹‰æ•è·å¼‚å¸¸åè¦è¿›è¡Œçš„æ“ä½œtypedef void NSUncaughtExceptionHandler(NSException *exception);FOUNDATION_EXPORT NSUncaughtExceptionHandler * _Nullable NSGetUncaughtExceptionHandler(void);FOUNDATION_EXPORT void NSSetUncaughtExceptionHandler(NSUncaughtExceptionHandler * _Nullable); åœ¨ç¨‹åºå¯åŠ¨æ—¶åŠ ä¸Šä¸€ä¸ªå¼‚å¸¸æ•è·ç›‘å¬ï¼Œç”¨æ¥å¤„ç†ç¨‹åºå´©æºƒæ—¶çš„å›è°ƒåŠ¨ä½œ 123456789101112void exceptionHandler(NSException *exception) { NSLog(@\"%@\", [exception reason]); NSLog(@\"%@\", [exception userInfo]); NSLog(@\"%@\", [exception callStackSymbols]);}int main(int argc, char * argv[]) { NSSetUncaughtExceptionHandler(&amp;exceptionHandler); @autoreleasepool { return UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class])); }} å‚è€ƒ My App Crashed, Now What? â€“ Part 1 æ‰‹åŠ¨è§£æCrashLogä¹‹â€”-æ–¹æ³•ç¯‡ Understanding and Analyzing Application Crash Reports Address space layout randomization NSSetUncaughtExceptionHandler not catch all errors on iPhone","link":"/2019/02/09/iOSer-Analysis-iOS-Crash/"},{"title":"æµ…æiOSå¯åŠ¨å›¾åŠ¨ç”»","text":"æ¦‚è¦ å¯åŠ¨å›¾çš„ä»·å€¼ ?å¦‚ä½•è®¾ç½®å¯åŠ¨å›¾ ?å¸¸è§çš„å¯åŠ¨å›¾å½¢å¼ ? å¯åŠ¨å›¾çš„ä»·å€¼ A launch screen appears instantly when your app starts up. The launch screen is quickly replaced with the first screen of your app, giving the impression that your app is fast and responsive. The launch screen isnâ€™t an opportunity for artistic expression. Itâ€™s solely intended to enhance the perception of your app as quick to launch and immediately ready for use. Every app must supply a launch screen. å¯åŠ¨å±ä¸»è¦æ˜¯ä¸ºäº†ä¼˜åŒ–ç”¨æˆ·ä½“éªŒçš„ åœ¨å¯åŠ¨å±ä¸Šæ˜¾ç¤ºæ–‡å­—æˆ–å¹¿å‘Šçš„è¡Œä¸ºåœ¨Appleçš„è®¾è®¡è§„èŒƒä¸Šå¹¶ä¸æå€¡ å¦‚ä½•è®¾ç½®å¯åŠ¨å›¾ iOS8ä»¥ä¸‹ é’ˆå¯¹ä¸åŒå°ºå¯¸çš„è®¾å¤‡é€šè¿‡é™æ€å›¾ç‰‡è¿›è¡Œè®¾ç½® ä¹Ÿå¯ä»¥å°†å›¾ç‰‡å‘½åæˆç³»ç»ŸæŒ‡å®šçš„åç§°,ç¨‹åºè¿è¡Œæ—¶ä¼šé»˜è®¤ä½¿ç”¨è¯¥æ–‡ä»¶å¯å‚è€ƒdemoä¸­çš„LaunchAnimate æ³¨æ„:è¿™ä¸¤ç§æ–¹å¼éƒ½è¦æŠŠå·¥ç¨‹ä¸­çš„Launch Screen Fileå†…å®¹ç½®ç©º,é»˜è®¤è¯¥é…ç½®çš„ä¼˜å…ˆçº§æœ€é«˜ iOS8ä»¥ä¸Š(åŒ…æ‹¬iOS8) å¯ä»¥ä½¿ç”¨LaunchScreen.storyboardè¿›è¡Œè®¾ç½® å¯åŠ¨å›¾ç‰‡å°†åœ¨è¿è¡Œæ—¶ç”Ÿæˆ? WWDC 2014 Platform State of the Union é€šè¿‡Xcodeå¯¼å‡ºæ²™ç›’æ–‡ä»¶,æ˜¾ç¤ºåŒ…å†…å®¹AppData/Library/Cache/Snapshots/åŒ…å/xxx@3x.ktxæˆ–xxx@2x.png ä¸€èˆ¬åªæœ‰å‡ ç™¾å­—èŠ‚åˆ°2,3KB,è™½ç„¶ç§°ä¹‹ä¸ºå¿«ç…§,ä½†æ˜¯çœ‹ä¸Šå»å’ŒåŸå›¾å·®åˆ«è¿˜æ˜¯æŒºå¤§çš„,é…·ç‹—çš„å¯åŠ¨å›¾,åªç”Ÿæˆä¸€å¼ çº¯ç™½çš„å›¾,è€Œçº¯è‰²çš„å¯åŠ¨å›¾çœ‹ä¸Šå»ç¡®å®è¿›è¡Œäº†æˆªå±,ç®—æ˜¯è¯æ˜ä¼šåœ¨è¿è¡Œæ—¶ç”Ÿæˆå¯åŠ¨å›¾å§? å¸¸è§çš„å¯åŠ¨å›¾å½¢å¼ é™æ€å›¾ç‰‡,æ¯”å¦‚å¾®ä¿¡ å¯åŠ¨å›¾ä¸Šæœ‰åŠ¨æ€æ–‡å­—æˆ–åŠ¨ç”»,æ¯”å¦‚é…·ç‹—éŸ³ä¹,æ‰‹æœºäº¬ä¸œ å¯åŠ¨å›¾å†…å®¹å¯å˜åŒ–(äº§å“å®£ä¼ /èŠ‚æ—¥ç¥ç¦/å¹¿å‘Šç­‰),æ¯”å¦‚æ–°æµªå¾®åš,å–œé©¬æ‹‰é›… å¾®ä¿¡ é…·ç‹—å¯åŠ¨å›¾ å¾®åš å¯åŠ¨å›¾åŠ¨ç”»è®¾ç½®é™åˆ¶:ç”±ä¸Šå¯çŸ¥,LaunchScreen.storyboardæ–¹å¼ä¸‹,è¿è¡Œæ—¶ä¼šç”Ÿæˆæˆªå›¾,ä»¥åå¯åŠ¨å°±ä¼šç›´æ¥ä½¿ç”¨è¯¥æˆªå›¾,å› æ­¤åº”ç”¨å¯åŠ¨åçš„åˆè¯†æ ·å¼åœ¨è®¾ç½®åæ˜¯ä¸èƒ½æ”¹å˜çš„,ç„¶ååœ¨LaunchScreen.Storyboardä¸èƒ½æ˜¯è‡ªå®šä¹‰çš„æ§åˆ¶å™¨,ä¹Ÿä¸èƒ½æ”¾ç½®è‡ªå®šä¹‰çš„è§†å›¾ã€‚ æ–¹æ¡ˆ:æ ¹æ®é™åˆ¶,ä¸è¦ç¢ç£¨å¾€çœŸæ­£çš„å¯åŠ¨å›¾ä¸Šå»æ·»åŠ åŠ¨æ€æ–‡å­—æˆ–æ˜¯åŠ¨ç”»,è€Œé‡‡ç”¨å½“å¯åŠ¨å›¾ç»“æŸåå†è¿›è¡Œæ“ä½œ,ä»iOS8å¼€å§‹é€šè¿‡LaunchScreen.storyboardå¯ä»¥è·å¾—ä¸€ä¸ªUIViewController,è™½ç„¶ä¸èƒ½ç»‘å®šè‡ªå®šä¹‰ç±»,ä½†æ˜¯æ—¢ç„¶æ˜¯æ§åˆ¶å™¨,è‡ªç„¶æœ‰å®ƒçš„view,å¯ä»¥é€‰æ‹©è·å–å¯åŠ¨å›¾çš„view,ç„¶åæ·»åŠ åˆ°åˆé€‚çš„çˆ¶è§†å›¾ä¸­(å·®ä¸å¤šå°±æ˜¯UIWindow,å…¶ä»–çš„è§†å›¾å¦‚æœæœ‰å¯¼èˆªæ æ•ˆæœä¼šä¸å¥½),æœ€åæ‰§è¡Œå…¶ä»–æ“ä½œ,å¯å®ç°æ·»åŠ åŠ¨æ€æ–‡å­—ä¸åŠ¨ç”»çš„æ•ˆæœ,iOS8ä»¥ä¸‹ä¹Ÿç±»ä¼¼,åªè¦ç¡®ä¿å¯åŠ¨å›¾æ¶ˆå¤±åæ–°å‡ºç°çš„è§†å›¾å’ŒåŸæ¥ä¸€è‡´å³å¯ å¦‚ä½•å®ç°å¯åŠ¨å›¾æœ‰å¹¿å‘Š/èŠ‚æ—¥å›¾çš„æ•ˆæœå‘¢? åŸç†ä¹Ÿå·®ä¸å¤š,å¯åŠ¨å›¾ä¸ŠåŠéƒ¨åˆ†æ·¡è‰²ä¸€äº›,å¯ä»¥æ˜¯çº¯ç™½,åº•éƒ¨æœ‰å…¬å¸åç§°,logoç­‰ä¿¡æ¯,å…¨ç™½è‚¯å®šä¸å¥½çœ‹,ç­‰å¯åŠ¨å›¾æ¶ˆå¤±å,è¯·æ±‚å¹¿å‘Š,å¦‚æœæœ‰,å°±æŠŠå¹¿å‘ŠåŠ åˆ°è§†å›¾çš„ä¸ŠåŠéƒ¨åˆ†,æœ¬åœ°æœ‰ä¸€å¼ å ä½å›¾,æ²¡å¹¿å‘Šæˆ–ç¥ç¦å°±æ˜¾ç¤ºé‚£ä¸€å¼ ,å¹¿å‘Šå¯ä»¥åšä¸ªé¢„åŠ è½½,æ•ˆæœä¼šå¥½ä¸€äº›,è‡³äºåº•éƒ¨åŒæ ·æ˜¯å…¬å¸åç§°,logoç­‰ä¿¡æ¯ å¯åŠ¨å›¾åŠ¨æ€æ–‡å­—ä¸åŠ¨ç”»123456789101112131415161718192021// - åˆ«å¿˜äº†åœ¨LaunchScreen.storyboardæ–‡ä»¶ä¸­è¦æ·»åŠ æ ‡è®°UIViewController *viewController = [[UIStoryboard storyboardWithName:@\"LaunchScreen\" bundle:nil] instantiateViewControllerWithIdentifier:@\"LaunchScreen\"];// - è·å–viewUIView *launchView = viewController.view;[self compatibleWithLaunchView:launchView]; UIWindow *mainWindow = [UIApplication sharedApplication].keyWindow;launchView.frame = [UIApplication sharedApplication].keyWindow.frame;[launchView addSubview:self.dynamicLabel];[mainWindow addSubview:launchView];// - åŠ¨ç”»[UIView animateWithDuration:1.0f delay:0.5f options:UIViewAnimationOptionCurveLinear animations:^{ launchView.alpha = 0.0f; launchView.layer.transform = CATransform3DScale(CATransform3DIdentity, 2.0f, 2.0f, 1.0f);} completion:^(BOOL finished) { [launchView removeFromSuperview];}]; å¯åŠ¨å›¾æ·»åŠ å¹¿å‘Š/èŠ‚æ—¥ç¥ç¦123456789101112131415161718192021222324252627282930- (void)viewDidLoad { [super viewDidLoad]; [self.view addSubview:self.splashView]; // å¿½ç•¥æœ‰å¹¿å‘Šæ—¶çŠ¶æ€æ éœ€è¦éšè—å†å‡ºç° BOOL hasAd = arc4random() % 3 == 1 ? true : false; if (hasAd) { // - å¯ä»¥æŠŠä¸‹ä¸€å¼ å¹¿å‘Šå›¾ä¹Ÿè¯·æ±‚ä¸‹æ¥,å®ç°é¢„åŠ è½½,çœ‹ä¸Šå»æ•ˆæœä¼šæ¯”è¾ƒå¥½ [self.adImgView sd_setImageWithURL:[NSURL URLWithString:@\"https://ooo.0o0.ooo/2017/01/20/58821a46b366e.png\"]]; [self.splashView addSubview:self.adImgView]; [self.splashView addSubview:self.splashImgView]; dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2.5 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{ [self.splashView removeFromSuperview]; }); }else { [self.splashView addSubview:self.avatorImgView]; [UIView animateWithDuration:1.5 animations:^{ self.avatorImgView.transform = CGAffineTransformMakeTranslation(0, -60); } completion:^(BOOL finished) { [self.splashView removeFromSuperview]; }]; } // - æ˜¾ç¤ºæ§åˆ¶å™¨é¡µé¢é€»è¾‘...} æ•ˆæœå›¾ æ›´æ–° 170419æ³¨æ„ç‚¹æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°, LaunchScreen.storyboard æ—¶,é¡¶éƒ¨çº¦æŸè¦ç¦» Top Layout Guide 20 ä¸ªç‚¹,ä¸ç„¶æ˜¾ç¤ºæ—¶èƒ½æœ‰å˜å½¢æ„Ÿè§‰ã€‚ ä»£ç demo å‚è€ƒ iOS Human Interface Guidelines - Launch Screen iOSå¼€å‘æ—¶å¦‚ä½•ä½¿ç”¨ Launch Screen Storyboard é€šè¿‡LaunchScreenè‡ªå®šä¹‰å¯åŠ¨åŠ¨ç”» LaunchScreenTest","link":"/2017/01/21/iOSer-An-Analysis-of-iOS-Animation/"},{"title":"æµ…æUIButtonçš„imageEdgeInsetsä¸titleEdgeInsets","text":"å¯¼è¯­ ç³»ç»Ÿçš„ UIButton é»˜è®¤çŠ¶æ€ä¸‹çš„æ ·å¼æ˜¯å›¾æ ‡åœ¨å·¦æ ‡é¢˜åœ¨å³ï¼Œä½†æœ‰æ—¶å€™å¯èƒ½éœ€è¦ä¸åŒçš„æ’ç‰ˆã€‚å½“ç„¶å¯ä»¥é€šè¿‡ç»§æ‰¿æ·»åŠ å­è§†å›¾æ¥å®ç°éœ€æ±‚ï¼Œä½†æœ¬æ–‡æ‰“ç®—é€šè¿‡ç†è§£ UIButton è‡ªå¸¦çš„ imageEdgeInsets å’Œ titleEdgeInsets å±æ€§å®ç°è¯¥åŠŸèƒ½ã€‚ ä¸»è¦å†…å®¹åŒ…å«ä»¥ä¸‹ä¸¤ç‚¹: æµ…æ imageEdgeInsets å’Œ titleEdgeInsets çš„å±æ€§çš„åŸç† [ä¸ªäººè§‚ç‚¹] ç®€å•å®ç°å›¾æ ‡åœ¨å³æ ‡é¢˜åœ¨å·¦,å›¾æ ‡åœ¨ä¸Šæ ‡é¢˜åœ¨ä¸‹ã€‚ ç¯å¢ƒ macOS Sierra 10.12.4Xcode 8.3.2iPhone 6S (10.1.1) æµç¨‹ å…ˆä»è‹¹æœå®˜æ–¹å¯¹è¯¥æ–¹æ³•çš„æ³¨é‡Šå…¥æ‰‹ The inset or outset margins for the rectangle around the buttonâ€™s title text. ä½¿ç”¨æ­¤å±æ€§å¯è°ƒæ•´æŒ‰é’®æ ‡é¢˜çš„æœ‰æ•ˆç»˜å›¾çŸ©å½¢çš„å¤§å°å¹¶é‡æ–°å®šä½ã€‚(æ¥è‡ª google ç¿»è¯‘) Use this property to resize and reposition the effective drawing rectangle for the button title. You can specify a different value for each of the four insets (top, left, bottom, right). A positive value shrinks, or insets, that edgeâ€”moving it closer to the center of the button. A negative value expands, or outsets, that edge. Use the UIEdgeInsetsMake function to construct a value for this property. The default value is UIEdgeInsetsZero. å…³äº UIEdgeInsetsMake çš„ top, left, bottom, right ï¼Œæ­£æ•°è¡¨æ˜æ›´é è¿‘æŒ‰é’®çš„ä¸­å¿ƒï¼Œè´Ÿæ•°è¡¨ç¤ºæ›´é è¿‘æŒ‰é’®çš„è¾¹ç¼˜ï¼Œé»˜è®¤ä¸º UIEdgeInsetsZero ã€‚ é—®é¢˜ 1 margins æ˜¯è¾¹è·çš„å«ä¹‰ï¼Œé‚£åŸå§‹çš„ä½ç½®åœ¨å“ª? æµ‹è¯•ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738#import &lt;UIKit/UIKit.h&gt;@interface JAButton : UIButton@end#import \"JAButton.h\"@implementation JAButton- (instancetype)initWithFrame:(CGRect)frame { if (self = [super initWithFrame:frame]) { self.layer.borderColor = [UIColor blueColor].CGColor; self.layer.borderWidth = 1; [self setTitleColor:[UIColor redColor] forState:UIControlStateNormal]; // [1] [self setTitle:@\"æµ‹è¯•\" forState:UIControlStateNormal]; // [2] [self setImage:[UIImage imageNamed:@\"arrow\"] forState:UIControlStateNormal]; } return self;}- (void)layoutSubviews { [super layoutSubviews]; // [3] self.titleEdgeInsets = UIEdgeInsetsMake(0, 0, 0, 10); // [4] self.imageEdgeInsets = UIEdgeInsetsMake(0, 0, 0, 10);}@end...JAButton *b = [[JAButton alloc] initWithFrame:CGRectMake(10, 100, 100, 40)];[self.view addSubview:b]; æµ‹è¯• 1 åªæœ‰æ ‡é¢˜ [æ³¨é‡Š 2 3 4] æ ‡é¢˜çš„ä½ç½®å¦‚ä¸‹ æ ‡é¢˜å±…ä¸­ æµ‹è¯• 2 åªæœ‰å›¾æ ‡ [æ³¨é‡Š 1 3 4] å›¾æ ‡ä½ç½®ä¿¡æ¯å¦‚ä¸‹ å›¾æ ‡å±…ä¸­ æµ‹è¯• 3 æ ‡é¢˜ + å›¾æ ‡ [æ³¨é‡Š 3 4] å›¾æ ‡ æ ‡é¢˜ ä¸ºäº†ç»´æŒå±…ä¸­å°±è¦å°†æ ‡é¢˜å’Œå›¾æ ‡çœ‹åšä¸€ä¸ªæ•´ä½“å³å®½åº¦å’Œä¸º 37 + 10 = 47 ï¼Œç”¨ UIButton çš„å®½åº¦æ¥å‡å»æ€»å®½åº¦å†ä¹˜ä»¥ 0.5 å³å¯å®ç°æ•´ä½“å±…ä¸­ï¼Œå› æ­¤å›¾æ ‡çš„ X å°±æ˜¯ (100 - 47) * 0.5 = 26.5 æµ‹è¯• 4 åªè°ƒæ•´ titleEdgeInsets [æ³¨é‡Š 2 4] æ ‡é¢˜çš„ä½ç½®ä¿¡æ¯å¦‚ä¸‹ æµ‹è¯• 5 åªè°ƒæ•´ imageEdgeInsets [æ³¨é‡Š 1 3] å›¾æ ‡çš„ä½ç½®ä¿¡æ¯å¦‚ä¸‹ é—®é¢˜ 2 æ¯”è¾ƒæµ‹è¯• 4 ä¸æµ‹è¯• 1 ä¼šå‘ç° titleEdgeInsets çš„ right è®¾ç½®äº† 10 , X å´å‘å·¦åç§»äº† 5 ? åŒæ ·å¯¹æ¯” æµ‹è¯• 5 ä¸æµ‹è¯• 2 ä¼šå‘ç° imageEdgeInsets çš„ right è®¾ç½®äº† 10 , X å´å‘å·¦åç§»äº† 5 ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ç§å‡åŠçš„ç°è±¡å‘¢? å¯»æ‰¾ &amp; åˆ†æ åœ¨æœç´¢åï¼Œè¿™ç¯‡ åšå®¢å¯¹æˆ‘æœ‰æ‰€å¯å‘ å›ç­” 1 å®ƒä»¬åªæ˜¯imageå’Œbuttonç›¸è¾ƒäºåŸæ¥ä½ç½®çš„åç§»é‡ï¼Œé‚£ä»€ä¹ˆæ˜¯åŸæ¥çš„ä½ç½®å‘¢ï¼Ÿå°±æ˜¯è¿™ä¸ª æ²¡æœ‰è®¾ç½®edgeInsetæ—¶å€™çš„ä½ç½®äº†ã€‚å¦‚è¦è¦imageåœ¨å³è¾¹ï¼Œlabelåœ¨å·¦è¾¹ï¼Œé‚£imageçš„å·¦è¾¹ç›¸å¯¹äºbuttonçš„å·¦è¾¹å³ç§»äº†labelWidthçš„è·ç¦»ï¼Œimageçš„å³è¾¹ç›¸å¯¹äºlabelçš„å·¦è¾¹å³ç§»äº†labelWidthçš„è·ç¦»æ‰€ä»¥ï¼Œself.oneButton.imageEdgeInsets = UIEdgeInsetsMake(0, labelWidth, 0, -labelWidth); ä¸ºä»€ä¹ˆæ˜¯è´Ÿå€¼å‘¢ï¼Ÿå› ä¸ºè¿™æ˜¯contentInsetï¼Œæ˜¯åç§»é‡ï¼Œä¸æ˜¯è·ç¦»åŒæ ·çš„ï¼Œlabel çš„å³è¾¹ç›¸å¯¹äº button çš„å³è¾¹å·¦ç§»äº† imageWith çš„è·ç¦»ï¼Œlabel çš„å·¦è¾¹ç›¸å¯¹äº image çš„å³è¾¹å·¦ç§»äº† imageWith çš„è·ç¦»æ‰€ä»¥ self.oneButton.titleEdgeInsets = UIEdgeInsetsMake(0, -imageWith, 0, imageWith); è¿™æ ·å°±å®Œæˆimageåœ¨å³è¾¹ï¼Œlabelåœ¨å·¦è¾¹çš„æ•ˆæœäº†ã€‚ ä½†æ˜¯å¯¹ä¸‹é¢çš„å‰ç½®çŸ¥è¯†ç‚¹ï¼Œæ„Ÿè§‰æœ‰äº›ç–‘æƒ‘ å‰ç½®çŸ¥è¯†ç‚¹ï¼štitleEdgeInsetsæ˜¯titleç›¸å¯¹äºå…¶ä¸Šä¸‹å·¦å³çš„insetï¼Œè·ŸtableViewçš„contentInsetæ˜¯ç±»ä¼¼çš„ï¼Œå¦‚æœåªæœ‰titleï¼Œé‚£å®ƒä¸Šä¸‹å·¦å³éƒ½æ˜¯ç›¸å¯¹äºbuttonçš„ï¼Œimageä¹Ÿæ˜¯ä¸€æ ·ï¼›å¦‚æœåŒæ—¶æœ‰imageå’Œlabelï¼Œé‚£è¿™æ—¶å€™imageçš„ä¸Šå·¦ä¸‹æ˜¯ç›¸å¯¹äºbuttonï¼Œå³è¾¹æ˜¯ç›¸å¯¹äºlabelçš„ï¼›titleçš„ä¸Šå³ä¸‹æ˜¯ç›¸å¯¹äºbuttonï¼Œå·¦è¾¹æ˜¯ç›¸å¯¹äºimageçš„ã€‚ æˆ‘è®¤ä¸ºè™½ç„¶ä¸¤è€…éƒ½åœ¨ UIButton ä¸­ï¼Œä½† Apple æ—¢ç„¶å°† imageEdgeInsets å’Œ titleEdgeInsets æ‹†æˆä¸¤ä¸ªå±æ€§ï¼Œä¸¤è€…çš„ä½ç½®åº”è¯¥ä¸äº’ç›¸ä¾èµ–æ‰å¯¹ï¼Œå³ä½¿ä¾èµ–ï¼Œä¹Ÿåº”è¯¥ä¾èµ– UIButton è¿™ä¸ªçˆ¶è§†å›¾æ¯”è¾ƒåˆé€‚ã€‚ æµ‹è¯• 6 åœ¨æ ‡é¢˜å’Œå›¾æ ‡åŒæ—¶å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œè°ƒæ•´ titleEdgeInsets [æ³¨é‡Š 4] æ ‡é¢˜ å›¾æ ‡ æµ‹è¯• 7 åœ¨æ ‡é¢˜å’Œå›¾æ ‡åŒæ—¶å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œè°ƒæ•´ imageEdgeInsets [æ³¨é‡Š 3] æ ‡é¢˜ å›¾æ ‡ æµ‹è¯• 8 åœ¨æ ‡é¢˜å’Œå›¾æ ‡åŒæ—¶å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œè°ƒæ•´ imageEdgeInsets å’Œ titleEdgeInsets [ä¸æ³¨é‡Š] æ ‡é¢˜ å›¾æ ‡ å°ç»“ å°†æµ‹è¯• 3 å’Œ æµ‹è¯• 6 æˆ– æµ‹è¯• 3 å’Œæµ‹è¯• 7 å¯¹æ¯”ä¼šå‘ç°å³ä½¿åœ¨æ ‡é¢˜å’Œå›¾æ ‡åŒæ—¶å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œå•ç‹¬è°ƒæ•´ imageEdgeInsets æˆ– titleEdgeInsets éƒ½åªä¼šå¯¹å¯¹åº”çš„è§†å›¾çš„ä½ç½®äº§ç”Ÿå½±å“ï¼Œè€Œä¸”å½±å“åŒæ ·æ˜¯ å‡åŠ çš„ã€‚è€Œé€šè¿‡å°†æµ‹è¯• 3 å’Œ æµ‹è¯• 8 æ¯”è¾ƒï¼Œ titleEdgeInsets å’Œ imageEdgeInsets åŒæ—¶ä½œç”¨çš„æƒ…å†µä¸‹ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚ ä½è¯ ä¸Šé¢çš„å‚è€ƒåšå®¢ä¸­æåˆ° Aligning text and image on UIButton with imageEdgeInsets and titleEdgeInsets æ˜¯ StackOverflow ä¸Šå…³äºè¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªè®¨è®ºã€‚é‡Œé¢æœ‰è¿™æ ·ä¸€æ®µè¯ï¼Œå¯¹æˆ‘æœ‰æ‰€å¯å‘ I believe that this documentation was written imagining that the button has no title, just an image. It makes a lot more sense thought of this way, and behaves how UIEdgeInsets usually do. Basically, the frame of the image (or the title, with titleEdgeInsets) is moved inwards for positive insets and outwards for negative insetsã€‚ å®˜æ–¹çš„æ³¨é‡Šä¹Ÿè®¸æ­£å¦‚ä¸Šé¢è¿™æ®µè¯æ‰€è¡¨è¾¾çš„ï¼Œåªæ˜¯åœ¨å‘Šè¯‰æˆ‘ä»¬ imageEdgeInsets/titleEdgeInsets å…¶å®åªæ˜¯æè¿°äº†çˆ¶è§†å›¾(UIButton)ä¸å®ƒä»¬å„è‡ªè§†å›¾çš„é—´è·ã€‚ å›ç­” 2 åœ¨ç†è§£äº† imageEdgeInsets/titleEdgeInsets çš„ç‹¬ç«‹æ€§åï¼Œæˆ‘å°è¯•ç”¨è‡ªå·±çš„è¯æ¥è¯´æ˜ä¸ºä»€ä¹ˆä¼šå­˜åœ¨â€å‡åŠâ€çš„æ•ˆæœã€‚ æ¯”å¦‚ä¸‹é¢çš„ä»£ç  1self.titleEdgeInsets = UIEdgeInsetsMake(0, 0, 0, 10); åœ¨æ°´å¹³æ–¹å‘ä¸Š titleLabel å·¦ä¾§åç§»é‡ä¸º 0ï¼ŒtitleLabel å³ä¾§åç§»é‡ä¸º 10 ï¼Œä½†æ˜¯åç§»é‡ â‰  X çš„å˜åŒ–é‡ã€‚ X å·¦ç§» 10 é‚£ä¹ˆå®é™…ä¸Šçš„åç§»å±æ€§å€¼åº”è¯¥ä¸º (0,-10,0,10) : å·¦åç§»é‡(ç›¸å¯¹äº button å·¦ä¾§)ï¼Œtitle ä»åŸå§‹å‘ç›®æ ‡æ˜¯å¾€è¾¹ç¼˜æ–¹å‘ï¼Œæ‰€ä»¥æ˜¯è´Ÿå€¼(å‚è€ƒæœ¬æ–‡æœ€åˆçš„æ–‡æ¡£ç†è§£)ï¼Œåç§»é‡ä¸º 10*ï¼Œå³åç§»é‡(ç›¸å¯¹ *button å³ä¾§)ï¼Œä»åŸå§‹åˆ°ç›®æ ‡æ˜¯å¾€ä¸­é—´æ–¹å‘ï¼Œæ‰€ä»¥æ˜¯æ­£å€¼ã€‚ å› æ­¤ä¸Šé¢çš„ä»£ç è¡¨æ˜ titleLabel ç›¸å¯¹ UIButton å·¦ä¾§ä¸æ”¹å˜ï¼Œå³ä¾§æ”¹å˜ 10 ï¼Œåº”è¯¥æ˜¯åšä¸åˆ°çš„ï¼Œå·¦ä¾§é—´è·å¢åŠ 1ï¼Œå³ä¾§é—´è·å¿…ç„¶ä¼šå‡å°‘1ã€‚ä¼šè¢«ç­‰ä»·è½¬æ¢ä¸º 1self.titleEdgeInsets = UIEdgeInsetsMake(0, -5, 0, 5); ä¸ªäººæ¨æµ‹ å¦‚ä½•è½¬æ¢? å‚è€ƒ iOS çš„åæ ‡ç³»ï¼Œæ°´å¹³å‘å³ä¸º X è½´æ­£æ–¹å‘ ï¼Œå‚ç›´å‘ä¸‹ä¸º Y æ­£æ–¹å‘,è¦æ ¹æ® titleEdgeInsets / imageEdgeInsets å»è®¡ç®— title å’Œ image çš„åæ ‡ï¼Œå¯ä»¥å¯¹ UIEdgeInsets ç»“æ„ä½“çš„å››ä¸ªæˆå‘˜( top , left , bottom , right ) è¿›è¡Œå¤„ç† (åœ¨è´Ÿæ–¹å‘ç•™æ­£åç§»é‡å³æ˜¯å¾€æ­£æ–¹å‘åç§»)ã€‚ å…¬å¼å¦‚ä¸‹ æ°´å¹³æ–¹å‘ä¸Š X çš„åç§»é‡: (left + (-1) * right) / 2 å‚ç›´æ–¹å‘ä¸Š Y çš„åç§»é‡: (top + (-1) * bottom) / 2 ç›´ç™½ç‚¹çš„è¯: è´Ÿé—´è·(left,top)æ›´é è¿‘ï¼Œæ­£é—´è·(left,top)æ›´è¿œç¦»ï¼ŒåŸå§‹çŠ¶æ€å°±æ˜¯ UIEdgeInsets å…¨ä¸º 0 å³ä½ ä¸å»æ“ä½œ titleEdgeInsets / imageEdgeInsets æ—¶ã€‚ ä¸ªäººæ¨æµ‹ å®è·µ å®è·µæ˜¯æ£€éªŒçœŸç†çš„å”¯ä¸€æ ‡å‡†ï¼›ä¸ç®¡é»‘çŒ«ç™½çŒ«ï¼Œèƒ½æŠ“è€é¼ çš„å°±æ˜¯å¥½ğŸ±â€¦ å›¾æ ‡åœ¨å³æ ‡é¢˜åœ¨å·¦ æ ¹æ®ä¸Šé¢çš„çŒœæƒ³ï¼Œè¦å®ç°å›¾æ ‡ä¸æ ‡é¢˜çš„ä½ç½®äº¤æ¢ï¼Œå¾ˆç®€å•: imageView å·¦ä¾§ç›¸å¯¹äº UIButton å‘ä¸­å¤®ç§»åŠ¨äº† titleLabel çš„å®½åº¦ï¼Œè®°ä¸º titleLabel.w*ï¼Œå³ä¾§ç›¸å¯¹äº *UIButton å‘è¾¹ç¼˜åŒæ ·ç§»åŠ¨äº† titleLabel.w å› æ­¤ 123456789101112- (void)layoutSubviews { [super layoutSubviews]; // [3]// self.titleEdgeInsets = UIEdgeInsetsMake(0, 0, 0, 10);// // // [4]// self.imageEdgeInsets = UIEdgeInsetsMake(0, 0, 0, 10); self.imageEdgeInsets = UIEdgeInsetsMake(0, self.titleLabel.frame.size.width, 0, -self.titleLabel.frame.size.width); self.titleEdgeInsets = UIEdgeInsetsMake(0, -self.imageView.frame.size.width, 0, self.imageView.frame.size.width);} æ ‡é¢˜ å›¾æ ‡ ä½†æ˜¯å¦‚æœç”¨ç›´æ¥å»è®¾ç½® UIButton çš„ 123456789UIButton *b = [[UIButton alloc] initWithFrame:CGRectMake(10, 100, 100, 40)];b.layer.borderColor = [UIColor blueColor].CGColor;b.layer.borderWidth = 1;[b setTitleColor:[UIColor redColor] forState:UIControlStateNormal];[b setTitle:@\"æµ‹è¯•\" forState:UIControlStateNormal];[b setImage:[UIImage imageNamed:@\"arrow\"] forState:UIControlStateNormal]; [self.view addSubview:b]; b.imageEdgeInsets = UIEdgeInsetsMake(0, b.titleLabel.frame.size.width, 0, -b.titleLabel.frame.size.width); b.titleEdgeInsets = UIEdgeInsetsMake(0, -b.imageView.frame.size.width, 0, b.imageView.frame.size.width); ä½ ä¼šå‘ç°æ•ˆæœå¹¶ä¸å¦‚æ„ï¼ŒåŸå› æ˜¯å› ä¸º titleLabel çš„å°ºå¯¸ä¸æ­£ç¡® æˆ‘æƒ³åˆ°çš„è§£å†³æ–¹æ³•æœ‰ä¸‰ç§ ç»§æ‰¿ UIButton ï¼Œåœ¨å­ç±»çš„ layoutSubviews ä¸­è¿›è¡Œå¤„ç† å‚è€ƒä¸Šé¢åšå®¢çš„ä½œè€…åœ¨ Demo_ButtonImageTitleEdgeInsets æä¾›çš„ï¼ŒsizeWithFont:æ¥å®ç°ï¼Œé€šè¿‡å­—ç¬¦ä¸²è®¡ç®—å‡º titlelabel çš„å°ºå¯¸ï¼Œæ¥è®¾ç½® titleEdgeInsets ï¼Œè¯¦æƒ…è§ä»£ç æ®µ 1 ç¬¬ä¸‰ç§é€šè¿‡ sizeToFit å’Œç¬¬äºŒç§æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œè¯¦æƒ…è§ä»£ç æ®µ 2 ä»£ç æ®µ 1 123456789@interface NSString(UIStringDrawing)// Single line, no wrapping. Truncation based on the NSLineBreakMode.- (CGSize)sizeWithFont:(UIFont *)font NS_DEPRECATED_IOS(2_0, 7_0, \"Use -sizeWithAttributes:\") __TVOS_PROHIBITED;...CGFloat labelWidth = [self.titleLabel.textsizeWithFont:self.titleLabel.font].width; ä»£ç æ®µ 2 12345678910111213UIButton *b = [[UIButton alloc] initWithFrame:CGRectMake(10, 100, 100, 40)];b.layer.borderColor = [UIColor blueColor].CGColor;b.layer.borderWidth = 1;[b setTitleColor:[UIColor redColor] forState:UIControlStateNormal];[b setTitle:@\"æµ‹è¯•\" forState:UIControlStateNormal];[b setImage:[UIImage imageNamed:@\"arrow\"] forState:UIControlStateNormal];[self.view addSubview:b];// çœ‹è¿™é‡Œ --- [b.titleLabel sizeToFit];b.imageEdgeInsets = UIEdgeInsetsMake(0, b.titleLabel.frame.size.width, 0, -b.titleLabel.frame.size.width);b.titleEdgeInsets = UIEdgeInsetsMake(0, -b.imageView.frame.size.width, 0, b.imageView.frame.size.width); è™½ç„¶ä½ç½®ä¸å¯¹ï¼Œä½†å°ºå¯¸å·²ç»æ˜¯æ­£ç¡®çš„äº†ï¼Œä¹Ÿèƒ½å®ç°åˆé€‚çš„æ•ˆæœã€‚ å›¾æ ‡åœ¨ä¸‹æ ‡é¢˜åœ¨ä¸Š æ ¹æ®ä¸Šé¢çš„åŸç†ï¼Œåº”è¯¥å¯ä»¥æ¯”è¾ƒç®€å•çš„æ¨ç®—å‡ºçš„ imageEdgeInsets å’Œ titleEdgeInsets è¦æ±‚: imageView å’Œ titleLabel éƒ½å±…ä¸­ï¼Œä¸” imageVeiw åœ¨ä¸Š ä¸¤è€…éƒ½å­˜åœ¨çš„æƒ…å†µä¸‹ï¼ŒåŸå§‹çš„å·¦å³é—´è·æ˜¯( UIButton çš„å®½åº¦ - ä¸¤è€…çš„å®½åº¦ä¹‹å’Œ) * 0.5ï¼Œ imageView çš„ X è¦å‘å³ç§»åŠ¨ ((UIButton çš„å®½åº¦ - imageView çš„å®½åº¦) - (UIButton çš„å®½åº¦ - ä¸¤è€…çš„å®½åº¦ä¹‹å’Œ)) * 0.5 titleLable çš„å®½åº¦ * 0.5 é˜¶æ®µ 1 12self.imageEdgeInsets = UIEdgeInsetsMake(0, self.titleLabel.frame.size.width * 0.5, 0, -self.titleLabel.frame.size.width * 0.5);self.titleEdgeInsets = UIEdgeInsetsMake(0, -self.imageView.frame.size.width * 0.5, 0, self.imageView.frame.size.width * 0.5); ä¸¤è€…éƒ½å±…ä¸­äº†ï¼Œç„¶åè°ƒæ•´å‚ç›´æ–¹å‘ é˜¶æ®µ 2 12self.imageEdgeInsets = UIEdgeInsetsMake(-5, self.titleLabel.frame.size.width * 0.5, 5, -self.titleLabel.frame.size.width * 0.5);self.titleEdgeInsets = UIEdgeInsetsMake(5, -self.imageView.frame.size.width * 0.5, -5, self.imageView.frame.size.width * 0.5); æ•ˆæœæœ‰ç‚¹ä¸‘â€¦ è¯´æ˜: è¿™é‡Œå¿½ç•¥äº† UIButton æ”¾ä¸ä¸‹ titleLabel æˆ–è€…ç”¨ xib åˆ›å»ºæœ‰ intrinsicSize å¼•ç”¨çš„é—®é¢˜ã€‚ å‡æƒ³çš„å®ç° 123456789CGFloat imageX = (CGRectGetWidth(self.imageView.frame)+ CGRectGetWidth(self.titleLabel.frame)) * 0.5 + (self.imageEdgeInsets.left - self.imageEdgeInsets.right) / 2;CGFloat imageY = (CGRectGetHeight(self.frame) - self.imageView.image.size.height) * 0.5 + (self.imageEdgeInsets.top - self.imageEdgeInsets.bottom) / 2;CGFloat imageW = self.imageView.image.size.width;CGFloat imageH = self.imageView.image.size.height; CGFloat titleX = (CGRectGetWidth(self.titleLabel.frame) + CGRectGetWidth(self.titleLabel.frame) * 0.5) + (self.titleEdgeInsets.left - self.titleEdgeInsets.right) / 2;CGFloat titleY = (CGRectGetWidth(self.frame) - CGRectGetHeight(self.titleLabel.frame)) * 0.5 + (self.titleEdgeInsets.top - self.titleEdgeInsets.bottom) / 2;CGFloat titleW = CGRectGetWidth(self.titleLabel.frame);CGFloat titleH = CGRectGetHeight(self.titleLabel.frame); æ€»ç»“ æœ¬æ–‡é€šè¿‡æ§åˆ¶å˜é‡æ³•ğŸ˜· æµ‹è¯•äº† UIButton çš„ imageEdgeInsets å’Œ titleEdgeInsets å±æ€§çš„ä½œç”¨æ•ˆæœï¼Œå‘ç°ä¸¤è€…æ˜¯ç›¸äº’ç‹¬ç«‹ä¸”åªå‚è€ƒçˆ¶è§†å›¾ ( UIButton ) ï¼ŒåŒæ—¶å¯¹å®ç°å›¾æ ‡åœ¨å³æ ‡é¢˜åœ¨ä¸Šï¼Œå›¾æ ‡åœ¨ä¸Šæ ‡é¢˜åœ¨ä¸‹è¿™ä¸¤ç§æ ·å¼æä¾›äº†ä¸€ç‚¹æ€è·¯ã€‚ å‚è€ƒ UIButtonçš„titleEdgeInsetså±æ€§å’ŒimageEdgeInsetså±æ€§å®ç°å›¾ç‰‡æ–‡å­—æŒ‰è¦æ±‚æ’åˆ— Aligning text and image on UIButton with imageEdgeInsets and titleEdgeInsets","link":"/2017/05/20/iOSer-Analysis-of-UIButton-s-imageEdgeInsets-with-titleEdgeInsets/"},{"title":"è¶Šç‹± iPhone è®¾å¤‡å¯¼å‡º ipa && é‡ç­¾å","text":"å‰è¨€ ä»¥å‰æƒ³è·å–åº”ç”¨çš„ .ipa æ–‡ä»¶å¯ä»¥ä» iTunes ä¸‹è½½ï¼ŒmacOS ä¸Šçš„ iTunes å‡çº§æˆ 12.7 å,æ— æ³•å†è·å¾— .ipa æ–‡ä»¶, è€ŒiOS 9 åå°±ä¸èƒ½ä» iTools ä¹‹ç±»çš„è¾…åŠ©å·¥å…·ä¸­å¯¼å‡º .ipa æ–‡ä»¶ã€‚ åé¢ Apple å®˜ç½‘åˆæä¾›äº†ä¸€ä¸ª 12.6.3 çš„é“¾æ¥ å‡ºäºå¥½å¥‡å¿ƒ,æƒ³è¯•è¯•ç›´æ¥å¯¼å‡º.ipaæ–‡ä»¶,å¹¶é‡ç­¾åå®‰è£…åˆ°æœªè¶Šç‹±çš„è®¾å¤‡ä¸Šã€‚ ç¯å¢ƒ macOS Sierra 10.12.6iPhone 6 Plus (11.0)Xcode Version 9.0 (9A235)iPhone 5s(9.3.3 å·²è¶Šç‹±) è¶Šç‹±è®¾å¤‡ä¸­å¯¼å‡º .ipaSSH åˆ°è¶Šç‹±è®¾å¤‡,ä½¿ç”¨Cycript æ‰¾åˆ°xxx.app çš„ä½ç½® 123iPhone:~ root# ps -ef | grep WeChat 501 714 1 0 0:00.00 ?? 0:29.04 /var/containers/Bundle/Application/41A6836F-CFC9-4DC1-8A9C-ED4DE09F9A66/WeChat.app/WeChat 0 807 805 0 0:00.00 ttys001 0:00.01 grep WeChat æ‰¾åˆ°åä½¿ç”¨ tar å°† xxx.app æ‰“åŒ… 123456789101112iPhone:~ root# cd /var/containers/Bundle/Application/41A6836F-CFC9-4DC1-8A9C-ED4DE09F9A66/iPhone:/var/containers/Bundle/Application/41A6836F-CFC9-4DC1-8A9C-ED4DE09F9A66 root# lsWeChat.app iTunesArtwork iTunesMetadata.plistiPhone:/var/containers/Bundle/Application/41A6836F-CFC9-4DC1-8A9C-ED4DE09F9A66 root# tar -cvf /tmp/WeChat.tar ./././.com.apple.mobile_container_manager.metadata.plist./WeChat.app/./WeChat.app/AppIcon60x60@2x.png..../WeChat.app/zh_TW.lproj/network_setting.html./iTunesArtwork./iTunesMetadata.plist ä½¿ç”¨ scp å‘é€æ‰“åŒ…æ–‡ä»¶åˆ° mac ä¸Š 123âœ ~ scp root@192.168.199.132:/tmp/WeChat.tar ~/Desktop/WeChat.tarroot@192.168.199.132's password:WeChat.tar 100% 97MB 1.7MB/s 00:58 é‡ç­¾åè¦æ±‚å¯æ‰§è¡Œæ–‡ä»¶è¦å…ˆè„±å£³ 1234567891011121314151617181920212223242526272829303132// è·å¾—æ²™ç›’åœ°å€iPhone:~ root# cycript -p WeChatcy# [[NSFileManager defaultManager] URLsForDirectory:NSDocumentDirectory inDomains:NSUserDomainMask][0]#\"file://s\"cy# exit(0)// è·å¾—åº”ç”¨åœ°å€iPhone:~ root# ps -ef | grep WeChat 501 714 1 0 0:00.00 ?? 0:03.25 /var/containers/Bundle/Application/41A6836F-CFC9-4DC1-8A9C-ED4DE09F9A66/WeChat.app/WeChat 0 717 699 0 0:00.00 ttys000 0:00.01 grep WeChat// DYLD_INSERT_LIBRARIES=dumpdecrypted.dylib path/to/AppiPhone:/var/mobile/Containers/Data/Application/E7DE74DA-2FC9-4A86-A4D7-F993A88AB225/Documents root# su mobileiPhone:~/Containers/Data/Application/E7DE74DA-2FC9-4A86-A4D7-F993A88AB225/Documents mobile$ DYLD_INSERT_LIBRARIES=dumpdecrypted.dylib /var/containers/Bundle/Application/41A6836F-CFC9-4DC1-8A9C-ED4DE09F9A66/WeChat.app/WeChatmach-o decryption dumperDISCLAIMER: This tool is only meant for security research purposes, not for application crackers.[+] detected 64bit ARM binary in memory.[+] offset to cryptid found: @0x100028ca8(from 0x100028000) = ca8[+] Found encrypted data at address 00004000 of length 56131584 bytes - type 1.[+] Opening /private/var/containers/Bundle/Application/41A6836F-CFC9-4DC1-8A9C-ED4DE09F9A66/WeChat.app/WeChat for reading.[+] Reading header[+] Detecting header type[+] Executable is a plain MACH-O image[+] Opening WeChat.decrypted for writing.[+] Copying the not encrypted start of the file[+] Dumping the decrypted data into the file[+] Copying the not encrypted remainder of the file[+] Setting the LC_ENCRYPTION_INFO-&gt;cryptid to 0 at offset ca8[+] Closing original file[+] Closing dump file åŸç‰ˆçš„ dumpdecrypted æ— æ³•åº”å¯¹æœ‰ Frameworks çš„æƒ…å†µ,ä¸è¿‡æœ‰ä¸€ä¸ªåˆ†æ”¯ç‰ˆæœ¬dumpdecrypted æä¾›äº†è§£å†³çš„æ–¹æ³•,ä½†æ˜¯è¿˜æœ‰Plugins,å¹¸è€Œè¿˜æœ‰ä¸€ä¸ªåˆ†æ”¯æä¾›äº†ä½¿ç”¨dumpdecryptd å¯¹ .extension æ–‡ä»¶è¿›è¡Œè„±å£³(todayé‚£ç§å°æ’ä»¶,ç”¨è¿™ä¸ªç‰ˆæœ¬è„±å£³å°è¯•ä¸æˆåŠŸ,æ‰¾äº†XXåŠ©æ‰‹å»ä¸‹è½½è„±å£³çš„éƒ¨åˆ†),è¯¦æƒ…å¯å‚è€ƒApp Extensionçš„è„±å£³åŠæ³•ã€‚éƒ½èƒ½æ”¯æŒçš„ç‰ˆæœ¬ä¹Ÿå·²ç»æœ‰äº†dumpdecrypted åˆ†æ”¯å¯¹ dumpdecrypted æœ‰äº›éƒ¨åˆ†çš„ä»£ç ä¸ç†è§£ åŸç‰ˆçš„ dumptofile çš„å‡½æ•°å‚æ•°æ˜¯æ€ä¹ˆæ¥çš„? Frameworksåˆ†æ”¯ç‰ˆæœ¬åšäº†ä»€ä¹ˆ? extension åˆ†æ”¯ç‰ˆæœ¬åšäº†ä»€ä¹ˆ? åœ¨è¿™ä¸ªdumpdecryptedçš„Frameworks åˆ†æ”¯ç‰ˆæœ¬ä¸­ 12345__attribute__((constructor))static void dumpexecutable() { ... _dyld_register_func_for_add_image(&amp;image_added);} __attribute__((constructor))æ ¹æ® attribute((constructor))ç”¨æ³•è§£æ,å¾—åˆ°çš„GNUçš„æ–‡æ¡£ å¯çŸ¥ dumpexecutable() æ–¹æ³•åœ¨ main å‡½æ•°ä¹‹å‰æ‰§è¡Œ _dyld_register_func_for_add_imageæ‰¾äº† github ä¸Šçš„ dyld 123456789101112131415161718/* * _dyld_register_func_for_add_image registers the specified function to be * called when a new image is added (a bundle or a dynamic shared library) to * the program. When this function is first registered it is called for once * for each image that is currently part of the program. */void_dyld_register_func_for_add_image(void (*func)(const struct mach_header *mh, intptr_t vmaddr_slide)){ DYLD_LOCK_THIS_BLOCK; typedef void (*callback_t)(const struct mach_header *mh, intptr_t vmaddr_slide); static void (*p)(callback_t func) = NULL; if(p == NULL) _dyld_func_lookup(\"__dyld_register_func_for_add_image\", (void**)&amp;p); p(func);} dyld ä¼šè´Ÿè´£ä¼ é€’ mh å’Œ intptr_t å‚æ•° 1234// usr/include/sys/_types/_intptr_t.htypedef __darwin_intptr_t intptr_t;// usr/include/arm/_types.htypedef long __darwin_intptr_t; å› æ­¤ intptr_t å°±æ˜¯ long ç±»å‹ 12345static void image_added(const struct mach_header *mh, intptr_t slide) { Dl_info image_info; int result = dladdr(mh, &amp;image_info); dumptofile(image_info.dli_fname, mh);} è°ƒç”¨ dumptofile å‡½æ•°, åœ¨ _dyld_register_func_for_add_image å‡½æ•°çš„æ³¨é‡Šä¸­æåˆ°äº† called when a new image is added (a bundle or a dynamic shared library) å› æ­¤å¯ä»¥å°† framework ä¹Ÿä¸€èµ·å¯¼å‡ºã€‚ æŸ¥æ‰¾ dyld åå‘ç°åœ¨ ImageLoader.h å¤´æ–‡ä»¶ä¸­,æœ‰ 1typedef void (*Initializer)(int argc, const char* argv[], const char* envp[], const char* apple[], const ProgramVars* vars); åœ¨ ImageLoaderMachO.cpp ä¸­æœ‰å¦‚ä¸‹çš„å‡½æ•°å®ç° 1234567891011121314151617181920212223void ImageLoaderMachO::doImageInit(const LinkContext&amp; context){ if ( fHasDashInit ) { const uint32_t cmd_count = ((macho_header*)fMachOData)-&gt;ncmds; const struct load_command* const cmds = (struct load_command*)&amp;fMachOData[sizeof(macho_header)]; const struct load_command* cmd = cmds; for (uint32_t i = 0; i &lt; cmd_count; ++i) { switch (cmd-&gt;cmd) { case LC_ROUTINES_COMMAND: Initializer func = (Initializer)(((struct macho_routines_command*)cmd)-&gt;init_address + fSlide); // &lt;rdar://problem/8543820&amp;9228031&gt; verify initializers are in image if ( ! this-&gt;containsAddress((void*)func) ) { dyld::throwf(\"initializer function %p not in mapped image for %s\\n\", func, this-&gt;getPath()); } if ( context.verboseInit ) dyld::log(\"dyld: calling -init function %p in %s\\n\", func, this-&gt;getPath()); func(context.argc, context.argv, context.envp, context.apple, &amp;context.programVars); break; } cmd = (const struct load_command*)(((char*)cmd)+cmd-&gt;cmdsize); } }} æ ¹æ®å‡½æ•°å‘½åçŸ¥é“è¿™åº”è¯¥æ˜¯ç»™é•œåƒåšåˆå§‹åŒ–çš„,é‡Œé¢ func å‡½æ•°æ˜¯ Initializer ç±»å‹çš„,é€šè¿‡ context å‚æ•°è·å–ä¸Šä¸‹æ–‡ä¿¡æ¯,åŸç‰ˆçš„ dumptofile å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸ºä»€ä¹ˆä¼šæ˜¯ (int argc, const char **argv, const char **envp, const char **apple, struct ProgramVars *pvars) åˆ°è¿™é‡Œå°±å¯çŸ¥ä¸€äºŒã€‚ .extension è„±å£³çš„ dumpdecrypted ç‰ˆæœ¬ä¸åŸç‰ˆçš„åŒºåˆ«ä¸»è¦æ˜¯ 123456...strlcpy(npath, cachePath.UTF8String, sizeof(npath));strlcat(npath, tmp, sizeof(npath));strlcat(npath, \".decrypted\", sizeof(npath));strlcpy(buffer, npath, sizeof(buffer));... æŒ‡æ˜å°†è„±å£³çš„åŒ…å¯¼å‡ºåˆ°åº”ç”¨æ²™ç›’çš„ .../Library/Caches ç›®å½•ä¸‹ /Library/MobileSubstrate/DynamicLibraries/ ä¸‹çš„åŠ¨æ€åº“ä¼šè¢«MobileSubstrate.dylib è‡ªåŠ¨åŠ è½½ã€‚ åœ¨åŸç‰ˆçš„ dumpdecrypted æ·»åŠ ä¸€äº›è¾“å‡º,ä½¿ç”¨ printf æ—¶,æ®è¯´åœ¨åé¢æ·»åŠ ä¸€ä¸ª \\n å¯ä»¥åœ¨æ—¥å¿—ä¸­çœ‹åˆ°,ä½†æ˜¯è¯•äº†ä¼¼ä¹æ²¡æ•ˆæœ,å› æ­¤ä½¿ç”¨ NSLog è¿›è¡Œè¾“å‡º,æ·»åŠ  1#import &lt;Foundation/Foundation.h&gt; åŒæ—¶ä¿®æ”¹ Makefile æ–‡ä»¶, æŒ‡æ˜è¦é“¾æ¥ Foundation æ¡†æ¶ 1-framework Foundation make &amp;&amp; ldid ç­¾å,å‘é€åˆ° /Library/MobileSubstrate/DynamicLibraries/ é…ç½®å¥½å¯¹åº”çš„ .plist æ–‡ä»¶,å¯åŠ¨,ç„¶åé—ªé€€,æŸ¥çœ‹æ—¥å¿— 123456789Nov 20 09:13:29 Jasons-iPhone QQReaderUI[1237] &lt;Notice&gt;: MS:Notice: Injecting: com.tencent.qqreaderiphone [QQReaderUI] (1290.11)Nov 20 09:13:29 Jasons-iPhone QQReaderUI[1237] &lt;Notice&gt;: MS:Notice: Loading: /Library/MobileSubstrate/DynamicLibraries/dumpdecrypted.dylibNov 20 09:13:29 Jasons-iPhone QQReaderUI[1237] &lt;Warning&gt;: [TEST]:rpath = /private/var/containers/Bundle/Application/E276C2C9-20FE-4450-915A-86EBE07798AC/QQReaderUI.app/QQReaderUINov 20 09:13:29 Jasons-iPhone QQReaderUI[1237] &lt;Warning&gt;: [TEST]:fd = 4Nov 20 09:13:29 Jasons-iPhone QQReaderUI[1237] &lt;Warning&gt;: [TEST]:npath = QQReaderUINov 20 09:13:29 Jasons-iPhone QQReaderUI[1237] &lt;Warning&gt;: [TEST]:npath = QQReaderUI.decryptedNov 20 09:13:29 Jasons-iPhone QQReaderUI[1237] &lt;Warning&gt;: [TEST]:outfd = -1Nov 20 09:13:29 Jasons-iPhone QQReaderUI[1237] &lt;Warning&gt;: [TEST]:outfd = -1Nov 20 09:13:29 Jasons-iPhone com.apple.xpc.launchd[1] (UIKitApplication:com.tencent.qqreaderiphone[0xc2a3][1237]) &lt;Warning&gt;: Service exited with abnormal code: 1 ç¬¬ä¸€ä¸ª outfd = -1 12outfd = open(npath, O_RDWR|O_CREAT|O_TRUNC, 0644);NSLog(@\"[TEST]:outfd = %d\\n\",outfd); å°è¯•åœ¨å½“å‰ç›®å½•ä¸‹(/Library/MobileSubstrate/DynamicLibraries/),æ‰“å¼€(åˆ›å»º)ä¸€ä¸ª QQReaderUI.decrypted,å› ä¸ºæƒé™çš„é—®é¢˜å¤±è´¥äº†ã€‚ ç¬¬äºŒä¸ª outfd = -1 åé¢ dumpdecrypted.dylib è¿˜ä¼šåˆ¤æ–­æ˜¯ä¸æ˜¯åœ¨/private/var/mobile/Applications(é€šè¿‡AppStoreå’ŒiTuneså®‰è£…çš„ç¨‹åºéƒ½åœ¨é‡Œé¢ã€‚),ä½†æ˜¾ç„¶ä¸æ˜¯,å› æ­¤ä¹Ÿå¤±è´¥äº† è°ƒç”¨ _exit(1) é—ªé€€ æ‰¾åˆ°ä¸€ä¸ªæ¯”è¾ƒå…·ä½“çš„è§£é‡Š,æ’ç‰ˆä¸å¤ªå¥½â€¦ å›åˆ°æ­£é¢˜å°†è„±å£³åçš„å¯æ‰§è¡Œæ–‡ä»¶åŒæ ·çš„å‘é€åˆ° mac ä¸Š 123456âœ ~ scp root@192.168.199.132:/var/mobile/Containers/Data/Application/E7DE74DA-2FC9-4A86-A4D7-F993A88AB225/Documents/WeChat.decrypted ~/Desktoproot@192.168.199.132's password:WeChat.decrypted 100% 68MB 444.4KB/s 02:36âœ ~ cd Desktopâœ Desktop file WeChat.decryptedWeChat.decrypted: Mach-O 64-bit executable arm64 å¦‚ä½•åˆ¤æ–­æ˜¯å¦å·²è„±å£³åˆ¤æ–­äºŒè¿›åˆ¶æ˜¯å¦è¢«åŠ å¯†å¯ä»¥ä½¿ç”¨ otool å·¥å…· otool - object file displaying tool otoolå¯ä»¥è¾“å‡ºappçš„load commandsï¼Œç„¶åé€šè¿‡æŸ¥çœ‹cryptidè¿™ä¸ªæ ‡å¿—ä½æ¥åˆ¤æ–­appæ˜¯å¦è¢«åŠ å¯†ã€‚1ä»£è¡¨åŠ å¯†äº†ï¼Œ0ä»£è¡¨è¢«è§£å¯†äº† 1234567891011121314151617// ç›´æ¥ä»æ‰‹æœºä¸­å¯¼å‡ºçš„ WeChat âœ Wechat otool -l WeChat.app/WeChat | grep -B 2 crypt(standard input)-489- cmd LC_ENCRYPTION_INFO(standard input)-490- cmdsize 20(standard input):491: cryptoff 16384(standard input):492: cryptsize 46907392(standard input):493: cryptid 1// è„±å£³åçš„ WeChatâœ Wechat otool -l WeChat.decrypted | grep -B 2 crypt(standard input):1:WeChat.decrypted:--(standard input)-489- cmd LC_ENCRYPTION_INFO(standard input)-490- cmdsize 20(standard input):491: cryptoff 16384(standard input):492: cryptsize 46907392(standard input):493: cryptid 0 å¯ä»¥çœ‹å‡ºæ‰‹æœºå¯¼å‡ºçš„åªæœ‰å½“å‰æ¶æ„çš„,è€Œè„±å£³ä¹Ÿåªé’ˆå¯¹å½“å‰è¿è¡Œçš„æ¶æ„,ç›´æ¥ä» iTunes ä¸‹è½½çš„ .ipa æ–‡ä»¶ä¸­çš„äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°å¤§çº¦æ˜¯ä»æ‰‹æœºå¯¼å‡ºçš„ä¸¤å€,å› ä¸ºå®ƒåŒ…å«äº†å…¶ä»–çš„æ¶æ„ã€‚ äº†è§£é‡ç­¾åå­¦ä¹ ä¸€èˆ¬éƒ½æ˜¯ä»æ¨¡ä»¿å¼€å§‹çš„,çœ‹çœ‹ Xcode æ˜¯æ€ä¹ˆç­¾åçš„,åˆ›å»ºæ–°å·¥ç¨‹,âŒ˜ + B ç¼–è¯‘ä¸€ä¸‹,ç„¶åæŸ¥çœ‹æ—¥å¿— 1234567891011121314151617/// ç­¾åCodeSign /Users/Jason/Library/Developer/Xcode/DerivedData/JustForTest-ggxnkdgkdklojofwwsifymqzfwqo/Build/Products/Debug-iphoneos/JustForTest.app/// cd åˆ°å·¥ç¨‹ç›®å½• cd path/to/project/// æ‰©å±•ç¯å¢ƒå˜é‡ export CODESIGN_ALLOCATE=/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/codesign_allocate export PATH=\"/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin:/Applications/Xcode.app/Contents/Developer/usr/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin\"/// ç­¾åçš„èº«ä»½ + æè¿°æ–‡ä»¶è¯´æ˜ Signing Identity: \"iPhone Developer: å¼€å‘è€…å (å¼€å‘è€…ID)\"Provisioning Profile: \"iOS Team Provisioning Profile: com.coder.bk123\" (c8748c6c-9d07-41ce-8d55-ff5ca9999999)// ä½¿ç”¨ codesign æ‰§è¡Œç­¾åæ“ä½œ /usr/bin/codesign --force --sign ç­¾åå€¼ --entitlements /Users/Jason/Library/Developer/Xcode/DerivedData/JustForTest-ggxnkdgkdklojofwwsifymqzfwqo/Build/Intermediates.noindex/JustForTest.build/Debug-iphoneos/JustForTest.build/JustForTest.app.xcent --timestamp=none /Users/Jason/Library/Developer/Xcode/DerivedData/JustForTest-ggxnkdgkdklojofwwsifymqzfwqo/Build/Products/Debug-iphoneos/JustForTest.app --forceå¼ºåˆ¶ä»£æ›¿å·²å­˜åœ¨çš„ç­¾å --timestampæ—¶é—´æˆ³ --sign123-s, --sign identity Sign the code at the path(s) given using this identity. See SIGNING IDENTI- TIES below. è¯¦æƒ…å¯ä½¿ç”¨ man codesign æŸ¥çœ‹ æ‰“å¼€é’¥åŒ™ä¸²åº”ç”¨,æ‰¾åˆ°å¼€å‘è€…è¯ä¹¦,å› ä¸ºæˆ‘æ˜¯DebugçŠ¶æ€ä¸‹è¿è¡Œçš„,æ‰€ä»¥çœ‹å¼€å‘è¯ä¹¦,sign çš„å€¼å°±æ˜¯æŒ‡çº¹ä¸­çš„ SHA1 ç­¾å,20ä¸ª16è¿›åˆ¶ æ­£å¥½æ˜¯40ä½ --entitlementså‚æ•°å€¼å¯¹åº”çš„ xxx.app.xcent æ–‡ä»¶å†…å®¹å¦‚ä¸‹ 12345678910111213141516&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"&gt;&lt;plist version=\"1.0\"&gt;&lt;dict&gt; &lt;key&gt;application-identifier&lt;/key&gt; &lt;string&gt;XXXXX.åŒ…å&lt;/string&gt; &lt;key&gt;com.apple.developer.team-identifier&lt;/key&gt; &lt;string&gt;XXXXX&lt;/string&gt; &lt;key&gt;get-task-allow&lt;/key&gt; &lt;true/&gt; &lt;key&gt;keychain-access-groups&lt;/key&gt; &lt;array&gt; &lt;string&gt;XXXXX.åŒ…å&lt;/string&gt; &lt;/array&gt;&lt;/dict&gt;&lt;/plist&gt; å…¶ä¸­ XXXXX æ˜¯å‘å¸ƒè¯ä¹¦ä¸­å¼€å‘è€…çš„èº«ä»½ID å³ com.apple.developer.team-identifier ä¸­çš„å­—æ®µå€¼ åœ¨ WWDC16 Session 401 Whatâ€™s New in Xcode App Signing æœ‰å¦‚ä¸‹çš„å†…å®¹ There are three things that you need in order to sign your apps. The first thing is a signing certificate. Signing certificates establish your identity as a developer.Provisioning profiles are all about your apps, and they grant permissions. And entitlements declare support for capabilities.Like iCloud or Wallet. So certificates. These are issued by Apple.And this is important because the device needs a trust chain back to Apple so it can install the app. And certificates come in two forms. signing certificate: å¼€å‘è€…èº«ä»½æ˜¯å¦å¯ä¿¡Provisioning profiles: å“ªäº›è®¾å¤‡å¯å®‰è£…entitlements: æœ‰å“ªäº›èƒ½åŠ›,æ¯”å¦‚æ¨é€,åº”ç”¨é—´åˆ†äº«â€¦. åœ¨æ–°åˆ›å»ºçš„å·¥ç¨‹ Product ç›®å½•ä¸‹ Show in Finder æ¥æŸ¥çœ‹ xxx.app æ–‡ä»¶,å¯ä»¥å‘ç°é‡Œé¢åŒ…å«ä¸€ä¸ª embedded.mobileprovision æ–‡ä»¶,å¯ä»¥é€šè¿‡ 1âœ security cms -D -i embedded.mobileprovision ç»“æœå¦‚ä¸‹: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"&gt;&lt;plist version=\"1.0\"&gt;&lt;dict&gt; &lt;key&gt;AppIDName&lt;/key&gt; &lt;string&gt;Resign01&lt;/string&gt; &lt;key&gt;ApplicationIdentifierPrefix&lt;/key&gt; &lt;array&gt; &lt;string&gt;å‘å¸ƒæ—¶çš„å¼€å‘è€…ID&lt;/string&gt; &lt;/array&gt; &lt;key&gt;CreationDate&lt;/key&gt; &lt;date&gt;2017-11-15T03:42:41Z&lt;/date&gt; &lt;key&gt;Platform&lt;/key&gt; &lt;array&gt; &lt;string&gt;iOS&lt;/string&gt; &lt;/array&gt; &lt;key&gt;DeveloperCertificates&lt;/key&gt; &lt;array&gt; &lt;data&gt;ç­¾åè¯ä¹¦&lt;/data&gt; &lt;data&gt;...&lt;/data&gt; &lt;/array&gt; &lt;key&gt;Entitlements&lt;/key&gt; &lt;dict&gt; &lt;key&gt;keychain-access-groups&lt;/key&gt; &lt;array&gt; &lt;string&gt;å‘å¸ƒæ—¶çš„å¼€å‘è€…ID.*&lt;/string&gt; &lt;/array&gt; &lt;key&gt;get-task-allow&lt;/key&gt; &lt;true/&gt; &lt;key&gt;application-identifier&lt;/key&gt; &lt;string&gt;å‘å¸ƒæ—¶çš„å¼€å‘è€…ID.com.coder.Resign01&lt;/string&gt; &lt;key&gt;com.apple.developer.healthkit&lt;/key&gt; &lt;true/&gt; &lt;key&gt;com.apple.security.application-groups&lt;/key&gt; &lt;array&gt; &lt;string&gt;group.com.coder.Resign01&lt;/string&gt; &lt;/array&gt; &lt;key&gt;com.apple.developer.team-identifier&lt;/key&gt; &lt;string&gt;å‘å¸ƒæ—¶çš„å¼€å‘è€…ID&lt;/string&gt; &lt;key&gt;aps-environment&lt;/key&gt; &lt;string&gt;development&lt;/string&gt; &lt;/dict&gt; &lt;key&gt;ExpirationDate&lt;/key&gt; &lt;date&gt;2018-11-15T03:42:41Z&lt;/date&gt; &lt;key&gt;Name&lt;/key&gt; &lt;string&gt;iOS Team Provisioning Profile: com.coder.Resign01&lt;/string&gt; &lt;key&gt;ProvisionedDevices&lt;/key&gt; &lt;array&gt; &lt;string&gt;å…è®¸å®‰è£…çš„è®¾å¤‡çš„UDID&lt;/string&gt; &lt;string&gt;....&lt;/string&gt; &lt;/array&gt; &lt;key&gt;TeamIdentifier&lt;/key&gt; &lt;array&gt; &lt;string&gt;å‘å¸ƒæ—¶çš„å¼€å‘è€…ID&lt;/string&gt; &lt;/array&gt; &lt;key&gt;TeamName&lt;/key&gt; &lt;string&gt;å¼€å‘è€…å&lt;/string&gt; &lt;key&gt;TimeToLive&lt;/key&gt; &lt;integer&gt;365&lt;/integer&gt; &lt;key&gt;UUID&lt;/key&gt; &lt;-- æè¿°æ–‡ä»¶ --&gt; &lt;string&gt;c8748c6c-9d07-41ce-8d55-ff5ca999999&lt;/string&gt; &lt;key&gt;Version&lt;/key&gt; &lt;integer&gt;1&lt;/integer&gt;&lt;/dict&gt;&lt;/plist&gt; é€šè¿‡ Xcode æ—¥å¿—çš„æè¿°æ–‡ä»¶åºåˆ—å·åœ¨ ~/Library/MobileDevice/Provisioning Profiles/ ç›®å½•æŸ¥æ‰¾,ç„¶åç”¨å¯¹æ¯”å·¥å…·è¿›è¡Œæ¯”è¾ƒ,å‘ç°ä¸¤è€…æ˜¯ç›¸åŒçš„, ä»ä¸­å¯ä»¥çœ‹å‡º,å¼€å‘çš„æƒ…å†µä¸‹,ç­¾åçš„è¿‡ç¨‹ä¼šå°†æˆ‘ä»¬ä» Apple å¼€å‘è€…åå°ä¸‹è½½çš„æè¿°æ–‡ä»¶embedded.mobileprovision æ”¾åˆ°åŒ…ä¸­,ç”¨äºå®‰è£…æ—¶çš„éªŒè¯ã€‚ æˆ‘ä»¬åœ¨ Apple å¼€å‘è€…åå°ç”Ÿæˆè¯ä¹¦æ—¶è¦æ±‚ä¸Šä¼ ä¸€ä¸ª .csr æ–‡ä»¶,Certificate_signing_request Before creating a CSR, the applicant first generates a key pair, keeping the private key secret. The CSR contains information identifying the applicant (such as a distinguished name in the case of an X.509 certificate) which must be signed using the applicantâ€™s private key. The CSR also contains the public key chosen by the applicant. The CSR may be accompanied by other credentials or proofs of identity required by the certificate authority, and the certificate authority may contact the applicant for further information. åˆ›å»º .csr æ–‡ä»¶å‰,ä¼šç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•ç”Ÿæˆä¸€å¯¹å¯†é’¥,åˆ†åˆ«æ˜¯å…¬é’¥å’Œç§é’¥,ç§é’¥å­˜æ”¾åœ¨æœ¬åœ°,è€Œå…¬é’¥ä¸ä¸€äº›è¡¨æ˜èƒ½è‡ªèº«èº«ä»½çš„ä¿¡æ¯ä¸€èµ·ç”¨äºç”Ÿæˆ .csr æ–‡ä»¶ã€‚ Apple å¼€å‘è€…åå°ç›¸å½“äºä¸€ä¸ª CA Trusted certificates can be used to create secure connections to a server via the Internet. A certificate is essential in order to circumvent a malicious party which happens to be on the route to a target server which acts as if it were the target. Such a scenario is commonly referred to as a man-in-the-middle attack. The client uses the CA certificate to authenticate the CA signature on the server certificate, as part of the authorizations before launching a secure connection. Usually, client softwareâ€”for example, browsersâ€”include a set of trusted CA certificates. This makes sense, as many users need to trust their client software. A malicious or compromised client can skip any security check and still fool its users into believing otherwise. å…³äºç­¾åçš„åŸç†,è¯·çœ‹ä¸‹å›¾ æ¥è‡ª-iOS App ç­¾åçš„åŸç† æµ‹è¯•ç¯å¢ƒä¸‹(Ad Hoc)å¦‚ä½•ä¿è¯åº”ç”¨èƒ½æ­£å¸¸è¿è¡Œ? æ¥è‡ª developer.apple.com è¯ä¹¦å’Œ device ID ä¸€èˆ¬åº”è¯¥éƒ½ä¸ä¼šæœ‰é—®é¢˜,éƒ½æ˜¯ä» Apple å¼€å‘è€…åå°è·å–çš„,æ‰€ä»¥ä¸»è¦å»è€ƒè™‘çš„æ˜¯ bundle ID å’Œ entitlements åé¢å®è·µå‘ç°å¯¹ entitlements.plist æ–‡ä»¶æ·»åŠ æƒé™,åˆ é™¤æƒé™,ä¼šå½±å“åˆ°å¯¹åº”çš„embedded.mobileprovision,ä½†æ˜¯ä¾ç„¶å¯ä»¥æˆåŠŸå®‰è£…å¹¶è¿è¡Œã€‚ çœ‹äº†æ–‡å­—çš„è¯´æ˜ The app successfully launches if the appâ€™s bundle ID matches the App ID, the signature matches the distribution certificate, and the device is in the device list of the ad hoc provisioning profile. åªæåˆ°äº† 3 ç‚¹,åŒ…ååŒ¹é…,è¯ä¹¦åŒ¹é…(--sign å¯¹åº”çš„è¯ä¹¦ç­¾åembedded.mobileprovision æ–‡ä»¶ä¸­åŒ…å«çš„è¯ä¹¦),æè¿°æ–‡ä»¶çš„è®¾å¤‡åˆ—è¡¨åŒ…å«å½“å‰è®¾å¤‡ å“ªäº›æ–‡ä»¶éœ€è¦å‚ä¸ç­¾å Nested code , æ¯”å¦‚ .a é™æ€åº“, .frameworks (å…ˆç­¾å)Mach-O executables , äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶Resources , èµ„æºæ–‡ä»¶ï¼Œå°±æ˜¯ CodeResources çš„éƒ¨åˆ†To apply the signature, the codesign utility adds the signature directly to the executable file. .ipa åŒ…é‡Œæœ‰ä¸€ä¸ª _CodeSignature çš„æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­æœ‰ä¸ª CodeResources æ–‡ä»¶ 12345678910111213141516171819202122&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"&gt;&lt;plist version=\"1.0\"&gt;&lt;dict&gt; &lt;key&gt;files&lt;/key&gt; &lt;dict&gt; ... &lt;/dict&gt; &lt;key&gt;files2&lt;/key&gt; &lt;dict&gt; ... &lt;/dict&gt; &lt;key&gt;rules&lt;/key&gt; &lt;dict&gt; ... &lt;/dict&gt; &lt;key&gt;rules2&lt;/key&gt; &lt;dict&gt; ... &lt;/dict&gt;&lt;/dict&gt;&lt;/plist&gt; rules å’Œ files æ˜¯ä¸ºè€ç‰ˆæœ¬å‡†å¤‡çš„ï¼Œè€Œ files2 å’Œ rules2æ˜¯ä¸ºæ–°çš„ç¬¬äºŒç‰ˆçš„ä»£ç ç­¾åå‡†å¤‡çš„ã€‚æœ€ä¸»è¦çš„åŒºåˆ«æ˜¯åœ¨æ–°ç‰ˆæœ¬ä¸­ä½ æ— æ³•å†å°†æŸäº›èµ„æºæ–‡ä»¶æ’é™¤åœ¨ä»£ç ç­¾åä¹‹å¤–ã€‚+äºŒè¿›åˆ¶çš„ç­¾åä¼šè¢«æ”¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ å‚è€ƒçš„é‚£ç¯‡æ–‡ç« çš„é“¾æ¥æŒ‚äº†â€¦ https://xiuchundao.me/post/code-resources-and-embedded-mobileprovision-included-in-ipa-file Mach-O executables. â€¦ To apply the signature, the codesign utility adds the signature directly to the executable file. å¯ä»¥çŸ¥é“äºŒè¿›åˆ¶æ–‡ä»¶çš„ç­¾åç¡®å®æ˜¯ç›´æ¥åœ¨æ–‡ä»¶ä¸­çš„ æ€»ç»“ ç­¾åå·¥å…·: codesign,éœ€è¦æä¾› è¯ä¹¦çš„SHA1ç­¾åå€¼ å’Œ entitlements.plist embedded.mobileprovision å°±æ˜¯ä» Apple å¼€å‘è€…åå°ä¸‹è½½çš„æè¿°æ–‡ä»¶, åŒæ—¶åœ¨ç¼–è¯‘æ—¶ä¼šè¢«æ‹·è´åˆ°åŒ…ä¸­ é‡ç­¾åçš„åº”ç”¨è¦æˆåŠŸè¿è¡Œè¦ä¿è¯åŒ…ååŒ¹é…,è¯ä¹¦åŒ¹é…(--sign å¯¹åº”çš„è¯ä¹¦ç­¾åembedded.mobileprovision æ–‡ä»¶ä¸­åŒ…å«çš„è¯ä¹¦),æè¿°æ–‡ä»¶çš„è®¾å¤‡åˆ—è¡¨åŒ…å«å½“å‰è®¾å¤‡ å‚ä¸ç­¾åçš„æœ‰å†…åµŒçš„æ¡†æ¶,èµ„æºæ–‡ä»¶,äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ å‚è€ƒ Wiki-SHA1 App Distribution Guide - Adding Capabilities iOSAppHook Code Signing Tasks Maintaining Identifiers, Devices, and Profiles AppDistributionGuide-Introduction attribute((constructor))ç”¨æ³•è§£æ How do you compile and run an objective-c file outside Xcode?","link":"/2017/11/28/iOSer-Escape-iPhone-device-export-ipa-resign/"},{"title":"Wiki - é€šè¿‡é…ç½®è·å–iPhoneçš„UDID","text":"ä»…è®°å½•123456789101112131415161718192021222324252627282930313233&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"&gt;&lt;plist version=\"1.0\"&gt; &lt;dict&gt; &lt;key&gt;PayloadContent&lt;/key&gt; &lt;dict&gt; &lt;key&gt;URL&lt;/key&gt; &lt;string&gt;http://dev.skyfox.org/udid/receive.php&lt;/string&gt; &lt;!--æ¥æ”¶æ•°æ®çš„æ¥å£åœ°å€--&gt; &lt;key&gt;DeviceAttributes&lt;/key&gt; &lt;array&gt; &lt;string&gt;UDID&lt;/string&gt; &lt;string&gt;IMEI&lt;/string&gt; &lt;string&gt;ICCID&lt;/string&gt; &lt;string&gt;VERSION&lt;/string&gt; &lt;string&gt;PRODUCT&lt;/string&gt; &lt;/array&gt; &lt;/dict&gt; &lt;key&gt;PayloadOrganization&lt;/key&gt; &lt;string&gt;dev.skyfox.org&lt;/string&gt; &lt;!--ç»„ç»‡åç§°--&gt; &lt;key&gt;PayloadDisplayName&lt;/key&gt; &lt;string&gt;æŸ¥è¯¢è®¾å¤‡UDID&lt;/string&gt; &lt;!--å®‰è£…æ—¶æ˜¾ç¤ºçš„æ ‡é¢˜--&gt; &lt;key&gt;PayloadVersion&lt;/key&gt; &lt;integer&gt;1&lt;/integer&gt; &lt;key&gt;PayloadUUID&lt;/key&gt; &lt;string&gt;3C4DC7D2-E475-3378-489C-0BB8D737A653&lt;/string&gt; &lt;!--è‡ªå·±éšæœºå¡«å†™çš„å”¯ä¸€å­—ç¬¦ä¸²--&gt; &lt;key&gt;PayloadIdentifier&lt;/key&gt; &lt;string&gt;dev.skyfox.profile-service&lt;/string&gt; &lt;key&gt;PayloadDescription&lt;/key&gt; &lt;string&gt;æœ¬æ–‡ä»¶ä»…ç”¨æ¥è·å–è®¾å¤‡ID&lt;/string&gt; &lt;!--æè¿°--&gt; &lt;key&gt;PayloadType&lt;/key&gt; &lt;string&gt;Profile Service&lt;/string&gt; &lt;/dict&gt;&lt;/plist&gt;","link":"/2022/12/11/iOSer-Get-iPhone-udid/"},{"title":"å…å¯†ç è¿œç¨‹ç™»é™†iOSè®¾å¤‡","text":"å‰ææ¡ä»¶ è¶Šç‹±è®¾å¤‡ è®¾å¤‡å·²å®‰è£…OpenSSH æµç¨‹ ç”ŸæˆRSAè¯ä¹¦ æ¨é€å…¬é’¥åˆ°iOSè®¾å¤‡ é…ç½®~/.ssh/configæ–‡ä»¶ è¿œç¨‹SSHç™»é™† ç”ŸæˆRSAè¯ä¹¦ssh-keygen1234567891011121314151617181920212223$ ssh-keygen// é»˜è®¤ä¸ºid_rsa å¯å¦å–åæ¯”å¦‚ iPadMini å¯†ç Apple$%^321Generating public/private rsa key pair.Enter file in which to save the key (/Users/Jason/.ssh/id_rsa):Enter passphrase (empty for no passphrase):Enter same passphrase again:Your identification has been saved in iPadMini.Your public key has been saved in iPadMini.pub.The key fingerprint is:SHA256:6lL+mpTksDTg4CsPiqD1WIemisd1BeoLtbXmgKuhjto Jason@BJ-iAirThe key's randomart image is:+---[RSA 2048]----+| || . ||. . . . ||.o .o . . || ..++o.oS || +.=B=o ||=o.+=O* ||X*+*o+o. ||&amp;=E ..+o. |+----[SHA256]-----+ å°†RSAè¯ä¹¦ç§»åŠ¨åˆ°~/.ssh/ç›®å½•ä¸‹12$ mv iPadMini ~/.ssh/$ mv iPadMini.pub ~/.ssh/ æ¨é€å…¬é’¥åˆ°iOSè®¾å¤‡~/.ssh/ ç›®å½•æ˜¯å¦å­˜åœ¨12345$ ssh root@your_device_ip// æ²¡æœ‰.sshç›®å½•æ—¶$ cd ~$ mkdir .ssh æ¨é€å…¬é’¥1234$ scp ~/.ssh/iPadMini.pub root@your_device_ip:/var/root/.ssh/root@192.168.5.105's password:iPadMini.pub 100% 395 0.4KB/s 00:00 ä¿®æ”¹å…¬é’¥æ–‡ä»¶å1234$ cd ~/.ssh/// å½“ä¸å­˜åœ¨authorized_keysè¯¥æ–‡ä»¶æ—¶ å¯ä»¥$ mv iPadMini.pub authorized_keys// å½“å­˜åœ¨æ—¶,å¯ç”¨catå°†å…¬é’¥åŠ åˆ°authorized_keysæ–‡ä»¶å°¾ é…ç½®~/.ssh/configæ–‡ä»¶12345// è¿›è¡Œè¿œç¨‹ç™»é™†æ“ä½œçš„è®¡ç®—æœº(æ¯”å¦‚ Mac OS)$ cd ~/.ssh/// æŸ¥çœ‹configæ–‡ä»¶æ˜¯å¦å­˜åœ¨,ä¸å­˜åœ¨åˆ™åˆ›å»º$ mkdir config configå†…å®¹æ ¼å¼:12345Host aMini HostName your_device_ip ## è®¾å¤‡ip User root ## ç”¨æˆ·å PreferredAuthentications publickey IdentityFile ~/.ssh/iPadMini ## æŒ‡å®šRSAç§é’¥æ–‡ä»¶ è¿œç¨‹ç™»é™†123$ ssh aMiniEnter passphrase for key '/Users/Jason/.ssh/iPadMini':niya:~ root# å·²ç»èƒ½å…å¯†ç SSHç™»é™†äº†","link":"/2016/11/20/iOSer-Free-password-to-remotely-access-iOS-devices/"},{"title":"å–œé©¬æ‹‰é›…éŸ³é¢‘æ–‡ä»¶å¯¼å‡º","text":"å‰è¨€ å¹³æ—¶å–œæ¬¢ç”¨å–œé©¬æ‹‰é›…å¬å¹¿æ’­ä¸€èˆ¬éƒ½ç¦»çº¿ä¸‹è½½åå¬,ä½†æ˜¯æ‰‹æœºçš„ç©ºé—´ä¸è¶³,æœ‰äº›éŸ³é¢‘åˆä¸æƒ³åˆ ,å› æ­¤æƒ³æŠŠéŸ³é¢‘æ–‡ä»¶å¯¼å‡º,ç„¶åå°±å¯ä»¥ä»»æ€§åˆ å•¦ã€‚ ç¯å¢ƒ iPad Mini 2(8.4,å·²è¶Šç‹±)macOS Sierra 10.12.3å–œé©¬æ‹‰é›…v5.4.57 æµç¨‹ sshç™»å½•åˆ°iPadä¸Š cycripytå¯»æ‰¾å–œé©¬æ‹‰é›…çš„è¿›ç¨‹å¹¶æ³¨å…¥ å¯»æ‰¾æ²™ç›’è·¯å¾„ å¯»æ‰¾éŸ³é¢‘æ–‡ä»¶ å¯¼å‡ºéŸ³é¢‘æ–‡ä»¶ åç»­å¤„ç† å‡†å¤‡å…ˆç”¨å–œé©¬æ‹‰é›…ä¸‹è½½ä¸€äº›æ„Ÿå…´è¶£çš„éŸ³é¢‘ sshç™»å½•1ssh root@your_device_ip cycripytæ‰¾è¿›ç¨‹ä¸ºé¿å…å¹²æ‰°,å…ˆå…³é—­å…¶ä»–è¿›ç¨‹,æ‰“å¼€å–œé©¬æ‹‰é›…åº”ç”¨,ç”¨psæŒ‡ä»¤è·å–å½“å‰è¿è¡Œè¿›ç¨‹åˆ—è¡¨ æ ¹æ®è·¯å¾„åŠ åå­—åˆ¤æ–­é‚£ä¸ªtingè¿›ç¨‹å³ä¸ºå–œé©¬æ‹‰é›…çš„è¿›ç¨‹ ä½¿ç”¨cycriptæ³¨å…¥ 1iPad:~ root# cycript -p ting ç›´æ¥è¾“å‡ºUIApp çœ‹åº”ç”¨å•ä¾‹å¯¹è±¡æ˜¯ä»€ä¹ˆ 12cy# UIApp#\"&lt;XMUIApplication: 0x144e228a0&gt;\" æ˜¯å–œé©¬æ‹‰é›…çš„å…¨æ‹¼,åº”è¯¥å°±æ˜¯è¿™ä¸ªäº†,å¦‚æœè¿˜è¦ç¡®å®š,å¯ä»¥è¾“å…¥exit(0)å°±ä¼šå‘ç°å–œé©¬æ‹‰é›…è¢«å…³é—­äº†ã€‚ å¯»æ‰¾æ²™ç›’è·¯å¾„1[[NSFileManager defaultManager] URLsForDirectory:NSDocumentDirectory inDomains:NSUserDomainMask][0] ç»“æœå¦‚ä¸‹ 1#\"file:///var/mobile/Containers/Data/Application/88888888-0E68-49E6-AB14-457891C5BCFF/Documents/\" æ²™ç›’è·¯å¾„æ‰¾åˆ°äº†,æ¥ä¸‹æ¥æ‰¾éŸ³é¢‘è·¯å¾„ å¯ä»¥ç¦»å¼€cycriptäº† å¯»æ‰¾éŸ³é¢‘è·¯å¾„ æˆ‘ä»¬çŸ¥é“iOSæ²™ç›’ä¸€èˆ¬åŒ…å«äº†3ä¸ªç›®å½• Documents Library tmp StoreKitåº”è¯¥æ˜¯å†…è´­è€Œåˆ›å»ºçš„ æ’é™¤tmp,StoreKit,ç¬¬ä¸€æ„Ÿè§‰æ˜¯éŸ³é¢‘æ–‡ä»¶åœ¨Documents,cdåˆ°è¯¥ç›®å½•æŸ¥çœ‹,åæ­£é”™äº†ä¹Ÿä¸è¦ç´§,å†è¯•å°±å¥½äº† .dbæ•°æ®åº“æ–‡ä»¶æ’é™¤,umengrtåº”è¯¥æ˜¯å‹ç›Ÿç»Ÿè®¡,åˆ†äº«ä¹‹ç±»çš„,chatèŠå¤©çš„ æœ‰ä¸€ä¸ªiDocçš„ç›®å½•,å°è¯•è¿›å…¥, æœ‰Downloadç›®å½•,é‚£åº”è¯¥å¾ˆæ˜æ˜¾äº†,è¿›å» å°è¯•è¿‡ç›´æ¥å‘é€åˆ°ç”µè„‘,ç¡®å®æ˜¯éŸ³é¢‘ 12$ file /Users/Jason/Desktop/Download/00a6b52f49f757bece6676c658789222/Users/Jason/Desktop/Download/00a6b52f49f757bece6676c658789222: ISO Media, Apple iTunes ALAC/AAC-LC (.M4A) Audio ä½†éŸ³é¢‘æ–‡ä»¶çš„å‘½åæ˜¯ç¡®æœ‰ç‚¹å¥‡æ€ª,åº”è¯¥æ˜¯ä½¿ç”¨äº†ç±»ä¼¼SDWebImageé‚£ç§ç½‘ç»œå›¾ç‰‡ç¼“å­˜æ¡†æ¶,éŸ³é¢‘åå¯èƒ½ç”¨äº†md5ä¹‹ç±»é¿å…å†²çª,æ²¡å…³ç³»,åœ¨åº”ç”¨æ˜¾ç¤ºå‡ºæ­£å¸¸çš„éŸ³é¢‘åç§°,æ‰€ä»¥è‚¯å®šä¼šæœ‰åœ°æ–¹ä¿å­˜æ˜ å°„å…³ç³»çš„,ä¸Šä¸€çº§åœ¨Documentsä¸­,å‘ç°äº†åä¸ºting.sqliteçš„æ–‡ä»¶,æ˜¯ä¸ªsqliteæ–‡ä»¶,çœ‹æ˜¯ä¸æ˜¯åœ¨æ•°æ®åº“ä¿å­˜ç€æ˜ å°„å…³ç³» å› ä¸ºæ‰‹æœºä¸Šä¸å¤ªå¥½æ‰§è¡Œsqlite,å…ˆç”¨catçœ‹çœ‹æ•°æ®åº“æ–‡ä»¶å¤§æ¦‚çš„å†…å®¹ çœ‹ä¸Šå»åº”è¯¥æ˜¯æ˜¯åœ¨è¯¥æ–‡ä»¶ä¸­æ˜ å°„å…³ç³» å¯¼å‡ºéŸ³é¢‘æ–‡ä»¶å…³äºå¯¼å‡ºéŸ³é¢‘æ–‡ä»¶,å¯ä»¥ä½¿ç”¨iToolsæˆ–ç›´æ¥ä½¿ç”¨ç»ˆç«¯å…ˆæ‰“åŒ…å†ä½¿ç”¨scpå‘é€ 12iPad:xxx# tar -cvzf apps.tar.gz ./Download... åœ¨macä¸Šæ‰§è¡Œ 1Â» ~ scp root@192.168.1.174:/var/mobile/Containers/Data/Application/88888888-0E68-49E6-AB14-45710CC5BCFF/Documents/iDoc/apps.tar.gz ~/Desktop/apps.tar.gz ä¼ è¾“æˆåŠŸåˆ°macä¸Š,æ¥ç€å°±è¿›å…¥åç»­å¤„ç†æ“ä½œ ç±»ä¼¼çš„å¾—åˆ°ting.sqliteæ–‡ä»¶ åç»­å¤„ç†ä¸»è¦æ˜¯æ ¹æ®æ ¹æ®ting.sqliteå¤„ç†éŸ³é¢‘çš„æ–‡ä»¶å æ‰“å¼€ç»ˆç«¯ 12345Â» ~/Desktop sqlite3 ting.sqliteEnter \".help\" for usage hints.sqlite&gt; .tablesadData_table download_tablesqlite&gt; æŸ¥è¯¢download_table 1sqlite&gt; select * from download_table; è®°å½•çš„æ ¼å¼å¦‚ä¸‹: é‡Œé¢ç¡®å®åŒ…å«çš„æ–‡ä»¶å è¯æ˜:æ˜ å°„å…³ç³»ç¡®å®å­˜åœ¨ å…ˆè¦äº†è§£sqlite3ä¸shellçš„è„šæœ¬æ€ä¹ˆäº¤äº’,å³ä»sqliteä¸­å¾—åˆ°çš„æ•°æ®å¦‚ä½•ä¼ é€’åˆ°shellä¸­ æŸ¥äº†ä¸€ä¸‹ sqlite3 ä¸ shelläº¤äº’å¤§æ¦‚ æœ‰ä¸¤ç§æ–¹å¼ echo / cat é€šè¿‡ç®¡é“ä¼ è¾“è¿›å» æ­¤æ—¶sqlite3 ä½œä¸º æ¥æ”¶ç«¯ sqlite3 xxx â€˜æŸ¥è¡¨è¯­å¥â€™ ç›´æ¥sqlite3æ‰§è¡ŒæŸ¥è¡¨è¯­å¥,æœ€åå¯ä»¥é€šè¿‡ç®¡é“ä¼ ç»™shellå¤„ç† åœ¨è¿™é‡Œé€‰æ‹©äº†ç¬¬2ç§ sqlite3æ–‡æ¡£ å¤§è‡´æ€è·¯æ˜¯ç”¨awk + sedå¾—åˆ°éŸ³é¢‘åä¸ä¹±ç å,åœ¨ç”¨mvå»ä¿®æ”¹åç§° å‚è€ƒè„šæœ¬å¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536#!/bin/bash## modify the path when you change the place which to store the music file## å·¥ç¨‹ç›®å½•,è‡ªå®šä¹‰music_file_path=\"xxx_Path\"cd ${music_file_path}## obtain datassqlite3 ting.sqlite 'select * from download_table' | awk -F \"|\" -v OFS='|' '{print $18,$3,$2}' &gt; mappersed -i \"\" \"s/ /_/g\" ./mappersed -i \"\" \"s/ï¼š/_/g\" ./mappersed -i \"\" \"s/:/_/g\" ./mappersed -i \"\" \"s/-/_/g\" ./mappersed -i \"\" \"s/ï¼Œ/_/g\" ./mappersed -i \"\" \"s/ï¼/_/g\" ./mappersed -i \"\" \"s/ï¼Ÿ/_/g\" ./mappersed -i \"\" \"s/ã€/_/g\" ./mapper## foreach the download directory to find the music namefor f in ./download/*do ## .downloadæ–‡ä»¶ ä»£è¡¨è¿˜æœªä¸‹è½½ è¿‡æ‰ # echo ${f##*.} if [ ${f##*.}x != \"download\"x ]; then cache_name=`basename ${f}` music_name=$(grep -r ${cache_name} ./mapper | awk -F \"|\" -v OFS='|' '{print $3}') echo ${cache_name} echo ${music_name} # echo ./download/${music_name}.mp3 mv ./download/${cache_name} ./download/${music_name}.mp3 fidone æ•ˆæœå›¾ æœ€åè¯•å¬äº†ä¸€ä¸‹,éŸ³é¢‘æ–‡ä»¶èƒ½æ­£å¸¸æ’­æ”¾,æ²¡æœ‰é—®é¢˜ å‚è€ƒ shellè„šæœ¬â€“ifåˆ¤æ–­ï¼ˆæ•°å­—æ¡ä»¶ã€å­—ç¬¦ä¸²æ¡ä»¶ï¼‰ Passing Command Line Variables to awk [simple awk tutorial](http://www.hcs.harvard.edu/ ~dholland/computers/awk.html) How to pass variables from awk to shell awkå˜é‡ä¼ é€’ç»™SHELL Set variable in current shell from awk Shellè·å–æ–‡ä»¶åç¼€å Linux shell ä¹‹ æå–æ–‡ä»¶åå’Œç›®å½•åçš„ä¸€äº›æ–¹æ³• How to replace space with comma using sed?","link":"/2017/02/18/iOSer-Himalayan-audio-file-export/"},{"title":"iOS9ä¸Šå¦‚ä½•å¯¼å‡ºå…¶ä»–åº”ç”¨çš„.ipaæ–‡ä»¶","text":"åœ¨iOS9ä»¥ä¸‹,å¯ä»¥ç”¨iTools,PPåŠ©æ‰‹ç­‰å·¥å…·å¯¼å‡ºå…¶ä»–åº”ç”¨çš„iPa,ä½†æ˜¯iOS9å¼€å§‹å°±ä¸è¡Œäº† æœç´¢å,æ ¹æ®ios9è¶Šç‹±åå¦‚ä½•å¤‡ä»½ipaï¼Ÿè¿™ç¯‡å¸–å­,å°è¯•ç”¨macç‰ˆçš„PPåŠ©æ‰‹åœ¨è¶Šç‹±çš„5s(9.3.2)ä¸Šå¯¼å‡ºiPa æŠ¥é”™ å®‰è£…äº†afc2add iPa iOS7.x patchesä¾ç„¶æ— æ³•å¯¼å‡º,ä¹Ÿè®¸winç‰ˆçš„å¯ä»¥ ä»å¼€å‘è€…çš„è§’åº¦,åº”è¯¥åªæ˜¯æƒ³è·å–å…¶ä»–åº”ç”¨çš„iPaæ–‡ä»¶,æä¾›ä¸€ä¸ªæ–¹æ³•,å…¶å®å’ŒiOSçš„ç‰ˆæœ¬æ²¡æœ‰å…³ç³»,åœ¨macä¸Šç”¨iTunesåœ¨AppStore*æœç´¢å¹¶ä¸‹è½½è¯¥åº”ç”¨,ä¸‹è½½çš„.ipaæ–‡ä»¶ä¼šä¿å­˜åœ¨~/Music/iTunes/iTunes Media/Mobile Applications,è‡³äºæ²™ç›’ä¿¡æ¯,å¼€å‘è€…è‡ªå·±å¼€å‘çš„å¯ä»¥é€šè¿‡Xcode*å¯¼å‡º,åˆ«äººåˆ«å‘çš„,è¶Šç‹±ç¯å¢ƒä¸‹ä¹Ÿå¯ä»¥çœ‹åˆ°ã€‚ æ›´æ–° 20170925åœ¨ iTunes 12.7 ä¸­, Apple ç§»é™¤äº†ä¸‹è½½ App çš„åŠŸèƒ½,ç›®å‰å·²å¤±æ•ˆ","link":"/2017/01/21/iOSer-How-to-export-the-ipa-file-for-other-apps-on-iOS9/"},{"title":"è¶Šç‹±ç¯å¢ƒä¸‹iOSå¦‚ä½•åˆ¶ä½œ.debç±»å‹çš„åº”ç”¨","text":"å‰è¨€ ä¸€èˆ¬çš„iOS*åº”ç”¨éƒ½æ˜¯.ipaæ ¼å¼çš„,Debæ ¼å¼æ˜¯Linuxä¸‹çš„ä¸€ç§æ‰“åŒ…æ–¹å¼,ç›¸æ¯”äº.ipaæ ¼å¼éœ€è¦è¯ä¹¦éªŒè¯é‚£äº›æ­¥éª¤,åœ¨è¶Šç‹±è®¾å¤‡ä¸‹.deb*æ–‡ä»¶çš„å®‰è£…å’Œå¸è½½éƒ½æ¯”è¾ƒå®¹æ˜“,ç”¨ç»ˆç«¯æŒ‡ä»¤å³å¯ã€‚ ç¯å¢ƒ macOS Sierra 10.12.3 æµç¨‹å¤§è‡´åˆ†ä¸º åˆ›å»ºå·¥ç¨‹ ç¼–è¯‘ å®‰è£… åˆ›å»ºå·¥ç¨‹ è¶Šç‹±ç¯å¢ƒä¸‹åˆ›å»ºå·¥ç¨‹ä¸€èˆ¬æœ‰ä¸¤ç§,ä¸€ç§æ˜¯æœ‰GUIæ¨¡æ¿çš„iOSOpenDev,Githubåœ°å€å·²ç»æ¯”è¾ƒä¹…æ—¶é—´ä¸æ›´æ–°äº†,å®‰è£…åçš„æ•ˆæœå›¾å¤§è‡´å¦‚ä¸‹: è¿˜æœ‰ä¸€ç§æ˜¯ç”¨theos,è¿™ä¸ªåœ¨ã€ŠiOSåº”ç”¨é€†å‘å·¥ç¨‹ã€‹ä¸­è§åˆ°çš„æ¯”è¾ƒå¤š,æœ¬æ–‡ä¸»è¦ä¹Ÿå°±ç”¨è¿™ç§æ–¹å¼åˆ›å»ºå·¥ç¨‹ã€‚ bla,bla,blaåœ¨æˆåŠŸå®‰è£…theoså,å°±å¯ä»¥å¼€å§‹äº† åˆ›å»ºå¥½çš„å·¥ç¨‹ç›®å½•å¦‚ä¸‹ ä¾æ¬¡è¿›è¡Œç®€å•è¯´æ˜ control æè¿°äº†è¿™ä¸ªdebåŒ…çš„ä¸€äº›ä¿¡æ¯ xxx.h xxx.mè¿™ä¸ªä¸ç”¨è¯´,iOSå·¥ç¨‹å¸ˆåº”è¯¥éƒ½çŸ¥é“ Makefile æè¿°äº†è¯¥å·¥ç¨‹å¦‚ä½•è¿›è¡Œç¼–è¯‘,å¼•å…¥thoes*çš„ä¸€äº›æ–‡ä»¶,å‚ä¸ç¼–è¯‘çš„.mæ–‡ä»¶(æ¯”å¦‚*DEBAppDelegate.m),è¦é“¾æ¥çš„åº“æ–‡ä»¶(æ¯”å¦‚ UIKit),å®‰è£…æˆåŠŸåè¦killçš„è¿›ç¨‹,å½“ç„¶è¿˜æœ‰å…¶ä»–å­—æ®µ,æ¯”å¦‚å¤„ç†å™¨çš„æ¶æ„,SDKçš„ç‰ˆæœ¬,è¿™äº›åœ¨ã€ŠiOSåº”ç”¨é€†å‘å·¥ç¨‹ã€‹ä¸­ä¹Ÿæœ‰è¯´æ˜ ç¼–è¯‘bla,bla,bla åœ¨.h,.m*ä¸­å†™å®Œä»£ç å,åˆ°å·¥ç¨‹ç›®å½•ä¸‹ *make package å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å®‰è£…ç¼–è¯‘,å¯èƒ½ç¼–è¯‘çš„è¿‡ç¨‹ä¼šå‡ºç°ä¸é€šè¿‡çš„æƒ…å†µ,åªè¦æ ¹æ®æŠ¥é”™çš„åŸå› ,ä¸ŠGoogleæˆ–stackoverflowæœç´¢ä¸€èˆ¬å°±èƒ½è§£å†³ã€‚è™½ç„¶ä¹Ÿæƒ³è´´å›¾è¯´æ˜æˆ‘é‡åˆ°çš„é—®é¢˜,ä½†æ˜¯å½“æ—¶æ²¡æœ‰è®°å½•ä¸‹æ¥,ä»¥åæœ‰ç©ºä¼šå†è¯•è¯•,æ¢ä¸ªè§’åº¦æƒ³,ä¸ºä»€ä¹ˆå†™blogå‘¢?å¦‚æœä¸å†™çš„è¯,ä»¥åå¿˜äº†,å°±æ²¡æœ‰åœ°æ–¹æ‰¾äº†,ä¸€å¼€å§‹å¤šç•™å¿ƒäº›,åé¢å¤§æ¦‚å°±å¯ä»¥çœåŠ›äº›å§ã€‚ ç¼–è¯‘æˆåŠŸå å¤šäº†ä¸¤ä¸ªç›®å½•objå’Œpackages,packageä¸‹å°±æ˜¯ç¼–è¯‘åçš„deb*åŒ…å,æ¯ç¼–è¯‘ä¸€æ¬¡,åé¢çš„-1,å°±ä¼š++*,è®°å½•ä½ æ˜¯ç¬¬å‡ æ¬¡æˆåŠŸç¼–è¯‘è¿™ä¸ªåŒ…å§ å®‰è£… å› ä¸ºç”ŸæˆdebåŒ…è¿˜æ˜¯è¦åˆ°æ‰‹æœºä¸Šè¿è¡Œæ‰è¡Œçš„,æ‰€ä»¥éœ€è¦ç”¨åˆ°scpè¿™ä¸ªæŒ‡ä»¤,è¶Šç‹±è®¾å¤‡ä¸€èˆ¬éƒ½ä¼šè£…opensshè¿™ä¸ªæ’ä»¶,æä¾›è¿œç¨‹ç™»é™†,æ–¹ä¾¿æ•°æ®ä¼ è¾“ã€‚ 1scp ./packages/com.coder.createdeb_0.0.1-1+debug_iphoneos-arm.deb root@192.168.5.105:/var/root/ è¿™ä¸ªé—®é¢˜å¤§è‡´æ˜¯å› ä¸ºIP*æ²¡å˜,è®¾å¤‡å˜äº†,è€Œ/.ssh/known_hostsæ–‡ä»¶ä¸­è®°å½•çš„æ˜¯åŸæ¥è®¾å¤‡çš„ä¿¡æ¯,è§£å†³æ–¹æ³•,åˆ é™¤/.ssh/known_hosts*ä¸­çš„è®°å½• å†è¯•ä¸€æ¬¡ sshç™»é™†è®¾å¤‡å,æŸ¥çœ‹rootçš„å®¶ç›®å½• å·²ç»åœ¨è®¾å¤‡ä¸Šäº† 1dpkg -i dpkg -i com.coder.createdeb_0.0.1-1+debug_iphoneos-arm.deb å½“ç„¶ä¹Ÿå¯ä»¥ä¸€æ¡é¾™æœåŠ¡,ç›´æ¥åœ¨Markfileçš„æœ€ä¸Šä¸€è¡ŒåŠ ä¸Šè¿œç¨‹è®¾å¤‡çš„IPåœ°å€ 1THEOS_DEVICE_IP = è¿œç¨‹è®¾å¤‡çš„IP å®‰è£…æŒ‡ä»¤æ”¹ä¸º 1make package install ç„¶åsshè¾“å…¥å¯†ç çš„è¿‡ç¨‹ä¹Ÿå¯ä»¥å»æ‰ å®‰è£…æˆåŠŸå,æ‰‹æœºæ¡Œé¢å¯èƒ½æ²¡æœ‰å‡ºç°å®‰è£…çš„debæ–‡ä»¶,è¿™æ—¶å€™å¯ä»¥æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤ 1su mobile -c uicache åº”ç”¨æˆªå›¾","link":"/2017/02/07/iOSer-How-to-create-a-deb-type-of-application-in-iOS/"},{"title":"ObjC Runtime ä¸­ Weak å±æ€§çš„å®ç° (ä¸Š)","text":"å‰è¨€ OC ä¸­çš„ weak å±æ€§æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œä¸ºä»€ä¹ˆåœ¨å¯¹è±¡é‡Šæ”¾åä¼šè‡ªåŠ¨å˜æˆ nilï¼Ÿæœ¬æ–‡å¯¹è¿™ä¸ªé—®é¢˜è¿›è¡Œäº†ä¸€ç‚¹æ¢è®¨ã€‚ ç¯å¢ƒ mac OS Sierra 10.12.4objc709 å‚è€ƒç­”æ¡ˆ æœç´¢åå‘ç°runtime å¦‚ä½•å®ç° weak å±æ€§ç»™å‡ºäº†ä¸€ä¸ªå‚è€ƒç­”æ¡ˆã€‚ runtime å¯¹æ³¨å†Œçš„ç±»ï¼Œ ä¼šè¿›è¡Œå¸ƒå±€ï¼Œå¯¹äº weak å¯¹è±¡ä¼šæ”¾å…¥ä¸€ä¸ª hash è¡¨ä¸­ã€‚ ç”¨ weak æŒ‡å‘çš„å¯¹è±¡å†…å­˜åœ°å€ä½œä¸º keyï¼Œå½“æ­¤å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º 0 çš„æ—¶å€™ä¼š deallocï¼Œå‡å¦‚ weak æŒ‡å‘çš„å¯¹è±¡å†…å­˜åœ°å€æ˜¯ a ï¼Œé‚£ä¹ˆå°±ä¼šä»¥ a ä¸ºé”®ï¼Œ åœ¨è¿™ä¸ª weak è¡¨ä¸­æœç´¢ï¼Œæ‰¾åˆ°æ‰€æœ‰ä»¥ a ä¸ºé”®çš„ weak å¯¹è±¡ï¼Œä»è€Œè®¾ç½®ä¸º nil ã€‚ æµ‹è¯• ä»£ç  123456789101112131415161718192021222324252627282930313233#import &lt;Foundation/Foundation.h&gt;@interface WeakProperty : NSObject@property (nonatomic,weak) NSObject *obj;@end@implementation WeakProperty- (void)dealloc { NSLog(@\"%s\",__func__);}@endint main(int argc, const char * argv[]) { @autoreleasepool { WeakProperty *property = [[WeakProperty alloc] init]; NSObject *obj = [[NSObject alloc] init]; property.obj = obj; NSLog(@\"%@\",property.obj); // ä¼šè§¦å‘å‡½æ•° ``id objc_initWeak(id *location, id newObj)`` // NSObject *obj = [[NSObject alloc] init]; // __weak NSObject *obj2 = obj; // ä¼šè§¦å‘å‡½æ•° ``void objc_copyWeak(id *dst, id *src)`` // __weak NSObject *obj3 = obj2; } return 0;} ç»“æœ å¯¹è±¡çš„ weak å±æ€§è°ƒç”¨ setter æ—¶ è°ƒç”¨ id objc_storeWeak(id *location, id newObj) è°ƒç”¨ static id storeWeak(id *location, objc_object *newObj)â€¦ ä½¿ç”¨ NSLog è¾“å‡º property.obj å±æ€§æ—¶ è°ƒç”¨ id objc_loadWeakRetained(id *location) å½“ dealloc é‡Šæ”¾å¯¹è±¡æ—¶ è°ƒç”¨ void objc_destroyWeak(id *location) ç›¸å…³å‡½æ•° æŸ¥çœ‹ NSObject.mm æºç å‘ç° id objc_storeWeak(id *location, id newObj) id objc_storeWeakOrNil(id *location, id newObj) id objc_initWeak(id *location, id newObj) id objc_initWeakOrNil(id *location, id newObj) void objc_destroyWeak(id *location) éƒ½è°ƒç”¨äº† static id storeWeak(id *location, objc_object *newObj) , objc_xxxWeakOrNil å¤šäº†ä¸€ç‚¹é¢å¤–çš„å¤„ç†ï¼Œä½†å¹¶ä¸å½±å“æ•´ä½“çš„ç†è§£ã€‚è€Œ void objc_destroyWeak(id *location) åœ¨è°ƒç”¨ static id storeWeak(id *location, objc_object *newObj) æ—¶ newObj å‚æ•°ä¼ é€’çš„æ˜¯ nil è¿™ä¸€ç‚¹ä¸ä¸Šé¢æåˆ°çš„å‚è€ƒç­”æ¡ˆä¸­å…³äº dealloc é‡Šæ”¾å¯¹è±¡æ—¶ï¼Œå°†å“ˆå¸Œè¡¨ä¸­æŒ‡å®šçš„é”®å¯¹åº”çš„å€¼è®¾ç½®ä¸º nil æ˜¯ç¬¦åˆçš„ã€‚ å°ç»“ storeWeak å‡½æ•°ç”¨äºä¸º weak å±æ€§èµ‹å€¼ (åŒ…æ‹¬é”€æ¯) objc_loadWeakRetained å‡½æ•°ç”¨äºè·å– weak å±æ€§ è§‚å¯Ÿ &amp; åˆ†æ å¯¹äºå‡½æ•° storeWeak ä¸»è¦åˆ†æä¸¤ç§æƒ…å†µä¸‹çš„è°ƒç”¨ èµ‹å€¼ï¼Œå³ id objc_storeWeak(id *location, id newObj) é”€æ¯ï¼Œå³ void objc_destroyWeak(id *location) è€Œå¯¹äº weak å±æ€§çš„è·å–ä¸»è¦åˆ†æ å‡½æ•° id objc_loadWeakRetained(id *location) è§‚å¯Ÿ: id objc_storeWeak(id *location, id newObj) 123456789101112131415/** * This function stores a new value into a __weak variable. It would * be used anywhere a __weak variable is the target of an assignment. * * @param location The address of the weak pointer itself * @param newObj The new object this weak ptr should now point to * * @return \\e newObj */idobjc_storeWeak(id *location, id newObj){ return storeWeak&lt;DoHaveOld, DoHaveNew, DoCrashIfDeallocating&gt; (location, (objc_object *)newObj);} è¯¥å‡½æ•°å•çº¯çš„è°ƒç”¨äº† storeWeak å‡½æ•° è§‚å¯Ÿ: void objc_destroyWeak(id *location) 1234567891011121314151617/** * Destroys the relationship between a weak pointer * and the object it is referencing in the internal weak * table. If the weak pointer is not referencing anything, * there is no need to edit the weak table. * * This function IS NOT thread-safe with respect to concurrent * modifications to the weak variable. (Concurrent weak clear is safe.) * * @param location The weak pointer address. */voidobjc_destroyWeak(id *location){ (void)storeWeak&lt;DoHaveOld, DontHaveNew, DontCrashIfDeallocating&gt; (location, nil);} è¯¥å‡½æ•°ä¹Ÿåªæ˜¯å•çº¯çš„è°ƒç”¨äº† storeWeak å‡½æ•° å‡½æ•° storeWeak æºç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687template &lt;HaveOld haveOld, HaveNew haveNew, CrashIfDeallocating crashIfDeallocating&gt;static id storeWeak(id *location, objc_object *newObj){ assert(haveOld || haveNew); if (!haveNew) assert(newObj == nil); Class previouslyInitializedClass = nil; id oldObj; SideTable *oldTable; SideTable *newTable; // Acquire locks for old and new values. // Order by lock address to prevent lock ordering problems. // Retry if the old value changes underneath us. retry: if (haveOld) { oldObj = *location; oldTable = &amp;SideTables()[oldObj]; } else { oldTable = nil; } if (haveNew) { newTable = &amp;SideTables()[newObj]; } else { newTable = nil; } SideTable::lockTwo&lt;haveOld, haveNew&gt;(oldTable, newTable); if (haveOld &amp;&amp; *location != oldObj) { SideTable::unlockTwo&lt;haveOld, haveNew&gt;(oldTable, newTable); goto retry; } // Prevent a deadlock between the weak reference machinery // and the +initialize machinery by ensuring that no // weakly-referenced object has an un-+initialized isa. if (haveNew &amp;&amp; newObj) { Class cls = newObj-&gt;getIsa(); if (cls != previouslyInitializedClass &amp;&amp; !((objc_class *)cls)-&gt;isInitialized()) { SideTable::unlockTwo&lt;haveOld, haveNew&gt;(oldTable, newTable); _class_initialize(_class_getNonMetaClass(cls, (id)newObj)); // If this class is finished with +initialize then we're good. // If this class is still running +initialize on this thread // (i.e. +initialize called storeWeak on an instance of itself) // then we may proceed but it will appear initializing and // not yet initialized to the check above. // Instead set previouslyInitializedClass to recognize it on retry. previouslyInitializedClass = cls; goto retry; } } // Clean up old value, if any. if (haveOld) { weak_unregister_no_lock(&amp;oldTable-&gt;weak_table, oldObj, location); } // Assign new value, if any. if (haveNew) { newObj = (objc_object *) weak_register_no_lock(&amp;newTable-&gt;weak_table, (id)newObj, location, crashIfDeallocating); // weak_register_no_lock returns nil if weak store should be rejected // Set is-weakly-referenced bit in refcount table. if (newObj &amp;&amp; !newObj-&gt;isTaggedPointer()) { newObj-&gt;setWeaklyReferenced_nolock(); } // Do not set *location anywhere else. That would introduce a race. *location = (id)newObj; } else { // No new value. The storage is not changed. } SideTable::unlockTwo&lt;haveOld, haveNew&gt;(oldTable, newTable); return (id)newObj;} å¯ä»¥ç»“åˆ lldb è¾¹è°ƒè¯•è¾¹å¯¹å…¶è¿›è¡Œåˆ†æï¼Œ åˆ†æ: id objc_storeWeak(id *location, id newObj) 123// Template parameters.enum HaveOld { DontHaveOld = false, DoHaveOld = true };enum HaveNew { DontHaveNew = false, DoHaveNew = true }; å¯¹äºæ¨¡æ¿å‚æ•°ï¼Œä¼ é€’çš„æ˜¯ DoHaveOld(true) &amp; DoHaveNew(true) åœ¨64ä½æ±‡ç¼–ä¸­ï¼Œå½“å‚æ•°å°‘äº7ä¸ªæ—¶ï¼Œ å‚æ•°ä»å·¦åˆ°å³æ”¾å…¥å¯„å­˜å™¨: rdi, rsi, rdx, rcx, r8, r9ã€‚æ­¤å¤„ location å’Œ newObj åˆ†åˆ«æ¥è‡ª rdi å’Œ rsiã€‚ æ ¹æ®æ³¨é‡ŠåŠ åœ°å€æ¯”è¾ƒï¼Œå¯çŸ¥ location ä¸º æŒ‡å‘å¼±å¼•ç”¨çš„åœ°å€ï¼ŒnewObj ä¸ºè¦æ±‚ å¼±å¼•ç”¨æŒ‡å‘çš„åœ°å€ï¼Œåœ¨å½“å‰åœºæ™¯ä¸‹ä¸ºèµ‹å€¼ç»™ WeakProperty çš„ obj å±æ€§çš„ obj å˜é‡ã€‚ åœ¨å½“å‰åœºæ™¯ä¸‹å³ä¸ºæ‰§è¡Œ storeWeak åï¼Œå†…å­˜åœ°å€ 0x0000000101301638 ä¸Šä¿å­˜çš„å€¼ä¸º 0x0000000101301490 é“ºå«: SideTable å…³äºç»“æ„ä½“ SideTableï¼Œåœ¨æœ¬æ–‡ä¸­å½“åšé»‘ç›’æ¥å¤„ç† 123456789101112131415161718192021222324struct SideTable { spinlock_t slock; RefcountMap refcnts; weak_table_t weak_table; SideTable() { memset(&amp;weak_table, 0, sizeof(weak_table)); } ~SideTable() { _objc_fatal(\"Do not delete SideTable.\"); } void lock() { slock.lock(); } void unlock() { slock.unlock(); } void forceReset() { slock.forceReset(); } // Address-ordered lock discipline for a pair of side tables. template&lt;HaveOld, HaveNew&gt; static void lockTwo(SideTable *lock1, SideTable *lock2); template&lt;HaveOld, HaveNew&gt; static void unlockTwo(SideTable *lock1, SideTable *lock2);}; å…³äº spinlock_tï¼ŒWiki ä¸Šå…³äº Spinlock è¯æ¡çš„è§£é‡Šå¦‚ä¸‹ In software engineering, a spinlock is a lock which causes a thread trying to acquire it to simply wait in a loop (â€œspinâ€) while repeatedly checking if the lock is available. Since the thread remains active but is not performing a useful task, the use of such a lock is a kind of busy waiting. Once acquired, spinlocks will usually be held until they are explicitly released, although in some implementations they may be automatically released if the thread being waited on (that which holds the lock) blocks, or â€œgoes to sleep. ä¾‹å­ 1234567891011121314151617181920212223242526272829303132333435363738; Intel syntaxlocked: ; The lock variable. 1 = locked, 0 = unlocked. dd 0 ; å®šä¹‰ lock å˜é‡ é»˜è®¤ä¸º 0 spin_lock: mov eax, 1 ; Set the EAX register to 1. ; è®¾ç½® EAX å¯„å­˜å™¨çš„å€¼ä¸º 1 xchg eax, [locked] ; Atomically swap the EAX register with ; the lock variable. ; This will always store 1 to the lock, leaving ; the previous value in the EAX register. ; äº¤æ¢ eax ä¸ lock å˜é‡çš„å€¼ï¼Œæ ¹æ®ä¸Šä¸€æ­¥å¯çŸ¥ï¼Œlock è‚¯å®šä¼šè¢«èµ‹å€¼ä¸º1 test eax, eax ; Test EAX with itself. Among other things, this will ; set the processor's Zero Flag if EAX is 0. ; If EAX is 0, then the lock was unlocked and ; we just locked it. ; Otherwise, EAX is 1 and we didn't acquire the lock. ; å°† EAX ä¸ è‡ªèº«æ¯”è¾ƒï¼Œå¦‚æœ EAX æ˜¯ 0 åˆ™è®¾ç½® Zeor Flag ï¼Œè¡¨æ˜å½“å‰æœªåŠ é”ï¼Œåªè¦åŠ é”æ“ä½œå³å¯ï¼Œåä¹‹è¯æ˜å·²è¢«åŠ é”ï¼Œä¸è®¾ç½® Zero Flagã€‚ jnz spin_lock ; Jump back to the MOV instruction if the Zero Flag is ; not set; the lock was previously locked, and so ; we need to spin until it becomes unlocked. ; å¦‚æœ Zero Flag æœªè¢«è®¾ç½®ï¼Œåˆ™è·³è½¬ç»§ç»­ spin_lock ret ; The lock has been acquired, return to the calling ; function. ; è·å¾—é”åï¼Œç»§ç»­æ‰§è¡Œ; å½“è·å¾—æ‰€çš„æ“ä½œæ‰§è¡Œå®Œæˆåï¼Œåˆ™ locked å˜æˆ 0ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å†æ¬¡è¿›è¡Œ spin_lock æ“ä½œ locked ä¸º 0ï¼Œå¯¼è‡´ EAX ä¸º0 ï¼Œé‡æ–°è·å¾—äº†é”ï¼ŒåŒæ—¶ locked å˜æˆ 1...spin_unlock: mov eax, 0 ; Set the EAX register to 0. xchg eax, [locked] ; Atomically swap the EAX register with ; the lock variable. ret ; The lock has been released. é…åˆ google çš„ç¿»è¯‘å¯çŸ¥ï¼Œè‡ªæ—‹é”ä¼šå¾ªç¯ç­‰å¾…ç›´åˆ°é”å¯ç”¨ã€‚ ä» weak_table_t ç»“æ„ä½“çš„æ³¨é‡Šè¯´æ˜äº†ï¼Œå®ƒä¼šä¿å­˜ ids å’Œ keys çš„å½¢å¼ä¿å­˜å¯¹è±¡ 12345678910/** * The global weak references table. Stores object ids as keys, * and weak_entry_t structs as their values. */struct weak_table_t { weak_entry_t *weak_entries; size_t num_entries; uintptr_t mask; uintptr_t max_hash_displacement;}; ç»“æ„ä½“ SideTable å¯çœ‹åšæ˜¯ä¸€ä¸ªå¸¦åŠ é”åŠŸèƒ½çš„é›†åˆï¼Œå…¶ä¸­çš„å…ƒç´ ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜æ”¾ã€‚ åœ¨ ObjC çš„å…¥å£å‡½æ•° _objc_init ä¼šè°ƒç”¨å‡½æ•° arr_init æ¥åˆå§‹åŒ– SideTableBuf é™æ€å˜é‡ æ­£æ–‡: id objc_storeWeak(id *location, id newObj) è¿›å…¥ if (haveOld) æ¡ä»¶ åˆ›å»ºæ–°å…ƒç´ ï¼Œå› æ­¤ location åœ°å€çš„åŸå€¼ä¸º nil è¿›å…¥ SideTables() å‡½æ•° 123static StripedMap&lt;SideTable&gt;&amp; SideTables() { return *reinterpret_cast&lt;StripedMap&lt;SideTable&gt;*&gt;(SideTableBuf);} å…³äº reinterpret_cast çš„è®¨è®º reinterpret_cast is the most dangerous cast, and should be used very sparingly. It turns one type directly into another - such as casting the value from one pointer to another, or storing a pointer in an int, or all sorts of other nasty things. Largely, the only guarantee you get with reinterpret_cast is that normally if you cast the result back to the original type, you will get the exact same value (but not if the intermediate type is smaller than the original type). There are a number of conversions that reinterpret_cast cannot do, too. Itâ€™s used primarily for particularly weird conversions and bit manipulations, like turning a raw data stream into actual data, or storing data in the low bits of an aligned pointer. å®ƒæ˜¯ä¸€ç§ç±»å‹å¼ºè½¬çš„æ–¹å¼ SideTableBuf æ˜¯å¤§å°ä¸º 4096 çš„ SideTable ç¼“å­˜æ•°ç»„ï¼Œ oldTable çš„èµ‹å€¼ç›¸å½“äºåœ¨å–æ•°ç»„å…ƒç´ ï¼Œnil å¯çœ‹æˆ 0 ï¼Œå³å–ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ åŒç†ï¼ŒhaveNew ä¸º true ï¼ŒnewTable æ˜¯ä»¥ newObj ä¸ºç´¢å¼•åœ¨ SideTabBuf ä¸­ æŸ¥æ‰¾å…ƒç´ ã€‚ è°ƒç”¨ SideTable::lockTwo æ–¹æ³• 1SideTable::lockTwo&lt;haveOld, haveNew&gt;(oldTable, newTable); è¿›å…¥ SideTable::lockTwo æ–¹æ³• 123456template&lt;&gt;void SideTable::lockTwo&lt;DoHaveOld, DoHaveNew&gt; (SideTable *lock1, SideTable *lock2){ spinlock_t::lockTwo(&amp;lock1-&gt;slock, &amp;lock2-&gt;slock);} è¿›å…¥ lockTwo æ–¹æ³• 1234567891011// Address-ordered lock discipline for a pair of locks.static void lockTwo(mutex_tt *lock1, mutex_tt *lock2) { if (lock1 &lt; lock2) { lock1-&gt;lock(); lock2-&gt;lock(); } else { lock2-&gt;lock(); if (lock2 != lock1) lock1-&gt;lock(); }} åˆ¤æ–­ if (haveOld &amp;&amp; *location != oldObj) æ¡ä»¶ haveOld &amp;&amp; *location != oldObj ï¼ŒoldObj è¢«èµ‹å€¼ä¸º *location æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸¤è€…ç›¸ç­‰ï¼Œä¸ç­‰è¯´æ˜å‡ºäº†é—®é¢˜ï¼Œç®—æ˜¯å®¹é”™ã€‚ åˆ¤æ–­ if (haveNew &amp;&amp; newObj) æ¡ä»¶ haveNew &amp;&amp; newObj æ ¹æ®æ³¨é‡Šå¯çŸ¥ä¹Ÿæ˜¯ä¸€ä¸ªå®¹é”™çš„å¤„ç† æ¸…é™¤æ—§å€¼ 123if (haveOld) { weak_unregister_no_lock(&amp;oldTable-&gt;weak_table, oldObj, location);} èµ‹äºˆæ–°å€¼ 123456789101112131415161718// Assign new value, if any.if (haveNew) { newObj = (objc_object *) weak_register_no_lock(&amp;newTable-&gt;weak_table, (id)newObj, location, crashIfDeallocating); // weak_register_no_lock returns nil if weak store should be rejected // Set is-weakly-referenced bit in refcount table. if (newObj &amp;&amp; !newObj-&gt;isTaggedPointer()) { newObj-&gt;setWeaklyReferenced_nolock(); } // Do not set *location anywhere else. That would introduce a race. *location = (id)newObj;}else { // No new value. The storage is not changed.} ä»¥ location ä¸º key,ä»¥ newObj ä¸ºå€¼ä¿å­˜åˆ°å¯¹åº”çš„ weak_table_t çš„ç»“æ„ä½“ä¸­ è°ƒç”¨ SideTable::unlockTwo æ–¹æ³• 1SideTable::unlockTwo&lt;haveOld, haveNew&gt;(oldTable, newTable); åˆ†æ: void objc_destroyWeak(id *location) å› ä¸ºä¼ é€’çš„æ¨¡æ¿å‚æ•°ä¸º DontHaveNew ï¼Œå½“é‡Šæ”¾æ‰æ—§å€¼åï¼Œä¸ä¼šå†è¿›å…¥ if (haveNew) æ¡ä»¶ä¸­è·å¾—æ–°å€¼ã€‚ åˆ†æ: id objc_loadWeakRetained(id *location) 1234567retry: // fixme std::atomic this load obj = *location; ... result = obj; ... return result é€šè¿‡ * å–å€¼ç¬¦å·æ“ä½œ location ï¼Œè·å¾—å¼±å¼•ç”¨æŒ‡å‘çš„åœ°å€ã€‚ æ€»ç»“ æœ¬æ–‡é€šè¿‡å¯¹ ObjC è¿è¡Œæ—¶ç²—ç•¥åˆ†æï¼Œæ¥äº†è§£ weak å±æ€§æ˜¯å¦‚ä½•è¿›è¡Œå­˜å‚¨ï¼Œä½¿ç”¨ä¸é‡Šæ”¾çš„ã€‚ObjC çš„ç±»ç»“æ„ä¸­ä¸€ä¸ªé™æ€çš„é”®å€¼å¯¹è¡¨å˜é‡ï¼Œå®ƒä¿å­˜ç€å¯¹è±¡çš„å¼±å¼•ç”¨å±æ€§ï¼Œå…¶ä¸­çš„é”®ä¸ºæŒ‡å‘å¼±å¼•ç”¨çš„å†…å­˜åœ°å€ï¼Œå€¼ä¸ºå¼±å¼•ç”¨ï¼Œå½“å¯¹è±¡é”€æ¯æ—¶é€šè¿‡é”®æŸ¥è¡¨ï¼Œç„¶åå°†å¯¹åº”çš„å¼±å¼•ç”¨ä»è¡¨ä¸­ç§»é™¤ã€‚ å‚è€ƒ When should static_cast, dynamic_cast, const_cast and reinterpret_cast be used? The LLDB Debugger 64ä½æ±‡ç¼–å‚æ•°ä¼ é€’ Wiki - Spinlock alignas specifier 4.3.7. MOV and MVN","link":"/2017/05/29/iOSer-Implementation-of-Weak-Attribute-in-ObjC-Runtime-Part1/"},{"title":"ObjC Runtime ä¸­ Weak å±æ€§çš„å®ç° (ä¸­)","text":"å¯¼è¯­ åœ¨ä¸Šä¸€ç¯‡ä¸­ç®€å•åˆ†æäº† Weak å±æ€§æ˜¯å¦‚ä½•è¢«å­˜å‚¨ï¼Œè·å–å’Œé”€æ¯çš„ï¼Œå…¶ä¸­çš„ SideTable ç»“æ„ä½“å½“åšé»‘ç›’è¿›è¡Œå¤„ç†ã€‚æœ¬æ–‡å°è¯•å¯¹ SideTable çš„ç»“æ„è¿›è¡Œä¸€äº›åˆ†æã€‚ è§‚å¯Ÿ 123456789101112131415161718192021222324struct SideTable { spinlock_t slock; RefcountMap refcnts; weak_table_t weak_table; SideTable() { memset(&amp;weak_table, 0, sizeof(weak_table)); } ~SideTable() { _objc_fatal(\"Do not delete SideTable.\"); } void lock() { slock.lock(); } void unlock() { slock.unlock(); } void forceReset() { slock.forceReset(); } // Address-ordered lock discipline for a pair of side tables. template&lt;HaveOld, HaveNew&gt; static void lockTwo(SideTable *lock1, SideTable *lock2); template&lt;HaveOld, HaveNew&gt; static void unlockTwo(SideTable *lock1, SideTable *lock2);}; SideTable ä¸»è¦åˆ†ä¸º 3 éƒ¨åˆ† weak_table_t: weak å¼•ç”¨çš„å…¨å±€ hash è¡¨ RefcountMap : å¼•ç”¨è®¡æ•°çš„ hash è¡¨ slock: ä¿è¯åŸå­æ“ä½œçš„è‡ªæ—‹é” åœ¨ static id storeWeak(id *location, objc_object *newObj) æ–¹æ³•ä¸­æœ‰ 123456789101112131415// Assign new value, if any.if (haveNew) { newObj = (objc_object *) weak_register_no_lock(&amp;newTable-&gt;weak_table, (id)newObj, location, crashIfDeallocating); // weak_register_no_lock returns nil if weak store should be rejected // Set is-weakly-referenced bit in refcount table. if (newObj &amp;&amp; !newObj-&gt;isTaggedPointer()) { newObj-&gt;setWeaklyReferenced_nolock(); } // Do not set *location anywhere else. That would introduce a race. *location = (id)newObj;} å¯çŸ¥å¯¹äºå¼±å¼•ç”¨å˜é‡çš„ä¿å­˜ï¼Œä¸»è¦è¿˜æ˜¯çœ‹ weak_table è¿™ä¸ªå±æ€§ æµ‹è¯•ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041#import &lt;Foundation/Foundation.h&gt;@interface WeakProperty : NSObject@property (nonatomic,weak) NSObject *obj;@property (nonatomic,weak) NSObject *obj2;@property (nonatomic,weak) NSObject *obj3;@property (nonatomic,weak) NSObject *obj4;@property (nonatomic,weak) NSObject *obj5;@end@implementation WeakProperty- (void)dealloc { NSLog(@\"%s\",__func__);}@endint main(int argc, const char * argv[]) { @autoreleasepool { WeakProperty *property = [[WeakProperty alloc] init]; NSObject *obj = [[NSObject alloc] init]; property.obj = obj; NSLog(@\"%@\",property.obj); // [1] property.obj2 = obj; // [2] property.obj3 = obj; property.obj4 = obj; property.obj5 = obj; // [3] property.obj = nil; } return 0;} ç»“æ„ä½“: weak_table_t weak_table_t çš„å®šä¹‰åœ¨ objc-weak.h ä¸­ 12345678910/** * The global weak references table. Stores object ids as keys, * and weak_entry_t structs as their values. */struct weak_table_t { weak_entry_t *weak_entries; size_t num_entries; uintptr_t mask; uintptr_t max_hash_displacement;}; è¯´æ˜: ä¸€ä¸ªæŒ‡å‘ weak_entry_t çš„æŒ‡é’ˆ size_t(å³ unsigned ) ç±»å‹çš„ num_entries ï¼Œç”¨äºæè¿° hash è¡¨çš„é•¿åº¦ uintptr_t(å³ unsigned long) ç±»å‹çš„ mask(æ©ç ) uintptr_t(å³ unsigned long) ç±»å‹çš„ max_hash_displacement ç»“æ„ä½“: weak_entry_t 12345678910111213141516171819202122232425262728293031323334struct weak_entry_t { DisguisedPtr&lt;objc_object&gt; referent; union { struct { weak_referrer_t *referrers; uintptr_t out_of_line_ness : 2; uintptr_t num_refs : PTR_MINUS_2; uintptr_t mask; uintptr_t max_hash_displacement; }; struct { // out_of_line_ness field is low bits of inline_referrers[1] weak_referrer_t inline_referrers[WEAK_INLINE_COUNT]; }; }; bool out_of_line() { return (out_of_line_ness == REFERRERS_OUT_OF_LINE); } weak_entry_t&amp; operator=(const weak_entry_t&amp; other) { memcpy(this, &amp;other, sizeof(other)); return *this; } weak_entry_t(objc_object *newReferent, objc_object **newReferrer) : referent(newReferent) { inline_referrers[0] = newReferrer; for (int i = 1; i &lt; WEAK_INLINE_COUNT; i++) { inline_referrers[i] = nil; } }}; åœ¨ C++ ä¸­ï¼Œç»“æ„ä½“æ˜¯ç”±å…³é”®è¯ struct å®šä¹‰çš„ä¸€ç§æ•°æ®ç±»å‹ã€‚ä»–çš„æˆå‘˜å’ŒåŸºç±»é»˜è®¤ä¸ºå…¬æœ‰çš„ï¼ˆpublicï¼‰ã€‚ç”±å…³é”®è¯ class å®šä¹‰çš„æˆå‘˜å’ŒåŸºç±»é»˜è®¤ä¸ºç§æœ‰çš„ï¼ˆprivateï¼‰ã€‚è¿™æ˜¯ C++ ä¸­ ç»“æ„ä½“å’Œç±»ä»…æœ‰çš„åŒºåˆ«ã€‚ ç±»: DisguisedPtr 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950// DisguisedPtr&lt;T&gt; acts like pointer type T*, except the // stored value is disguised to hide it from tools like `leaks`.// nil is disguised as itself so zero-filled memory works as expected, // which means 0x80..00 is also disguised as itself but we don't care.// Note that weak_entry_t knows about this encoding.template &lt;typename T&gt;class DisguisedPtr { uintptr_t value; // unsigned long static uintptr_t disguise(T* ptr) { return -(uintptr_t)ptr; } static T* undisguise(uintptr_t val) { return (T*)-val; } public: DisguisedPtr() { } DisguisedPtr(T* ptr) : value(disguise(ptr)) { } DisguisedPtr(const DisguisedPtr&lt;T&gt;&amp; ptr) : value(ptr.value) { } DisguisedPtr&lt;T&gt;&amp; operator = (T* rhs) { value = disguise(rhs); return *this; } DisguisedPtr&lt;T&gt;&amp; operator = (const DisguisedPtr&lt;T&gt;&amp; rhs) { value = rhs.value; return *this; } // é‡è½½äº†ä¸€äº›æŒ‡é’ˆçš„è¿ç®—ç¬¦ operator T* () const { return undisguise(value); } T* operator -&gt; () const { return undisguise(value); } T&amp; operator * () const { return *undisguise(value); } T&amp; operator [] (size_t i) const { return undisguise(value)[i]; } // pointer arithmetic operators omitted // because we don't currently use them anywhere}; 1234// The address of a __weak variable.// These pointers are stored disguised so memory analysis tools// don't see lots of interior pointers from the weak table into objects.typedef DisguisedPtr&lt;objc_object *&gt; weak_referrer_t; å°ç»“ weak_entry_t åŒ…å«ä¸€ä¸ª DisguisedPtr&lt;objc_object&gt;,Disguised æ˜¯ä¼ªè£…çš„æ„æ€ï¼Œæ ¹æ®æ³¨é‡Šå¯çŸ¥ï¼Œå¯ä»¥å°† DisguisedPtr&lt;T&gt; å½“æˆ T * æŒ‡é’ˆç±»å‹å³å¯ï¼Œåœ¨å½“å‰åœºæ™¯å¯çœ‹ä½œæ˜¯ä¸€ä¸ªæŒ‡å‘ objc_object çš„æŒ‡é’ˆç±»å‹ weak_referrer_t æ˜¯ DisguisedPtr&lt;objc_object *&gt; å¯ä»¥çœ‹æˆæ˜¯ objc_object æŒ‡é’ˆçš„åœ°å€ æ¥ç€æ˜¯ä¸€ä¸ª union ï¼Œout_of_line_ness ä¸ inline_referrers[1] å…±ç”¨äº†ä½ 2 ä½ï¼Œå› ä¸º 123456// out_of_line_ness field overlaps with the low two bits of inline_referrers[1].// inline_referrers[1] is a DisguisedPtr of a pointer-aligned address.// The low two bits of a pointer-aligned DisguisedPtr will always be 0b00// (disguised nil or 0x80..00) or 0b11 (any other address).// Therefore out_of_line_ness == 0b10 is used to mark the out-of-line state.#define REFERRERS_OUT_OF_LINE 2 æ³¨é‡Šè¯´æ˜äº† DisuisedPtr çš„ä½ 2 ä½ä¸æ˜¯ 0b00 å°±æ˜¯ 0b11ï¼Œæ‰€ä»¥è¦è¡¨ç¤º out-of-line åªèƒ½ä½¿ç”¨ out_of_line_ness == 0b10 (å½“ out_of_line_ness ä¸º 0b01 æˆ– 0b10 ä¼šåˆ†åˆ«å¾—åˆ° false å’Œ true ) num_refs å  30 (32ä½ç³»ç»Ÿ) / 62(64ä½ç³»ç»Ÿ) ä½mask å’Œ max_hash_displacement åœ¨ weak_table_t ä¸­ä¹Ÿæœ‰ã€‚ out_of_line() æ–¹æ³•åœ¨ä¸Šé¢ç®—æ˜¯å·²ç»è¯´è¿‡äº† weak_entry_t&amp; operator=(const weak_entry_t&amp; other) {...} é‡è½½è¿ç®—ç¬¦ = The memcpy() function copies n bytes from memory area srcto memory area dest. The memory areas may not overlap.Use memmove(3) if the memory areas do overlap. ä»å‚æ•° other æ‰€æŒ‡çš„å†…å­˜åœ°å€çš„èµ·å§‹ä½ç½®å¼€å§‹æ‹·è´ sizeof(other) å­—èŠ‚åˆ° this æŒ‡é’ˆæŒ‡å‘çš„å½“å‰å¯¹è±¡çš„èµ·å§‹åœ°å€ã€‚ weak_entry_t(objc_object *newReferent, objc_object **newReferrer) : referent(newReferent) : referent(newReferent) æ˜¯åˆå§‹åŒ–åˆ—è¡¨ï¼Œä»£è¡¨ç”¨å‚æ•° newReferentæ¥åˆå§‹åŒ–ç»“æ„ä½“ä¸­çš„ referent å±æ€§ã€‚è”åˆç±»å‹ä¸­çš„ inline_referrers[0] æ¥æ”¶å‚æ•° newReferrer ï¼Œå¹¶å°†å‰©ä¸‹çš„ 1ï¼Œ2ï¼Œ3 éƒ½ç½®ä¸º nil å‡½æ•°: weak_register_no_lock æ³¨é‡Š [2] &amp; [3] 1234/// Adds an (object, weak pointer) pair to the weak table./// æ·»åŠ ä¸€ä¸ª (å¯¹è±¡ï¼Œå¼±å¼•ç”¨æŒ‡é’ˆï¼‰åˆ° weak hash è¡¨ä¸­id weak_register_no_lock(weak_table_t *weak_table, id referent, id *referrer, bool crashIfDeallocating); å…·ä½“å®ç°å¦‚ä¸‹: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061/** * Registers a new (object, weak pointer) pair. Creates a new weak * object entry if it does not exist. * * @param weak_table The global weak table. * @param referent The object pointed to by the weak reference. * @param referrer The weak pointer address. */id weak_register_no_lock(weak_table_t *weak_table, id referent_id, id *referrer_id, bool crashIfDeallocating){ objc_object *referent = (objc_object *)referent_id; objc_object **referrer = (objc_object **)referrer_id; if (!referent || referent-&gt;isTaggedPointer()) return referent_id; // ensure that the referenced object is viable bool deallocating; if (!referent-&gt;ISA()-&gt;hasCustomRR()) { deallocating = referent-&gt;rootIsDeallocating(); } else { BOOL (*allowsWeakReference)(objc_object *, SEL) = (BOOL(*)(objc_object *, SEL)) object_getMethodImplementation((id)referent, SEL_allowsWeakReference); if ((IMP)allowsWeakReference == _objc_msgForward) { return nil; } deallocating = ! (*allowsWeakReference)(referent, SEL_allowsWeakReference); } if (deallocating) { if (crashIfDeallocating) { _objc_fatal(\"Cannot form weak reference to instance (%p) of \" \"class %s. It is possible that this object was \" \"over-released, or is in the process of deallocation.\", (void*)referent, object_getClassName((id)referent)); } else { return nil; } } // now remember it and where it is being stored weak_entry_t *entry; if ((entry = weak_entry_for_referent(weak_table, referent))) { append_referrer(entry, referrer); } else { weak_entry_t new_entry(referent, referrer); weak_grow_maybe(weak_table); weak_entry_insert(weak_table, &amp;new_entry); } // Do not set *referrer. objc_storeWeak() requires that the // value not change. return referent_id;} å¼±å¼•ç”¨å±æ€§ obj åœ¨å‡½æ•° weak_register_no_lock ä¸­ä¼ é€’ç»™è¡Œå‚ referent_idï¼Œ èµ‹å€¼ç»™å±€éƒ¨å˜é‡ referent ï¼Œlocation ä¼ é€’ç»™å½¢å‚ referrer_idï¼Œèµ‹å€¼ç»™å±€éƒ¨å˜é‡ referrerã€‚ ç»è¿‡ä¸€äº›æ£€æŸ¥ï¼Œæ¯”å¦‚æ˜¯å¦å…è®¸å¼±å¼•ç”¨ï¼Œå¼±å¼•ç”¨å¯¹è±¡æ˜¯å¦å¯ç”¨ã€‚ 123456789101112131415161718192021222324252627282930313233/** * Return the weak reference table entry for the given referent. * If there is no entry for referent, return NULL. * Performs a lookup. * * @param weak_table * @param referent The object. Must not be nil. * * @return The table of weak referrers to this object. */static weak_entry_t *weak_entry_for_referent(weak_table_t *weak_table, objc_object *referent){ assert(referent); weak_entry_t *weak_entries = weak_table-&gt;weak_entries; if (!weak_entries) return nil; size_t begin = hash_pointer(referent) &amp; weak_table-&gt;mask; size_t index = begin; size_t hash_displacement = 0; while (weak_table-&gt;weak_entries[index].referent != referent) { index = (index+1) &amp; weak_table-&gt;mask; if (index == begin) bad_weak_table(weak_table-&gt;weak_entries); hash_displacement++; if (hash_displacement &gt; weak_table-&gt;max_hash_displacement) { return nil; } } return &amp;weak_table-&gt;weak_entries[index];} æ ¹æ® referent ä¸º key ï¼Œåœ¨ weak_table ä¸­é€šè¿‡éå† weak_entries æ•°ç»„ï¼Œå¯¹referent å±æ€§å€¼è¿›è¡Œæ¯”è¾ƒçš„æ–¹å¼æ¥æŸ¥æ‰¾å…ƒç´ ï¼Œæœªæ‰¾åˆ°ï¼Œèµ° else 12345678weak_entry_t(objc_object *newReferent, objc_object **newReferrer) : referent(newReferent){ inline_referrers[0] = newReferrer; for (int i = 1; i &lt; WEAK_INLINE_COUNT; i++) { inline_referrers[i] = nil; }} æ‰§è¡Œ weak_entry_t ç»“æ„ä½“çš„åˆå§‹åŒ– é€šè¿‡å¼ºè½¬æ“ä½œæ¥ä¼ªè£…æŒ‡é’ˆã€‚æ¥æ”¶ newReferrer å³ referrer ä¸º inline_referrers[0] åœ¨è¿™é‡Œ *referrer ç­‰äº nil æ‰€ä»¥ inline_referres æ•°ç»„å…ƒç´ å…¨æŒ‡å‘ nilï¼Œå› ä¸ºæ˜¯æ— ç¬¦å·é•¿æ•´æ•°ï¼Œå› æ­¤å°±æ˜¯ 0ã€‚ å‡½æ•°: weak_grow_maybe å½“å¼±å¼•ç”¨çš„ hash è¡¨çš„ç©ºé—´ä½¿ç”¨ç‡è¾¾åˆ° 3/4 åï¼Œæ‰©å…… hash è¡¨ 12345678910// Grow the given zone's table of weak references if it is full.static void weak_grow_maybe(weak_table_t *weak_table){ size_t old_size = TABLE_SIZE(weak_table); // Grow if at least 3/4 full. if (weak_table-&gt;num_entries &gt;= old_size * 3 / 4) { weak_resize(weak_table, old_size ? old_size*2 : 64); }} å‡½æ•°: weak_entry_insert æ·»åŠ å…ƒç´ åˆ°å¼±å¼•ç”¨çš„ hash è¡¨ä¸­ 12345678910111213141516171819202122232425/** * Add new_entry to the object's table of weak references. * Does not check whether the referent is already in the table. */static void weak_entry_insert(weak_table_t *weak_table, weak_entry_t *new_entry){ weak_entry_t *weak_entries = weak_table-&gt;weak_entries; assert(weak_entries != nil); size_t begin = hash_pointer(new_entry-&gt;referent) &amp; (weak_table-&gt;mask); size_t index = begin; size_t hash_displacement = 0; while (weak_entries[index].referent != nil) { index = (index+1) &amp; weak_table-&gt;mask; if (index == begin) bad_weak_table(weak_entries); hash_displacement++; } weak_entries[index] = *new_entry; weak_table-&gt;num_entries++; if (hash_displacement &gt; weak_table-&gt;max_hash_displacement) { weak_table-&gt;max_hash_displacement = hash_displacement; }} è·å– new_entry çš„ referent å±æ€§ï¼Œå³å¼±å¼•ç”¨çš„ obj å±æ€§ï¼Œä»¥å…¶åœ°å€çš„æ— ç¬¦å·é•¿æ•´æ•°å–ç›¸åæ•°æ¥åšå‚æ•°ï¼Œé€šè¿‡ç§»ä½ä¸ä½ç§»è¿›è¡Œ hash æ“ä½œï¼Œé€šè¿‡ weak_table-&gt;mask(63 = 0b111111) æ©ç ä¿ç•™ hash æ“ä½œåçš„ä½ 6 ä½( 64 ä½ç³»ç»Ÿ),ä½œä¸ºç´¢å¼•ï¼Œæ¥ä¸‹æ¥ç”¨ while (weak_entries[index].referent != nil) {...} ï¼Œè§£å†³ hash ç¢°æ’çš„é—®é¢˜ã€‚ç„¶åæ·»åŠ åˆ° hash è¡¨ä¸­ï¼Œä¿®æ”¹è¡¨çš„é•¿åº¦ æ•ˆæœå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œstatic id storeWeak(id *location, objc_object *newObj) çš„ location å’Œ newObj åˆ†åˆ«è¢«ä¿å­˜åˆ° weak_table_t ç»“æ„ä½“çš„ referent ï¼Œinline_referrers æ•°ç»„çš„é¦–ä½ã€‚ æŸ¥æ‰¾ referent æ˜¯å¦å­˜åœ¨çš„æ¡ä»¶æ˜¯ 12345678while (weak_table-&gt;weak_entries[index].referent != referent) { index = (index+1) &amp; weak_table-&gt;mask; if (index == begin) bad_weak_table(weak_table-&gt;weak_entries); hash_displacement++; if (hash_displacement &gt; weak_table-&gt;max_hash_displacement) { return nil; }} æ³¨é‡Š [2] &amp; [3] è¿›å…¥ append_referrer å‡½æ•°å 12345678if (! entry-&gt;out_of_line()) { // Try to insert inline. for (size_t i = 0; i &lt; WEAK_INLINE_COUNT; i++) { if (entry-&gt;inline_referrers[i] == nil) { entry-&gt;inline_referrers[i] = new_referrer; return; } } å› ä¸º entry-&gt; out_of_line() ç­‰äº false ä¼šå°è¯•æ·»åŠ åˆ° (entry-&gt;inline_referrers æ•°ç»„ä¸­ã€‚ å–æ¶ˆ [2] çš„æ³¨é‡Šï¼Œå› ä¸ºå·²ç»è¾¾åˆ° 4 ä¸ªï¼Œæ‰€ä»¥åœ¨ obj5 æ—¶ï¼Œä¼šæ‰©å……ã€‚ 1234567891011// Couldn't insert inline. Allocate out of line.weak_referrer_t *new_referrers = (weak_referrer_t *) calloc(WEAK_INLINE_COUNT, sizeof(weak_referrer_t));// This constructed table is invalid, but grow_refs_and_insert// will fix it and rehash it.for (size_t i = 0; i &lt; WEAK_INLINE_COUNT; i++) { new_referrers[i] = entry-&gt;inline_referrers[i];}entry-&gt;referrers = new_referrers;entry-&gt;num_refs = WEAK_INLINE_COUNT;entry-&gt;out_of_line_ness = REFERRERS_OUT_OF_LINE; ä¼šè®¾ç½® entry-&gt;out_of_line_ness ä¸º REFERRERS_OUT_OF_LINE ç»“åˆæ³¨é‡Š 1234567/** * The internal structure stored in the weak references table. * It maintains and stores * a hash set of weak references pointing to an object. * If out_of_line_ness != REFERRERS_OUT_OF_LINE then the set * is instead a small inline array. */ å¯çŸ¥å½“ weak å˜é‡å¼•ç”¨æ•°é‡ä¸å¤šäº 4 ä¸ªæ—¶ï¼Œä¼šä½¿ç”¨æ•°ç»„æ–¹å¼è¿›è¡Œå­˜å‚¨ï¼Œè€Œå¤šäº 4 ä¸ªåä¼šç”¨ hash è¡¨çš„æ–¹å¼è¿›è¡Œå­˜å‚¨ã€‚ å‡½æ•°: weak_unregister_no_lock123/// Removes an (object, weak pointer) pair from the weak table./// ä» weak hash è¡¨ä¸­ç§»é™¤ä¸€ä¸ª(å¯¹è±¡ï¼Œå¼±å¼•ç”¨æŒ‡é’ˆï¼‰void weak_unregister_no_lock(weak_table_t *weak_table, id referent, id *referrer); å…·ä½“å®ç°å¦‚ä¸‹: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849/** * Unregister an already-registered weak reference. * This is used when referrer's storage is about to go away, but referent * isn't dead yet. (Otherwise, zeroing referrer later would be a * bad memory access.) * Does nothing if referent/referrer is not a currently active weak reference. * Does not zero referrer. * * FIXME currently requires old referent value to be passed in (lame) * FIXME unregistration should be automatic if referrer is collected * * @param weak_table The global weak table. * @param referent The object. * @param referrer The weak reference. */voidweak_unregister_no_lock(weak_table_t *weak_table, id referent_id, id *referrer_id){ objc_object *referent = (objc_object *)referent_id; objc_object **referrer = (objc_object **)referrer_id; weak_entry_t *entry; if (!referent) return; if ((entry = weak_entry_for_referent(weak_table, referent))) { remove_referrer(entry, referrer); bool empty = true; if (entry-&gt;out_of_line() &amp;&amp; entry-&gt;num_refs != 0) { empty = false; } else { for (size_t i = 0; i &lt; WEAK_INLINE_COUNT; i++) { if (entry-&gt;inline_referrers[i]) { empty = false; break; } } } if (empty) { weak_entry_remove(weak_table, entry); } } // Do not set *referrer = nil. objc_storeWeak() requires that the // value not change.} åŒæ ·æ˜¯ä½¿ç”¨ weak_entry_for_referent å‡½æ•°æŸ¥æ‰¾å¼±å¼•ç”¨æ˜¯å¦å­˜åœ¨ æ³¨é‡Š [1] &amp; [2] ï¼Œå–æ¶ˆæ³¨é‡Š [3] 1234567891011121314151617181920212223242526272829303132333435363738/** * Remove old_referrer from set of referrers, if it's present. * Does not remove duplicates, because duplicates should not exist. * * @todo this is slow if old_referrer is not present. Is this ever the case? * * @param entry The entry holding the referrers. * @param old_referrer The referrer to remove. */static void remove_referrer(weak_entry_t *entry, objc_object **old_referrer){ if (! entry-&gt;out_of_line()) { for (size_t i = 0; i &lt; WEAK_INLINE_COUNT; i++) { if (entry-&gt;inline_referrers[i] == old_referrer) { entry-&gt;inline_referrers[i] = nil; return; } } ... objc_weak_error(); return; } size_t begin = w_hash_pointer(old_referrer) &amp; (entry-&gt;mask); size_t index = begin; size_t hash_displacement = 0; while (entry-&gt;referrers[index] != old_referrer) { index = (index+1) &amp; entry-&gt;mask; if (index == begin) bad_weak_table(entry); hash_displacement++; if (hash_displacement &gt; entry-&gt;max_hash_displacement) { ... return; } } entry-&gt;referrers[index] = nil; entry-&gt;num_refs--;} ç§»é™¤æ—¶ï¼Œæ˜¯ä»¥ referrer å±æ€§æ¥æ¯”è¾ƒï¼Œå‘ç°åœ°å€ç›¸åŒï¼Œå°†å…¶ç½®ä¸º nil æ¥å®ç°ç§»é™¤çš„æ•ˆæœã€‚ å‡½æ•°: weak_clear_no_lock123/// Called on object destruction. Sets all remaining weak pointers to nil./// åœ¨å¯¹è±¡è°ƒç”¨ææ„æ–¹æ³•æ—¶ï¼Œè®¾ç½®æ‰€æœ‰ç•™ä¸‹çš„å¼±å¼•ç”¨æŒ‡é’ˆä¸ºnilvoid weak_clear_no_lock(weak_table_t *weak_table, id referent); å…·ä½“å®ç°å¦‚ä¸‹: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051/** * Called by dealloc; nils out all weak pointers that point to the * provided object so that they can no longer be used. * * @param weak_table * @param referent The object being deallocated. */void weak_clear_no_lock(weak_table_t *weak_table, id referent_id) { objc_object *referent = (objc_object *)referent_id; weak_entry_t *entry = weak_entry_for_referent(weak_table, referent); if (entry == nil) { /// XXX shouldn't happen, but does with mismatched CF/objc //printf(\"XXX no entry for clear deallocating %p\\n\", referent); return; } // zero out references weak_referrer_t *referrers; size_t count; if (entry-&gt;out_of_line()) { referrers = entry-&gt;referrers; count = TABLE_SIZE(entry); } else { referrers = entry-&gt;inline_referrers; count = WEAK_INLINE_COUNT; } for (size_t i = 0; i &lt; count; ++i) { objc_object **referrer = referrers[i]; if (referrer) { if (*referrer == referent) { *referrer = nil; } else if (*referrer) { _objc_inform(\"__weak variable at %p holds %p instead of %p. \" \"This is probably incorrect use of \" \"objc_storeWeak() and objc_loadWeak(). \" \"Break on objc_weak_error to debug.\\n\", referrer, (void*)*referrer, (void*)referent); objc_weak_error(); } } } weak_entry_remove(weak_table, entry);} ä¼šè¢« dealloc è°ƒç”¨ï¼Œæ ¹æ®æ³¨é‡Šå’Œä»£ç å¯çŸ¥åŒæ ·ä»¥ referent ä¸º key éå†,ç„¶åä¾æ¬¡å°†ç½®ä¸º nilï¼Œä½†æ˜¯æµ‹è¯•æ—¶ï¼Œèµ°çš„éƒ½æ˜¯ if (entry == nil) ç„¶åç›´æ¥ returnã€‚ æ€»ç»“ å¼±å¼•ç”¨æŸ¥æ‰¾æ ¹æ® referent å±æ€§ï¼Œé¦–æ¬¡ä¼šè¢«å­˜å‚¨åˆ° weak_table_t ç»“æ„ä½“ referent å’Œ inline_referrers[0],å½“ç»§ç»­æ·»åŠ æ—¶ï¼Œå¦‚æœå¼•ç”¨æ¬¡æ•°ä¸å¤§äº 4 ä¸ªä¿å­˜åœ¨æ•°ç»„inline_referrers ä¸­ï¼Œå½“è¶…è¿‡ 4 ä¸ªåä»¥ hash è¡¨çš„å½¢å¼è¿›è¡Œå­˜å‚¨ã€‚ç§»é™¤æ—¶ï¼Œæ ¹æ® referrer ä» inline_referrers ä¸­ç§»é™¤ã€‚ å‚è€ƒ int - What is size_t in C? - Stack Overflow wiki - C++ç±» wiki - ä½æ®µ Linux Programmerâ€™s Manual memcpy inline bool objc_object::isTaggedPointer(); How does the function work? PHPå“ˆå¸Œè¡¨ç¢°æ’æ”»å‡»åŸç† wiki - æ©ç  wiki - å“ˆå¸Œè¡¨ When to use reinterpret_cast? OSObject c++ operatoræ“ä½œç¬¦çš„ä¸¤ç§ç”¨æ³•ï¼šé‡è½½å’Œéšå¼ç±»å‹è½¬æ¢ï¼Œstringè½¬å…¶ä»–åŸºæœ¬æ•°æ®ç±»å‹çš„ç®€æ´å®ç°string_cast c++ä¸­å†’å·ï¼ˆ:ï¼‰å’ŒåŒå†’å·ï¼ˆ::ï¼‰çš„ç”¨æ³• ARC å¼•ç”¨è®¡æ•°ä¹‹weak","link":"/2017/06/04/iOSer-Implementation-of-Weak-Attribute-in-ObjC-Runtime-Part2/"},{"title":"iOS é¢œè‰²å®","text":"å‰è¨€ å¹³å¸¸ç”¨çš„é¢œè‰²å®å¤§æ¦‚å¦‚ä¸‹ 1#define RGBHex(rgbValue) [UIColor colorWithRed:((float)((rgbValue &amp; 0xFF0000) &gt;&gt; 16))/255.0 green:((float)((rgbValue &amp; 0xFF00) &gt;&gt; 8))/255.0 blue:((float)(rgbValue &amp; 0xFF))/255.0 alpha:1.0] è€ƒè™‘åˆ°è“æ¹–ä¸­è·å¾—çš„åå…­è¿›åˆ¶é¢œè‰²å€¼ä¸º#FF0000,cvæ—¶éœ€è¦å…ˆåˆ é™¤#å†æ·»åŠ 0x,æƒ³çœç•¥è¿™éƒ¨åˆ† å®ç° Cè¯­è¨€å®ä¸­â€™#â€™ç§°ä¹‹ä¸ºå­—ç¬¦ä¸²åŒ–æ“ä½œç¬¦(Stringizing Operator)ï¼Œå®ƒå°†å‡½æ•°å®çš„å®é™…å‚æ•°è½¬æ¢ä¸ºå¯¹åº”çš„å­—ç¬¦ä¸²å¸¸é‡ã€‚åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹å®šä¹‰å¦‚ä¸‹çš„é¢œè‰²å® 123456789101112131415161718#define HEXA(COLOR,A) ({ \\ char *color = #COLOR;\\ NSString *colorString = [NSString stringWithUTF8String:color]; \\ colorString = [colorString stringByReplacingOccurrencesOfString:@\"#\" withString:@\"\"]; \\ colorString = [colorString stringByReplacingOccurrencesOfString:@\"0x\" withString:@\"\"]; \\ unsigned int red,green,blue; \\ NSRange range; \\ range.length = 2; \\ range.location = 0; \\ [[NSScanner scannerWithString:[colorString substringWithRange:range]] scanHexInt:&amp;red]; \\ range.location = 2; \\ [[NSScanner scannerWithString:[colorString substringWithRange:range]] scanHexInt:&amp;green]; \\ range.location = 4; \\ [[NSScanner scannerWithString:[colorString substringWithRange:range]] scanHexInt:&amp;blue]; \\ [UIColor colorWithRed:red/255.0f green:green/255.0f blue:blue/255.0f alpha:A]; \\})#define HEX(COLOR) HEXA(COLOR,1.0) æ”¯æŒ0xFF0000/#FF0000/FF0000è¿™ä¸‰ç§æ ¼å¼","link":"/2019/11/25/iOSer-OC-Color-macro/"},{"title":"å®è·µ - Touch ID è§£é”åŠŸèƒ½","text":"å¯¼è¯­iOS 8 å¼•å…¥äº† Touch ID è®¤è¯çš„æ–¹å¼æ¥è§£å†³è¾“å…¥å¯†ç çš„éº»çƒ¦æ“ä½œï¼ŒSwift æœ€ä½éœ€è¦ iOS 8*ï¼Œå› æ­¤æœ¬æ–‡ä¼šç”¨ *Swift æ¥å®ç° Touch ID åŠŸèƒ½ ç¯å¢ƒ macOS Sierra 10.12.4Xcode 8.3.1Swift 3.0iPhone 6S 10.1.1 Touch ID éœ€è¦ç¡¬ä»¶æ”¯æŒ LocalAuthentication.frameworkTouch ID è®¤è¯ä¾èµ–çš„æ¡†æ¶ï¼Œå¼•å…¥å³å¯ LAContextTouch ID è®¤è¯çš„ä¸Šä¸‹æ–‡å¯¹è±¡ æœ‰ä¸¤ä¸ªæ–¹æ³• èƒ½ä¸èƒ½?1open func canEvaluatePolicy(_ policy: LAPolicy, error: NSErrorPointer) -&gt; Bool LAPolicy12345678public enum LAPolicy : Int {/// Device owner was authenticated using a biometric method (Touch ID).@available(iOS 8.0, *) case deviceOwnerAuthenticationWithBiometrics /// Device owner was authenticated by Touch ID or device passcode.@available(iOS 9.0, *) case deviceOwnerAuthentication å…·ä½“ç”¨é‚£ç§ç­–ç•¥å»éªŒè¯ã€‚ NSErrorPointer1public typealias NSErrorPointer = AutoreleasingUnsafeMutablePointer&lt;NSError?&gt;? æµç¨‹(æ˜¾ç¤ºä»€ä¹ˆ,ç»“æœå¦‚ä½•?)1open func evaluatePolicy(_ policy: LAPolicy, localizedReason: String, reply: @escaping (Bool, Error?) -&gt; Swift.Void) localizedReason è¦æ±‚ Touch ID éªŒè¯çš„åŸå›  replyè¿”å›çš„ç»“æœåçš„å›è°ƒ LAErrorå¤±è´¥çš„åŸå› æœ‰ è®¤è¯å¤±è´¥(æ¯”å¦‚ç”¨äº†æœªè¢«è®¤è¯çš„æ‰‹æŒ‡) ç”¨æˆ·å–æ¶ˆ ç”¨æˆ·å–æ¶ˆé€‰æ‹©äº†è¾“å…¥å¯†ç  ç³»ç»Ÿå–æ¶ˆ(æ¯”å¦‚å¦ä¸€ä¸ªç¨‹åºåˆ‡æ¢è‡³å‰å°) æœªè®¾ç½®å¯†ç  è®¾å¤‡ä¸æ”¯æŒ æœªè®¾ç½® Touch ID (æ‰‹æŒ‡æ²¡è®¾ç½®) iOS 9 ä¸Šåˆæ·»åŠ äº† 3 ç§æƒ…å†µ å¤±è´¥æ¬¡æ•°è¿‡å¤š è¢«å–æ¶ˆ ( ä¸Šä¸€æ¬¡è®¤è¯è¿‡ç¨‹è¿˜æœªç»“æŸ ) LAContext ä¸Šä¸‹æ–‡å¯¹è±¡æœ‰ä¸åˆæ³• å…·ä½“è¯¦æƒ…å¯ä»¥æŸ¥çœ‹ LAError æšä¸¾çš„å®šä¹‰ Code12345678910111213141516171819202122232425262728293031323334func authenticateUser() { // Get the local authentication context. let context = LAContext() // Declare a NSError variable. var error: NSError? // Set the reason string that will appear on the authentication alert. let reasonString = \"è¯·ç”»æŠ¼ğŸ¾\" if context.canEvaluatePolicy(LAPolicy.deviceOwnerAuthenticationWithBiometrics, error: &amp;error) { _ = [context .evaluatePolicy(LAPolicy.deviceOwnerAuthenticationWithBiometrics, localizedReason: reasonString, reply: { (success: Bool, evalPolicyError: Error?) -&gt; Swift.Void in if success { print(\"Authentication success\") } else{ let err : LAError = LAError(_nsError: evalPolicyError! as NSError) switch err.code.rawValue { case LAError.systemCancel.rawValue: print(\"Authentication was cancelled by the system\") case LAError.userCancel.rawValue: print(\"Authentication was cancelled by the user\") case LAError.userFallback.rawValue: print(\"User selected to enter custom password\") default: print(\"Authentication failed\") break } } } )] }} Demo æ€»ç»“ Touch ID åŠŸèƒ½çš„è®¾è®¡å…¶å®æ¯”è¾ƒç›´è§‚ï¼Œå®ç°ä¹ŸæŒºå®¹æ˜“çš„ï¼Œé‡åˆ°çš„å¹²æ‰°ä¸»è¦æ˜¯ Swift ç”±äºç‰ˆæœ¬è¿­ä»£è¯­æ³•ä¸Šçš„å·®å¼‚ã€‚ å‚è€ƒ Working with Touch ID API in iOS 8 SDK Whatâ€™s New in iOS 8.0 Touch ID Xcode 8 / Swift 3: â€œExpression of type UIViewController? is unusedâ€ warning","link":"/2017/04/29/iOSer-Practice-Touch-ID-unlock-function/"},{"title":"OC & Swift æ··ç¼–","text":"å¯¼è¯­ æœ¬æ–‡ä¸»è¦ç®€å•æè¿°äº†åœ¨ OC &amp; Swift æ··ç¼–å·¥ç¨‹ä¸­ï¼Œä¸¤è€…æ˜¯å¦‚ä½•ç›¸äº’è°ƒç”¨çš„ï¼Œé¡ºä¾¿å®ç°åœ¨ Swift ä¸­è·å–ç±»çš„å±æ€§ã€‚ ç¯å¢ƒ macOS Sierra 10.12.4Xcode 8.3.1Swift 3.0 æµç¨‹Swift è°ƒç”¨ OC åœ¨ OC ç¼–ç¨‹è¯­è¨€ç¼–å†™çš„æºå·¥ç¨‹ä¸­ï¼Œå½“åˆ›å»º Swift æ–‡ä»¶æ—¶ï¼Œæ ¹æ®æç¤ºåˆ›å»ºå¥½æ¡¥æ¥æ–‡ä»¶ã€‚åœ¨æ¡¥æ¥æ–‡ä»¶ä¸­æœ‰å¦‚ä¸‹æ³¨é‡Š Use this file to import your targetâ€™s public headers that you would like to expose to Swift. é€šè¿‡åœ¨è¯¥æ–‡ä»¶å¼•å…¥å¤´æ–‡ä»¶å¯ä»¥é¡ºåˆ©å®ç°åœ¨ Swift ä¸­è°ƒç”¨ OC æ–¹æ³•ã€‚ OC è°ƒç”¨ Swift æŸ¥çœ‹ Build Settings ï¼Œå…¶ä¸­æœ‰ä¸€é¡¹ Swift Compiler - General å¦‚ä¸‹å›¾æ‰€ç¤º å…¶ä¸­ Objective-C Bridging Header å­—æ®µå³ä¸ºæ¡¥æ¥æ–‡ä»¶ã€‚ä¸‹é¢çš„ Objective-C Generated interface Header Name å­—æ®µå°±æ˜¯ OC ä¸­è°ƒç”¨ Swift ç±»æ—¶éœ€è¦å¼•å…¥çš„å¤´æ–‡ä»¶ã€‚è¯¥å­—æ®µçš„å€¼çš„è§„åˆ™ä¸º å·¥ç¨‹å-Swift.h 123456// å¼•å…¥å¤´æ–‡ä»¶#import \"Daily_modules-Swift.h\"// ä½¿ç”¨Swiftæ–‡ä»¶[[TouchIDViewController alloc] init]; æŒ‰ä½ âŒ˜ è¿›å…¥ TouchIDViewController 123456789101112131415@import UIKit;#endif#pragma clang diagnostic ignored \"-Wproperty-attribute-mismatch\"#pragma clang diagnostic ignored \"-Wduplicate-method-arg\"@class NSBundle;@class NSCoder;SWIFT_CLASS(\"_TtC13Daily_modules21TouchIDViewController\")@interface TouchIDViewController : UIViewController- (void)viewDidLoad;- (void)didReceiveMemoryWarning;- (nonnull instancetype)initWithNibName:(NSString * _Nullable)nibNameOrNil bundle:(NSBundle * _Nullable)nibBundleOrNil OBJC_DESIGNATED_INITIALIZER;- (nullable instancetype)initWithCoder:(NSCoder * _Nonnull)aDecoder OBJC_DESIGNATED_INITIALIZER;@end åœ¨è¿è¡Œæ—¶å·¥ç¨‹çš„ objc-runtime-new.h å¤´æ–‡ä»¶ä¸­ 12345678910111213141516struct objc_class : objc_object { ... class_data_bits_t bits; ...}struct class_data_bits_t { ... bool isSwift() { return getBit(FAST_IS_SWIFT); } ...}// class is a Swift class#define FAST_IS_SWIFT (1UL&lt;&lt;0) å¯ä»¥äº†è§£åˆ° Swift ç¼–å†™çš„ç±»ä¹Ÿå°±ä¼šè¢«è¿è¡Œæ—¶å¤„ç†ã€‚ Swift çš„ç±»çš„åç§° æ¯”å¦‚å½“å‰å·¥ç¨‹çš„ _TtC13Daily_modules21TouchIDViewController å¦‚ä½•æ¥çš„ã€‚ å‰ç¼€ _TtCå·¥ç¨‹åçš„é•¿åº¦: 13å·¥ç¨‹å: Daily_modlesç±»åçš„é•¿åº¦: 21ç±»å: TouchIDViewController 12345678910111213extension NSObject { // create a static method to get a swift class for a string name public class func swiftClassFromString(className: String) -&gt; AnyClass! { // get the project name if let appName = Bundle.main.object(forInfoDictionaryKey: \"CFBundleName\") as! String? { // generate the full name of your class (take a look into your \"YourProject-swift.h\" file) let classStringName = \"_TtC\\(appName.lengthOfBytes(using: String.Encoding.utf8))\\(appName)\\(className.lengthOfBytes(using: String.Encoding.utf8))\\(className)\" // return the class! return NSClassFromString(classStringName) } return nil; }} ä¸Šé¢æ˜¯ä¸€ä¸ªè·å– Swift ç±»çš„ extension Swift ç‰ˆè·å–ç±»çš„å±æ€§12345678910111213141516171819public class func getPropertiesInfo(cls:AnyClass?, recursive:Bool) -&gt; Any! { var clsM = cls var glist = [String]() var outCount:UInt32 = 0; repeat { let properties:UnsafeMutablePointer&lt;objc_property_t?&gt; = class_copyPropertyList(clsM, &amp;outCount); for index in 0..&lt;outCount { let property = property_getName(properties[Int(index)]) let result = String(cString: property!) glist.append(result) } clsM = clsM?.superclass() print(clsM! == NSObject.self); }while (clsM! != NSObject.self &amp;&amp; recursive) return glist} åªèƒ½è·å– public / open è®¿é—®èŒƒå›´çš„å±æ€§ + OC åŸæœ‰çš„å±æ€§ æ€»ç»“åœ¨ Swift çš„æ³¨é‡Šä¸­å¦‚ä¸‹çš„ä¸€æ®µè¯ /// Accessing Objective-C Methods and Properties/// ============================================////// When you use AnyObject as a concrete type, you have at your disposal/// every @objc method and propertyâ€”that is, methods and properties/// imported from Objective-C or marked with the @objc attribute. Because/// Swift canâ€™t guarantee at compile time that these methods and properties/// are actually available on an AnyObject instanceâ€™s underlying type, these/// @objc symbols are available as implicitly unwrapped optional methods and/// properties, respectively. è¿™ä¸€ç‚¹å’Œå‚è€ƒé“¾æ¥ä¸­æåˆ°çš„è¡¨è¾¾æ˜¯æœ‰å…³çš„ çº¯Swiftç±»çš„å‡½æ•°è°ƒç”¨å·²ç»ä¸å†æ˜¯Objective-cçš„è¿è¡Œæ—¶å‘æ¶ˆæ¯ï¼Œè€Œæ˜¯ç±»ä¼¼C++çš„vtableï¼Œåœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šäº†è°ƒç”¨å“ªä¸ªå‡½æ•°ï¼Œæ‰€ä»¥æ²¡æ³•é€šè¿‡runtimeè·å–æ–¹æ³•ã€å±æ€§ã€‚ TestSwiftVCç»§æ‰¿è‡ªUIViewControllerï¼ŒåŸºç±»NSObjectï¼Œè€ŒSwiftä¸ºäº†å…¼å®¹Objective-Cï¼Œå‡¡æ˜¯ç»§æ‰¿è‡ªNSObjectçš„ç±»éƒ½ä¼šä¿ç•™å…¶åŠ¨æ€æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½é€šè¿‡runtimeæ‹¿åˆ°ä»–çš„æ–¹æ³•ã€‚ Swift ä¸èƒ½é€šè¿‡è¿è¡Œæ—¶è·å–å¯¹åº”ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œä½†æ˜¯å¦‚æœæ˜¯ç»§æ‰¿è‡ª NSObject( imported from Objective-C ) æˆ–è¢«æ ‡è®°äº† @objc åˆ™å¯ä»¥è¢«è·å–,èƒ½è¢«è·å–åˆ°çš„å±æ€§ä¹Ÿæ˜¯æœ‰æ‰€é™åˆ¶çš„ã€‚ å‚è€ƒ Swift language NSClassFromString Swift Runtime åˆ†æï¼šè¿˜åƒ OC Runtime ä¸€æ ·å—ï¼Ÿ I canâ€™t get properties of a Class using swift by class_copyPropertyList List of classâ€™s properties in swift","link":"/2017/04/25/iOSer-OC-Swift-Mixed/"},{"title":"å®è·µç¯‡ï¼šiOS åº”ç”¨é‡ç­¾å (ä¸‹)","text":"å¯¼è¯­ æœ¬æ–‡ä¸»è¦æè¿°äº†åœ¨åŒ…å«å¤š target ä¸ æ³¨å…¥ dylib çš„åœºæ™¯ä¸‹è¯¥å¦‚ä½•è¿›è¡Œé‡ç­¾åçš„æ“ä½œã€‚ ç¯å¢ƒ &amp; å·¥å…· macOS Sierra 10.12.4Xcode 8.3.1Jailbreak iPad 8.4No Jailbreak iPhone 10.1.1yololibtheosmobiledeviceWechat 6.5.7 å¤š target åœ¨ Apple å®˜æ–¹çš„Code Signing Guide ä¸­æåˆ°å‚ä¸ç­¾åçš„æœ‰äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåº“æ–‡ä»¶ï¼Œèµ„æºæ–‡ä»¶ã€‚å¾®ä¿¡çš„ .ipa åŒ…ä¸­åŒ…å«äº† PlugIns ç›®å½•ï¼Œé‡Œé¢åŒ…å«äº†æ’ä»¶çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ŒWatch ç›®å½•ï¼Œå…¶ä¸­åŒ…å«äº†åº”ç”¨åœ¨ Watch OS å¹³å°ä¸‹çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ è¯¥å¦‚ä½•ç­¾åå‘¢? åˆ›å»ºä¸€ä¸ªå·¥ç¨‹ï¼Œæ·»åŠ äº† ShareExtension + Watch OS çš„ target*ï¼Œç„¶å *Archive çœ‹çœ‹ Xcode æ˜¯å¦‚ä½•æ‰§è¡Œç­¾åæµç¨‹çš„ã€‚ ä»ä¸Šé¢çš„æˆªå›¾å¯çŸ¥ Xcode ç­¾åçš„æ‰€éœ€è¦çš„å†…å®¹ï¼Œè¿˜æ˜¯å’Œä¸Šç¯‡ä¸­è¯´çš„ä¸€è‡´ï¼Œä½†æ˜¯å¤š target ç¯å¢ƒä¸‹éœ€è¦å¯¹äºŒè¿›åˆ¶ç”±å†…åˆ°å¤–è¿›è¡Œç­¾åæ“ä½œï¼ŒåŒæ—¶æ¯ä¸ª target éƒ½éœ€è¦æœ‰å„è‡ªçš„æè¿°æ–‡ä»¶ã€‚ ç”¨ otool -l path/to/unix_exec_file | grep -B 2 crypt æ¥ç¡®å®šæ˜¯å¦è¢«åŠ å£³äº†ã€‚ç»è¿‡æµ‹è¯•å‘ç° Plugins ç›®å½•ä¸‹çš„äºŒè¿›åˆ¶æ˜¯åŠ å¯†çš„ï¼Œè€Œ Watch ç›®å½•ä¸‹çš„äºŒè¿›åˆ¶å¹¶æ²¡æœ‰è¢«åŠ å¯† å› ä¸ºåŠ å£³çš„ä»£ç è¦è„±å£³æ‰èƒ½è¿›è¡Œé‡ç­¾åï¼Œä¸€èˆ¬ä¼šç”¨ç±»ä¼¼ dumpdecrypted çš„å·¥å…·åœ¨è¿è¡Œæ—¶é€šè¿‡ dump çš„æ–¹å¼æ¥è·å¾—è„±å£³åçš„æ–‡ä»¶ï¼Œå› æ­¤åœ¨è¿™é‡Œå¯ä»¥å°† Plugins å’Œ Watch ç›®å½•åˆ é™¤ï¼Œè¿™æ ·å¤„ç†åï¼Œåº”ç”¨å°±ä»å¤š target å°±è½¬æ¢ä¸ºå• target äº†ã€‚ ä»¥å¾®ä¿¡ 6.5.7 ç‰ˆæœ¬ä¸ºä¾‹ï¼Œå‡†å¤‡å¥½ AdHoc ç±»å‹çš„æè¿°æ–‡ä»¶ä¹‹åï¼Œè¿›è¡Œå¦‚ä¸‹æ“ä½œ: åˆ é™¤åº”ç”¨ä¸­çš„ _CodeSignature ç›®å½• ç”¨è„±å£³åçš„äºŒè¿›åˆ¶æ–‡ä»¶æ›¿æ¢æ‰åŸåº”ç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶ copy æè¿°æ–‡ä»¶åˆ°åº”ç”¨ç›®å½•ä¸­ ä¿®æ”¹ info.plist ä¸­çš„åŒ…åæ›¿æ¢ä¸ºé‡ç­¾åçš„æè¿°æ–‡ä»¶å¯¹åº”çš„åŒ…å å¯¹æ•´ä¸ªåº”ç”¨çš„äºŒè¿›åˆ¶è¿›è¡Œç­¾åï¼ˆ codesign ...ï¼‰ æ‹–æ‹½åˆ° iTunes ç”Ÿæˆ .ipa æ–‡ä»¶ å®‰è£… .ipa ç»“æœæˆåŠŸã€‚ æ³¨å…¥ dylib ç”¨ Xcode ä¸­çš„ OpenDev æ¨¡æ¿(éœ€è¦å•ç‹¬ä¸‹è½½)ï¼Œç”Ÿæˆè¦æ³¨å…¥åˆ°å¾®ä¿¡ä¸­çš„ dylibï¼Œåœ¨ç”Ÿæˆçš„å·¥ç¨‹ä¸­æ·»åŠ ç±»ä¼¼ä¸‹é¢çš„æ–¹æ³•ã€‚ 123456789@implementation Dylib__attribute__((constructor))static void entry() { NSLog(@\"hello, world!\");}@end âŒ˜ B ç¼–è¯‘ç”ŸæˆåŠ¨æ€åº“,ç”¨ yololib å°†åŠ¨æ€åº“æ³¨å…¥åˆ°å¾®ä¿¡çš„äºŒè¿›åˆ¶ã€‚åŒæ—¶å°†è¯¥åŠ¨æ€åº“æ‹·è´åˆ°å¾®ä¿¡åº”ç”¨çš„ç›®å½•ä¸­ 1./yololib ç›®æ ‡å¯æ‰§è¡Œæ–‡ä»¶ éœ€æ³¨å…¥çš„dylib åŒæ ·è¿›è¡Œé‡ç­¾åæ“ä½œï¼Œæ‹–åˆ° iTunes ä¸­ç”Ÿæˆ .ipa æ–‡ä»¶ã€‚ç”¨ mobiledevice å·¥å…·è¿›è¡Œå®‰è£…æ“ä½œã€‚ 1$ mobiledevice install_app /path/to/.ipa â å®‰è£…å¤±è´¥ é”™è¯¯ä¸€: dylib æœªé‡ç­¾å æŸ¥çœ‹è®¾å¤‡æ—¥å¿—,å‘ç°å¦‚ä¸‹è¾“å‡º,å¯ä»¥çœ‹å‡ºæ˜¯åŠ¨æ€åº“æ²¡æœ‰è¿›è¡Œç­¾åæ“ä½œ 12&lt;Notice&gt;: SystemUI unknown identifier: 'com.coder.demo'Apr 17 10:53:17 xiaoguai amfid[12845] &lt;Notice&gt;: /private/var/containers/Bundle/Application/89E48C85-CC8E-4A9E-B6C0-9E1329DDF2AD/WeChat.app/Dylib.dylib not valid: 0xe800801c: No code signature found. è§£å†³æ–¹æ³•1# codesign --force --sign xxxxxx -a arm64 Dylib.dylib å› ä¸ºæˆ‘è„±å£³çš„æ˜¯ arm64 çš„äºŒè¿›åˆ¶,æ‰€ä»¥å¯ä»¥é€šè¿‡ -a æŒ‡å®šå¯¹åŠ¨æ€åº“çš„å…·ä½“æ¶æ„è¿›è¡Œç­¾åæ“ä½œã€‚ é”™è¯¯äºŒ: dylib è·¯å¾„é”™è¯¯ å› ä¸º yololib æ³¨å…¥ååŠ¨æ€åº“çš„æ‰§è¡Œè·¯å¾„ç”± @executable_path æŒ‡æ˜ï¼Œæ‰€ä»¥è¦ç¡®è®¤åœ¨æ‰§è¡Œæ—¶èƒ½æ‰¾åˆ°å¯¹åº”çš„åŠ¨æ€åº“äºŒè¿›åˆ¶ã€‚ä¸‹é¢å°±æ˜¯ä¸€ä¸ªé”™è¯¯çš„è·¯å¾„ å¦‚æœåŠ¨æ€åº“æ‰§è¡Œè·¯å¾„é”™è¯¯æ—¶ï¼Œå¯ä»¥å®‰è£…ï¼Œä½†æ˜¯è¿è¡Œå°±ä¼šé—ªé€€ è§£å†³æ–¹æ³• cd åˆ° WeChat.app ç›®å½•ä¸‹,ç¡®ä¿ yololib æ³¨å…¥åï¼ŒåŠ¨æ€åº“çš„æ‰§è¡Œè·¯å¾„ä¸º @executable_path /Dylib.dylib ç»“æœ æŸ¥çœ‹è®¾å¤‡æ—¥å¿—ï¼Œå¯ä»¥çœ‹åˆ°åŠ¨æ€åº“å·²æˆåŠŸæ³¨å…¥ æ€»ç»“ è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºä¸­å›½çš„å¼€å‘è€…åˆ©ç”¨å…è´¹çš„è¯ä¹¦å¤§é‡å¯¹åº”ç”¨è¿›è¡Œé‡ç­¾åï¼Œæ‰€ä»¥ç›®å‰è‹¹æœåŠ ä¸Šäº†è®¸å¤šé™åˆ¶ï¼Œå…è´¹å¼€å‘è€…çš„provisioningè¯ä¹¦æœ‰æ•ˆæ—¶é—´ä»ä¹‹å‰çš„30å¤©æ”¹ä¸º7å¤©ï¼Œè¿‡æœŸåéœ€è¦é‡æ–°ç­¾åã€‚å¦å¤–å°±æ˜¯ä¸€ä¸ªæ˜ŸæœŸå†…æœ€å¤šåªèƒ½ç”³è¯·åˆ°10ä¸ªè¯ä¹¦ã€‚ æœ¬æ–‡é€šè¿‡ Xcode çš„ä¸€æ¬¡å¤š target çš„å·¥ç¨‹ç­¾åæµç¨‹å…¥æ‰‹ï¼Œäº†è§£å¤š target çš„ç­¾åé¡ºåºã€‚å› ä¸ºé‡ç­¾åéœ€è¦è¿›è¡Œè„±å£³çš„æ“ä½œï¼Œå› æ­¤å¯¹å¤š target çš„åº”ç”¨ï¼Œåœ¨ä¸å½±å“çš„æƒ…å†µä¸‹ï¼Œå¯åˆ é™¤å…¶ä»– target æ–‡ä»¶ï¼Œå°†å…¶è½¬æ¢ä¸ºå• target*ã€‚æ³¨å…¥çš„ *dylib éœ€è¦ç‹¬ç«‹ç­¾åï¼ŒåŒæ—¶ä½¿ç”¨ yololib æ—¶éœ€è¦æ³¨æ„æ‰§è¡Œè·¯å¾„çš„é—®é¢˜ã€‚ æœ€åæŠŠæ•´ä½“æµç¨‹å†æ•´ç†ä¸‹: åˆ é™¤åº”ç”¨ä¸­çš„ _CodeSignature ç›®å½• ç”¨è„±å£³åçš„äºŒè¿›åˆ¶æ–‡ä»¶æ›¿æ¢æ‰åŸåº”ç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶ copy æè¿°æ–‡ä»¶åˆ°åº”ç”¨ç›®å½•ä¸­ ä¿®æ”¹ info.plist ä¸­çš„åŒ…åæ›¿æ¢ä¸ºé‡ç­¾åçš„æè¿°æ–‡ä»¶å¯¹åº”çš„åŒ…å ä½¿ç”¨ Xcode çš„ OpenDev æ¨¡æ¿ç”Ÿæˆ dylib æ–‡ä»¶ å¯¹åŠ¨æ€åº“è¿›è¡Œç­¾å ä½¿ç”¨ yololib å°†åŠ¨æ€åº“æ³¨å…¥åˆ°äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ å¯¹æ•´ä¸ªåº”ç”¨çš„äºŒè¿›åˆ¶è¿›è¡Œç­¾åï¼ˆ codesign ...ï¼‰ æ‹–æ‹½åˆ° iTunes ç”Ÿæˆ .ipa æ–‡ä»¶ ä½¿ç”¨ mobiledevice å®‰è£… ipa æ–‡ä»¶ å‚è€ƒ ä¸€æ­¥ä¸€æ­¥å®ç°iOSå¾®ä¿¡è‡ªåŠ¨æŠ¢çº¢åŒ…(éè¶Šç‹±) linuxè¿æ¥iOSè®¾å¤‡å¹¶ä¸”å®‰è£…ipaåº”ç”¨ libimobiledevice iOSAppHook","link":"/2017/04/17/iOSer-Practice-articles-iOS-application-re-signature-next/"},{"title":"å®è·µç¯‡ï¼šiOS åº”ç”¨é‡ç­¾å(ä¸Š)","text":"ç¯å¢ƒ &amp; å·¥å…· macOS Sierra 10.12.4Xcode 8.3.1Jailbreak iPad 8.4No Jailbreak iPhone 10.1.1 å½±å“å› ç´  _CodeSignature äºŒè¿›åˆ¶æ–‡ä»¶ embedded.mobileprovision entitlements æ‰‹åŠ¨Developer ç¯å¢ƒ AppStore ä¸Šä¸‹è½½çš„åº”ç”¨æ˜¯åŠ å£³çš„ï¼Œæ˜¯ä¸èƒ½ç›´æ¥ç”¨äºé‡ç­¾åçš„ã€‚ä¸ºä»€ä¹ˆå‘¢? ç°åœ¨çš„æˆ‘ä¸æ¸…æ¥šï¼Œå¦‚æœæˆ‘å»å®ç°çš„è¯ï¼Œå¯ä»¥åœ¨ codesign åœ¨ç­¾åæ—¶å¯ä»¥åˆ¤æ–­ä»£ç æ®µæ˜¯å¦å·²ç»åŠ å¯†äº†ï¼Œå¦‚æœåŠ å¯†è¿‡è¯æ˜å·²ç»å¤„ç†äº†ï¼Œå°±ä¸å»ç­¾åã€‚äºŒè¿›åˆ¶çš„ç­¾åä¾ç„¶æ˜¯è‹¹æœæœåŠ¡å™¨ä¸Šçš„ç§é’¥çš„ç­¾åï¼Œåœ¨å®‰è£…è¿‡ç¨‹ä¸­ï¼Œå»éªŒè¯äºŒè¿›åˆ¶çš„ç­¾åæ—¶ï¼Œæ— æ³•åŒ¹é…ï¼Œå› æ­¤å®‰è£…å¤±è´¥ã€‚ é‡ç­¾åéœ€è¦å·²ç»è„±å£³çš„åº”ç”¨ï¼Œå¯ä»¥æ‰‹åŠ¨/å•†åº—ä¸‹è½½ä¸€ä¸ªå·²ç»è„±å£³çš„åº”ç”¨ã€‚ ä»¥é…·ç‹—éŸ³ä¹ä¸ºä¾‹ è§£å‹ .iPa cd åˆ° kugou.app ä¸­ åˆ é™¤åº”ç”¨ä¸­çš„ _CodeSignature ç›®å½• ä»è‡ªå·±çš„å…¶ä»–åº”ç”¨çš„ .app æ–‡ä»¶ä¸­ï¼Œæ‹·è´ä¸€ä»½ embedded.mobileprovision åˆ° kugou.app ç›®å½•ä¸‹ ç”¨è„±å£³åçš„äºŒè¿›åˆ¶æ–‡ä»¶æ›¿æ¢æ‰åŸæ¥çš„ã€‚ æ‰¾åˆ°é‡ç­¾åçš„ sign å€¼(é’¥åŒ™ä¸²)ä¸ entitlement æ–‡ä»¶ ç”¨ codesign å®Œæˆç­¾åæ“ä½œ entitlement æ–‡ä»¶çš„ç¤ºä¾‹å¦‚ä¸‹: 12345678910111213141516&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"&gt;&lt;plist version=\"1.0\"&gt;&lt;dict&gt; &lt;key&gt;application-identifier&lt;/key&gt; &lt;string&gt;XXXX.åŒ…å&lt;/string&gt; &lt;key&gt;com.apple.developer.team-identifier&lt;/key&gt; &lt;string&gt;XXXX&lt;/string&gt; &lt;key&gt;get-task-allow&lt;/key&gt; &lt;true/&gt; &lt;key&gt;keychain-access-groups&lt;/key&gt; &lt;array&gt; &lt;string&gt;XXXX.åŒ…å&lt;/string&gt; &lt;/array&gt;&lt;/dict&gt;&lt;/plist&gt; 123âœ blog-52 /usr/bin/codesign --force --sign ç­¾åå€¼ --entitlements Runtrace.app.xcent --timestamp=none kugou.appkugou.app: replacing existing signatureâœ blog-52 ç­¾åå®Œ .app éœ€è¦æ‰“åŒ…æˆ .ipa æ–‡ä»¶,å¯ä»¥å°† .app æ‹–å…¥åˆ° .iTunes æ¥ç”Ÿæˆ .ipa ã€‚ åœ¨è¶Šç‹±è®¾å¤‡ä¸ŠæŠ¥ åœ¨éè¶Šç‹±è®¾å¤‡ä¸ŠæŠ¥ ä¿®æ”¹ info.plist çš„åŒ…åï¼Œé‡æ–°åˆ¶ä½œ .ipa ï¼Œå†æ¬¡å°è¯• åœ¨è¶Šç‹±ä¸éè¶Šç‹±è®¾å¤‡ä¸Šéƒ½èƒ½æ­£å¸¸å®‰è£…ï¼Œæ‰“å¼€ä¸é—ªé€€ï¼Œè¡¨æ˜å·²ç»è¿‡äº† Apple çš„ç­¾åæ£€æŸ¥äº†ã€‚ AdHoc ç¯å¢ƒ æ“ä½œä¸ Developer ç¯å¢ƒç±»ä¼¼ï¼Œä½† embedded.mobileprovision éœ€è¦æ¢æˆ AdHoc çš„æè¿°æ–‡ä»¶ï¼ŒåŒæ—¶ entitlement æ–‡ä»¶éœ€è¦å¤„ç†ï¼Œå† Xcode ç›´æ¥ Archive å·¥ç¨‹ï¼Œç…§ç€æ—¥å¿—ä¸­çš„è·¯å¾„æŸ¥æ‰¾ï¼Œå¾—åˆ°çš„ entitlement è¿˜æ˜¯å¼€å‘ç¯å¢ƒçš„ï¼Œåœ¨å½“å‰ç¯å¢ƒä¸‹æ˜¯æ— æ•ˆçš„ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ª entitlement çš„ç¤ºä¾‹ 123456789101112131415161718&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"&gt;&lt;plist version=\"1.0\"&gt;&lt;dict&gt; &lt;key&gt;application-identifier&lt;/key&gt; &lt;string&gt;XXXX.åŒ…å&lt;/string&gt; &lt;key&gt;aps-environment&lt;/key&gt; &lt;string&gt;production&lt;/string&gt; &lt;key&gt;com.apple.developer.team-identifier&lt;/key&gt; &lt;string&gt;XXXX&lt;/string&gt; &lt;key&gt;get-task-allow&lt;/key&gt; &lt;false/&gt; &lt;key&gt;keychain-access-groups&lt;/key&gt; &lt;array&gt; &lt;string&gt;XXXX.åŒ…å&lt;/string&gt; &lt;/array&gt;&lt;/dict&gt;&lt;/plist&gt; ä¸ä¸Šé¢ä¸åŒä¹‹å¤„åœ¨äº get-task-allow ä¸º false ,åŒæ—¶å¢åŠ äº† aps-environment è¿™ä¸ªèŠ‚ç‚¹ã€‚å¦‚ä½•æ‰¾åˆ°çš„ï¼Ÿä¸»è¦è¿˜æ˜¯é€šè¿‡å¯¹æ¯”å·¥å…·æ¯”è¾ƒå‡ºç”¨ ios-app-signer å·¥å…·ç­¾åä¸ codesign ç­¾ååï¼Œä¸¤ä¸ª .app åŒ…çš„ 4 ä¸ªå½±å“å› ç´ çš„å·®å¼‚ï¼Œæœ€åå‘ç°ä¸¤è€…çš„å†³å®šæ€§å·®å¼‚åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚ å°æ’æ›² åœ¨è¶Šç‹±è®¾å¤‡ä¸Šï¼Œç”¨å¼€å‘çš„ sign ç­¾åä¹Ÿèƒ½æˆåŠŸå®‰è£…ï¼Œä½†åœ¨éè¶Šç‹±ä¸Šæ— æ³•å®‰è£…ï¼Œç›®æ ‡ä¸»è¦è¿˜æ˜¯åœ¨éè¶Šç‹±è®¾å¤‡ä¸Šï¼Œè¶Šç‹±åº”è¯¥æ˜¯ä¼šå½±å“åº”ç”¨ç­¾åè®¤è¯çš„è¿™ä¸ªè¿‡ç¨‹ã€‚ å·¥å…· å…³äºé‡ç­¾åçš„å·¥å…·è¿˜æ˜¯æŒºå¤šçš„ï¼Œå°±è¯´æˆ‘ä½¿ç”¨è¿‡çš„ã€‚åœ¨éè¶Šç‹±è®¾å¤‡ä¸Šè¦è¿‡ç­¾åçš„è®¤è¯ï¼Œæœ¬è´¨ä¸Šæ¥è¯´åº”è¯¥éƒ½æ˜¯ä¾èµ–äº codesign è¿™ä¸ªåŸç”Ÿçš„å·¥å…·çš„ã€‚ ios-app-signerSwift å¼€å‘ï¼Œä¸»ç•Œé¢å¦‚ä¸‹ é€‰ç­¾åè¯ä¹¦ + æè¿°æ–‡ä»¶å°±å¯ä»¥äº†ï¼Œæ“ä½œä¹Ÿéå¸¸ç®€å• 1234567891011121314151617181920212223242526272829//MARK: Codesigning func codeSign(file: String, certificate: String, entitlements: String?,before:((file: String, certificate: String, entitlements: String?)-&gt;Void)?, after: ((file: String, certificate: String, entitlements: String?, codesignTask: AppSignerTaskOutput)-&gt;Void)?)-&gt;AppSignerTaskOutput{ let useEntitlements: Bool = ({ if entitlements == nil { return false } else { if fileManager.fileExistsAtPath(entitlements!) { return true } else { return false } } })() if let beforeFunc = before { beforeFunc(file: file, certificate: certificate, entitlements: entitlements) } var arguments = [\"-vvv\",\"-fs\",certificate,\"--no-strict\"] if useEntitlements { arguments.append(\"--entitlements=\\(entitlements!)\") } arguments.append(file) let codesignTask = NSTask().execute(codesignPath, workingDirectory: nil, arguments: arguments) if let afterFunc = after { afterFunc(file: file, certificate: certificate, entitlements: entitlements, codesignTask: codesignTask) } return codesignTask} å…¶ä¸­ codesignPath å°±æ˜¯ let codesignPath = â€œ/usr/bin/codesignâ€ ã€‚å¤§è‡´ä¹Ÿæ˜¯åˆ©ç”¨ codesign è¿›è¡Œç­¾åã€‚ fastlane sigh resign æ¥è‡ª å¸–å­ fastlane æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„å·¥å…·é›†ï¼Œèƒ½è¾…åŠ©å»è§£å†³ iOSï¼ŒMac å’Œ Android ä¸€äº›ç¹ççš„ä»»åŠ¡ï¼Œæ¯”å¦‚ç”Ÿæˆæˆªå›¾å¤„ç†é…ç½®æ–‡ä»¶ä»¥åŠå‘å¸ƒåº”ç”¨ç¨‹åºç­‰ã€‚ å‘½ä»¤è¡Œçš„æ“ä½œä¹Ÿéå¸¸ç®€å•ï¼Œåªæ˜¯ä¸€èˆ¬åœ¨é‡ç­¾åæ—¶è¦ä¼ ä¸€ä¸ª .ipa åœ°å€ï¼Œè¿™éœ€è¦å¤„ç†ä¸€ä¸‹ï¼Œä¸åƒç›´æ¥ç”¨ codesign æˆ–è€… ios-app-signer å¯ä»¥ä¼  .app æ–‡ä»¶ï¼Œä¸­é—´å¯èƒ½éœ€è¦ç”¨ iTunes å¤„ç†ä¸‹ã€‚ æ“ä½œæµç¨‹æ˜¯: .ipa åœ°å€ é€‰æ‹© sign 12345678910[WARNING] You are calling sigh directly. Usage of the tool name without the `fastlane` prefix is deprecated in fastlane 2.0Please update your scripts to use `fastlane sigh resign` instead.Path to ipa file: /Users/Jason/Music/iTunes/iTunes\\ Media/Mobile\\ Applications/kugou.ipa[00:05:56]: Available identities: iPhone Developer: xxxx xxxxx (576J77ZA38) DE64343206CB84E95C5CF22F1C5D346664171B5A iPhone Developer: xxx@126.com (VRZB43ZE67)...Signing Identity: é‡Œé¢åœ¨å¯¹åŠ¨æ€åº“ç­¾åæ—¶ï¼Œæœ‰å¦‚ä¸‹çš„ä»£ç  12345678910111213for framework in \"$FRAMEWORKS_DIR\"/*do if [[ \"$framework\" == *.framework || \"$framework\" == *.dylib ]] then log \"Resigning '$framework'\" # Must not qote KEYCHAIN_FLAG because it needs to be unwrapped and passed to codesign with spaces # shellcheck disable=SC2086 /usr/bin/codesign ${VERBOSE} ${KEYCHAIN_FLAG} -f -s \"$CERTIFICATE\" \"$framework\" checkStatus else log \"Ignoring non-framework: $framework\" fidone æ€»ç»“ æœ¬æ–‡ä¸»è¦ä»¥ codesign æŒ‡ä»¤çš„æ–¹å¼å®ç°äº†é‡ç­¾åä¸­æ¯”è¾ƒç®€å•çš„ä¸€ç§æƒ…å†µï¼ŒåŒæ—¶ä»‹ç»äº†å‡ ä¸ªæ¯”è¾ƒæœ‰æ•ˆçš„é‡ç­¾åçš„å·¥å…·ã€‚ å‚è€ƒ iosæ‰“åŒ…ipaçš„å››ç§å®ç”¨æ–¹æ³•(.appè½¬.ipa) iOSè¯ä¹¦åŠipaåŒ…é‡ç­¾åæ¢ç©¶ æœ€ç®€å•çš„é‡ç­¾ååº”ç”¨çš„æ–¹æ³• iOS: Already installed app is not launching and crashing everytime in launching","link":"/2017/04/10/iOSer-Practice-articles-iOS-application-re-signature/"},{"title":"å¿«é€Ÿç”ŸæˆiOSåº”ç”¨çš„å›¾æ ‡","text":"ç›®æ ‡ shellè„šæœ¬è‡ªåŠ¨ç”Ÿæˆåº”ç”¨çš„å›¾æ ‡ å‰æ .pngæ ¼å¼çš„å›¾ç‰‡è¿›è¡Œç¼©å°æ“ä½œä¸ä¼šå¤±çœŸ åº”ç”¨çš„å›¾æ ‡å°ºå¯¸æ˜¯å¯é¢„å…ˆç¡®å®š æµç¨‹ Q: å¦‚ä½•è°ƒæ•´å›¾æ ‡å°ºå¯¸? æ‰¾æŒ‡ä»¤å¯»æ‰¾åˆé€‚çš„æŒ‡ä»¤,æœ€å¥½æ˜¯ç³»ç»Ÿè‡ªå¸¦çš„,æœç´¢å¾—çŸ¥æŒ‡ä»¤ sips å¯ç”¨äºè°ƒæ•´å›¾ç‰‡çš„å°ºå¯¸ 12345678$ man sipsNAME sips -- scriptable image processing system.DESCRIPTION This tool is used to query or modify raster image files and ColorSync ICC profiles. Its functionality can also be used through the \"Image Events\" AppleScript suite. sips æ˜¯ä¸€ä¸ªå¯è„šæœ¬åŒ–çš„å›¾ç‰‡æ‰§è¡Œç³»ç»Ÿ,é€šå¸¸å¯ç”¨äºæŸ¥è¯¢æˆ–ä¿®æ”¹å›¾ç‰‡æ–‡ä»¶ 1234-z pixelsH pixelsW --resampleHeightWidth pixelsH pixelsW Resample image at specified size. Image apsect ratio may be altered. sips æŒ‡ä»¤æœ‰ä¸ª-zå‚æ•°,åé¢è·Ÿè°ƒæ•´åçš„å°ºå¯¸é«˜ä¸å®½ Q:å¦‚ä½•ç¡®å®šæœ‰å“ªäº›å°ºå¯¸? åº”ç”¨å›¾æ ‡å°ºå¯¸ generate_app_icon.sh1234567891011121314151617181920212223242526#!/bin/bashscale_config=( \"iTunesArtwork.png\" 512 \"iTunesArtwork@2x.png\" 1024 \"Icon-60@2x.png\" 120 \"Icon-60@3x.png\" 180 \"Icon-76.png\" 76 \"Icon-76@2x.png\" 152 \"Icon-Small-40.png\" 40 \"Icon-Small-40@2x.png\" 80 \"Icon-Small-40@3x.png\" 120 \"Icon-Small.png\" 29 \"Icon-Small@2x.png\" 58 \"Icon-Small@3x.png\" 87 # extra )num=${#scale_config[@]}for (( i = 0; i &lt; num; i++ )); do cache_img=${scale_config[i]} cp logo.png ${cache_img} i=$((${i}+1)) sips -Z ${scale_config[i]}x${scale_config[i]} ${cache_img}done ä»£ç  å‚è€ƒ shell æ•´å‹å˜é‡è‡ªå¢ï¼ˆåŠ 1ï¼‰çš„å‡ ç§æ–¹æ³• shell æ•°ç»„é•¿åº¦ åº”ç”¨å›¾æ ‡å°ºå¯¸","link":"/2016/12/08/iOSer-Quickly-generate-icons-for-iOS-apps/"},{"title":"iOSä¸Šå®ç° 3D Touch åŠŸèƒ½","text":"å‰è¨€åœ¨ WWDC 2016 - Session 228 - iOS ä¸­æåˆ°äº† 3D Touch,å¯¹å®ƒç®€å•å®šä¹‰æ˜¯ 3D Touch ä¸º iOS ç”¨æˆ·ç•Œé¢æ·»åŠ äº†ä¸€ä¸ªå…¨æ–°çš„ç»´åº¦ï¼Œå¹¶å¼•å…¥äº†ä¸€ç§å…¨æ–°çš„ä¸ iPhone äº¤äº’çš„æ–¹å¼ã€‚ è®¾å¤‡é™åˆ¶: iPhone 6s+ ç³»ç»Ÿé™åˆ¶: iOS 9+ ç¯å¢ƒ macOS Sierra 10.12.3Xcode 8.2.1iPhone 6s 10.1.1 åº”ç”¨åœºæ™¯åœ¨ 3d Touch APIs æ–‡æ¡£ä¸­,æåˆ°äº† The Home screen quick action API is for adding shortcuts to your app icon that anticipate and accelerate a userâ€™s interaction with your app.The UIKit peek and pop API lets you provide easy access, within your app, to additional content while maintaining the userâ€™s context. Use the peek quick actions API to provide a press-enabled replacement to your appâ€™s touch-and-hold actions.The Web view peek and pop API lets you enable system-mediated previews of HTML link destinations.The UITouch force properties let you add customized force-based user interaction to your app. 3d Touch å¤§æ¦‚æœ‰ 3 ä¸ªåº”ç”¨åœºæ™¯,ä¸»å±å¿«é€Ÿå¯åŠ¨,è€Œ UIKit peek and pop å’Œ Web view peek and pop å¯ä»¥åˆå¹¶ä¸ºä¸€ä¸ªé¢„è§ˆçš„åŠŸèƒ½ï¼Œ å¯ä»¥æ ¹æ® force properties æŒ‰å‹å±æ€§å€¼åšå…¶å®ƒäº¤äº’ä¸Šçš„æ“ä½œã€‚ ä¸»å±å¿«é€Ÿå¯åŠ¨(Home Screen Quick Actions)å…³äºè¿™ä¸ªåŠŸèƒ½,å¾ˆå¤šåº”ç”¨éƒ½æ˜¯æœ‰çš„ï¼Œé•¿æŒ‰å¹¶ä¿æŒå‡ ç§’å°±å¯ä»¥è§¦å‘ï¼Œç®—æ˜¯ä¸€ä¸ªåº”ç”¨åŠŸèƒ½çš„å¿«é€Ÿå…¥å£ï¼Œå½“ä½ è§‰å¾—åº”ç”¨çš„æŸäº›åŠŸèƒ½å¾ˆé‡è¦æ—¶ï¼Œè®©ç”¨æˆ·èƒ½å¿«é€Ÿå®šä½åˆ°è¿™ä¸ªåŠŸèƒ½ï¼Œå°±å¯ä»¥æ·»åŠ åˆ°è¿™å„¿ã€‚ å…³äºæ•°é‡ä¸Šçš„é™åˆ¶ï¼Œæˆ‘æŸ¥äº†ä¸€ä¸‹èµ„æ–™ï¼Œåœ¨ Class - UIApplicationâ€‹Shortcutâ€‹Item ä¸­æœ‰å¦‚ä¸‹å†…å®¹ The system limits the number quick actions displayed when a user presses a Home screen app icon. Within the limited set of displayed quick action titles, your* static quick actions are shown first, starting at the topmost position in the list. If your static items do not consume the permissible number for display and you have also defined dynamic quick actions using this class, then one or more of your dynamic quick actions is displayed. ç»“è®º: ç³»ç»Ÿä¼šé™åˆ¶ Quick Actions çš„æ˜¾ç¤ºæ•°é‡ï¼Œ åœ¨ iOS 9 ä¸Šæœ€å¤šæ˜¾ç¤º 4 ä¸ªï¼Œæœ‰äº›åº”ç”¨ç¡®å®å¯ä»¥æ˜¾ç¤º5ä¸ªã€‚ Quick Actions æˆªå›¾ é¢„è§ˆä¸å¼¹å‡ºçª—å£(Peek and Pop)Peek and Pop è®© Google ç›´æ¥ç¿»è¯‘æ„æ€æ˜¯å·çœ‹å’Œæµè¡Œï¼Œå¾ˆæ˜æ˜¾ä¸æ˜¯è‹¹æœæƒ³è¡¨è¾¾çš„æ„æ€ã€‚Peek è‹±æ–‡è§£é‡Šä¸º look quickly or furtively å¿«é€Ÿå·å·çš„ç¥ä¸€çœ¼ï¼Œå¤§çº¦å°±æ˜¯é¢„è§ˆçš„æ„æ€ï¼Œdoc ä¸Šæœ‰çš„è¿™ä¸€å¥ Optional navigation to the view shown in the previewâ€”known as a pop å¤§æ¦‚æ˜ç™½æ˜¯ä»€ä¹ˆæ„æ€äº†ã€‚å°±åƒå¾®ä¿¡ä¸­è¿™ä¸ªè¿™ä¸ªæ ·å­ ä¸Šé¢è¿™ä¸ªæ•ˆæœåœ¨æœªè”ç½‘çŠ¶æ€ä¸‹ä¸å—å½±å“ï¼Œè€Œ åŠ è½½çš„æ˜¯ç½‘ç»œèµ„æº,å½“æœªè”ç½‘æ—¶,å°±æ— æ³•å®ç°é¢„è§ˆåŠŸèƒ½, å±äº Web view peek and pop æŒ‰å‹å±æ€§(force properties)iOS9.0 ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ–°çš„äº¤äº’å‚æ•°:åŠ›åº¦ã€‚æˆ‘ä»¬å¯ä»¥æ£€æµ‹æŸä¸€äº¤äº’çš„åŠ›åº¦å€¼ï¼Œæ¥åšç›¸åº”çš„äº¤äº’å¤„ç† æ¯”å¦‚ç³»ç»Ÿçš„è”ç³»äºº å®ç°å…³äºä¸»å±å¿«é€Ÿå¯åŠ¨ä¸Šé¢å¼•ç”¨çš„ä¸€æ®µè¯æåˆ°äº† static quick actions å’Œ dynamic quick actions ï¼Œä¹Ÿå°±æ˜¯è¯´å¿«é€Ÿå¯åŠ¨çš„è®¾ç½®æ–¹æ³•æœ‰é™æ€å’ŒåŠ¨æ€ã€‚ é™æ€ é…ç½® info.plist æ–‡ä»¶ æ‘˜ä¸€æ®µé…·ç‹—çš„ info.plist çš„é…ç½®æ–¹æ³•ï¼Œåº”è¯¥å°±ä¸€ç›®äº†ç„¶äº† 1234567891011121314151617181920212223242526272829303132333435&lt;key&gt;UIApplicationShortcutItems&lt;/key&gt; &lt;array&gt; &lt;dict&gt; &lt;key&gt;UIApplicationShortcutItemTitle&lt;/key&gt; &lt;string&gt;å¬æ­Œè¯†æ›²&lt;/string&gt; &lt;key&gt;UIApplicationShortcutItemType&lt;/key&gt; &lt;string&gt;com.kugou.shortcut.recognize&lt;/string&gt; &lt;key&gt;UIApplicationShortcutItemIconFile&lt;/key&gt; &lt;string&gt;3d_touch_recognize.png&lt;/string&gt; &lt;/dict&gt; &lt;dict&gt; &lt;key&gt;UIApplicationShortcutItemTitle&lt;/key&gt; &lt;string&gt;ç»§ç»­æ’­æ”¾&lt;/string&gt; &lt;key&gt;UIApplicationShortcutItemType&lt;/key&gt; &lt;string&gt;com.kugou.shortcut.playmusic&lt;/string&gt; &lt;key&gt;UIApplicationShortcutItemIconFile&lt;/key&gt; &lt;string&gt;3d_touch_playmusic.png&lt;/string&gt; &lt;/dict&gt; &lt;dict&gt; &lt;key&gt;UIApplicationShortcutItemTitle&lt;/key&gt; &lt;string&gt;æœç´¢&lt;/string&gt; &lt;key&gt;UIApplicationShortcutItemType&lt;/key&gt; &lt;string&gt;com.kugou.shortcut.search&lt;/string&gt; &lt;key&gt;UIApplicationShortcutItemIconFile&lt;/key&gt; &lt;string&gt;3d_touch_search.png&lt;/string&gt; &lt;/dict&gt; &lt;dict&gt; &lt;key&gt;UIApplicationShortcutItemTitle&lt;/key&gt; &lt;string&gt;æ’­æ”¾æœ¬åœ°éŸ³ä¹&lt;/string&gt; &lt;key&gt;UIApplicationShortcutItemType&lt;/key&gt; &lt;string&gt;com.kugou.shortcut.local&lt;/string&gt; &lt;key&gt;UIApplicationShortcutItemIconFile&lt;/key&gt; &lt;string&gt;3d_touch_localmusic.png&lt;/string&gt; &lt;/dict&gt; &lt;/array&gt; UIApplicationShortcutItems æ•°ç»„ç±»å‹ å¿«æ·å¯åŠ¨çš„ key UIApplicationShortcutItemTitle æ ‡é¢˜(å¿…å¡«) [å¯ç›‘å¬è¯¥é¡¹åˆ¤æ–­ç”¨æˆ·æ˜¯ä»å“ªä¸€ä¸ªæ ‡ç­¾è¿›å…¥App] UIApplicationShortcutItemType ç±»å‹(å¿…å¡« [å¯ç›‘å¬è¯¥é¡¹åˆ¤æ–­ç”¨æˆ·æ˜¯ä»å“ªä¸€ä¸ªæ ‡ç­¾è¿›å…¥App] UIApplicationShortcutItemIconFile å›¾æ ‡(é»˜è®¤æ˜¯ä¸€ä¸ªé»‘è‰²çš„åœ†ç‚¹) åŠ¨æ€æ¯ä¸€é¡¹å¿«é€Ÿå¯åŠ¨å¯¹åº”ä¸€ä¸ª UIApplicationShortcutItem å¯¹è±¡ 1234567891011121314151617181920NS_CLASS_AVAILABLE_IOS(9_0) __TVOS_PROHIBITED@interface UIApplicationShortcutItem : NSObject &lt;NSCopying, NSMutableCopying&gt;- (instancetype)init NS_UNAVAILABLE;- (instancetype)initWithType:(NSString *)type localizedTitle:(NSString *)localizedTitle localizedSubtitle:(nullable NSString *)localizedSubtitle icon:(nullable UIApplicationShortcutIcon *)icon userInfo:(nullable NSDictionary *)userInfo NS_DESIGNATED_INITIALIZER;- (instancetype)initWithType:(NSString *)type localizedTitle:(NSString *)localizedTitle;// An application-specific string that identifies the type of action to perform.@property (nonatomic, copy, readonly) NSString *type;// Properties controlling how the item should be displayed on the home screen.@property (nonatomic, copy, readonly) NSString *localizedTitle;@property (nullable, nonatomic, copy, readonly) NSString *localizedSubtitle;@property (nullable, nonatomic, copy, readonly) UIApplicationShortcutIcon *icon;// Application-specific information needed to perform the action.// Will throw an exception if the NSDictionary is not plist-encodable.@property (nullable, nonatomic, copy, readonly) NSDictionary&lt;NSString *, id &lt;NSSecureCoding&gt;&gt; *userInfo;@end å¿«é€Ÿå¯åŠ¨é¡¹çš„å›¾æ ‡å¯¹åº”çš„æ˜¯ UIApplicationShortcutIcon ç±» 123456789101112NS_CLASS_AVAILABLE_IOS(9_0) __TVOS_PROHIBITED@interface UIApplicationShortcutIcon : NSObject &lt;NSCopying&gt;// Create an icon using a system-defined image.+ (instancetype)iconWithType:(UIApplicationShortcutIconType)type;// Create an icon from a custom image.// The provided image named will be loaded from the app's bundle// and will be masked to conform to the system-defined icon style.+ (instancetype)iconWithTemplateImageName:(NSString *)templateImageName;@end åˆ›å»º UIApplicationShortcutItem å¯¹è±¡åï¼Œå¯ä»¥é€šè¿‡ UIApplication çš„ shortcutItems å±æ€§è¿›è¡Œå…³è”ã€‚ 1234@interface UIApplication (UIShortcutItems)// Register shortcuts to display on the home screen, or retrieve currently registered shortcuts.@property (nullable, nonatomic, copy) NSArray&lt;UIApplicationShortcutItem *&gt; *shortcutItems NS_AVAILABLE_IOS(9_0) __TVOS_PROHIBITED;@end æ¯”å¦‚ç”¨å¦‚ä¸‹ä»£ç åŠ¨æ€åˆ›å»ºé…·ç‹—çš„ç¬¬ 5 ä¸ª åˆ†äº«â€é…·ç‹—â€éŸ³ä¹ 1234567891011121314151617- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions { ... /** * é€šè¿‡ä»£ç å®ç°åŠ¨æ€èœå• * ä¸€èˆ¬æƒ…å†µä¸‹è®¾ç½®ä¸»æ ‡é¢˜ã€å›¾æ ‡ã€typeç­‰ï¼Œå‰¯æ ‡é¢˜æ˜¯ä¸è®¾ç½®çš„ - ç®€çº¦åŸåˆ™ * iconWithTemplateImageName è‡ªå®šä¹‰çš„icon * iconWithType ç³»ç»Ÿçš„icon */ UIApplicationShortcutIcon *share = [UIApplicationShortcutIcon iconWithType:UIApplicationShortcutIconTypeFavorite]; UIApplicationShortcutItem *itemShare = [[UIApplicationShortcutItem alloc] initWithType:@\"share\" localizedTitle:@\"åˆ†äº« â€œé…·ç‹—â€éŸ³ä¹\" localizedSubtitle:nil icon:share userInfo:nil]; [UIApplication sharedApplication].shortcutItems = @[itemShare]; ...} ä½†æ˜¯æœ€åå‘ç°è¿˜æ˜¯åªæœ‰ 4 ä¸ª,çœ‹æ¥å¿«é€Ÿå¯åŠ¨çš„æ•°é‡ç¡®å®æ˜¯æœ‰é™åˆ¶ã€‚ é—®é¢˜: å¦‚ä½•åŒºåˆ†ç‚¹å‡»å…·ä½“è¦è·³è½¬åˆ°å“ªä¸ªåŠŸèƒ½ç•Œé¢? å¿…å®šå­˜åœ¨ä¿¡æ¯çš„ä¼ é€’ 123// Called when the user activates your application by selecting a shortcut on the home screen,// except when -application:willFinishLaunchingWithOptions: or -application:didFinishLaunchingWithOptions returns NO.- (void)application:(UIApplication *)application performActionForShortcutItem:(UIApplicationShortcutItem *)shortcutItem completionHandler:(void(^)(BOOL succeeded))completionHandler NS_AVAILABLE_IOS(9_0) __TVOS_PROHIBITED; å½“ç”¨æˆ·é€šè¿‡å¿«é€Ÿå¯åŠ¨çš„æ–¹å¼æ¿€æ´»åº”ç”¨æ—¶ï¼Œä¼šè§¦å‘ UIApplicationDelegate çš„è¿™ä¸ªæ–¹æ³• å®ç°è¯¥æ–¹æ³•,å¹¶è®¾ç½®æ–­ç‚¹ï¼Œé€šè¿‡å¿«é€Ÿå¯åŠ¨æ¿€æ´»åº”ç”¨ï¼Œè¾“å‡º shortcutItem å‚æ•° 1&lt;UIApplicationShortcutItem: 0x17026f380; type: com.kugou.shortcut.local, title: æ’­æ”¾æœ¬åœ°éŸ³ä¹&gt; æˆ‘ä»¬å¯ä»¥çŸ¥é“è‡³å°‘å¯ä»¥é€šè¿‡ type å’Œ title å»åŒºåˆ†ä¸åŒçš„å¿«é€Ÿå¯åŠ¨æŒ‰é’®ã€‚ å…³äºé¢„è§ˆä¸å¼¹å‡ºçª—å£ç»è¿‡æˆæƒçš„åº”ç”¨è§†å›¾æ§åˆ¶å™¨å¯å“åº”ç”¨æˆ·ä¸åŒçš„æŒ‰å‹åŠ›é‡ï¼Œéšç€æŒ‰å‹åŠ›é‡çš„å¢åŠ ï¼Œä¼šæœ‰ä¸‰ä¸ªäº¤äº’é˜¶æ®µï¼š æš—ç¤ºé¢„è§ˆåŠŸèƒ½å¯ç”¨ï¼Œä¼šæœ‰ä¸€ä¸ªè™šåŒ–çš„æ•ˆæœPeekï¼šé‡æŒ‰ä¸€ä¸‹åå‡ºç°çš„é¢„è§ˆï¼Œå±•ç¤ºé¢„è§ˆçš„è§†å›¾ä»¥åŠå¿«æ·èœå•Popï¼šè·³è½¬åˆ°é¢„è§ˆçš„è§†å›¾æ§åˆ¶å™¨ï¼Œæ˜¯åœ¨Peekåè¿›ä¸€æ­¥æŒ‰å‹åè¿›å…¥é¢„è§ˆçš„è§†å›¾æ§åˆ¶å™¨ æµç¨‹ ä¸»è§†å›¾æ§åˆ¶å™¨ ç”¨äºæ˜¾ç¤º Peek å¼¹çª—çš„è§†å›¾æ§åˆ¶å™¨ Peek è§†å›¾æ§åˆ¶å™¨ï¼Œç”¨äºæä¾›é¢„è§ˆçš„å¼¹çª—è§†å›¾ ä¸»è§†å›¾ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990#import \"ViewController.h\"#import \"PreviewViewController.h\"@interface ViewController () &lt;UIViewControllerPreviewingDelegate,UITableViewDataSource,UITableViewDelegate&gt; @property (nonatomic,strong) UITableView *tableView;@property (nonatomic,strong) NSArray *datas; @end@implementation ViewController- (void)viewDidLoad { [super viewDidLoad]; _tableView = [[UITableView alloc] initWithFrame:self.view.bounds style:UITableViewStylePlain]; _tableView.dataSource = self; _tableView.delegate = self; [self.view addSubview:_tableView];}- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section { return 10;}- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath { UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@\"peekpop\"]; if (cell == nil) { cell = [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:@\"peekpop\"]; } cell.textLabel.text = self.datas[indexPath.row]; /** * UIForceTouchCapability æ£€æµ‹æ˜¯å¦æ”¯æŒ3D Touch * æ”¯æŒ3D Touch */ if (self.traitCollection.forceTouchCapability == UIForceTouchCapabilityAvailable) { // ç³»ç»Ÿæ‰€æœ‰cellå¯å®ç°é¢„è§ˆï¼ˆpeekï¼‰ [self registerForPreviewingWithDelegate:self sourceView:cell]; // æ³¨å†Œcell } return cell;} - (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath{ [tableView deselectRowAtIndexPath:indexPath animated:YES]; PreviewViewController *webVC = [[PreviewViewController alloc] init]; webVC.webUrl = self.datas[indexPath.row]; webVC.hidesBottomBarWhenPushed = true; [self.navigationController pushViewController:webVC animated:true];} #pragma mark - UIViewControllerPreviewingDelegate- (nullable UIViewController *)previewingContext:(id &lt;UIViewControllerPreviewing&gt;)previewingContext viewControllerForLocation:(CGPoint)location{ // è½¬åŒ–åæ ‡ location = [self.tableView convertPoint:location fromView:[previewingContext sourceView]]; // æ ¹æ®locatonè·å–ä½ç½® NSIndexPath *indexPath = [self.tableView indexPathForRowAtPoint:location]; PreviewViewController *webVC = [[PreviewViewController alloc] init]; webVC.webUrl = self.datas[indexPath.row]; return webVC;} - (void)previewingContext:(id &lt;UIViewControllerPreviewing&gt;)previewingContext commitViewController:(UIViewController *)viewControllerToCommit{ viewControllerToCommit.hidesBottomBarWhenPushed = YES; [self.navigationController pushViewController:viewControllerToCommit animated:YES];}# pragma mark - æ‡’åŠ è½½- (NSArray *)datas { if (_datas == nil) { NSMutableArray *dataM = [NSMutableArray arrayWithCapacity:30]; for (int i = 0; i &lt; 10; ++i) { [dataM addObject:@\"https://www.baidu.com\"]; } _datas = [dataM copy]; } return _datas;}@end Peek è§†å›¾æ§åˆ¶å™¨ 123456789101112131415161718192021222324252627282930313233343536#import \"PreviewViewController.h\"@interface PreviewViewController ()@property (nonatomic,strong) UIWebView *webView;@end@implementation PreviewViewController- (void)viewDidLoad { [super viewDidLoad]; _webView = [[UIWebView alloc] initWithFrame:self.view.bounds]; [_webView loadRequest:[NSURLRequest requestWithURL:[NSURL URLWithString:_webUrl]]]; [self.view addSubview:_webView];} - (NSArray&lt;id&lt;UIPreviewActionItem&gt;&gt; *)previewActionItems{ // èµ UIPreviewAction *admire = [UIPreviewAction actionWithTitle:@\"èµ\" style:UIPreviewActionStyleDefault handler:^(UIPreviewAction * _Nonnull action, UIViewController * _Nonnull previewViewController) { NSLog(@\"ç‚¹èµæˆåŠŸ\"); }]; // ä¸¾æŠ¥ UIPreviewAction *report = [UIPreviewAction actionWithTitle:@\"ä¸¾æŠ¥\" style:UIPreviewActionStyleDestructive handler:^(UIPreviewAction * _Nonnull action, UIViewController * _Nonnull previewViewController) { NSLog(@\"ä¸¾æŠ¥æˆåŠŸ\"); }]; // æ”¶è— UIPreviewAction *collect = [UIPreviewAction actionWithTitle:@\"æ”¶è—\" style:UIPreviewActionStyleSelected handler:^(UIPreviewAction * _Nonnull action, UIViewController * _Nonnull previewViewController) { NSLog(@\"æ”¶è—æˆåŠŸ\"); }]; return @[admire,report,collect];}@end å¯¹ä»¥ä¸Šçš„ä»£ç è¿›è¡Œç®€ç­”è¯´æ˜ï¼š ä¸»è§†å›¾éµå®ˆ UIViewControllerPreviewingDelegate æ³¨å†Œè§¦å‘ Peek çš„è§†å›¾å¯¹è±¡ è®¾ç½® Peek è§†å›¾æ§åˆ¶å™¨çš„æ“ä½œ (å¯é€‰) è¯¥åè®®æœ‰ä¸¤ä¸ªæ–¹æ³• 1234567NS_CLASS_AVAILABLE_IOS(9_0) @protocol UIViewControllerPreviewingDelegate &lt;NSObject&gt;// If you return nil, a preview presentation will not be performed- (nullable UIViewController *)previewingContext:(id &lt;UIViewControllerPreviewing&gt;)previewingContext viewControllerForLocation:(CGPoint)location NS_AVAILABLE_IOS(9_0);- (void)previewingContext:(id &lt;UIViewControllerPreviewing&gt;)previewingContext commitViewController:(UIViewController *)viewControllerToCommit NS_AVAILABLE_IOS(9_0);@end æ ¹æ®API-UIViewâ€‹Controllerâ€‹Previewingâ€‹Delegate,ä¸­å¯çŸ¥ previewingâ€‹Context:â€‹viewâ€‹Controllerâ€‹Forâ€‹Location:â€‹Called when the user has pressed a source view in a previewing view controller, thereby obtaining a surrounding blur to indicate that a preview (peek) is available. previewingâ€‹Context:â€‹commitâ€‹Viewâ€‹Controller:â€‹Called to let you prepare the presentation of a commit (pop) view from your commit view controller. è¿™ä¸¤ä¸ªæ–¹æ³•å°†ä¼šåˆ†åˆ«åœ¨ç”¨æˆ·æŒ‰å‹æ“ä½œæ³¨å†Œäº† Peek çš„è§†å›¾å¯¹è±¡ä¸ Peek è§†å›¾å³å°†ä»ä¸»è§†å›¾ Pop æ—¶è§¦å‘ã€‚ å‚æ•°è¯´æ˜ previewingContextThe context object for the previewing view controller. é¢„è§ˆè§†å›¾æ§åˆ¶å™¨çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œè´Ÿè´£å®ç°ä¸€ç³»åˆ—é¢„è§ˆçš„æ•ˆæœï¼Œå…¶ä¸­çš„ sourceView å±æ€§æŒ‡å‘ä¸»è§†å›¾ä¸­è§¦å‘é¢„è§ˆæ“ä½œçš„è§†å›¾å¯¹è±¡ locationThe location of the touch in the source viewâ€™s coordinate system. location åœ¨ sourceView è§†å›¾çš„åæ ‡ç³»ä¸­è§¦æ‘¸çš„ä½ç½®ï¼Œæ¯”å¦‚åœ¨ä¸‹é¢é‚£å¼ æˆªå›¾ä¸­ä»£ç†æ–¹æ³•ä¼ é€’è¿›æ¥çš„ locaiton å‚æ•°çš„å€¼ä¸º (x = 95, y = 33.5) è¿™ä¸ªæ˜¯ç›¸å¯¹äºç‚¹å‡»çš„ cell ä¸ºäº†ç¡®å®šç‚¹å‡»çš„å…·ä½“æ˜¯å“ªä¸ª cell éœ€è¦å¯¹è¿›è¡Œè½¬æ¢ï¼Œè½¬æ¢åçš„ç»“æœä¸º (x = 95, y = 77.5) å°†æ¥è‡ªäº fromView: è§†å›¾çš„åæ ‡ location è½¬ä¸ºç›¸å¯¹äº self.tableView çš„ location ReturnThe view controller whose view you want to provide as the preview (peek), or nil to disable preview.. Peek é¢„è§ˆçš„è§†å›¾æ§åˆ¶å™¨ 12345678/*** UIForceTouchCapability æ£€æµ‹æ˜¯å¦æ”¯æŒ3D Touch* æ”¯æŒ3D Touch*/if (self.traitCollection.forceTouchCapability == UIForceTouchCapabilityAvailable) { // ç³»ç»Ÿæ‰€æœ‰cellå¯å®ç°é¢„è§ˆï¼ˆpeekï¼‰ [self registerForPreviewingWithDelegate:self sourceView:cell]; // æ³¨å†Œcell} æ³¨å†Œä¸å–æ¶ˆæ³¨å†Œ API 1234567@interface UIViewController (UIViewControllerPreviewingRegistration)// Registers a view controller to participate with 3D Touch preview (peek) and commit (pop).- (id &lt;UIViewControllerPreviewing&gt;)registerForPreviewingWithDelegate:(id&lt;UIViewControllerPreviewingDelegate&gt;)delegate sourceView:(UIView *)sourceView NS_AVAILABLE_IOS(9_0);- (void)unregisterForPreviewingWithContext:(id &lt;UIViewControllerPreviewing&gt;)previewing NS_AVAILABLE_IOS(9_0);@end åœ¨ Peek è§†å›¾æ§åˆ¶å™¨ä¸­æ·»åŠ ä»£ç  12345678910- (NSArray&lt;id&lt;UIPreviewActionItem&gt;&gt; *)previewActionItems{ // èµ UIPreviewAction *admire = [UIPreviewAction actionWithTitle:@\"èµ\" style:UIPreviewActionStyleDefault handler:^(UIPreviewAction * _Nonnull action, UIViewController * _Nonnull previewViewController) { NSLog(@\"ç‚¹èµæˆåŠŸ\"); }]; ... return @[admire,report,collect];} å› ä¸ºå¯¹é¢„è§ˆçš„è§†å›¾çš„æ“ä½œå†™åœ¨ Peek è§†å›¾æ§åˆ¶å™¨æ˜¯å¾ˆæ­£å¸¸ Swift çš„å®ç°é£æ ¼çš„å¯ä»¥å‚è€ƒæ–‡ç« åçš„é“¾æ¥ ViewControllerPreviews: Using the UIViewController previewing APIsã€‚ å…³äºæŒ‰å‹å±æ€§1234// Force of the touch, where 1.0 represents the force of an average touch@property(nonatomic,readonly) CGFloat force NS_AVAILABLE_IOS(9_0);// Maximum possible force with this input mechanism@property(nonatomic,readonly) CGFloat maximumPossibleForce NS_AVAILABLE_IOS(9_0); æŒ‰å‹å®ç°é¢„è§ˆæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§æ ¹æ®æŒ‰å‹å®ç°çš„äº¤äº’ã€‚åœ¨æ­¤å°±ä¸åœ¨èµ˜è¿°äº†ã€‚ å‚è€ƒ Is there a limit to how many UIApplicationShortcutItems you can have? 3D Touch Quick Action 4 Item Limit? iOSä¹‹å®ç°3D Touch API-UIViewâ€‹Controllerâ€‹Previewingâ€‹Delegate ViewControllerPreviews: Using the UIViewController previewing APIs Understanding convertPoint:toView:","link":"/2017/03/18/iOSer-Realize-3d-Touch-on-iOS/"},{"title":"é˜…è¯»:iOS Appç­¾åçš„åŸç†","text":"å¯¼è¯­ å‰å‡ å¤©åœ¨ Bugly å…¬ä¼—å·ä¸Šçœ‹åˆ°è¿™ç¯‡ iOS Appç­¾åçš„åŸç†ï¼Œè§£å†³äº†æˆ‘åŸæ¥å…³äº iOS å¼€å‘çš„è¯ä¹¦ç›¸å…³çŸ¥è¯†çš„ä¸€äº›æ¨¡ç³Šçš„åœ°æ–¹ã€‚ ä¸‹é¢æŒ‰ä½¿ç”¨çš„åœºæ™¯è¿›è¡Œæ¢³ç†ã€‚ åœºæ™¯ä¸€: æŒ‡å®š AppStore å®‰è£… App æ‰“åŒ…ä¸Šä¼ åˆ° AppStore ï¼Œè‹¹æœæœåŠ¡å™¨ç”¨å¯¹åº”ç”¨è¿›è¡ŒåŠ å£³,ç­¾å,ç”¨ç§é’¥å¯¹ç­¾ååŠ å¯† iOS ä» AppStore ä¸‹è½½åº”ç”¨ï¼Œåœ¨å®‰è£…æ—¶ç”¨å…¬é’¥è¿›è¡ŒéªŒè¯ .ipa åŒ…é‡Œæœ‰ä¸€ä¸ª _CodeSignature çš„æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­æœ‰ä¸ª CodeResourcesæ–‡ä»¶,æ‹–æ‹½åˆ° Sublime Text ä¸­ï¼Œå‘ç°å…¶å†…å®¹åŒ…æ‹¬ 4 ä¸ªèŠ‚ç‚¹ï¼Œ 12345678910111213141516171819202122&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"&gt;&lt;plist version=\"1.0\"&gt;&lt;dict&gt; &lt;key&gt;files&lt;/key&gt; &lt;dict&gt; ... &lt;/dict&gt; &lt;key&gt;files2&lt;/key&gt; &lt;dict&gt; ... &lt;/dict&gt; &lt;key&gt;rules&lt;/key&gt; &lt;dict&gt; ... &lt;/dict&gt; &lt;key&gt;rules2&lt;/key&gt; &lt;dict&gt; ... &lt;/dict&gt;&lt;/dict&gt;&lt;/plist&gt; å‚è€ƒè¿™ç¯‡æ–‡ç« ,å¯ä»¥å¾—åˆ°å¦‚ä¸‹è§‚ç‚¹ rules å’Œ files æ˜¯ä¸ºè€ç‰ˆæœ¬å‡†å¤‡çš„ï¼Œè€Œ files2 å’Œ rules2æ˜¯ä¸ºæ–°çš„ç¬¬äºŒç‰ˆçš„ä»£ç ç­¾åå‡†å¤‡çš„ã€‚æœ€ä¸»è¦çš„åŒºåˆ«æ˜¯åœ¨æ–°ç‰ˆæœ¬ä¸­ä½ æ— æ³•å†å°†æŸäº›èµ„æºæ–‡ä»¶æ’é™¤åœ¨ä»£ç ç­¾åä¹‹å¤–ã€‚ äºŒè¿›åˆ¶çš„ç­¾åä¼šè¢«æ”¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ å‚è€ƒæ•°å­—ç­¾åçš„è¿‡ç¨‹ï¼Œæ•´ä¸ªæµç¨‹åº”è¯¥è¿™æ ·çš„: è‹¹æœåå°å¯¹åº”ç”¨ä¸­çš„å„é¡¹èµ„æºè¿›è¡Œå“ˆå¸Œå¹¶ç­¾åç”Ÿæˆè¯¥è¡¨ï¼Œç”¨ä»¥æ ‡è¯†è¿™ä¸ªåº”ç”¨ï¼Œå½“è¦å®‰è£…åˆ° iOS è®¾å¤‡ä¸­æ—¶ï¼Œå…ˆç”¨å…¬é’¥è§£å¯†ç­¾å,åŒæ ·å¯¹èµ„æºè¿›è¡Œå“ˆå¸Œç„¶åè¿›è¡ŒåŒ¹é…ã€‚å¦‚æœåŒ¹é…ä¸Šçš„è¯ï¼Œåœ¨å½“å‰åœºæ™¯ä¸‹å°±å¯ä»¥è¯æ˜åº”ç”¨æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ï¼Œå³ä»£è¡¨æ˜¯ä» AppStore ä¸Šä¸‹è½½çš„ï¼Œå¦‚æœéªŒè¯ä¸é€šè¿‡ï¼Œåˆ™æ— æ³•å®‰è£…ã€‚ äºŒè¿›åˆ¶çš„ç­¾åæˆ‘æ‰¾äº† Apple çš„Code Signing Guide é‡æ–°ç¡®å®šäº†ä¸‹ç­¾åçš„éƒ¨åˆ† å“ªäº›æ–‡ä»¶å‚ä¸çš„ç­¾å Nested code , æ¯”å¦‚ .a é™æ€åº“, .frameworks (å…ˆç­¾å)Mach-O executables , äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶Resources , èµ„æºæ–‡ä»¶ï¼Œå°±æ˜¯ CodeResources çš„éƒ¨åˆ† To apply the signature, the codesign utility adds the signature directly to the executable file. è¿™å¥è¯ç¡®å®è¯æ˜äº†å…³äºäºŒè¿›åˆ¶çš„ç­¾åä¼šç›´æ¥è¢«åŠ åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚ åœºæ™¯äºŒ : å¼€å‘ç¯å¢ƒä¸‹å®‰è£…åº”ç”¨å‚è€ƒæ•°å­—è¯ä¹¦çš„è¿‡ç¨‹ mac: æœåŠ¡å™¨è‹¹æœæœåŠ¡å™¨: CAiOS è®¾å¤‡: å®¢æˆ·ç«¯ æœåŠ¡å™¨å‘ CA å‘é€è¯ä¹¦è¯·æ±‚( .csr ),å…¶ä¸­åŒ…å«äº†æœ¬åœ°ç”Ÿæˆçš„å…¬é’¥ï¼ŒCA ç­¾ååå°†è¯ä¹¦å‘é€å›æœåŠ¡å™¨å¹¶å®‰è£…åˆ°æœåŠ¡å™¨ä¸Šï¼Œåœ¨è¿›è¡Œåº”ç”¨å®‰è£…æ—¶ï¼Œç”¨æœ¬åœ°ç§é’¥ç­¾åå¹¶å°†è¯ä¹¦ä¸€èµ·å®‰è£…åˆ°å®¢æˆ·ç«¯ã€‚ å› ä¸ºå®¢æˆ·ç«¯æœ‰ CA çš„å…¬é’¥ï¼Œæ‰€ä»¥å¯ä»¥è§£å¯†è¯ä¹¦çš„ç­¾åï¼Œç„¶åé€šè¿‡è®¡ç®—éªŒè¯å…¬é’¥æ˜¯å¦å·²è¢«è®¤è¯ï¼Œè‹¥è¢«è®¤è¯ï¼Œåˆ™ä½¿ç”¨å…¶å…¬é’¥æ¥è§£å¯†ç§é’¥åŠ å¯†çš„å†…å®¹ã€‚ è¯ä¹¦æ˜¯é™„åœ¨åé¢å®‰è£…æåˆ°çš„ embedded.moilbeprovision åœºæ™¯ä¸‰ : AdHoc/ä¼ä¸šè¯ä¹¦å®‰è£…åº”ç”¨ä¸ºäº†ä¿è¯æƒé™(é€šçŸ¥ï¼ŒIAPâ€¦)ï¼Œå®‰è£…è®¾å¤‡æ•°é‡ç»Ÿä¸€è¿›è¡Œæ§åˆ¶ï¼Œå¼•å…¥äº†æè¿°æ–‡ä»¶ (Provisioning Profile) ã€‚ æè¿°æ–‡ä»¶ä¹Ÿç”¨è‹¹æœæœåŠ¡å™¨ç§é’¥ç­¾åï¼Œæ‰“åŒ…æ—¶ï¼Œä¼šæŠŠæè¿°æ–‡ä»¶ä¸€èµ·æ‰“åŒ…åˆ°åˆ°åº”ç”¨ä¸­ï¼Œæ–‡ä»¶åä¸º embedded.mobileprovision ç¼–è¯‘è‡ªå·±çš„ä»»æ„ä¸€ä¸ªå·¥ç¨‹,ç„¶åæ‰¾åˆ° Produce çš„ç›®å½•,é‡Œé¢æœ‰ .app ç›®å½•ï¼Œè¿›åˆ°é‡Œé¢å³å¯å‘ç° embedded.mobileprovisionã€‚ å¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹ 1security cms -D -i embedded.mobileprovision 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"&gt;&lt;plist version=\"1.0\"&gt;&lt;dict&gt; &lt;key&gt;AppIDName&lt;/key&gt; &lt;string&gt;XC Wildcard&lt;/string&gt; &lt;key&gt;ApplicationIdentifierPrefix&lt;/key&gt; &lt;array&gt; &lt;string&gt;ZEY3XXXXXX&lt;/string&gt; &lt;/array&gt; &lt;key&gt;CreationDate&lt;/key&gt; &lt;date&gt;2017-03-08T06:25:32Z&lt;/date&gt; &lt;key&gt;Platform&lt;/key&gt; &lt;array&gt; &lt;string&gt;iOS&lt;/string&gt; &lt;/array&gt; &lt;key&gt;DeveloperCertificates&lt;/key&gt; &lt;array&gt; &lt;data&gt;MIIF...fA=&lt;/data&gt; &lt;data&gt;MIIF...94=&lt;/data&gt; &lt;/array&gt; &lt;key&gt;Entitlements&lt;/key&gt; &lt;dict&gt; &lt;key&gt;keychain-access-groups&lt;/key&gt; &lt;array&gt; &lt;string&gt;ZEY3XXXXXX.*&lt;/string&gt; &lt;/array&gt; &lt;key&gt;get-task-allow&lt;/key&gt; &lt;true/&gt; &lt;key&gt;application-identifier&lt;/key&gt; &lt;string&gt;ZEY3XXXXXX.*&lt;/string&gt; &lt;key&gt;com.apple.developer.team-identifier&lt;/key&gt; &lt;string&gt;ZEY3XXXXXX&lt;/string&gt; &lt;/dict&gt; &lt;key&gt;ExpirationDate&lt;/key&gt; &lt;date&gt;2018-03-08T06:25:32Z&lt;/date&gt; &lt;key&gt;Name&lt;/key&gt; &lt;string&gt;iOS Team Provisioning Profile: *&lt;/string&gt; &lt;key&gt;ProvisionedDevices&lt;/key&gt; &lt;array&gt; &lt;string&gt;2b8ffa94ec91d9ce9c94da9ad423b88888888888&lt;/string&gt; &lt;/array&gt; &lt;key&gt;TeamIdentifier&lt;/key&gt; &lt;array&gt; &lt;string&gt;ZEY3XXXXXX&lt;/string&gt; &lt;/array&gt; &lt;key&gt;TeamName&lt;/key&gt; &lt;string&gt;Deliang Wang&lt;/string&gt; &lt;key&gt;TimeToLive&lt;/key&gt; &lt;integer&gt;365&lt;/integer&gt; &lt;key&gt;UUID&lt;/key&gt; &lt;string&gt;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&lt;/string&gt; &lt;key&gt;Version&lt;/key&gt; &lt;integer&gt;1&lt;/integer&gt;&lt;/dict&gt; å¯çœ‹åˆ° embedded.moilbeprovision ä¸­åŒ…å«äº†åº”ç”¨çš„åŒ…åï¼Œè¯ä¹¦ï¼Œå¯å®‰è£…è®¾å¤‡ï¼Œè¿‡æœŸæ—¶é—´ç­‰ç­‰ä¿¡æ¯ã€‚ æœ€åå…³é”®ç‚¹ æ•°å­—ç­¾åçš„ä¿è¯äº†åº”ç”¨çš„å®Œæ•´æ€§ä¸”æ¥è‡ª AppStore ã€‚ æè¿°æ–‡ä»¶ç»Ÿä¸€ç®¡ç†æƒé™ï¼ŒåŒ…åï¼Œå¯å®‰è£…çš„è®¾å¤‡ç­‰ä¿¡æ¯ã€‚ éå¯¹ç§°åŠ å¯†ï¼Œç§é’¥åŠ å¯†ï¼Œå…¬é’¥éªŒè¯ é™„ä¸€å¼ æ¥è‡ªåŸæ–‡çš„å›¾ Thatâ€™s all å‚è€ƒ æ•°å­—ç­¾å æ•°å­—è¯ä¹¦ æ¼«è°ˆiOSç¨‹åºçš„è¯ä¹¦å’Œç­¾åæœºåˆ¶ Apple - Code Signing Guide","link":"/2017/03/28/iOSer-Readers-iOS-App-signature-principle/"},{"title":"å°è®° - Apple å¼€å‘è€…ç»­è´¹","text":"å¯¼è¯­æœ€è¿‘ï¼Œå…¬å¸çš„ä¸ªäººå¼€å‘è€…è´¦å·éœ€è¦ç»­è´¹ï¼ŒåŒäº‹å‘ç°ä»–çš„ VISA ä¿¡ç”¨å¡æ— æ³•æ”¯ä»˜ã€‚æç¤ºä½ çš„æ”¯ä»˜æˆæƒå¤±è´¥ã€‚è¯·æ ¸å®ä½ çš„ä¿¡æ¯åé‡è¯•ï¼Œæˆ–è¯•è¯•å…¶ä»–ä»˜æ¬¾æ–¹å¼ã€‚æˆ‘åœ¨å°è¯•çš„æ—¶å€™ä¹ŸæŠ¥äº†ä¸Šé¢çš„é”™è¯¯ï¼Œå†æ¬¡å°è¯•å°±é¡ºåˆ©æ”¯ä»˜äº†ã€‚æœç´¢åå‘ç°åŸæ¥è‡ª 2015å¹´6æœˆ1æ—¥ èµ·ï¼Œä¸­å›½å¤§é™†å‘è¡Œçš„ VISA å•æ ‡å¡è‹¥åœ¨ä¸­å›½å¢ƒå†…ä»–è¡Œçš„ VISA å¤–å¡æ”¶å•å•†æˆ·äº¤æ˜“ï¼ŒVISA ç½‘ç»œå°†ä¸èƒ½å—ç†ã€‚ è§£å†³æ–¹æ¡ˆæ¢ä¸€å¼  VISA + é“¶è” çš„åŒæ ‡å¡ ä¸è¿‡æ®è¯´å¾ˆå¤šé“¶è¡Œè¡¨ç¤ºå·²ä¸å†å‘åŒæ ‡å¡äº§å“â€¦ å•æ ‡å¡ åŒæ ‡å¡ å‚è€ƒ å…³äºå¢ƒå†…VISAå•æ ‡ä¿¡ç”¨å¡åœæ­¢å¢ƒå†…è·¨è¡Œå—ç†çš„é€šçŸ¥ è´­ä¹°å¼€å‘è€…è´¦å·å¤±è´¥ï¼Œæ”¯ä»˜çš„æ—¶å€™æ€»æ˜¯æç¤ºâ€œæˆæƒå¤±è´¥â€¦â€çš„æç¤º å¤®å¦ˆæ”¾å¤§æ‹›ï¼šâ€œåŒæ ‡â€ä¿¡ç”¨å¡å°†æ­£å¼é€€å¸‚","link":"/2017/04/27/iOSer-Small-note-Apple-developer-renewal/"},{"title":"Swift 3ä¸Šçš„Stringå’ŒCharacter","text":"æ¦‚è§ˆ å­—ç¬¦ä¸²å¦‚ä½•éå†?å­—ç¬¦ä¸²å¦‚ä½•æ“ä½œ(å¢åˆ æ”¹)?å­—ç¬¦ä¸²å¦‚ä½•æ¯”è¾ƒ? æœ¬æ–‡ä¸»è¦å…³æ³¨çš„å°±æ˜¯å­—ç¬¦ä¸²çš„ä¸Šé¢3ç‚¹æ“ä½œ ç¯å¢ƒè¯´æ˜ macOS Sierra 10.12.2Xcode Version 8.2.1 å¦‚ä½•éå†?OCå…ˆçœ‹çœ‹OCä¸­å¦‚ä½•å¯¹é›†åˆè¿›è¡Œéå† 123456789101112131415NSArray *ss = @[@1,@2,@3];// forI æä¾›å¤–éƒ¨ç´¢å¼•,é€šè¿‡ç´¢å¼•éå†é›†åˆfor (int i = 0; i &lt; ss.count; ++i) { NSLog(@\"forI:%@\",ss[i]);}// forin é€šè¿‡å†…éƒ¨è¿­ä»£é›†åˆ,ä¸éœ€è¦ç´¢å¼•for (NSNumber *s in ss) { NSLog(@\"forin:%@\",s);}// blockæ–¹å¼è¿­ä»£[ss enumerateObjectsUsingBlock:^(id _Nonnull s, NSUInteger idx, BOOL * _Nonnull stop) { NSLog(@\"enumerate:%@\",s);}]; éå†OCå­—ç¬¦ä¸²çš„æ–¹å¼ 12345678910111213141516NSString *s = @\"testString\";// forIfor (int i = 0; i &lt; s.length; ++i) { NSLog(@\"%c\",[s characterAtIndex:i]);}// Collection expression type 'NSString *' may not respond to 'countByEnumeratingWithState:objects:count:'// NSStringå¹¶æ²¡æœ‰å®ç°NSFastEnumerationåè®®// for (NSString *subs in s) { // } [s enumerateSubstringsInRange:NSMakeRange(0, s.length) options:NSStringEnumerationByComposedCharacterSequences usingBlock:^(NSString * _Nullable substring, NSRange substringRange, NSRange enclosingRange, BOOL * _Nonnull stop) { NSLog(@\"%@\",substring);}]; Swift12345678// - æ‘˜è‡ªString.h iOS10.2public struct String { /// Creates an empty string. public init() ...} ç”±ä¸Šå¯çŸ¥:Swiftä¸­çš„å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªç»“æ„ä½“ ç»“æ„ä½“æ˜¯å€¼ç±»å‹,ä½œå‚æ•°ä¼ é€’æ—¶æ˜¯æ‹·è´å‰¯æœ¬è¿›è¡Œä¼ é€’,ä¿è¯åŸå­—ç¬¦ä¸²ä¸ä¼šè¢«æ”¹å˜ æŸ¥çœ‹ä¸Šé¢çš„æ³¨é‡Šå¯ä»¥äº†è§£åˆ°Stringçš„ä¸€äº›çŸ¥è¯†ç‚¹ ä¸NSStringç±»æ— ç¼æ¡¥æ¥123456/// A Unicode string value.////// A string is a series of characters, such as `\"Swift\"`. Strings in Swift are/// Unicode correct, locale insensitive, and designed to be efficient. The/// `String` type bridges with the Objective-C class `NSString` and offers/// interoperability with C functions that works with strings. ç”¨å­—é¢é‡åˆå§‹åŒ–12345/// You can create new strings using string literals or string interpolations./// A string literal is a series of characters enclosed in quotes.////// let greeting = \"Welcome!\"/// 123456789101112131415161718/// Character View/// --------------////// A string's `characters` property is a collection of *extended grapheme/// clusters*, which approximate human-readable characters. Many individual/// characters, such as \"Ã©\", \"ê¹€\", and \"ğŸ‡®ğŸ‡³\", can be made up of multiple Unicode/// code points. These code points are combined by Unicode's boundary/// algorithms into extended grapheme clusters, represented by Swift's/// `Character` type. Each element of the `characters` view is represented by/// a `Character` instance.////// print(cafe.characters.count)/// // Prints \"9\"/// print(Array(cafe.characters))/// // Prints \"[\"C\", \"a\", \"f\", \"Ã©\", \" \", \"d\", \"u\", \" \", \"ğŸŒ\"]\"////// Each visible character in the `cafe` string is a separate element of the/// `characters` view. æŸ¥çœ‹Stringçš„characterså±æ€§ 1234567public struct CharacterView { /// Creates a view of the given string. public init(_ text: String)}/// A view of the string's contents as a collection of characters.public var characters: String.CharacterView Stringçš„charactersæ˜¯ä¸€ä¸ªå­—ç¬¦é›†åˆå¯ä»¥æ ¹æ®characterså¯¹Stringè¿›è¡Œéå†æ“ä½œ String.CharacterView123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869/// `String.CharacterView` is a collection of `Character`.extension String.CharacterView : BidirectionalCollection { /// A position in a string's `CharacterView` instance. /// /// You can convert between indices of the different string views by using /// conversion initializers and the `samePosition(in:)` method overloads. /// The following example finds the index of the first space in the string's /// character view and then converts that to the same position in the UTF-8 /// view: /// /// let hearts = \"Hearts &lt;3 â™¥ï¸ ğŸ’˜\" /// if let i = hearts.characters.index(of: \" \") { /// let j = i.samePosition(in: hearts.utf8) /// print(Array(hearts.utf8.prefix(upTo: j))) /// } /// // Prints \"[72, 101, 97, 114, 116, 115]\" public struct Index : Comparable, CustomPlaygroundQuickLookable { /// A custom playground Quick Look for this instance. /// /// If this type has value semantics, the `PlaygroundQuickLook` instance /// should be unaffected by subsequent mutations. public var customPlaygroundQuickLook: PlaygroundQuickLook { get } } /// A type used to represent the number of steps between two indices, where /// one value is reachable from the other. /// /// In Swift, *reachability* refers to the ability to produce one value from /// the other through zero or more applications of `index(after:)`. public typealias IndexDistance = Int /// The position of the first character in a nonempty character view. /// /// In an empty character view, `startIndex` is equal to `endIndex`. public var startIndex: String.CharacterView.Index { get } /// A character view's \"past the end\" position---that is, the position one /// greater than the last valid subscript argument. /// /// In an empty character view, `endIndex` is equal to `startIndex`. public var endIndex: String.CharacterView.Index { get } /// Returns the next consecutive position after `i`. /// /// - Precondition: The next position is valid. public func index(after i: String.CharacterView.Index) -&gt; String.CharacterView.Index /// Returns the previous consecutive position before `i`. /// /// - Precondition: The previous position is valid. public func index(before i: String.CharacterView.Index) -&gt; String.CharacterView.Index /// Accesses the character at the given position. /// /// The following example searches a string's character view for a capital /// letter and then prints the character at the found index: /// /// let greeting = \"Hello, friend!\" /// if let i = greeting.characters.index(where: { \"A\"...\"Z\" ~= $0 }) { /// print(\"First capital letter: \\(greeting.characters[i])\") /// } /// // Prints \"First capital letter: H\" /// /// - Parameter position: A valid index of the character view. `position` /// must be less than the view's end index. public subscript(i: String.CharacterView.Index) -&gt; Character { get }} ç”±ä¸Šé¢å¯ä»¥å¾—çŸ¥,forIæ–¹å¼çš„ç´¢å¼•çš„æ•°æ®ç±»å‹ç”±åŸæ¥çš„intæ”¹æˆäº†String.CharacterView.Index 1let s = \"Swift\" forIæ–¹å¼ 123for i in 0..&lt;s.characters.count { print(s.characters[s.characters.index(s.startIndex, offsetBy: i)])} for-inæ–¹å¼ 123for c in s.characters { print(c)} blockæ–¹å¼ 123s.characters.forEach { (c) in print(c)} å¦‚ä½•æ“ä½œ(å¢åˆ æ”¹)?å¢ å¯ä»¥ç”¨\\(String)ç»„åˆå­—ç¬¦ä¸² 12345678910111213/// String interpolations are string literals that evaluate any included/// expressions and convert the results to string form. String interpolations/// are an easy way to build a string from multiple pieces. Wrap each/// expression in a string interpolation in parentheses, prefixed by a/// backslash.////// let name = \"Rosa\"/// let personalizedGreeting = \"Welcome, \\(name)!\"////// let price = 2/// let number = 3/// let cookiePrice = \"\\(number) cookies: $\\(price * number).\"/// å¯ä»¥ç”¨*â€+â€*è¿æ¥å­—ç¬¦ä¸² 123456/// Combine strings using the concatenation operator (`+`).////// let longerGreeting = greeting + \" We're glad you're here!\"/// print(longerGreeting)/// // Prints \"Welcome! We're glad you're here!\"/// appendâ€¦ åˆ  removeAll( ) remove(at:â€¦) â€¦ æ”¹12345// ç›´æ¥èµ‹å€¼s = \"swift\"// æ›¿æ¢s.replaceSubrange(s.index(s.startIndex,offsetBy:1)...s.index(s.startIndex, offsetBy: 4), with: \"WIFT\") å¦‚ä½•æ¯”è¾ƒ?12345678910111213/// Comparing strings for equality using the equal-to operator (`==`) or a/// relational operator (like `&lt;` and `&gt;=`) is always performed using the/// Unicode canonical representation. This means that different/// representations of a string compare as being equal.////// let cafe1 = \"Cafe\\u{301}\"/// let cafe2 = \"CafÃ©\"/// print(cafe1 == cafe2)/// // Prints \"true\"////// The Unicode code point `\"\\u{301}\"` modifies the preceding character to/// include an accent, so `\"e\\u{301}\"` has the same canonical representation/// as the single Unicode code point `\"Ã©\"`. 123456789101112extension String : Equatable { /// Returns a Boolean value indicating whether two values are equal. /// /// Equality is the inverse of inequality. For any values `a` and `b`, /// `a == b` implies that `a != b` is `false`. /// /// - Parameters: /// - lhs: A value to compare. /// - rhs: Another value to compare. public static func ==(lhs: String, rhs: String) -&gt; Bool} Unicodeç¼–ç  ä½¿ç”¨==è¿›è¡Œæ¯”è¾ƒ å†…å®¹æ¯”è¾ƒ å‚è€ƒ å­—ç¬¦ä¸²å’Œå­—ç¬¦ï¼ˆStrings and Charactersï¼‰","link":"/2017/01/30/iOSer-String-and-Character-on-Swift-3/"},{"title":"UIViewçš„initä¸initWithFrame:çš„è°ƒç”¨å…³ç³»","text":"å‰è¨€ å‡‘å·§å¾—çŸ¥äº†ä»¥ä¸‹ç°è±¡: è°ƒç”¨UIViewå­ç±»çš„initæ–¹æ³•ä¼šå…ˆå»è°ƒç”¨initWithFrame: è°ƒç”¨UIViewå­ç±»çš„initWithFrame:ä¸ä¼šè°ƒç”¨initæ–¹æ³• ä¸€å¼€å§‹ä¼šå¾ˆè‡ªç„¶çš„è®¤ä¸ºinitWithFrame:å¤šä¸€ä¸ªå‚æ•°çš„æ–¹æ³•å†…éƒ¨ä¼šè°ƒç”¨initè¿™ä¸ªåˆå§‹åŒ–æ–¹æ³•,ä¼šå¯¹ä¸Šé¢çš„ç°è±¡æ„Ÿåˆ°å¥‡æ€ªã€‚ä½†æ˜¯åœ¨ç”¨XcodeæŸ¥çœ‹äº†initå’ŒinitWithFrame:æ–¹æ³•çš„è¯´æ˜åå°±äº†ç„¶äº†ã€‚ æµç¨‹ å…ˆä»frameè¿™ä¸ªUIViewçš„å±æ€§å…¥æ‰‹,å½“ç”¨ 1UIView *v = [[UIView alloc] init]; ç”¨lldbè°ƒè¯•æ‰“å°å‡ºframe ä»å¾—åˆ°çš„ç»“æœå¯çŸ¥:å°±ç®—åªè°ƒç”¨initæ–¹æ³•,UIViewå¯¹è±¡çš„frameä¹Ÿæ˜¯æœ‰å€¼çš„? ç±»ä¼¼Javaç±»ä¸­çš„åŸºæœ¬æ•°æ®ç»“æ„,éƒ½æœ‰é»˜è®¤å€¼ ç›´æ¥è®¾ç½®frameå±æ€§,å½“å‰æƒ…å†µä¸‹,è‡³å°‘æˆ‘æ²¡æœ‰å†™,è™½ç„¶æœ€ç»ˆè‚¯å®šæ˜¯è¦è¿›è¡Œè®¾ç½®çš„ è°ƒç”¨äº†initWithFrame:æ–¹æ³•,ä¼ é€’çš„å‚æ•°ä¸ºCGRectZero å› ä¸ºæ²¡æœ‰UIViewçš„initæ–¹æ³•çš„å…·ä½“ä»£ç ,æ‰€ä»¥åªèƒ½ç®—æ˜¯*æ£æµ‹*,æ ¹æ®å®é™…çš„æƒ…å†µ,å†åŠ ä¸Šæ—¢ç„¶å·²ç»æœ‰äº†initWithFrame:æ–¹æ³•è®¾ç½®frame,åº”è¯¥æ²¡å¿…è¦æé‚£ä¹ˆéº»çƒ¦,å°±ç¬¬3ç§æƒ…å†µå§ã€‚ è°ƒç”¨UIViewå­ç±»çš„initæ–¹æ³•ä¼šå…ˆå»è°ƒç”¨initWithFrame:,è¿™ä¸ªç®—æ˜¯å¯ä»¥æˆç«‹çš„ è‹¥initè°ƒç”¨initWithFrame:(?),initWithFrame:è‡ªç„¶å°±ä¸ä¼šå†è°ƒç”¨initæ–¹æ³•äº†ã€‚ å®ç°å°è¯•å»ç¼–å†™ç¬¦åˆä¸Šé¢å‡è®¾çš„ä»£ç  æŸ¥çœ‹NSObjectä¸­çš„initæ–¹æ³•çš„è¯´æ˜ è‡³å°‘å¯ä»¥å¾—çŸ¥ä¸¤ç‚¹ initæ˜¯è®©å­ç±»å®ç°åˆå§‹åŒ–ä¸€ä¸ªæ–°å¯¹è±¡çš„æ–¹æ³•NSObjectç±»çš„initæ²¡æœ‰åˆå§‹åŒ–æ“ä½œ,åªæ˜¯ç®€å•çš„è¿”å›äº†ä¸€ä¸ªselfæŒ‡é’ˆ ç»§æ‰¿å…³ç³»ä¸º:CustomView -&gt; UIView -&gt; UIResponder -&gt; NSObject NSObjectç±» 1234567- (instancetype)init { self = [super init]; if (self) { // Initialize self } return self;} UIViewç±» 123456789101112131415161718- (instancetype)init { self = [super init]; if (self) { ... [self initWithFrame:CGRectZero]; ... } return self;}- (instancetype)initWithFrame:(CGRect)frame { self = [super init]; if (self) { ... self.frame = frame; ... }} â€¦ CustomUIViewç±» 1234567891011121314- (instancetype)init { self = [super init]; if (self) { ... } return self;}- (instancetype)initWithFrame:(CGRect)frame { self = [super initWithFrame:frame]; if (self) { ... }} CustomViewå¯¹è±¡è°ƒç”¨initæ–¹æ³• è°ƒç”¨UIViewçš„initæ–¹æ³• è°ƒç”¨NSObjectçš„initæ–¹æ³•,è¿”å›selfæŒ‡é’ˆ selfæ˜¯CustomViewå¯¹è±¡,æ‰€ä»¥æ‰§è¡ŒCustomViewå¯¹è±¡çš„initWithFrame:æ–¹æ³• CustomViewå¯¹è±¡è°ƒç”¨initWithFrame:å¯¹è±¡ è°ƒç”¨UIViewçš„initæ–¹æ³• è°ƒç”¨NSObjectçš„initæ–¹æ³•,è¿”å›selfæŒ‡é’ˆ æ ¹æ®ä¼ é€’å‚æ•°è®¾ç½®frameå±æ€§å€¼ å‚è€ƒ ä¸€ä¸ªç±»ç»§æ‰¿UIView,è°ƒç”¨initæ–¹æ³•,ä¸ºä»€ä¹ˆè¿™ä¸ªinitæ–¹æ³•ä¼šå»è°ƒç”¨æˆ‘é‡å†™çš„initWithFrameæ–¹æ³•?","link":"/2017/03/01/iOSer-UIView-init-and-initWithFrame-call-relationship/"},{"title":"ç†è§£objcè¿è¡Œæ—¶ä¸€:ç±»æ˜¯ä»€ä¹ˆ","text":"ç¯å¢ƒè¯´æ˜ macOS Sierra 10.12.1Xcode 8.1 è·å¾—å¯è¿è¡Œçš„objcæºç ä¸€ä¸ªå¯ä»¥ç¼–è¯‘å¹¶è¿è¡Œçš„objcæºç æ‰èƒ½æ›´å¥½çš„ç†è§£è¿è¡Œæ—¶ objc-706 ç±»OCä¸­çš„å¤§éƒ¨åˆ†ç±»æ˜¯ç»§æ‰¿è‡ªNSObjectè¿™ä¸ªç±»çš„å› æ­¤ä»NSObjectè¿™ä¸ªç±»å…¥æ‰‹ NSObject.h 123@interface NSObject &lt;NSObject&gt; { Class isa OBJC_ISA_AVAILABILITY;} å¯çŸ¥NSObjectå¯¹è±¡åŒ…å«ä¸€ä¸ªClassç±»å‹çš„isaæŒ‡é’ˆ Class æœ‰3ä¸ªæ–‡ä»¶ä¸Classæœ‰å…³ æ‰“å¼€ä¸€ä¸ªå…¶ä»–çš„ä¸€ä¸ªæ­£å¸¸çš„Xcodeå·¥ç¨‹,åŒæ ·ç‚¹å‡»Class è¿›å…¥åˆ° objc.h å†è¿›å…¥åˆ°runtime.h,Classçš„å®šä¹‰ 1234567891011121314151617181920212223242526272829303132333435/* Types */#if !OBJC_TYPES_DEFINED/// An opaque type that represents a method in a class definition.typedef struct objc_method *Method;/// An opaque type that represents an instance variable.typedef struct objc_ivar *Ivar;/// An opaque type that represents a category.typedef struct objc_category *Category;/// An opaque type that represents an Objective-C declared property.typedef struct objc_property *objc_property_t;struct objc_class { Class isa OBJC_ISA_AVAILABILITY;#if !__OBJC2__ Class super_class OBJC2_UNAVAILABLE; const char *name OBJC2_UNAVAILABLE; long version OBJC2_UNAVAILABLE; long info OBJC2_UNAVAILABLE; long instance_size OBJC2_UNAVAILABLE; struct objc_ivar_list *ivars OBJC2_UNAVAILABLE; struct objc_method_list **methodLists OBJC2_UNAVAILABLE; struct objc_cache *cache OBJC2_UNAVAILABLE; struct objc_protocol_list *protocols OBJC2_UNAVAILABLE;#endif} OBJC2_UNAVAILABLE;/* Use `Class` instead of `struct objc_class *` */#endif æ³¨æ„æœ‰ä¸ª#if !OBJC_TYPES_DEFINEDå®å®šä¹‰,æ­£å¸¸Xcodeå·¥ç¨‹æ‰¾ä¸åˆ°å®šä¹‰,ä½†åœ¨objc-706å·¥ç¨‹ä¸­æœç´¢å¯å¾—,å®ƒåœ¨objc-private.h*ä¸­,#define OBJC_TYPES_DEFINED 1æ‰€ä»¥ä¸Šé¢çš„ä»£ç å…¶å®æ˜¯ä¸ä¼šå‚ä¸ç¼–è¯‘çš„,çœŸæ­£çš„å®šä¹‰åœ¨åœ¨*objc-private.h,å†è¿›å…¥åˆ°objc-runtime-old.h,ä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªobjc-runtime-new.h,æ ¹æ®å‘½åä¸è°ƒè¯•ç»“æœ,çœŸæ­£çš„å®šä¹‰æ˜¯objc-runtime-new.h 123456struct objc_class : objc_object { // Class ISA; Class superclass; cache_t cache; // formerly cache pointer and vtable class_data_bits_t bits; // class_rw_t * plus custom rr/alloc flags ... 1typedef struct objc_class *Class;* Classæ˜¯ä¸€ä¸ªæŒ‡å‘objc_classç»“æ„ä½“çš„æŒ‡é’ˆ å‚è€ƒ å—å³°å­ - Objective-C Runtime è¿è¡Œæ—¶ä¹‹ä¸€ï¼šç±»ä¸å¯¹è±¡","link":"/2016/11/22/iOSer-Understand-objc-runtime-1-what-is-the-class/"},{"title":"ç†è§£iOSäº‹ä»¶ä¼ é€’ä¸å“åº”æœºåˆ¶","text":"å¯¼è¯­è¯´è¯´ iOS ä¸­å…³äºäº‹ä»¶æ˜¯å¦‚ä½•ä¼ é€’ä¸å“åº”çš„ã€‚ å› ç´  iOS å…³é”®è¯ æ—¶é—´ ç‚¹å‡»/é•¿æŒ‰/æ‘‡ä¸€æ‘‡/éŸ³ä¹æš‚åœ/æ’­æ”¾æ—¶ åœ°ç‚¹ å“åº”è€… UIButton/UIViewâ€¦ äº‹ä»¶æ´¾å‘ &amp; å“åº”è€…é“¾æ¡ äººç‰© ç”¨æˆ·/è¿è¡Œå¾ªç¯ NSRunLoop &amp; UIApplication äº‹ä»¶ UITapGestureRecognizer/UITouchUpInsideâ€¦ UIEvent å¦‚ä½• æ‰§è¡Œçš„å…·ä½“æ“ä½œ å¤–éƒ¨ä¸šåŠ¡å®ç° ç¯å¢ƒ &amp; å·¥å…· macOS Sierra 10.12.3Xcode 8.2.1chisel ä¾‹å­123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051#import \"ViewController.h\"@interface ViewController ()@end@implementation ViewController- (void)viewDidLoad { [super viewDidLoad]; // æ‰‹åŠ¿ UIView *v = [[UIView alloc] initWithFrame:CGRectMake(0, 100, 100, 100)]; v.backgroundColor = [UIColor redColor]; UITapGestureRecognizer *tap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(tapAction:)]; [v addGestureRecognizer:tap]; [self.view addSubview:v]; // ç‚¹å‡» UIButton *btn = [[UIButton alloc] initWithFrame:CGRectMake(0, 200, 100, 30)]; btn.backgroundColor = [UIColor grayColor]; [btn setTitle:@\"æµ‹è¯•\" forState:UIControlStateNormal]; [btn addTarget:self action:@selector(btnAction:) forControlEvents:UIControlEventTouchUpInside]; [self.view addSubview:btn]; // Timer NSTimer *timer = [NSTimer scheduledTimerWithTimeInterval:5.0 target:self selector:@selector(timerAction:) userInfo:nil repeats:true]; [[NSRunLoop currentRunLoop] addTimer:timer forMode:NSRunLoopCommonModes]; // CADisplay CADisplayLink *link = [CADisplayLink displayLinkWithTarget:self selector:@selector(displayLinkAction:)]; [link addToRunLoop:[NSRunLoop mainRunLoop] forMode:NSDefaultRunLoopMode]; link.preferredFramesPerSecond = 6;}- (void)btnAction:(UIButton *)btn { NSLog(@\"ç‚¹å‡»äº‹ä»¶\");}- (void)tapAction:(UITapGestureRecognizer *)tap { NSLog(@\"è§¦æ‘¸äº‹ä»¶\");}- (void)timerAction:(NSTimer *)timer { NSLog(@\"timeräº‹ä»¶\");}- (void)displayLinkAction:(CADisplayLink *)link { NSLog(@\"displayLinkäº‹ä»¶\");}@end è°ƒç”¨å †æ ˆ ç±»å‹ æˆªå›¾ ç‚¹å‡» æ‰‹åŠ¿ Timer CADisplayLink å°ç»“å„ç§ç±»å‹çš„äº‹ä»¶éƒ½æ˜¯ç”± RunLoop æ¥æ”¶ã€‚è§¦å±äº‹ä»¶ç”± UIApplication é€šè¿‡é˜Ÿåˆ—çš„æ–¹å¼è¿›è¡Œæ´¾å‘ã€‚ ç›¸å…³çš„ç±»: UIEventç±» UIEvent æ˜¯äº‹ä»¶æ´¾å‘ä¸­çš„åŸºæœ¬å•å…ƒ 12345678910111213141516171819202122232425NS_CLASS_AVAILABLE_IOS(2_0) @interface UIEvent : NSObject@property(nonatomic,readonly) UIEventType type NS_AVAILABLE_IOS(3_0);@property(nonatomic,readonly) UIEventSubtype subtype NS_AVAILABLE_IOS(3_0);@property(nonatomic,readonly) NSTimeInterval timestamp;#if UIKIT_DEFINE_AS_PROPERTIES@property(nonatomic, readonly, nullable) NSSet &lt;UITouch *&gt; *allTouches;#else- (nullable NSSet &lt;UITouch *&gt; *)allTouches;#endif- (nullable NSSet &lt;UITouch *&gt; *)touchesForWindow:(UIWindow *)window;- (nullable NSSet &lt;UITouch *&gt; *)touchesForView:(UIView *)view;- (nullable NSSet &lt;UITouch *&gt; *)touchesForGestureRecognizer:(UIGestureRecognizer *)gesture NS_AVAILABLE_IOS(3_2);// An array of auxiliary UITouchâ€™s for the touch events that did not get delivered for a given main touch. This also includes an auxiliary version of the main touch itself.- (nullable NSArray &lt;UITouch *&gt; *)coalescedTouchesForTouch:(UITouch *)touch NS_AVAILABLE_IOS(9_0);// An array of auxiliary UITouchâ€™s for touch events that are predicted to occur for a given main touch. These predictions may not exactly match the real behavior of the touch as it moves, so they should be interpreted as an estimate.- (nullable NSArray &lt;UITouch *&gt; *)predictedTouchesForTouch:(UITouch *)touch NS_AVAILABLE_IOS(9_0);@endNS_ASSUME_NONNULL_END è§¦å±äº‹ä»¶äº‹ä»¶ç±»å‹ äº‹ä»¶é©±åŠ¨åº”ç”¨ç¨‹åºçš„ä¸»è¦èŒè´£æ˜¯å¤„ç†ç”¨æˆ·äº‹ä»¶ï¼Œå³ç”±é¼ æ ‡ï¼Œé”®ç›˜ï¼Œè·Ÿè¸ªå™¨å’Œå¹³æ¿ç”µè„‘ç­‰è®¾å¤‡ç”Ÿæˆçš„äº‹ä»¶ã€‚ åˆ° iOS åº”ç”¨ä¸­ç›¸åº”çš„æˆäº†è§¦å±ã€åŠ é€Ÿè®¡ã€è¿œç¨‹æ§åˆ¶ç­‰äº‹ä»¶ã€‚ 12345678910111213141516171819202122232425262728NS_CLASS_AVAILABLE_IOS(2_0) @interface UIResponder : NSObject &lt;UIResponderStandardEditActions&gt;#if UIKIT_DEFINE_AS_PROPERTIES@property(nonatomic, readonly, nullable) UIResponder *nextResponder;#else- (nullable UIResponder*)nextResponder;#endif...// è§¦å±äº‹ä»¶ (Multitouch)- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(nullable UIEvent *)event;- (void)touchesMoved:(NSSet&lt;UITouch *&gt; *)touches withEvent:(nullable UIEvent *)event;- (void)touchesEnded:(NSSet&lt;UITouch *&gt; *)touches withEvent:(nullable UIEvent *)event;- (void)touchesCancelled:(NSSet&lt;UITouch *&gt; *)touches withEvent:(nullable UIEvent *)event;- (void)touchesEstimatedPropertiesUpdated:(NSSet&lt;UITouch *&gt; *)touches NS_AVAILABLE_IOS(9_1);...// åŠ é€Ÿå™¨äº‹ä»¶ (Motion Events)- (void)motionBegan:(UIEventSubtype)motion withEvent:(nullable UIEvent *)event NS_AVAILABLE_IOS(3_0);- (void)motionEnded:(UIEventSubtype)motion withEvent:(nullable UIEvent *)event NS_AVAILABLE_IOS(3_0);- (void)motionCancelled:(UIEventSubtype)motion withEvent:(nullable UIEvent *)event NS_AVAILABLE_IOS(3_0);// è¿œç¨‹äº‹ä»¶ (Remote Control Events)- (void)remoteControlReceivedWithEvent:(nullable UIEvent *)event NS_AVAILABLE_IOS(4_0);@end å“åº”è€… åº”ç”¨ç¨‹åºä½¿ç”¨å“åº”è€…å¯¹è±¡æ¥æ”¶å’Œå¤„ç†äº‹ä»¶ã€‚å“åº”è€…å¯¹è±¡æ˜¯ UIResponder ç±»çš„ä»»ä½•å®ä¾‹ï¼Œå¸¸è§çš„å­ç±»åŒ…æ‹¬ UIView ï¼ŒUIViewController å’Œ UIApplication ã€‚ UIKit è‡ªåŠ¨ç®¡ç†å¤§å¤šæ•°å“åº”è€…ç›¸å…³çš„è¡Œä¸ºï¼ŒåŒ…æ‹¬äº‹ä»¶å¦‚ä½•ä»ä¸€ä¸ªå“åº”è€…ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥ä¿®æ”¹é»˜è®¤è¡Œä¸ºæ¥æ›´æ”¹äº‹ä»¶åœ¨åº”ç”¨ç¨‹åºä¸­çš„ä¼ é€æ–¹å¼ã€‚ å“åº”è€…é“¾æ¡ åœ¨å½“å‰åœºæ™¯ä¸‹çš„ btn çš„å“åº”è€…é“¾æ¡å¦‚ä¸‹ 1234567(lldb) presponder btn&lt;UIButton: 0x115e0fea0; frame = (0 200; 100 30); opaque = NO; layer = &lt;CALayer: 0x1702214a0&gt;&gt; | &lt;UIView: 0x115d07820; frame = (0 0; 375 667); autoresize = W+H; layer = &lt;CALayer: 0x17403df00&gt;&gt; | | &lt;ViewController: 0x115e0d720&gt; | | | &lt;UIWindow: 0x115e0de20; frame = (0 0; 375 667); autoresize = W+H; gestureRecognizers = &lt;NSArray: 0x170245d90&gt;; layer = &lt;UIWindowLayer: 0x170220e00&gt;&gt; | | | | &lt;UIApplication: 0x115e007f0&gt; | | | | | &lt;AppDelegate: 0x17403b6a0&gt; é€šè¿‡ UIApplication.h æ–‡ä»¶ä¸­çš„æ³¨é‡Šä¸ä¸‹é¢ lldb è°ƒè¯•çš„ç»“æœ actionA selector identifying an action method. See the discussion for information on the permitted selector forms.targetThe object to receive the action message. If target is nil, the app sends the message to the first responder, from whence it progresses up the responder chain until it is handled.senderThe object that is sending the action message. The default sender is the UIControl object that invokes this method.eventA UIEvent object that encapsulates information about the event originating the action message. æ¯”è¾ƒå®¹æ˜“æ¨æ–­å‡º æè¿° å€¼ sendAction btnAction: to ViewController from UIButton forEvent UITounesEvent UIView ä¸èƒ½æ¥æ”¶è§¦å±äº‹ä»¶çš„ä¸‰ç§æƒ…å†µï¼š ä¸æ¥å—ç”¨æˆ·äº¤äº’ï¼šuserInteractionEnabled = NO; éšè—ï¼šhidden = YES; é€æ˜ï¼šalpha = 0.0~0.01 äº‹ä»¶åˆ†å‘ å‘ç”Ÿè§¦æ‘¸äº‹ä»¶åï¼Œç³»ç»Ÿä¼šå°†è¯¥äº‹ä»¶åŠ å…¥åˆ°ä¸€ä¸ªç”± UIApplication ç®¡ç†çš„é˜Ÿåˆ—äº‹ä»¶ä¸­(ä»ä¸Šé¢çš„è°ƒç”¨å †æ ˆä¸­å¯çŸ¥)ã€‚ UIApplication ä¼šä»äº‹ä»¶é˜Ÿåˆ—ä¸­å–å‡ºæœ€å‰é¢çš„äº‹ä»¶ï¼Œå¹¶å°†äº‹ä»¶åˆ†å‘ä¸‹å»ä»¥ä¾¿å¤„ç†ï¼Œé€šå¸¸ä¼šå…ˆå‘é€äº‹ä»¶ç»™åº”ç”¨ç¨‹åºçš„ä¸»çª—å£(keyWindow) ä¸»çª—å£ (keyWindow) å¯¹è±¡é¦–å…ˆä¼šä½¿ç”¨ hitTest:withEvent: æ–¹æ³•å¯»æ‰¾æ­¤æ¬¡ Touch æ“ä½œåˆå§‹ç‚¹æ‰€åœ¨çš„è§†å›¾(View)ï¼Œå³éœ€è¦å°†è§¦æ‘¸äº‹ä»¶ä¼ é€’ç»™æœ€åˆé€‚çš„è§†å›¾ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¹‹ä¸º hit-test view åº”ç”¨å¦‚ä½•æ‰¾åˆ°æœ€åˆé€‚çš„æ§ä»¶æ¥å¤„ç†äº‹ä»¶ï¼Ÿæœ‰ä»¥ä¸‹å‡†åˆ™ é¦–å…ˆåˆ¤æ–­ä¸»çª—å£ï¼ˆkeyWindowï¼‰è‡ªå·±æ˜¯å¦èƒ½æ¥å—è§¦æ‘¸äº‹ä»¶ è§¦æ‘¸ç‚¹æ˜¯å¦åœ¨è‡ªå·±èº«ä¸Š ä»åå¾€å‰éå†å­æ§ä»¶ï¼Œé‡å¤å‰é¢çš„ä¸¤ä¸ªæ­¥éª¤ï¼ˆé¦–å…ˆæŸ¥æ‰¾æ•°ç»„ä¸­æœ€åä¸€ä¸ªå…ƒç´ ï¼‰ å¦‚æœæ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„å­æ§ä»¶ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºè‡ªå·±æœ€åˆé€‚å¤„ç†æ³¨æ„ï¼šä¹‹æ‰€ä»¥ä¼šé‡‡å–ä»åå¾€å‰éå†å­æ§ä»¶çš„æ–¹å¼å¯»æ‰¾æœ€åˆé€‚çš„viewåªæ˜¯ä¸ºäº†åšä¸€äº›å¾ªç¯ä¼˜åŒ–ã€‚å› ä¸ºç›¸æ¯”è¾ƒä¹‹ä¸‹ï¼Œåæ·»åŠ çš„viewåœ¨ä¸Šé¢ï¼Œé™ä½å¾ªç¯æ¬¡æ•°ã€‚ äº‹ä»¶åˆ†å‘ &amp;&amp; å“åº”è€…é“¾æ¡éƒ½æ˜¯ä¸ºäº†æ‰¾å‡ºåˆé€‚çš„å“åº”è€… å°ç»“hit-test view ç¡®å®šæœ€åˆé€‚çš„è§†å›¾ï¼Œè‹¥è¯¥è§†å›¾å¦‚æœä¸èƒ½å“åº”è¯¥äº‹ä»¶æ—¶ï¼Œå¯é€šè¿‡å“åº”è€…é“¾æ¡æ‰¾åˆ°åˆé€‚çš„å“åº”è€…ã€‚ åœ¨å½“å‰åœºæ™¯ä¸‹ï¼Œ UIButton ä½œä¸ºç¬¬ä¸€å“åº”è€…èƒ½å“åº”å½“å‰çš„ç‚¹å‡»äº‹ä»¶ï¼Œè§¦å‘ UIResponser åè®®çš„ touchesEnded:withEvent ä»£ç†æ–¹æ³•ï¼Œæœ€åä½œä¸º sender å‚æ•°ä¼ é€’ç»™ ViewController çš„ btnAction: æ–¹æ³•ã€‚ æ‰‹åŠ¿UIView ä¸­æœ‰ 12345678@interface UIView (UIViewGestureRecognizers)@property(nullable, nonatomic,copy) NSArray&lt;__kindof UIGestureRecognizer *&gt; *gestureRecognizers NS_AVAILABLE_IOS(3_2);- (void)addGestureRecognizer:(UIGestureRecognizer*)gestureRecognizer NS_AVAILABLE_IOS(3_2);- (void)removeGestureRecognizer:(UIGestureRecognizer*)gestureRecognizer NS_AVAILABLE_IOS(3_2);... The gesture-recognizer objects currently attached to the view. gestureRecognizers ä¿å­˜ç€ä¸å½“å‰çš„è§†å›¾å¯¹è±¡ç›¸å…³è”çš„ UIGestureRecognizer ç±»å‹å¯¹è±¡ ä¸ºè§†å›¾æ·»åŠ æ‰‹åŠ¿ ä¸ºè§†å›¾æ·»åŠ  addTarget:Action:ï¼Œå°† å“åº”è€…é“¾æ¡ éƒ¨åˆ†ç¨ä½œå¤„ç†å¯å¾— å°ç»“æ— è®ºæ˜¯ç”¨ addTarget:Action: è¿˜æ˜¯å°†æ‰‹åŠ¿æ·»åŠ åˆ°è§†å›¾å¯¹è±¡ä¸Šï¼Œæœ€ç»ˆéƒ½æ˜¯åˆ›å»ºäº† UIEvent è¿™ä¸ªäº‹ä»¶å•å…ƒå¯¹è±¡ã€‚ æ‰‹åŠ¿ç›¸æ¯”è§¦ç¢°äº‹ä»¶çš„å¥½å¤„æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨å·²ç»å®šä¹‰å¥½çš„æ‰‹åŠ¿ï¼Œå¼€å‘è€…ä¸ç”¨è‡ªå·±è®¡ç®—æ‰‹æŒ‡ç§»åŠ¨è½¨è¿¹ã€‚ç¼ºç‚¹å°±æ˜¯æ²¡åŠæ³•è‡ªå®šä¹‰æ‰‹åŠ¿ï¼Œåªèƒ½ç”¨ç³»ç»Ÿå·²ç»å®ç°çš„æ‰‹åŠ¿ã€‚å¦‚æœæƒ³å®ç°è‡ªå·±å‘æ˜çš„æŸç§æ‰‹åŠ¿è¿˜å¾—å»ç”¨è§¦æ‘¸ã€‚ æ€»ç»“å½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒRunLoop æ¥æ”¶åˆ°å¤–éƒ¨æˆ–å†…éƒ¨æ³¨å†Œçš„äº‹ä»¶ï¼Œå°†å…¶ä¼ é€’ç»™ UIApplication å¯¹è±¡ï¼ŒUIApplication å°è£…æˆ UIEvent ç±»å‹çš„å¯¹è±¡å¹¶å°†å…¶åˆ†å‘ç»™åº”ç”¨ç¨‹åºçš„ä¸»çª—å£(keyWindow)ï¼Œä¸»çª—å£å¯¹è±¡ä½¿ç”¨ hit-test view çš„æµç¨‹æ‰¾åˆ°å“åº”å½“å‰äº‹ä»¶æœ€åˆé€‚çš„è§†å›¾ï¼Œè‹¥è¯¥è§†å›¾æ— æ³•å“åº”äº‹ä»¶ï¼Œåˆ™é€šè¿‡å“åº”è€…é“¾æ¡å‘ä¸Šä¼ é€’ï¼Œç›´åˆ°æ‰¾åˆ°åˆé€‚çš„å“åº”è€…,è¯¥å“åº”è€…éœ€è¦å®ç°äº† touchesBegan:withEvent: ç­‰ä»£ç†æ–¹æ³•ï¼Œè‹¥æ²¡æ‰¾åˆ°å°±å°†äº‹ä»¶æŠ›å¼ƒï¼Œæœ€ç»ˆä¼šå°†å“åº”è€…ä¼ é€’ç»™å¤–éƒ¨çš„è°ƒç”¨è€…ã€‚ å‚è€ƒ iOS ç‚¹å‡»äº‹ä»¶ä¼ é€’åŠå“åº” Understanding Responders and the Responder Chain Cocoa Event Handling Guide iOSæ‰‹åŠ¿ï¼ˆUIGestureRecognizerï¼‰å’Œè§¦æ‘¸ï¼ˆtouche eventï¼‰çš„åŒºåˆ«å’Œè”ç³»","link":"/2017/04/04/iOSer-Understand-iOS-event-delivery-and-response-mechanisms/"},{"title":"ç†è§£objcè¿è¡Œæ—¶äºŒ:ç±»çš„ç»“æ„(runtime.h)","text":"ç±»çš„æ•°æ®ç»“æ„(runtime.h)1234567891011121314151617struct objc_class { Class isa OBJC_ISA_AVAILABILITY;#if !__OBJC2__ Class super_class OBJC2_UNAVAILABLE; const char *name OBJC2_UNAVAILABLE; long version OBJC2_UNAVAILABLE; long info OBJC2_UNAVAILABLE; long instance_size OBJC2_UNAVAILABLE; struct objc_ivar_list *ivars OBJC2_UNAVAILABLE; struct objc_method_list **methodLists OBJC2_UNAVAILABLE; struct objc_cache *cache OBJC2_UNAVAILABLE; struct objc_protocol_list *protocols OBJC2_UNAVAILABLE;#endif} OBJC2_UNAVAILABLE;/* Use `Class` instead of `struct objc_class *` */ __OBJC2__ If you are running 10.5 or later, or any version of iOS, your computer is running Objective-C 2. If you are writing code which you want to work on systems before this, you can check for the OBJC2 macro, which will be defined only for Objective-C 2 and later systems. å‚è€ƒ OBJC2_UNAVAILABLE12345678910111213/* OBJC2_UNAVAILABLE: unavailable in objc 2.0, deprecated in Leopard *//*ä¸»è¦æ˜¯ä¸ºäº†å…¼å®¹ä»¥å‰çš„OCç‰ˆæœ¬,ç›®å‰æ¡ä»¶ä¸‹,å¯å¿½ç•¥ */#if !defined(OBJC2_UNAVAILABLE) # if __OBJC2__# define OBJC2_UNAVAILABLE UNAVAILABLE_ATTRIBUTE# else /* plain C code also falls here, but this is close enough */# define OBJC2_UNAVAILABLE \\ __OSX_DEPRECATED(10.5, 10.5, \"not available in __OBJC2__\") \\ __IOS_DEPRECATED(2.0, 2.0, \"not available in __OBJC2__\") \\ __TVOS_UNAVAILABLE __WATCHOS_UNAVAILABLE# endif#endif å› æ­¤å¯ç›´æ¥å¿½ç•¥æ‰OBJC2å’ŒOBJC2_UNAVAILABLE objc_classç»“æ„ä½“ åç§° å«ä¹‰ isa isaæŒ‡é’ˆ super_class çˆ¶ç±» name ç±»å version ç±»çš„ç‰ˆæœ¬å· instance_size ç±»çš„å¤§å° ivars å˜é‡åˆ—è¡¨ methodLists æ–¹æ³•åˆ—è¡¨ cache æ–¹æ³•ç¼“å­˜åˆ—è¡¨ protocols åè®®åˆ—è¡¨ Q: isaæŒ‡é’ˆæŒ‡å‘å“ª?å…ˆäº†è§£ä¸‹OCçš„ç±»çš„ç»§æ‰¿ä½“ç³» isaæŒ‡é’ˆä¸superclass è¦çŸ¥é“isaæŒ‡é’ˆçš„æŒ‡å‘,éœ€è¦å…ˆäº†è§£å…ƒç±», å…ƒç±»(metaClass)å› ä¸ºç±»ä¹Ÿæ˜¯å¯¹è±¡(struct objc_class : objc_object {â€¦}), å…ƒç±»å¯è¿‘ä¼¼è®¤ä¸ºæ˜¯ç±»å¯¹è±¡çš„isaæŒ‡é’ˆæ‰€æŒ‡å‘çš„ç±» æ–¹æ³•è°ƒç”¨å¯¹è±¡å°è£…äº†å˜é‡å’Œæ–¹æ³•,å˜é‡æ˜¯æ•°æ®,æ¯ä¸ªå¯¹è±¡éƒ½ä¸å°½ç›¸åŒ,ä½†æ–¹æ³•æ˜¯æ“ä½œ,æ¯ä¸ªå¯¹è±¡åº”è¯¥éƒ½ä¸€æ ·,æ‰€æœ‰çš„å¯¹è±¡å…±äº«ä¸€ä»½æ–¹æ³•çš„ä»£ç ,æ”¾åœ¨ç±»ä¸­,è€Œå› ä¸ºç±»æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡,å½“å‘ç±»å‘é€æ¶ˆæ¯æ—¶,è¯¥ç±»çš„isaæŒ‡é’ˆåº”è¯¥æŒ‡å‘ä¿å­˜ç±»æ–¹æ³•çš„åœ°å€,ç”±ä¸Šå¯å¾—,å…ƒç±»ä¸­ä¿å­˜ç€ç±»æ–¹æ³• å¯¹è±¡æ–¹æ³•çš„æŸ¥æ‰¾é¡ºåº:å½“å‰ç±» -&gt; çˆ¶ç±» -&gt; â€¦ -&gt; æ ¹ç±» ç±»æ–¹æ³•çš„æŸ¥æ‰¾é¡ºåº:å½“å‰ç±»çš„å…ƒç±» -&gt; å…ƒç±»çˆ¶ç±» -&gt; æ ¹å…ƒç±» A:æ€»ç»“ å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘ç±»å¯¹è±¡ ç±»å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘è¯¥ç±»å¯¹è±¡å¯¹åº”çš„å…ƒç±»å¯¹è±¡ æ‰€æœ‰å…ƒç±»å¯¹è±¡çš„isaæŒ‡é’ˆç»Ÿä¸€æŒ‡å‘NSObjectå…ƒç±»å¯¹è±¡ ç±»å¯¹è±¡çš„superclassæŒ‡å‘çˆ¶ç±»çš„ç±»å¯¹è±¡,å›æº¯è€Œä¸Šç›´åˆ°NSObjectç±»å¯¹è±¡ NSObjectçš„superclassæŒ‡å‘nil NSObjectå…ƒç±»å¯¹è±¡çš„çˆ¶ç±»ä¸ºNSObjectç±»å¯¹è±¡ NSObjectç±»å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘NSObjectå…ƒç±»å¯¹è±¡ éªŒè¯åœ¨objc-706å·¥ç¨‹ä¸­,åœ¨debug-objc targetçš„main.mmæ·»åŠ æµ‹è¯•ä»£ç  123objc_class *cls_a_s = (objc_class *)[NSString class];objc_class *cls_b_s = (objc_class *)cls_a_s-&gt;getMeta();NSLog(@\"%p,%p\",cls_a_s,cls_b_s); è¾“å‡ºç»“æœ: è§‚å¯Ÿ + è®¡ç®— 0x1dffffb6c19d89 = 0x1d8001004a10f1 - 0x1004a10f0 + 0x7fffb6c19d88 ç±»å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘åœ°å€æ»¡è¶³ä¸‹é¢çš„ç­‰å¼ addr(class-&gt;isa) = addr(metaclass-&gt;isa) - addr(metaclass-&gt;superclass) + addr(metaclass) å¦ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ 123objc_class *cls_a = (objc_class *)[NSObject class];objc_class *cls_b = (objc_class *)cls_a-&gt;getMeta();NSLog(@\"%p,%p\",cls_a,cls_b); 0x1d8001004a10f1 = 0x1d8001004a10f1 - addr(NSObject) + 0x1004a1140 NSObjectç±»åœ°å€æ˜¯0x1004a1140,ä¸Šå¼ä¹Ÿæˆç«‹ Q: å¦‚ä½•è·å¾—super_class,version,name,instance_sizeçš„å€¼è·å–super_class 12345678910111213/** * Returns the superclass of a class. * * @param cls A class object. * * @return The superclass of the class, or \\c Nil if * \\e cls is a root class, or \\c Nil if \\e cls is \\c Nil. * * @note You should usually use \\c NSObject's \\c superclass method instead of this function. */OBJC_EXPORT Class class_getSuperclass(Class cls) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0); è·å–version 123456789101112/** * Returns the version number of a class definition. * * @param cls A pointer to a \\c Class data structure. Pass * the class definition for which you wish to obtain the version. * * @return An integer indicating the version number of the class definition. * * @see class_setVersion */OBJC_EXPORT int class_getVersion(Class cls) OBJC_AVAILABLE(10.0, 2.0, 9.0, 1.0); è·å–name 123456789/** * Returns the name of a class. * * @param cls A class object. * * @return The name of the class, or the empty string if \\e cls is \\c Nil. */OBJC_EXPORT const char *class_getName(Class cls) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0); è·å–instance_size 123456789/** * Returns the size of instances of a class. * * @param cls A class object. * * @return The size in bytes of instances of the class \\e cls, or \\c 0 if \\e cls is \\c Nil. */OBJC_EXPORT size_t class_getInstanceSize(Class cls) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0); æµ‹è¯•ä»£ç  123456789int main(int argc, const char * argv[]) { @autoreleasepool { NSLog(@\"NSStringç±»çš„super_classæ˜¯%@\",class_getSuperclass([NSString class])); NSLog(@\"NSStringç±»çš„versionæ˜¯%d\",class_getVersion([NSString class])); NSLog(@\"NSStringç±»çš„nameæ˜¯%s\",class_getName([NSString class])); NSLog(@\"NSStringç±»çš„instance_sizeæ˜¯%ld\",class_getInstanceSize([NSString class])); } return 0;} è¾“å‡ºç»“æœ: Q:å¦‚ä½•è·å¾—ivars,methodLists,protocolsè·å¾—ivars 123456789101112131415/** * Describes the instance variables declared by a class. * * @param cls The class to inspect. * @param outCount On return, contains the length of the returned array. * If outCount is NULL, the length is not returned. * * @return An array of pointers of type Ivar describing the instance variables declared by the class. * Any instance variables declared by superclasses are not included. The array contains *outCount * pointers followed by a NULL terminator. You must free the array with free(). * * If the class declares no instance variables, or cls is Nil, NULL is returned and *outCount is 0. */OBJC_EXPORT Ivar *class_copyIvarList(Class cls, unsigned int *outCount) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0); è·å¾—methodLists 12345678910111213141516171819/** * Describes the instance methods implemented by a class. * * @param cls The class you want to inspect. * @param outCount On return, contains the length of the returned array. * If outCount is NULL, the length is not returned. * * @return An array of pointers of type Method describing the instance methods * implemented by the classâ€”any instance methods implemented by superclasses are not included. * The array contains *outCount pointers followed by a NULL terminator. You must free the array with free(). * * If cls implements no instance methods, or cls is Nil, returns NULL and *outCount is 0. * * @note To get the class methods of a class, use \\c class_copyMethodList(object_getClass(cls), &amp;count). * @note To get the implementations of methods that may be implemented by superclasses, * use \\c class_getInstanceMethod or \\c class_getClassMethod. */OBJC_EXPORT Method *class_copyMethodList(Class cls, unsigned int *outCount) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0); è·å¾—protocols 123456789101112131415/** * Describes the protocols adopted by a class. * * @param cls The class you want to inspect. * @param outCount On return, contains the length of the returned array. * If outCount is NULL, the length is not returned. * * @return An array of pointers of type Protocol* describing the protocols adopted * by the class. Any protocols adopted by superclasses or other protocols are not included. * The array contains *outCount pointers followed by a NULL terminator. You must free the array with free(). * * If cls adopts no protocols, or cls is Nil, returns NULL and *outCount is 0. */OBJC_EXPORT Protocol * __unsafe_unretained *class_copyProtocolList(Class cls, unsigned int *outCount) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0); æµ‹è¯•ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243#import \"objc-private.h\"#import &lt;Foundation/Foundation.h&gt;int main(int argc, const char * argv[]) { @autoreleasepool { Class cls = [NSObject class]; unsigned int count = 0; Ivar *list = class_copyIvarList(cls, &amp;count); for (unsigned int i = 0; i &lt; count; ++i) { Ivar ity = list[i]; const char *iname = ivar_getName(ity); NSLog(@\"%@\\n\",[NSString stringWithUTF8String:iname]); } free(list); objc_property_t *list2 = class_copyPropertyList(cls, &amp;count); for (unsigned int i = 0; i &lt; count; ++i) { objc_property_t ity = list2[i]; const char *iname = property_getName(ity); NSLog(@\"%@\\n\",[NSString stringWithUTF8String:iname]); } free(list2); Method *methods = class_copyMethodList(cls, &amp;count); for (unsigned int i = 0; i &lt; count; i++) { Method method = methods[i]; printf(\"\\t'%s'|'%s' of encoding '%s'\\n\", class_getName(cls), sel_getName(method_getName(method)), method_getTypeEncoding(method)); } free(methods); Protocol * __unsafe_unretained * protocols = class_copyProtocolList(cls, &amp;count); Protocol * protocol; for (unsigned int i = 0; i &lt; count; i++) { protocol = protocols[i]; NSLog(@\"protocol name: %s\", protocol_getName(protocol)); } } return 0;} è¾“å‡ºæ•ˆæœ è·å¾—cache ä¸ºå·²æœ‰ç±»æ·»åŠ ivar,property,method,protocol 12345678910111213141516/** * Adds a new instance variable to a class. * * @return YES if the instance variable was added successfully, otherwise NO * (for example, the class already contains an instance variable with that name). * * @note This function may only be called after objc_allocateClassPair and before objc_registerClassPair. éœ€è¦åœ¨obj_allocateClassPairä¸objc_registerClassPairä¹‹é—´è°ƒç”¨ * Adding an instance variable to an existing class is not supported. ä¸æ”¯æŒä¸ºå·²æœ‰çš„ç±»æ·»åŠ å®ä¾‹å˜é‡ * @note The class must not be a metaclass. Adding an instance variable to a metaclass is not supported. ä¸æ”¯æŒä¸ºå…ƒç±»æ·»åŠ å®ä¾‹å˜é‡ * @note The instance variable's minimum alignment in bytes is 1&lt;&lt;align. The minimum alignment of an instance * variable depends on the ivar's type and the machine architecture. * For variables of any pointer type, pass log2(sizeof(pointer_type)). */OBJC_EXPORT BOOL class_addIvar(Class cls, const char *name, size_t size, uint8_t alignment, const char *types) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0); 12345678910111213/** * Adds a property to a class. * * @param cls The class to modify. * @param name The name of the property. * @param attributes An array of property attributes. * @param attributeCount The number of attributes in \\e attributes. * * @return \\c YES if the property was added successfully, otherwise \\c NO * (for example, the class already has that property). */OBJC_EXPORT BOOL class_addProperty(Class cls, const char *name, const objc_property_attribute_t *attributes, unsigned int attributeCount) OBJC_AVAILABLE(10.7, 4.3, 9.0, 1.0); 123456789101112131415161718/** * Adds a new method to a class with a given name and implementation. * * @param cls The class to which to add a method. * @param name A selector that specifies the name of the method being added. * @param imp A function which is the implementation of the new method. The function must take at least two argumentsâ€”self and _cmd. * @param types An array of characters that describe the types of the arguments to the method. * * @return YES if the method was added successfully, otherwise NO * (for example, the class already contains a method implementation with that name). * * @note class_addMethod will add an override of a superclass's implementation, * but will not replace an existing implementation in this class. * To change an existing implementation, use method_setImplementation. */OBJC_EXPORT BOOL class_addMethod(Class cls, SEL name, IMP imp, const char *types) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0); 1234567891011/** * Adds a protocol to a class. * * @param cls The class to modify. * @param protocol The protocol to add to \\e cls. * * @return \\c YES if the method was added successfully, otherwise \\c NO * (for example, the class already conforms to that protocol). */OBJC_EXPORT BOOL class_addProtocol(Class cls, Protocol *protocol) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0); æµ‹è¯•ä»£ç  æ·»åŠ proerty 1234567891011121314151617181920212223int main(int argc, const char * argv[]) { @autoreleasepool { Class cls = [NSObject class]; unsigned int count = 0; /* Defines a property attribute typedef struct { const char *name; *&lt; The name of the attribute const char *value; *&lt; The value of the attribute (usually empty) } objc_property_attribute_t; */ objc_property_attribute_t t = {\"T\",\"123\"}; class_addProperty(cls, \"newProperty\",&amp;t, 1); objc_property_t *list2 = class_copyPropertyList(cls, &amp;count); for (unsigned int i = 0; i &lt; count; ++i) { objc_property_t ity = list2[i]; const char *iname = property_getName(ity); NSLog(@\"%@\\n\",[NSString stringWithUTF8String:iname]); } free(list2); } return 0;} æ·»åŠ method 1234567891011121314151617181920int main(int argc, const char * argv[]) { @autoreleasepool { Class cls = [NSObject class]; unsigned int count = 0; IMP imp = imp_implementationWithBlock(^{ NSLog(@\"add a new method\"); }); BOOL r = class_addMethod(cls, @selector(newMethod), imp, nil); Method *methods = class_copyMethodList(cls, &amp;count); for (unsigned int i = 0; i &lt; count; i++) { Method method = methods[i]; printf(\"\\t'%s'|'%s' of encoding '%s'\\n\", class_getName(cls), sel_getName(method_getName(method)), method_getTypeEncoding(method)); } free(methods); [(id)cls performSelector:@selector(newMethod)]; } return 0;} æ·»åŠ protocol 12345678910111213141516171819int main(int argc, const char * argv[]) { @autoreleasepool { Class cls = [NSObject class]; unsigned int count = 0; // objc_addProtocol(); Protocol *p = objc_allocateProtocol(\"newProtocol\"); objc_registerProtocol(p); class_addProtocol(cls,p); Protocol * __unsafe_unretained * protocols = class_copyProtocolList(cls, &amp;count); Protocol * protocol; for (unsigned int i = 0; i &lt; count; i++) { protocol = protocols[i]; NSLog(@\"protocol name: %s\", protocol_getName(protocol)); } } return 0;} æ³¨:ä»¥ä¸Šå‡½æ•°å£°æ˜æ‘˜è‡ªäºiOS10.1çš„runtime.h å‚è€ƒ å—å³°å­ - Objective-C Runtime è¿è¡Œæ—¶ä¹‹ä¸€ï¼šç±»ä¸å¯¹è±¡","link":"/2016/12/25/iOSer-Understand-objc-runtime-2-class-structure-runtime-h/"},{"title":"ç†è§£objcè¿è¡Œæ—¶å››-è¿è¡Œæ—¶æµç¨‹åˆ†æ","text":"æ¦‚è§ˆ ç³»ç»Ÿè°ƒç”¨åŠ è½½objcåŠ¨æ€åº“å‰çš„ä¸€äº›æµç¨‹ ç¯å¢ƒ macOS Sierra 10.12.3Xcode8.2.1 åº”ç”¨ç¨‹åºçš„æ‰§è¡Œæµç¨‹execå‡½æ•°æ— 12345$ whatis execbuiltin(1), !(1), %(1), .(1),... endif(1), endsw(1), esac(1), eval(1), exec(1), exit(1), export(1),...exec(ntcl) - Invoke subprocessessandbox-exec(1) - execute within a sandbox execå‡½æ•°æ—å¯ä»¥æ ¹æ®æŒ‡å®šçš„æ–‡ä»¶åæ‰¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶,å¹¶ç”¨å®ƒæ¥å–ä»£è°ƒç”¨è¿›ç¨‹çš„å†…å®¹ã€‚ å‡½æ•°åŸå‹ 1234567#include &lt;unistd.h&gt;int execl(const char *pathname, const char *arg0, ... /* (char *)0 */);int execv(const char *pathname, char *const argv[]);int execle(const char *pathname, const char *arg0, ... /* (char *)0, char *const envp[] */);int execve(const char *pathname, char *const argv[], char *const envp[]);int execlp(const char *filename, const char *arg0, ... /* (char *)0 */);int execvp(cosnt char *filename, char *const argv[]); åªæœ‰execveæ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„ç³»ç»Ÿè°ƒç”¨,å…¶å®ƒéƒ½æ˜¯åœ¨æ­¤åŸºç¡€ä¸Šç»è¿‡åŒ…è£…çš„åº“å‡½æ•° macOS*æ“ä½œç³»ç»Ÿçš„å†…æ ¸ä¸ºXNU* å‚è€ƒè‹¹æœå¼€æºç½‘ç«™ åœ¨å¦‚ä¸‹ç›®å½• xnu/bsd/kern/kern_exec.c æœ‰execveå‡½æ•°çš„å®šä¹‰ 1234567891011121314151617181920212223242526272829303132333435363738/* * execve * * Parameters: uap-&gt;fname File name to exec * uap-&gt;argp Argument list * uap-&gt;envp Environment list * * Returns: 0 Success * __mac_execve:EINVAL Invalid argument * __mac_execve:ENOTSUP Invalid argument * __mac_execve:EACCES Permission denied * __mac_execve:EINTR Interrupted function * __mac_execve:ENOMEM Not enough space * __mac_execve:EFAULT Bad address * __mac_execve:ENAMETOOLONG Filename too long * __mac_execve:ENOEXEC Executable file format error * __mac_execve:ETXTBSY Text file busy [misuse of error code] * __mac_execve:??? * * TODO: Dynamic linker header address on stack is copied via suword() *//* ARGSUSED */intexecve(proc_t p, struct execve_args *uap, int32_t *retval){ struct __mac_execve_args muap; int err; memoryshot(VM_EXECVE, DBG_FUNC_NONE); muap.fname = uap-&gt;fname; muap.argp = uap-&gt;argp; muap.envp = uap-&gt;envp; muap.mac_p = USER_ADDR_NULL; err = __mac_execve(p, &amp;muap, retval); return(err);} å¯çœ‹å‡ºmacOSä¸­çš„execveå‡½æ•° è°ƒç”¨__mac_execveå‡½æ•° å‡½æ•°åŸå‹çš„å‚æ•°å’Œä¸€èˆ¬çš„Unixç³»ç»Ÿæœ‰å‡ºå…¥ __mac_execve exec_activate_image exec_mach_imgact load_machfile parse_machfile exec_mach_imgact æ‹·è´å¯æ‰§è¡Œæ–‡ä»¶åˆ°å†…å­˜ä¸­ï¼Œå¹¶æ ¹æ®ä¸åŒçš„å¯æ‰§è¡Œæ–‡ä»¶ç±»å‹é€‰æ‹©ä¸åŒçš„åŠ è½½å‡½æ•°ï¼Œæ‰€æœ‰çš„é•œåƒçš„åŠ è½½è¦ä¹ˆç»ˆæ­¢åœ¨ä¸€ä¸ªé”™è¯¯ä¸Šï¼Œè¦ä¹ˆæœ€ç»ˆå®ŒæˆåŠ è½½é•œåƒã€‚ OS Xæœ‰ä¸‰ç§å¯æ‰§è¡Œæ–‡ä»¶ï¼Œmach-oç”±exec_mach_imgactå¤„ç†ï¼Œfat binaryç”±exec_fat_imgactå¤„ç†ï¼Œinterpreterï¼ˆè§£é‡Šå™¨ï¼‰ç”±exec_shell_imgactå¤„ç† load_machfile load_machfileä¼šåŠ è½½Mach-Oä¸­çš„å„ç§load monmandå‘½ä»¤ã€‚åœ¨å…¶å†…éƒ¨ä¼šç¦æ­¢æ•°æ®æ®µæ‰§è¡Œï¼Œé˜²æ­¢æº¢å‡ºæ¼æ´æ”»å‡»ï¼Œè¿˜ä¼šè®¾ç½®åœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–ï¼ˆASLRï¼‰ï¼Œè¿˜æœ‰ä¸€äº›æ˜ å°„çš„è°ƒæ•´ã€‚ parse_machfile parse_machfileä¼šæ ¹æ®load_commandçš„ç§ç±»é€‰æ‹©ä¸åŒçš„å‡½æ•°æ¥åŠ è½½ï¼Œå†…éƒ¨æ˜¯ä¸€ä¸ªSwitchè¯­å¥æ¥å®ç°çš„ å¯¹äºå‘½ä»¤çš„åŠ è½½ä¼šè¿›è¡Œå¤šæ¬¡æ‰«æï¼Œå½“æ‰«æä¸‰æ¬¡ä¹‹åï¼Œå¹¶ä¸”å­˜åœ¨dylinker_commandå‘½ä»¤æ—¶ï¼Œä¼šæ‰§è¡Œ load_dylinker()ï¼Œå¯åŠ¨åŠ¨æ€é“¾æ¥å™¨ (dyld) æ›´è¯¦ç»†çš„æµç¨‹,è¯·å‚çœ‹è¶£æ¢ Mach-Oï¼šåŠ è½½è¿‡ç¨‹ é‡ç‚¹å…³æ³¨çš„æ˜¯objcè¿è¡Œæ—¶çš„åŠ è½½æµç¨‹,å› ä¸ºè¿è¡Œæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªåŠ¨æ€åº“,æœ‰dyldåŠ è½½å™¨å,å°±å¯ä»¥å»å…³æ³¨äº†objcåŠ¨æ€åº“çš„åŠ è½½æµç¨‹ã€‚åœ¨æ­¤ä¹‹å‰,æœ‰ä¸¤ä¸ªé—®é¢˜æƒ³è¦è¯´æ˜ä¸€ä¸‹ macOSç³»ç»Ÿæ¶æ„ mach-oæ–‡ä»¶å¤´ macOSç³»ç»Ÿæ¶æ„ Mac OS X is built on a Unix core; the Darwin core is based on the Berkeley Software Distribution (BSD) version of Unix. The heart of the Darwin core is called Mach. Darwin(è¾¾å°”æ–‡)å†…æ ¸çš„æ ¸å¿ƒæ˜¯Mach,ä¸Šå±‚å°è£…äº†BSDæ¥æ”¯æŒPOSIX mach-oæ–‡ä»¶å¤´æ¦‚è¿° Mach-oåŒ…å«ä¸‰ä¸ªåŸºæœ¬åŒºåŸŸï¼šå¤´éƒ¨ï¼ˆheader structureï¼‰ã€‚åŠ è½½å‘½ä»¤ï¼ˆload commandï¼‰ã€‚æ®µï¼ˆsegmentï¼‰ã€‚å¯ä»¥æ‹¥æœ‰å¤šä¸ªæ®µï¼ˆsegmentï¼‰ï¼Œæ¯ä¸ªæ®µå¯ä»¥æ‹¥æœ‰é›¶ä¸ªæˆ–å¤šä¸ªåŒºåŸŸï¼ˆsectionï¼‰ã€‚æ¯ä¸€ä¸ªæ®µï¼ˆsegmentï¼‰éƒ½æ‹¥æœ‰ä¸€æ®µè™šæ‹Ÿåœ°å€æ˜ å°„åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ã€‚é“¾æ¥ä¿¡æ¯ã€‚ä¸€ä¸ªå®Œæ•´çš„ç”¨æˆ·çº§Mach-oæ–‡ä»¶çš„æœ«ç«¯æ˜¯é“¾æ¥ä¿¡æ¯ã€‚å…¶ä¸­åŒ…å«äº†åŠ¨æ€åŠ è½½å™¨ç”¨æ¥é“¾æ¥å¯æ‰§è¡Œæ–‡ä»¶æˆ–è€…ä¾èµ–åº“æ‰€éœ€ä½¿ç”¨çš„ç¬¦å·è¡¨ï¼Œå­—ç¬¦ä¸²è¡¨ç­‰ç­‰ã€‚ æ–°å»ºä¸€ä¸ªXcodeå·¥ç¨‹,âŒ˜ + B åç”ŸæˆProduct,å°†ç”Ÿæˆçš„Appä¸­çš„äºŒè¿›åˆ¶æ–‡ä»¶æ‹–åˆ°MachOViewä¸­,å¦‚ä¸‹æ‰€ç¤º: å­—æ®µè§£é‡Š é­”æ•°(Magic Number)æ ‡å¿—äº†å¯æ‰§è¡Œæ–‡ä»¶çš„ç±»å‹ åé¢æ‰¾å´åªæœ‰ ARMv7æ˜¯æœ‰çš„,ä½†æ˜¯ARM64å´åœ¨wikiä¸Šæ²¡æ‰¾åˆ°,æœç´¢å,æ ¹æ®å¸¸ç”¨é­”æ•° MH_MAGIC_64å®çš„å®šä¹‰åœ¨ xnu-(å†…æ ¸ç‰ˆæœ¬xxx)/EXTERNAL_HEADERS/mach-o/loader.h è¿™æ ·å°±å¯¹ä¸Šäº† æ¶æ„(Number of Architecture 2)å¯æ”¯æŒæ¶æ„æ•°é‡(ARMv7 &amp; ARMv64) CPUç±»å‹(CPU Type) &amp; CPUç±»å‹(CPU SubType)æ ‡æ˜CPUç±»å‹,ä¸ºäº†åç»­æ–¹ä¾¿å¤„ç† åŒæ ·offset,Size,Alignéƒ½æ˜¯è¯´æ˜äº†åº”ç”¨çš„å†…å­˜ä½ç½®ç›¸å…³çš„ä¿¡æ¯ Load CommandsåŠ è½½å‘½ä»¤,æ ¹æ®ä¸Šé¢ä¼šç”±parse_machfileå‡½æ•°æ‰§è¡Œ ä¸»è¦å…³æ³¨å‡ ä¸ªå­—æ®µ LC_LOAD_DYLINKER:åŠ è½½å™¨,è´Ÿè´£åŠ è½½å…¶ä»–åŠ¨æ€åº“ LC_LOAD_DYLIB(xxx):åŠ è½½çš„åŠ¨æ€åº“ æ›´è¯¦ç»†çš„å¯å‚è€ƒ iOSå®‰å…¨â€“äº†è§£Mach-oæ–‡ä»¶ç»“æ„ å‚è€ƒ what-are-the-uses-of-the-exec-command-in-shell-scripts C-shellçš„åŸºæœ¬ä½¿ç”¨ è¶£æ¢ Mach-Oï¼šåŠ è½½è¿‡ç¨‹ Mac OS X Architecture and Terminology Architecture of macOS Magic number (programming) å¸¸ç”¨é­”æ•°","link":"/2017/01/27/iOSer-Understand-objc-runtime-4-runtime-process-analysis/"},{"title":"ç†è§£objcè¿è¡Œæ—¶ä¸‰:æ–¹æ³•ç¼–ç ,æ‰§è¡Œ,è½¬å‘,äº¤æ¢","text":"æ–¹æ³•ç¼–ç æ¦‚å¿µ To assist the runtime system, the compiler encodes the return and argument types for each method in a character string and associates the string with the method selector. ä¸ºäº†è¾…åŠ©è¿è¡Œæ—¶ç³»ç»Ÿï¼Œç¼–è¯‘å™¨å¯¹å­—ç¬¦ä¸²ä¸­æ¯ä¸ªæ–¹æ³•çš„è¿”å›å’Œå‚æ•°ç±»å‹è¿›è¡Œç¼–ç ï¼Œå¹¶å°†å­—ç¬¦ä¸²ä¸æ–¹æ³•é€‰æ‹©å™¨ç›¸å…³è” OCç±»å‹ç¼–ç è¡¨ å­—ç¬¦ å«ä¹‰ c A char i An int s A short l A long l is treated as a 32-bit quantity on 64-bit programs. q A long long C An unsigned char I An unsigned int S An unsigned short L An unsigned long Q An unsigned long long f A float d A double B A C++ bool or a C99 _Bool v A void * A character string (char *) @ An object (whether statically typed or typed id) # A class object (Class) : A method selector (SEL) [array type] An array {name=typeâ€¦} A structure (name=typeâ€¦) A union bnum A bit field of num bits ^type A pointer to type ? An unknown type (among other things, this code is used for function pointers è¯¦æƒ…å‚è€ƒ:Type Encoding åœ¨ä¸Šä¸€èŠ‚ä½¿ç”¨method_getTypeEncodingæ‰“å°å‡ºæ–¹æ³•åˆ—è¡¨æ—¶ 12345...'NSString'|'initWithFormat:locale:arguments:' of encoding '@40@0:8@16@24[1{__va_list_tag=II^v^v}]32''NSString'|'initWithCoder:' of encoding '@24@0:8@16''NSString'|'initWithString:' of encoding '@24@0:8@16'... 12// method_getTypeEncodingå‡½æ•°çš„æ³¨é‡Šä¸ºè¿”å›ä¸€ä¸ªæè¿°äº†æ–¹æ³•å‚æ•°ä¸è¿”å›ç±»å‹çš„å­—ç¬¦ä¸² * Returns a string describing a method's parameter and return types. æ–¹æ³•æ˜¯å¦‚ä½•ç¼–ç çš„ ä¸ºä»€ä¹ˆNSStringçš„initWithString*çš„ç¼–ç æ˜¯@24@0:8@16* Googleäº†ä¸€ä¸‹ Apple Mail List: method_getTypeEncoding returns strange string é‡Œé¢ä¸»è¦è¯´äº†ä¸¤ä¸ªäº‹æƒ… ä¸ºä»€ä¹ˆæœ‰è¿™ä¹ˆå¤šçš„@:ä¹‹ç±»çš„æ•°å­—ä»£è¡¨ä»€ä¹ˆæ„æ€ å› ä¸ºOCæ–¹æ³•é»˜è®¤å¸¦äº†self*å’Œ_cmd*è¿™ä¸¤ä¸ªå‚æ•°,æ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆèƒ½ç›´æ¥åœ¨æ–¹æ³•ä¸­ç”¨è¿™ä¸¤ä¸ªâ€å…³é”®å­—â€çš„åŸå› ,æ‰€ä»¥é…åˆä¸Šé¢çš„ç¼–ç è¡¨ @(è¿”å›å€¼)24@(self)0:(_cmd)8@(ç¬¬ä¸€ä¸ªå‚æ•°NSString) å…³äºæ•°å­—ä»£è¡¨ä»€ä¹ˆæ„æ€? å¸–å­ä¸Šè¯´æ³•ä¸å¤ªç»Ÿä¸€, æœ‰è¯´æ˜¯æ ˆåç§»é‡(Stack offset)çš„,æœ‰è¯´å’Œ(arm,ppc,x86_64)å¹³å°ç›¸å…³ã€‚ å°è¯•æŸ¥äº†æºç ,è°ƒè¯•äº†åŠå¤©,ä¸å¤ªæˆåŠŸ,å¹¶ä¸æ˜¯æ˜æ˜¾çš„æœ‰ä¸€ä¸ªç”Ÿæˆè§„åˆ™ã€‚ç»è¿‡è§‚å¯Ÿ,å‘ç°@0:8æ˜¯æ¯ä¸ªæ–¹æ³•éƒ½æ˜¯ä¸€æ ·çš„(NSStringç±»),ç»“åˆä¸Šé¢çš„å«ä¹‰ 0 ç”¨æ¥æè¿°self,8ç”¨æ¥æè¿°_cmd,æƒ³åˆ°selfæŒ‡å‘è¯¥ç±»åœ°å€åŸºåœ°å€,åç§»é‡æ­£å¥½ä¸º0,å› æ­¤æ£æµ‹æ•°å­—çš„æ„æ€åº”è¯¥æ˜¯ç›¸å¯¹äºç±»çš„åŸºåœ°å€çš„åç§»é‡ æ•°æ®ç±»å‹IvarIvarç”¨äºè¡¨ç¤ºç±»çš„å®ä¾‹å˜é‡çš„ç±»å‹ å®šä¹‰å¦‚ä¸‹ 12345678struct objc_ivar { char *ivar_name OBJC2_UNAVAILABLE; char *ivar_type OBJC2_UNAVAILABLE; int ivar_offset OBJC2_UNAVAILABLE;#ifdef __LP64__ int space OBJC2_UNAVAILABLE;#endif} æµ‹è¯•ä»£ç  å®šä¹‰äº†ä¸€ä¸ªDataStructureç±» 123456789101112131415161718192021@interface DataStructure : NSObject { int _a; long _b; char _c; NSArray *_d;}int main(int argc, const char * argv[]) { @autoreleasepool { Class cls = [DataStructure class]; unsigned int count = 0; Ivar *list = class_copyIvarList(cls, &amp;count); for (unsigned int i = 0; i &lt; count; ++i) { Ivar ity = list[i]; const char *iname = ivar_getName(ity); NSLog(@\"%@\\n\",[NSString stringWithUTF8String:iname]); } free(list); } return 0;} type : i æ•´æ•°name: _aoffset: 0x1007028a0 objc_property_tobjc_property_tç”¨äºè¡¨ç¤ºç±»çš„å±æ€§çš„ç±»å‹ 123// runtime.h/// An opaque type that represents an Objective-C declared property.typedef struct objc_property *objc_property_t; 12// objc-private.htypedef struct property_t *objc_property_t; éƒ½æ˜¯æŒ‡å‘objc_propertyç»“æ„ä½“çš„æŒ‡é’ˆ objc_propertyç»“æ„ä½“çš„å®šä¹‰ 12345// objc-runtime-new.hstruct property_t { const char *name; const char *attributes;}; é‡Œé¢æœ‰ä¸ªæŒ‡é’ˆattributesæŒ‡å‘objc_property_attribute_tç»“æ„ä½“çš„æ•°ç»„ 123456// runtime.h/// Defines a property attributetypedef struct { const char *name; /**&lt; The name of the attribute */ const char *value; /**&lt; The value of the attribute (usually empty) */} objc_property_attribute_t; æµ‹è¯•ä»£ç  123456789101112131415161718int main(int argc, const char * argv[]) { @autoreleasepool { Class cls = [DataStructure class]; unsigned int count = 0; objc_property_attribute_t t1 = {\"g1\",\"val1\"}; objc_property_attribute_t t2 = {\"g2\",\"val2\"}; objc_property_attribute_t t[] = {t1,t2}; class_addProperty(cls, \"g\", t, 2); objc_property_t *list2 = class_copyPropertyList(cls, &amp;count); for (unsigned int i = 0; i &lt; count; ++i) { objc_property_t ity = list2[i]; const char *iname = property_getName(ity); NSLog(@\"%@\\n\",[NSString stringWithUTF8String:iname]); } free(list2); } return 0;} objc_property_t ä¸­çš„attributesæŒ‡é’ˆç¡®å®æŒ‡å‘äº†é€šè¿‡class_addPropertyå‡½æ•°æ·»åŠ åˆ°ç±»ä¸­,ç±»å‹ä¸ºobjc_property_attribute_tç»“æ„ä½“çš„æ•°ç»„ å…³è”å¯¹è±¡(Associated Object)OC*ä¸­è¦æƒ³ç»™åŸæœ‰çš„ç±»æ·»åŠ æ–¹æ³•,è¦ä¹ˆæ˜¯åŠ¨æ€æ·»åŠ ,å¦ä¸€ç§å°±æ˜¯åˆ†ç±»(Category),ä½†æ˜¯åˆ†ç±»æ—¶,ä¸èƒ½æ·»åŠ å®ä¾‹å˜é‡,ç¼–è¯‘å™¨ä¸å…è®¸,å¯ä»¥é€šè¿‡å…³è”å¯¹è±¡è¿›è¡Œç»‘å®š,åŒæ—¶è¿˜å¯ä»¥æŒ‡å®šç®¡ç†ç­–ç•¥,åƒä½¿ç”¨@property*ä¸€æ ·æ–¹ä¾¿ã€‚ æµ‹è¯•ä»£ç : 1234567891011static const void *assockey = \"\";int main(int argc, const char * argv[]) { @autoreleasepool { Class cls = [DataStructure class];// unsigned int count = 0; objc_setAssociatedObject(cls, assockey, @\"123\", OBJC_ASSOCIATION_COPY_NONATOMIC); NSLog(@\"%@\",objc_getAssociatedObject(cls, assockey)); } return 0;} è·Ÿè¿›å»å¾—åˆ° 1234567891011121314151617181920212223242526272829303132333435363738394041424344void _object_set_associative_reference(id object, void *key, id value, uintptr_t policy) { // retain the new value (if any) outside the lock. ObjcAssociation old_association(0, nil); id new_value = value ? acquireValue(value, policy) : nil; { AssociationsManager manager; AssociationsHashMap &amp;associations(manager.associations()); disguised_ptr_t disguised_object = DISGUISE(object); if (new_value) { // break any existing association. AssociationsHashMap::iterator i = associations.find(disguised_object); if (i != associations.end()) { // secondary table exists ObjectAssociationMap *refs = i-&gt;second; ObjectAssociationMap::iterator j = refs-&gt;find(key); if (j != refs-&gt;end()) { old_association = j-&gt;second; j-&gt;second = ObjcAssociation(policy, new_value); } else { (*refs)[key] = ObjcAssociation(policy, new_value); } } else { // create the new association (first time). ObjectAssociationMap *refs = new ObjectAssociationMap; associations[disguised_object] = refs; (*refs)[key] = ObjcAssociation(policy, new_value); object-&gt;setHasAssociatedObjects(); } } else { // setting the association to nil breaks the association. AssociationsHashMap::iterator i = associations.find(disguised_object); if (i != associations.end()) { ObjectAssociationMap *refs = i-&gt;second; ObjectAssociationMap::iterator j = refs-&gt;find(key); if (j != refs-&gt;end()) { old_association = j-&gt;second; refs-&gt;erase(j); } } } } // release the old value (outside of the lock). if (old_association.hasValue()) ReleaseValue()(old_association);} å¤§è‡´åŸç†æ˜¯æœ‰ä¸ªAssociationsHashMapå°†keyå’Œvalueè¿›è¡Œå…³è”,æ ¹æ®æ³¨é‡Š,å¯ä»¥å¾—å‡º,å¦‚æœkeyç›¸åŒæ—¶,retainæ–°å€¼releaseæ—§å€¼ æ–¹æ³•çš„æ‰§è¡Œå‰é¢è¯´äº†,OCæ˜¯ä¸€é—¨åŠ¨æ€çš„é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€,å®ƒè„±èƒäºSmalltalkWiki Smalltalkä¸­çš„æ¶ˆæ¯æœºåˆ¶è¢«OCé‡‡ç”¨å¹¶ä¼ æ‰¿ä¸‹æ¥ MessagesThe message is the most fundamental language construct in Smalltalk. Even control structures are implemented as message sends. Smalltalk adopts by default a synchronous, single dynamic message dispatch strategy (as contrasted to the asynchronous, multiple dispatch strategy adopted by some other object-oriented languages). è€Œå®ƒä¸C++è¿™ç§å‡½æ•°è°ƒç”¨(function calling)åŒºåˆ«åœ¨äºã€‚è¿è¡Œæ—¶æ‰€åº”æ‰§è¡Œçš„ä»£ç ç”±è¿è¡Œç¯å¢ƒæ¥å†³å®š;è€Œä½¿ç”¨å‡½æ•°è°ƒç”¨çš„è¯­è¨€,åˆ™ç”±ç¼–è¯‘å™¨å†³å®šã€‚ å…ˆäº†è§£ä¸€äº›æ¦‚å¿µ SELSELä¸Methodæœ‰å…³,çœ‹ä¸‹Method Method123456789// runtime.h/// An opaque type that represents a method in a class definition.typedef struct objc_method *Method;struct objc_method { SEL method_name OBJC2_UNAVAILABLE; char *method_types OBJC2_UNAVAILABLE; IMP method_imp OBJC2_UNAVAILABLE;} OBJC2_UNAVAILABLE; 123456789101112131415161718// objc-private.htypedef struct method_t *Method;// objc-runtime-new.hstruct method_t { SEL name; const char *types; IMP imp; struct SortBySELAddress : public std::binary_function&lt;const method_t&amp;, const method_t&amp;, bool&gt; { bool operator() (const method_t&amp; lhs, const method_t&amp; rhs) { return lhs.name &lt; rhs.name; } };}; ä¸€ä¸ªMethodåŒ…å« 123SEL name*: // æ–¹æ³•åconst char * types: // æ–¹æ³•çš„ç¼–ç IMP imp: // æ–¹æ³•çš„å®ç° 123// objc.h/// An opaque type that represents a method selector.typedef struct objc_selector *SEL; ä»£ç éªŒè¯ å½“å‘ä¸€ä¸ªOCå¯¹è±¡æ‰§è¡Œæ–¹æ³•(å‘é€æ¶ˆæ¯)æ—¶,æ–¹æ³•åœ¨åº•å±‚ä¼šè½¬æ¢æˆè°ƒç”¨objc_msgSend( )å‡½æ•° è¯¥å‡½æ•°çš„åŸå‹ä¸ºvoid objc_msgSend(id self, SEL cmd,â€¦) è¯¥å‡½æ•°é€šè¿‡SELåœ¨selfå¯¹è±¡çš„åˆ—è¡¨ä¸­æ‰¾æŒ‡å®šçš„æ–¹æ³• æµ‹è¯•ä»£ç  1234567int main(int argc, const char * argv[]) { @autoreleasepool { NSObject *cls= [[NSObject alloc] init]; [cls debugDescription]; } return 0;} æŒ‰æŒ‡ä»¤çº§åˆ«è°ƒè¯• âŒƒ + F7 åŠŸèƒ½é”®å¼€å¯æƒ…å†µä¸‹,è¦åŠ ä¸Šfn, ä»è°ƒç”¨å †æ ˆçœ‹ç¡®å®è°ƒç”¨äº†objc_msgSend,å†ç»§ç»­è·Ÿè¿›,ä¼šè¿›åˆ°objc-msg-x86_64.s(å› ä¸ºæ˜¯macOSçš„æºä»£ç ) å½“ç„¶è¿˜æœ‰å…¶ä»–çš„ä¸€äº›æƒ…å†µ,ä¼šäº¤ç”±Objective-Cè¿è¡Œç¯å¢ƒä¸­çš„å¦å¤–ä¸€äº›å‡½æ•°æ¥å¤„ç† objc_msgSend_stret: å‘é€æ¶ˆæ¯è¦è¿”å›ç»“æ„ä½“,äº¤ç”±æ­¤å‡½æ•°å¤„ç†objc_msgSend_fpret:å‘é€æ¶ˆæ¯è¿”å›çš„æ˜¯æµ®ç‚¹æ•°,äº¤ç”±æ­¤å‡½æ•°å¤„ç†objc_msgSendSuper: ç»™çˆ¶ç±»å‘é€æ¶ˆæ¯,äº¤ç”±æ­¤å‡½æ•°å¤„ç† ç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“å“ªä¸ªå¯¹è±¡(self)è¦æ¥æ”¶æ¶ˆæ¯(SEL),ä½†æ˜¯æ¶ˆæ¯å…·ä½“æ‰§è¡Œä»€ä¹ˆ?Methodç»“æ„ä½“å·²ç»å‘Šè¯‰äº†åˆ°,å°±æ˜¯é‚£ä¸ªIMP,å¦‚æœæˆ‘ä»¬è¦çŸ¥é“é‚£ä¸ªIMP,ä¸€ç§æ–¹æ³•å°±æ˜¯ç”¨ä¸€ä¸ªè¡¨å»å…³è”æ–¹æ³•å(SEL)å’Œæ–¹æ³•å®ç°(IMP),è¿™æ ·åœ¨objc_msgSendä¸­å°±å¯ä»¥æ ¹æ®æ–¹æ³•å(SEL)å»æ‰¾åˆ°æ–¹æ³•å®ç°(IMP) ç¬¬äºŒéƒ¨åˆ†,åœ¨æ¢ç©¶ç±»çš„ç»“æ„æ—¶,æ›¾ä½¿ç”¨class_copyMethodListå¾—åˆ°æ–¹æ³•åˆ—è¡¨,æ‰“æ–­ç‚¹,è¿›å…¥objc-runtime-new.mm 12345678910111213141516171819202122232425262728293031Method *class_copyMethodList(Class cls, unsigned int *outCount){ unsigned int count = 0; Method *result = nil; if (!cls) { if (outCount) *outCount = 0; return nil; } rwlock_reader_t lock(runtimeLock); assert(cls-&gt;isRealized()); count = cls-&gt;data()-&gt;methods.count(); if (count &gt; 0) { result = (Method *)malloc((count + 1) * sizeof(Method)); count = 0; // éå†è·å–æ–¹æ³•,æ¢è¨€ä¹‹,å¯é€šè¿‡cls-&gt;data()-&gt;methodsè·å¾—æ–¹æ³•çš„IMPåœ°å€,çŸ¥é“è¦æ‰§è¡Œçš„ä»£ç çš„åœ°å€ for (auto&amp; meth : cls-&gt;data()-&gt;methods) { result[count++] = &amp;meth; } result[count] = nil; } if (outCount) *outCount = count; return result;} å…¶ä¸­æœ‰ä¸€å¥ cls-&gt;data()-&gt;methods.count() çœ‹çœ‹cls-&gt;data()-&gt;methodså°è¯•ç›´æ¥è®¿é—®,ä¸è¡Œ,åº”è¯¥æ˜¯é”çš„å…³ç³» ç›´æ¥è°ƒè¯•é‡Œé¢çš„ä»£ç  æ–¹æ³•è½¬å‘åœ¨ç¬¬äºŒéƒ¨åˆ†çš„æ–¹æ³•è°ƒç”¨ä¸­,çŸ¥é“äº†æŸ¥æ‰¾æ–¹æ³•çš„é¡ºåº,å› ä¸ºOCçš„åŠ¨æ€æ€§,åœ¨ç¼–è¯‘æœŸé—´å‘ç±»å‘é€äº†å…¶æ— æ³•è§£è¯»çš„æ¶ˆæ¯,å¹¶ä¸ä¼šæŠ¥é”™,ä½†æ˜¯å½“è¿è¡Œæ—¶,å‘ç°æ¥æ”¶è€…ç¡®å®æ— æ³•å“åº”æ¶ˆæ¯æ—¶,å°±ä¼šæŠ¥unrecognized selector sent to instance 0x87*** Terminating app due to uncaught exception NSInvalidArgumentExceptionâ€¦,ä½†æ˜¯åœ¨æ­¤ä¹‹å‰,OCè¿˜ä¼šå¯åŠ¨â€œæ¶ˆæ¯è½¬å‘â€(message forwarding)æœºåˆ¶,è®©ç¨‹åºå‘˜æœ‰æœºä¼šå‘Šè¯‰å¯¹è±¡å¦‚ä½•å¤„ç†æœªçŸ¥æ¶ˆæ¯ã€‚ åŠ¨æ€æ–¹æ³•è§£ææ¥æ”¶è€…æ˜¯å¯¹è±¡ 1+ (BOOL)resolveInstanceMethod:(SEL)selector æ¥æ”¶è€…æ˜¯ç±» 1+ (BOOL)resolveClassMethod:(SEL)selector selectorå‚æ•°ä¸ºæœªè¯†åˆ«çš„æ–¹æ³•å‰æ:ç›¸å…³æ–¹æ³•çš„å®ç°ä»£ç å·²ç»å†™å¥½,åªæ˜¯è¿è¡Œæ—¶æ’å…¥åˆ°ç±»ä¸­å³å¯,å¸¸å¸¸ç”¨æ¥å®ç°@dynamicå±æ€§ã€‚ å¤‡æ´æ¥æ”¶è€…1- (id)forwardingTargetForSelector:(SEL)selector selectorå‚æ•°ä¸ºæœªè¯†åˆ«çš„æ–¹æ³•idè¿”å›ç±»å‹ä»£è¡¨èƒ½è¯†åˆ«selectoræ–¹æ³•çš„å¯¹è±¡,å¦‚æœæ²¡æœ‰,è¿”å›nil æµ‹è¯•ä»£ç  123456789101112131415161718192021int main(int argc, const char * argv[]) { @autoreleasepool { DataStructure *d = [[DataStructure alloc] init]; [d performSelector:@selector(haha)]; } return 0;}- (id)forwardingTargetForSelector:(SEL)aSelector { return [[NewTarget alloc] init];}@interface NewTarget : NSObject- (void)haha;@end@implementation NewTarget- (void)haha { NSLog(@\"haha\");}@end å°†å‘é€ç»™DataStructureç±»çš„hahaæ¶ˆæ¯è®©NewTargetç±»å»å“åº” è¯¥æ–¹æ³•é…åˆç»„åˆçš„å½¢å¼,å¯ä»¥æ¨¡æ‹Ÿå¤šç»§æ‰¿çš„æ•ˆæœ å®Œæ•´çš„æ¶ˆæ¯è½¬å‘å¯åŠ¨å®Œæ•´çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶,åˆ›å»ºNSInvocationå¯¹è±¡,å°è£…æœªå“åº”å¯¹è±¡çš„SEL,targetåŠå‚æ•°,è°ƒç”¨ 1- (void)forwardInvocation:(NSInvocation *)invocation ä½¿ç”¨è¯¥æ–¹æ³•å¯ä»¥ä¿®æ”¹æ¶ˆæ¯å†…å®¹,è¿½åŠ å‚æ•°,æ›´æ”¹SELç­‰ æ–¹æ³•äº¤æ¢(Method Swizzling)ä»ä¸Šé¢ä¹Ÿå¯ä»¥çŸ¥é“,OCä¸­å¯ä»¥åœ¨è¿è¡Œæ—¶,åŠ¨æ€æ·»åŠ æ–¹æ³•,æ”¹å˜æ¥æ”¶å¯¹è±¡,æ¶ˆæ¯æ”¹å˜ä¸è½¬å‘ç­‰ã€‚å› ä¸ºMethodæ–¹æ³•æœ‰SELä¸IMP,å¯ä»¥é€šè¿‡ä¿®æ”¹SELæŒ‡å‘çš„IMP,è¾¾åˆ°æ–¹æ³•äº¤æ¢çš„æ•ˆæœã€‚ ä»£ç  1234567891011121314151617181920212223242526272829/** * cls ç±» * originalSelector clsç±»åŸSEL * swizzSelector clsç±»æ–°SEL */ + (void)hookMethod:(Class)cls OriginSelector:(SEL)originalSelector SwizzledSelector:(SEL)swizzledSelector { // æ–¹æ³•æŒ‡é’ˆ Method originalMethod = class_getInstanceMethod(cls, originalSelector); Method swizzledMethod = class_getInstanceMethod(cls, swizzledSelector); // ä¸ºåŸSELæ·»åŠ æ–°çš„IMPå®ç° BOOL didAddMethod = class_addMethod(cls, originalSelector, method_getImplementation(swizzledMethod), method_getTypeEncoding(swizzledMethod)); // æ·»åŠ æˆåŠŸ if (didAddMethod) { // ç”¨åŸSELçš„IMPå®ç°æ›¿æ¢æ–°SELçš„IMPå®ç° è¾¾åˆ°äº¤æ¢æ–¹æ³•çš„æ•ˆæœ class_replaceMethod(cls, swizzledSelector, method_getImplementation(originalMethod), method_getTypeEncoding(originalMethod)); } else { // è‹¥å¤±è´¥,ç›´æ¥äº¤æ¢ method_exchangeImplementations(originalMethod, swizzledMethod); }} å‚è€ƒ å—å³°å­:Objective-C Runtime è¿è¡Œæ—¶ä¹‹äºŒï¼šæˆå‘˜å˜é‡ä¸å±æ€§ ASSOCIATED OBJECT ã€ŠEffective Objective-C 2.0ã€‹","link":"/2016/12/25/iOSer-Understand-objc-runtime-3-method-encoding-execution-etc/"},{"title":"ç†è§£Block(ä¸‹)","text":"å‰è¨€æœ¬æ–‡å°†ä¼šä»å†…å­˜ç»“æ„ä¸Šåˆ†æ OC ä¸­çš„ Block ã€‚ ç¯å¢ƒ macOS Sierra 10.12.3Xcode 8.2.1 å…³äº Block çš„å®ç°åœ¨ Blockçš„å®ç° ä¸­çš„ Block çš„ç»“æ„å£°æ˜å¦‚ä¸‹ 12345678910111213141516struct Block_literal_1 { void *isa; // initialized to &amp;_NSConcreteStackBlock or &amp;_NSConcreteGlobalBlock int flags; int reserved; void (*invoke)(void *, ...); struct Block_descriptor_1 { unsigned long int reserved; // NULL unsigned long int size; // sizeof(struct Block_literal_1) // optional helper functions void (*copy_helper)(void *dst, void *src); // IFF (1&lt;&lt;25) void (*dispose_helper)(void *src); // IFF (1&lt;&lt;25) // required ABI.2010.3.16 const char *signature; // IFF (1&lt;&lt;30) } *descriptor; // imported variables}; å…³äº ABI åœ¨è®¡ç®—æœºè½¯ä»¶ä¸­ï¼Œåº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ï¼ˆABIï¼‰æ˜¯ä¸¤ä¸ªç¨‹åºæ¨¡å—ä¹‹é—´çš„æ¥å£ï¼Œå…¶ä¸­ä¸€ä¸ªç¨‹åºæ¨¡å—é€šå¸¸æ˜¯æœºå™¨ä»£ç çº§åˆ«çš„åº“æˆ–æ“ä½œç³»ç»Ÿã€‚ ABIç¡®å®šå¦‚ä½•è°ƒç”¨å‡½æ•°ä»¥åŠåœ¨ç³»ç»Ÿè°ƒç”¨çš„æƒ…å†µä¸‹å°†äºŒè¿›åˆ¶æ ¼å¼ä¿¡æ¯ä»ä¸€ä¸ªç¨‹åºç»„ä»¶ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªç¨‹åºç»„ä»¶æˆ–æ“ä½œç³»ç»Ÿçš„è¯¦ç»†ä¿¡æ¯ã€‚ Block : ç»“æ„ä¸­æœ‰ä¸€ä¸ª isa æŒ‡é’ˆï¼Œåˆå§‹åŒ–æ—¶æŒ‡å‘ _NSConcreteStackBlock æˆ– _NSConcreteGlobalBlock çš„åœ°å€, ç”¨äºå®ç°å¯¹è±¡ç›¸å…³çš„åŠŸèƒ½ã€‚ flags : ç”¨äºæŒ‰ bit ä½è¡¨ç¤ºä¸€äº› block çš„é™„åŠ ä¿¡æ¯ reserved : ä¿ç•™ä½ void (*invoke)(void* ,...) : æ¥æ”¶å¯å˜å‚æ•°çš„å‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘ block å®ç°çš„å‡½æ•°è°ƒç”¨ (invoke) åœ°å€ã€‚ descriptor : Block_descriptor_1 ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œè¡¨ç¤ºè¯¥ block çš„é™„åŠ æè¿°ä¿¡æ¯ï¼Œä¸»è¦æ˜¯ size å¤§å°ï¼Œä»¥åŠ copy å’Œ dispose å‡½æ•°çš„æŒ‡é’ˆã€‚ imported variables : capture è¿‡æ¥çš„å˜é‡ï¼Œblock èƒ½å¤Ÿè®¿é—®å®ƒå¤–éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œå°±æ˜¯å› ä¸ºå°†è¿™äº›å˜é‡ï¼ˆæˆ–å˜é‡çš„åœ°å€ï¼‰å¤åˆ¶åˆ°äº†ç»“æ„ä½“ä¸­ã€‚ å®è·µå®è·µä¸€ : æ–°å»º Xcode å‘½ä»¤è¡Œå·¥ç¨‹main.m 12345678910111213#import &lt;Foundation/Foundation.h&gt;int main(int argc, const char * argv[]) { @autoreleasepool { // insert code here... void (^blockDemo)() = ^() { NSLog(@\"Hello world\"); }; blockDemo(); } return 0;} è®¾ç½®æ–­ç‚¹ï¼Œç¼–è¯‘å¹¶è¿è¡Œï¼ŒæŒ‰æŒ‡ä»¤çº§åˆ«å•æ­¥è°ƒè¯•ï¼Œå¯å¾—åˆ° ä»ä¸Šé¢çš„ç»“æœå¯çŸ¥, Block ç»“æ„ç¡®å®å¦‚ä¸Šé¢æ‰€æè¿°çš„, isa æŒ‡é’ˆæŒ‡å‘çš„æ˜¯ __NSGlobalBlock__ å°†å·¥ç¨‹çš„äºŒè¿›åˆ¶æ–‡ä»¶æ”¾åˆ° Hopper ï¼ŒæŸ¥çœ‹ __main_block_invoke 123456789101112131415 ___main_block_invoke:0000000100000f10 push rbp ; Objective C Block defined at 0x100001060, XREF=0x1000010700000000100000f11 mov rbp, rsp0000000100000f14 sub rsp, 0x100000000100000f18 lea rax, qword [ds:cfstring_Hello_world] ; @\"Hello world\"0000000100000f1f mov qword [ss:rbp+var_8], rdi0000000100000f23 mov qword [ss:rbp+var_10], rdi0000000100000f27 mov rdi, rax ; argument \"format\" for method imp___stubs__NSLog0000000100000f2a mov al, 0x00000000100000f2c call imp___stubs__NSLog0000000100000f31 add rsp, 0x100000000100000f35 pop rbp0000000100000f36 ret ; endp0000000100000f37 db 0x90 ; '.' åæ±‡ç¼–å¾—åˆ° 1234void ___main_block_invoke(void * _block) { NSLog(@\"Hello world\"); return;} ä¿®æ”¹ Xcode å·¥ç¨‹ï¼Œç”¨ Block å»æ•è·å‚æ•° 123456789101112131415#import &lt;Foundation/Foundation.h&gt;int main(int argc, const char * argv[]) { @autoreleasepool { // insert code here... int a = 1; NSString *testString = @\"2\"; void (^blockDemo)() = ^() { NSLog(@\"Hello world,%d,%@\",a,testString); }; blockDemo(); } return 0;} åŒæ ·æ“ä½œå¾—åˆ°å¦‚ä¸‹æˆªå›¾ å¦‚æœå–æ¶ˆ ARC ç¯å¢ƒ, isa æŒ‡é’ˆä¼šæŒ‡å‘ __NSStackBlock__ï¼Œåœ¨æ­¤ä¸å†æˆªå›¾è¯´æ˜ã€‚ å°ç»“ä¸€ éªŒè¯äº† Block ä¸­ invoke å‡½æ•°æŒ‡é’ˆæŒ‡å‘ block å®ç°çš„å‡½æ•°åœ°å€ã€‚ éªŒè¯äº† imported variables ç¡®å®ä¿å­˜äº†ä»å¤–éƒ¨ capture åˆ° Block ä¸­çš„å˜é‡ é—®é¢˜ä¸€Block ä¸­ isa æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡å’Œ Blockçš„å®ç° æè¿°çš„æœ‰å‡ºå…¥ å®è·µäºŒ : clang é‡å†™å·¥ç¨‹çš„ main.m æ–‡ä»¶æ‰¾åˆ° main.m æ–‡ä»¶ï¼Œåœ¨ç»ˆç«¯ä¸­ç”¨ clang -rewrite-objc path/to/main.m ç”Ÿæˆå¯¹åº”çš„ C++ ä»£ç ã€‚ å‚è€ƒæœ¬æ–‡åçš„å¼•ç”¨é“¾æ¥ 3 æ‘˜å½•å‡ºä¸ Block ç›¸å…³çš„å®ç°éƒ¨åˆ† 1234567891011121314151617181920212223#ifndef BLOCK_IMPL#define BLOCK_IMPLstruct __block_impl { void *isa; int Flags; int Reserved; void *FuncPtr;};// Runtime copy/destroy helper functions (from Block_private.h)#ifdef __OBJC_EXPORT_BLOCKSextern \"C\" __declspec(dllexport) void _Block_object_assign(void *, const void *, const int);extern \"C\" __declspec(dllexport) void _Block_object_dispose(const void *, const int);extern \"C\" __declspec(dllexport) void *_NSConcreteGlobalBlock[32];extern \"C\" __declspec(dllexport) void *_NSConcreteStackBlock[32];#else__OBJC_RW_DLLIMPORT void _Block_object_assign(void *, const void *, const int);__OBJC_RW_DLLIMPORT void _Block_object_dispose(const void *, const int);__OBJC_RW_DLLIMPORT void *_NSConcreteGlobalBlock[32];__OBJC_RW_DLLIMPORT void *_NSConcreteStackBlock[32];#endif#endif#define __block#define __weak 123456789101112131415161718192021222324252627282930struct __main_block_impl_0 { struct __block_impl impl; struct __main_block_desc_0* Desc; __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, int flags=0) { impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; }};static void __main_block_func_0(struct __main_block_impl_0 *__cself) { NSLog((NSString *)&amp;__NSConstantStringImpl__var_folders_lk_znn1qp4925j412wt4t_qkplc0000gn_T_main_8067ac_mi_0); }static struct __main_block_desc_0 { size_t reserved; size_t Block_size;} __main_block_desc_0_DATA = { 0, sizeof(struct __main_block_impl_0)};int main(int argc, const char * argv[]) { /* @autoreleasepool */ { __AtAutoreleasePool __autoreleasepool; void (*blockDemo)() = ((void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA)); ((void (*)(__block_impl *))((__block_impl *)blockDemo)-&gt;FuncPtr)((__block_impl *)blockDemo); } return 0;}static struct IMAGE_INFO { unsigned version; unsigned flag; } _OBJC_IMAGE_INFO = { 0, 2 }; main å‡½æ•°çš„æ‰§è¡Œæµç¨‹ å‡½æ•° __main_block_impl_0 ä»¥ __main_block_func_0 ä¸ __main_block_desc_0_DATA ä½œå‚æ•°ä¼ å…¥æ¥å®Œæˆç»“æ„ä½“ __main_block_impl_0 çš„åˆå§‹åŒ– å‡½æ•° __main_block_func_0 åœ¨è¿™é‡Œå³ä¸º NSLog(@\"Hello world\")ï¼Œå°†å…¶åœ°å€ä¼ é€’ç»™ç»“æ„ä½“ __main_block_impl_0 ä¸­çš„ __block_impl ç»“æ„ä½“ impl çš„å‡½æ•°æŒ‡é’ˆ FuncPtr å‚æ•° __main_block_desc_0 ä¼ é€’åˆ°ç»“æ„ä½“ __main_block_impl_0 ä¸­çš„ __main_block_desc_0 ç»“æ„ä½“çš„ Desc blockDemo å‡½æ•°æŒ‡é’ˆå¼•ç”¨äº†å‰é¢ç»“æ„ä½“åˆå§‹åŒ–ä¸­è·å¾—çš„ __main_block_impl_0 ç»“æ„ä½“ blockDemo å‡½æ•°æŒ‡é’ˆå¼•ç”¨çš„ç»“æ„ä½“å¼ºè½¬ä¸º __block_impl * ç±»å‹ï¼Œå› ä¸ºç»“æ„ä½“ __main_block_impl_0 çš„å†…å­˜ç»“æ„ä¸­æœ€å‰é¢å°±æ˜¯ __block_impl ç»“æ„ä½“çš„ implï¼Œå› æ­¤åœ¨è¿™é‡Œå¼ºè½¬ç±»å‹å€Ÿç”¨ä¸€ä¸‹é¢å‘å¯¹è±¡çš„æ¦‚å¿µå°±æ˜¯å­ç±»å¼ºè½¬æˆçˆ¶ç±»æŒ‡é’ˆï¼Œæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚å½“ç„¶é¢å‘è¿‡ç¨‹æ—©äºé¢å‘å¯¹è±¡ï¼Œé¢å‘å¯¹è±¡ä¸ºä»€ä¹ˆèƒ½å®ç°çˆ¶ç±»æŒ‡é’ˆå¼ºè½¬æˆå­ç±»ï¼Œåå€’æ˜¯åº”è¯¥è¦ä¾èµ–ä¸¤è€…å…¼å®¹çš„å†…å­˜ç»“æ„ã€‚ æ‰§è¡Œç¬¬ 5 æ­¥ç”Ÿæˆçš„ __block_impl çš„ç»“æ„ä½“çš„ FuncPtr å‡½æ•°ï¼Œå‰é¢éƒ¨åˆ†çš„ ((void (*)(__block_impl *)) è¡¨æ˜è¿™ä¸ªå‡½æ•°æ˜¯æ— è¿”å›å€¼,éœ€è¦ä¸€ä¸ª __block_impl çš„å‚æ•°ï¼Œåé¢éƒ¨åˆ†çš„ ((__block_impl *)blockDemo) è¯´æ˜è¦æ‰§è¡Œ FuncPtr å‡½æ•°ï¼Œå¹¶æŠŠ blockDemo å¼ºè½¬ä¸º (__block_impl * ) ä½œä¸ºå‚æ•°ä¼ é€’åˆ°è¯¥å‡½æ•°ä¸­ å°ç»“äºŒä»ä¸Šé¢çš„å®è·µä¸­,æˆ‘ä»¬å¯ä»¥å¾—çŸ¥å¹³æ—¶åˆ›å»ºçš„ Block åŒ…å«äº† struct __block_impl å’Œç±»ä¼¼ struct __main_block_desc_0 è¿™ä¸ Blockå®ç° ä¸­æè¿°çš„ Block çš„ç»“æ„æ˜¯ç­‰ä»·çš„ã€‚ å…³äºé—®é¢˜ä¸€ åœ¨å®è·µä¸€ä¸­ç”¨ po è¾“å‡º Block çš„ isa å¯¹è±¡ä¸ºç±»ä¼¼ __NSStackBlock__ è¿™ç§çš„ç±»å‹çš„ åœ¨å®è·µäºŒä¸­ç”¨ clang é‡å†™ OC ä»£ç ï¼ŒBlock çš„ isa æŒ‡é’ˆæŒ‡å‘ _NSConcreteStackBlock / _NSConcreteStackBlock å“ªä¸ªæ‰æ˜¯æ­£ç¡®çš„å‘¢? æ€è€ƒä¹‹åï¼Œæˆ‘è§‰å¾—æ˜¯è¿™æ ·çš„: ä»å†…å­˜è§’åº¦ä¸Šçœ‹ï¼Œisa ä¸­ä¿å­˜çš„å°±æ˜¯ä¸€ä¸ªå†…å­˜åœ°å€ã€‚æˆ‘ä»¬ç”¨ po æ¥è¾“å‡ºæ—¶ï¼Œå°±æ˜¯å‘Šè¯‰ lldb æŠŠæˆ‘ä¼ å…¥çš„è¿™ä¸ªå†…å­˜åœ°å€è®¤ä¸ºæ˜¯ä¸€ä¸ªå¯¹è±¡çš„èµ·å§‹åœ°å€ï¼Œä»¥ä¸€ä¸ªå¯¹è±¡çš„è§’åº¦å»çœ‹å®ƒï¼Œå› ä¸º Apple å¯¹ Block è¿›è¡Œäº†ç›¸åº”çš„å°è£…ï¼Œè‡ªç„¶è¾“å‡ºå¯¹åº”çš„ Block å¯¹è±¡ç±»å‹ã€‚ç„¶ååœ¨ clang ç¿»è¯‘æˆ C++ åï¼Œæ˜¯ä»¥ _NSConcreteStackBlock è¿™ç§å˜é‡åœ°å€çš„è§’åº¦æ¥çœ‹å¾…å®ƒã€‚ç®€è€Œè¨€ä¹‹ï¼Œä¸¤è€…éƒ½æ²¡æœ‰é—®é¢˜ï¼Œåªæ˜¯è§’åº¦ä¸åŒè€Œå·²ã€‚ å®è·µä¸‰ : æ•è·å¤–éƒ¨å˜é‡çš„ Blockç±»ä¼¼å®è·µäºŒæ“ä½œï¼ŒæŸ¥çœ‹æ•è·äº†å¤–éƒ¨å˜é‡çš„ Block çš„å®ç° 12345678910111213141516171819202122232425262728293031323334353637383940struct __main_block_impl_0 { struct __block_impl impl; struct __main_block_desc_0* Desc; int a; NSString *testString; __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, int _a, NSString *_testString, int flags=0) : a(_a), testString(_testString) { impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; }};static void __main_block_func_0(struct __main_block_impl_0 *__cself) { int a = __cself-&gt;a; // bound by copy NSString *testString = __cself-&gt;testString; // bound by copy NSLog((NSString *)&amp;__NSConstantStringImpl__var_folders_lk_znn1qp4925j412wt4t_qkplc0000gn_T_main_6832f1_mi_1,a,testString); }static void __main_block_copy_0(struct __main_block_impl_0*dst, struct __main_block_impl_0*src) {_Block_object_assign((void*)&amp;dst-&gt;testString, (void*)src-&gt;testString, 3/*BLOCK_FIELD_IS_OBJECT*/);}static void __main_block_dispose_0(struct __main_block_impl_0*src) {_Block_object_dispose((void*)src-&gt;testString, 3/*BLOCK_FIELD_IS_OBJECT*/);}static struct __main_block_desc_0 { size_t reserved; size_t Block_size; void (*copy)(struct __main_block_impl_0*, struct __main_block_impl_0*); void (*dispose)(struct __main_block_impl_0*);} __main_block_desc_0_DATA = { 0, sizeof(struct __main_block_impl_0), __main_block_copy_0, __main_block_dispose_0};int main(int argc, const char * argv[]) { /* @autoreleasepool */ { __AtAutoreleasePool __autoreleasepool; int a = 1; NSString *testString = (NSString *)&amp;__NSConstantStringImpl__var_folders_lk_znn1qp4925j412wt4t_qkplc0000gn_T_main_6832f1_mi_0; void (*blockDemo)() = ((void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA, a, testString, 570425344)); ((void (*)(__block_impl *))((__block_impl *)blockDemo)-&gt;FuncPtr)((__block_impl *)blockDemo); } return 0;}static struct IMAGE_INFO { unsigned version; unsigned flag; } _OBJC_IMAGE_INFO = { 0, 2 }; å°ç»“ä¸‰main å‡½æ•°çš„æ‰§è¡Œæµç¨‹ è¿™æ¬¡ä¸å®è·µäºŒä¸»è¦å·®åˆ«åœ¨ ç»“æ„ä½“ __main_block_impl_0 çš„å¤šäº†ä¸¤ä¸ª a å’Œ testString å±æ€§æ¥æ”¶å¤–ç•Œä¼ å…¥çš„å‚æ•°ã€‚ ç»“æ„ä½“ __main_block_desc_0 å¤šäº† copy å’Œ dispose ä¸¤ä¸ªå‡½æ•° å¤šäº† __main_block_copy_0 å’Œ __main_block_dispose_0 ä¸¤ä¸ªé™æ€æ–¹æ³• æŸ¥çœ‹ Block-private.h 1234567891011// Runtime support functions used by compiler when generating copy/dispose helpers// Values for _Block_object_assign() and _Block_object_dispose() parametersenum { // see function implementation for a more complete description of these fields and combinations BLOCK_FIELD_IS_OBJECT = 3, // id, NSObject, __attribute__((NSObject)), block, ... BLOCK_FIELD_IS_BLOCK = 7, // a block variable BLOCK_FIELD_IS_BYREF = 8, // the on stack structure holding the __block variable BLOCK_FIELD_IS_WEAK = 16, // declared __weak, only used in byref copy helpers BLOCK_BYREF_CALLER = 128, // called from __block (byref) copy/dispose support routines.}; å› ä¸º a ä¸æ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥æ˜¯ä»¥ä¼ å€¼çš„æ–¹å¼è¿›è¡Œä¼ é€’è¿‡ç¨‹ã€‚è€Œ testString æ˜¯å¯¹è±¡ï¼Œä¼šåœ¨å‡½æ•° __main_block_copy_0 ä¸­ä»¥å‚æ•° 3 å»è°ƒç”¨å‡½æ•° _Block_object_assignï¼Œåœ¨å‡½æ•° __main_block_dispose_0 ä¸­ç±»ä¼¼ã€‚ å®è·µå›› : __Block ä¿®é¥°æ•è·çš„å˜é‡æ’æ›²1234567891011121314151617#import &lt;Foundation/Foundation.h&gt;int main(int argc, const char * argv[]) { @autoreleasepool { // insert code here... int a = 1; NSString *testString = @\"2\"; __block int b = 2; __block NSString *testString2 = @\"3\"; void (^blockDemo)() = ^() { NSLog(@\"Hello world,%d,%d,%@,%@\",a,b,testString,testString2); }; blockDemo(); } return 0;} ä¸Šé¢è¿™æ®µä»£ç ç”¨ clang -rewrite-objc ä¼šæŠ¥ clang: error: unable to execute command: Segmentation fault: 11 ï¼Œæ®µé”™è¯¯ï¼Œä¸€èˆ¬æ˜¯è®¿é—®äº†éæ³•åœ°å€é€ æˆçš„ã€‚å¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸ºäº†é¿å…å­—ç¬¦ä¸²è¢«é‡å¤åˆ›å»ºï¼Œä¸€èˆ¬éƒ½ä¼šæœ‰ä¸ªå­—ç¬¦ä¸²å¸¸é‡ç¼“å­˜æ± ã€‚è€Œ OC ä¸­ä¹Ÿä¸ä¾‹å¤–ï¼Œç”¨å­—é¢é‡åˆ›å»ºçš„å­—ç¬¦ä¸²æ˜¯æ”¾åœ¨æ•°æ®æ®µä¸­çš„ã€‚ the string will be stored in a area of memory called data segment. This area never changes after the application is launched è¿™ä¸ªåŒºåŸŸçš„æ•°æ®åœ¨åº”ç”¨å¯åŠ¨åä¸ä¼šè¢«æ”¹å˜ï¼Œè€Œç”¨ __block æ¥ä¿®é¥°ï¼Œå¾ˆæ˜æ˜¾æ˜¯æƒ³åœ¨ block ä¸­è¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥æ‰ä¼šæŠ¥æ®µé”™è¯¯ã€‚ å›å½’ä¿®æ”¹åçš„ä»£ç  1234567891011121314151617#import &lt;Foundation/Foundation.h&gt;int main(int argc, const char * argv[]) { @autoreleasepool { // insert code here... int a = 1; NSString *testString = @\"2\"; __block int b = 2; __block NSString *testString2 = [[NSString alloc] initWithString:@\"3\"]; void (^blockDemo)() = ^() { NSLog(@\"Hello world,%d,%d,%@,%@\",a,b,testString,testString2); }; blockDemo(); } return 0;} rewrite åçš„ç»“æœ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263struct __Block_byref_b_0 { void *__isa;__Block_byref_b_0 *__forwarding; int __flags; int __size; int b;};struct __Block_byref_testString2_1 { void *__isa;__Block_byref_testString2_1 *__forwarding; int __flags; int __size; void (*__Block_byref_id_object_copy)(void*, void*); void (*__Block_byref_id_object_dispose)(void*); NSString *testString2;};struct __main_block_impl_0 { struct __block_impl impl; struct __main_block_desc_0* Desc; int a; NSString *testString; __Block_byref_b_0 *b; // by ref __Block_byref_testString2_1 *testString2; // by ref __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, int _a, NSString *_testString, __Block_byref_b_0 *_b, __Block_byref_testString2_1 *_testString2, int flags=0) : a(_a), testString(_testString), b(_b-&gt;__forwarding), testString2(_testString2-&gt;__forwarding) { impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; }};static void __main_block_func_0(struct __main_block_impl_0 *__cself) { __Block_byref_b_0 *b = __cself-&gt;b; // bound by ref __Block_byref_testString2_1 *testString2 = __cself-&gt;testString2; // bound by ref int a = __cself-&gt;a; // bound by copy NSString *testString = __cself-&gt;testString; // bound by copy NSLog((NSString *)&amp;__NSConstantStringImpl__var_folders_lk_znn1qp4925j412wt4t_qkplc0000gn_T_main_894ba5_mi_2,a,(b-&gt;__forwarding-&gt;b),testString,(testString2-&gt;__forwarding-&gt;testString2)); }static void __main_block_copy_0(struct __main_block_impl_0*dst, struct __main_block_impl_0*src) {_Block_object_assign((void*)&amp;dst-&gt;b, (void*)src-&gt;b, 8/*BLOCK_FIELD_IS_BYREF*/);_Block_object_assign((void*)&amp;dst-&gt;testString, (void*)src-&gt;testString, 3/*BLOCK_FIELD_IS_OBJECT*/);_Block_object_assign((void*)&amp;dst-&gt;testString2, (void*)src-&gt;testString2, 8/*BLOCK_FIELD_IS_BYREF*/);}static void __main_block_dispose_0(struct __main_block_impl_0*src) {_Block_object_dispose((void*)src-&gt;b, 8/*BLOCK_FIELD_IS_BYREF*/);_Block_object_dispose((void*)src-&gt;testString, 3/*BLOCK_FIELD_IS_OBJECT*/);_Block_object_dispose((void*)src-&gt;testString2, 8/*BLOCK_FIELD_IS_BYREF*/);}static struct __main_block_desc_0 { size_t reserved; size_t Block_size; void (*copy)(struct __main_block_impl_0*, struct __main_block_impl_0*); void (*dispose)(struct __main_block_impl_0*);} __main_block_desc_0_DATA = { 0, sizeof(struct __main_block_impl_0), __main_block_copy_0, __main_block_dispose_0};int main(int argc, const char * argv[]) { /* @autoreleasepool */ { __AtAutoreleasePool __autoreleasepool; int a = 1; NSString *testString = (NSString *)&amp;__NSConstantStringImpl__var_folders_lk_znn1qp4925j412wt4t_qkplc0000gn_T_main_894ba5_mi_0; __attribute__((__blocks__(byref))) __Block_byref_b_0 b = {(void*)0,(__Block_byref_b_0 *)&amp;b, 0, sizeof(__Block_byref_b_0), 2}; __attribute__((__blocks__(byref))) __Block_byref_testString2_1 testString2 = {(void*)0,(__Block_byref_testString2_1 *)&amp;testString2, 33554432, sizeof(__Block_byref_testString2_1), __Block_byref_id_object_copy_131, __Block_byref_id_object_dispose_131, ((NSString *(*)(id, SEL, NSString *))(void *)objc_msgSend)((id)((NSString *(*)(id, SEL))(void *)objc_msgSend)((id)objc_getClass(\"NSString\"), sel_registerName(\"alloc\")), sel_registerName(\"initWithString:\"), (NSString *)&amp;__NSConstantStringImpl__var_folders_lk_znn1qp4925j412wt4t_qkplc0000gn_T_main_894ba5_mi_1)}; void (*blockDemo)() = ((void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA, a, testString, (__Block_byref_b_0 *)&amp;b, (__Block_byref_testString2_1 *)&amp;testString2, 570425344)); ((void (*)(__block_impl *))((__block_impl *)blockDemo)-&gt;FuncPtr)((__block_impl *)blockDemo); } return 0;}static struct IMAGE_INFO { unsigned version; unsigned flag; } _OBJC_IMAGE_INFO = { 0, 2 }; å°ç»“å››ä»¥ __block ä¿®é¥°çš„å¤–éƒ¨å˜é‡è¢« Block æ•è·æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªä»¥ __Block_byref_å˜é‡å_æ•è·é¡ºåºä¸ºå˜é‡åçš„ç»“æ„ä½“ 12345__attribute__((__blocks__(byref))) __Block_byref_b_0 b = {(void*)0,(__Block_byref_b_0 *)&amp;b, 0, sizeof(__Block_byref_b_0), 2};void (*blockDemo)() = ((void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA, a, testString, (__Block_byref_b_0 *)&amp;b, (__Block_byref_testString2_1 *)&amp;testString2, 570425344));__main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, int _a, NSString *_testString, __Block_byref_b_0 *_b, __Block_byref_testString2_1 *_testString2, int flags=0) : a(_a), testString(_testString), b(_b-&gt;__forwarding), testString2(_testString2-&gt;__forwarding) {...} æ ¹æ®ä¸Šé¢çš„ä»£ç ,å¯ä»¥å¾—å‡ºç»“æ„ä½“ __Block_byref_xxx_xx ä¸­çš„ __forwarding å°±æ˜¯æŒ‡å‘è¿™ä¸ªç»“æ„ä½“çš„åœ°å€ï¼ŒåŒæ—¶åœ¨ç»“æ„ä½“çš„åˆå§‹åŒ–æ–¹æ³•ä¸­ä¼ é€’çš„æ˜¯å˜é‡åœ°å€çš„å¼•ç”¨ï¼Œå¹¶å°†è¿™ä¸ªå¼•ç”¨ä¼ é€’ç»™ç»“æ„ä½“ __main_block_impl_0 ä¸­å¯¹åº”çš„å¤–éƒ¨å˜é‡ï¼Œå› æ­¤ç”¨ __block ä¿®é¥°çš„å¤–éƒ¨å˜é‡æ˜¯ä»¥ä¼ å€çš„æ–¹å¼è¢« Block æ•è·çš„ã€‚ OC çš„å†…å­˜ç®¡ç†æ˜¯åŸºäºå¼•ç”¨è®¡æ•°çš„ï¼Œæ‹·è´åˆ° Block ä¸­çš„å¤–éƒ¨å˜é‡è¢«ç»“æ„ä½“ __Block_byref_xxx_xx çš„ __forwarding æ‰€å¼•ç”¨äº†ï¼Œå› æ­¤éœ€è¦è€ƒè™‘ç»´æŠ¤å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ã€‚ æ€»ç»“æœ€åï¼Œä»¥æˆ‘çš„è¯æ¥æ€»ç»“ä¸‹ Block å…·ä½“æ˜¯ä»€ä¹ˆ? Block æ˜¯ä¸€ä¸ªç»“æ„ä½“æŒ‡é’ˆï¼Œåˆå§‹åŒ–æ–¹æ³•ä¸­æ¥æ”¶æ•è·çš„å¤–éƒ¨å˜é‡ï¼Œå…¶ä¸­æœ‰ __block ä¿®é¥°åˆ™ä¼ å€ï¼Œæ²¡æœ‰åˆ™ä¼ å€¼ï¼Œ ç»“æ„ä½“ä¸­çš„ FuncPtr å±æ€§ä»¥å‡½æ•°æŒ‡é’ˆçš„å½¢å¼æŒ‡å‘ä¸€ä¸ªé¢„å®šä¹‰çš„åŒ¿åå‡½æ•°ï¼Œåœ¨è°ƒç”¨æ—¶ï¼Œä¼šæŠŠ Block ä½œä¸ºå‚æ•°ä¼ é€’åˆ°é¢„å®šä¹‰çš„åŒ¿åå‡½æ•°ä¸­å¹¶æ‰§è¡Œã€‚ That's all å‚è€ƒ Block Implementation Specification Wiki - Application binary interface è°ˆObjective-C blockçš„å®ç° iOS-Runtime-Headers a-look-inside-blocks-episode-3-block-copy How Objective-C handles the memory of immutable strings","link":"/2017/03/26/iOSer-Understand-the-block-next/"},{"title":"ç†è§£Block(ä¸Š)","text":"å‰è¨€ æ•´ç†ä¸€äº›æ¦‚å¿µ ç¯å¢ƒ Xcode 8.2.1macOS Sierra 10.12.3 æ˜¯ä»€ä¹ˆ Block objects are a C-level syntactic and runtime feature. They are similar to standard C functions, but in addition to executable code they may also contain variable bindings to automatic (stack) or managed (heap) memory. A block can therefore maintain a set of state (data) that it can use to impact behavior when executed. Blockæ˜¯ä¸ªCè¯­è¨€çº§åˆ«çš„è¯­æ³•ä¸è¿è¡Œæ—¶ç‰¹æ€§ã€‚å®ƒå’Œå‡½æ•°ç±»ä¼¼,èƒ½æ‰§è¡Œä»£ç ,ä½†æ›´é‡è¦çš„æ˜¯èƒ½ç»‘å®šå †æ ˆä¸­çš„å˜é‡,é€šè¿‡è®¾ç½®è¿™äº›å˜é‡æ¥æ”¹å˜ä»£ç çš„è¡Œä¸ºã€‚ ç”¨åœ¨å“ª You can use blocks to compose function expressions that can be passed to API, optionally stored, and used by multiple threads. Blocks are particularly useful as a callback because the block carries both the code to be executed on callback and the data needed during that execution. Blockå¸¸è¢«ç”¨åœ¨å¤šçº¿ç¨‹ä¸­,åœ¨åº”ç”¨å¼€å‘æ—¶,å¤§å¤šæ•°æƒ…å†µä¸‹ä¸èƒ½å› ä¸ºç½‘ç»œè¯·æ±‚è€Œé˜»å¡ä¸ç”¨æˆ·çš„äº¤äº’,å¾…å“åº”è¿”å›å,åˆéœ€è¦æ ¹æ®å“åº”çš„ç»“æœå¯¹é¡µé¢è¿›è¡Œè°ƒæ•´ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹,å¯ä»¥è®©ä¸»çº¿ç¨‹å¯ä»¥æä¾›ä¸€ä¸ªBlockåˆ°å­çº¿ç¨‹ã€‚ ä¼˜ç‚¹ ä¸»çº¿ç¨‹:å®ç°å¼‚æ­¥,æ— éœ€å…³æ³¨ç½‘ç»œè¯·æ±‚çš„ç»†èŠ‚éƒ¨åˆ†,åªè¦è€ƒè™‘è¯·æ±‚ç»“æœå¯¹ç•Œé¢çš„å½±å“,é¢„å…ˆåšå¥½å¤„ç†æ–¹å¼ã€‚ å­çº¿ç¨‹:è´Ÿè´£ç½‘ç»œè¯·æ±‚,å®ƒæ¸…æ¥šç½‘ç»œè¯·æ±‚ä½•æ—¶å®Œæˆ,ç”±å®ƒæ¥é€šçŸ¥ä¸»çº¿ç¨‹è¿›è¡Œé¡µé¢åˆ·æ–°æ“ä½œæ˜¯æ¯”è¾ƒåˆé€‚çš„ã€‚ è€Œå®ƒä»¬çš„è”ç»“ç‚¹å°±æ˜¯Block,ä¸»çº¿ç¨‹æä¾›Block,å­çº¿ç¨‹è´Ÿè´£åœ¨åˆé€‚æ—¶æœºè°ƒç”¨Block å¦‚æœæ²¡æœ‰Blockå› ä¸ºBlockå’Œå‡½æ•°ç±»ä¼¼,ç”¨å‡½æ•°æ¥å®ç°å›è°ƒåŠŸèƒ½,åŒæ—¶å› ä¸ºOCæ˜¯é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€,ä¸ºäº†èƒ½ä¸å…¶ä»–æ–¹æ³•äº¤äº’,æ›´è´´è¿‘ç°å®æƒ…å½¢,å†™äº†å¦‚ä¸‹ä»£ç  12345678910111213141516171819202122232425262728293031// ä¸»çº¿ç¨‹ .m å‡½æ•°å®šä¹‰void completedFunc(NSString *response) { NSLog(@\"Hello %@\",response);}// å‡½æ•°è°ƒç”¨SubViewController *subVC = [[SubViewController alloc] init];[subVC setCompletedFunc:completedFunc];sleep(3); [self.navigationController pushViewController:subVC animated:true];// å­çº¿ç¨‹.h- (void)setCompletedFunc:(void (NSString *))r;// å­çº¿ç¨‹.m// æ¥æ”¶å‡½æ•°æŒ‡é’ˆ@property (nonatomic,copy) NSString *httpResponse;@property (nonatomic,assign) Response reponser;- (void)setCompletedFunc:(void (NSString *))r { _reponser = r; // ...}// åœ¨åˆé€‚çš„æ—¶æœºè°ƒç”¨å›è°ƒæ–¹æ³•æ¯”å¦‚viewDidLoadNSLog(@\"å‘é€ç½‘ç»œè¯·æ±‚\");// æ¥æ”¶ç½‘ç»œè¯·æ±‚æ•°æ®_httpResponse = @\"test,test,test\";// æ‰§è¡Œå›è°ƒ_reponser(_httpResponse); å¦‚æœç”¨Blockæ–¹å¼æ”¹å†™,å¯ä»¥å°†å‡½æ•°çš„å®šä¹‰ä¸å‡½æ•°å‚æ•°çš„ä¼ é€’ç»“åˆåœ¨ä¸€èµ·,å’ŒåŒ¿åå‡½æ•°å·®ä¸å¤š,å› ä¸ºä¸»çº¿ç¨‹ä¸­å¹¶ä¸å…³å¿ƒå‡½æ•°çš„åç§°,ä¸»è¦è¿˜æ˜¯å…¶ä¸­æ‰§è¡Œçš„ä»£ç ,å­çº¿ç¨‹ä¸­æ˜¯è¦å±æ€§å¼•ç”¨æ¥æ‰§è¡Œ,è¿˜æ˜¯ç›´æ¥æ‰§è¡Œ,é‚£æ˜¯å­çº¿ç¨‹éœ€è¦è€ƒè™‘çš„äº‹æƒ…ã€‚è€ŒhttpResponseæ˜¯å­çº¿ç¨‹ä¸­çš„å˜é‡,è¢«ä¼ é€’åˆ°ä¸»çº¿ç¨‹çš„å‡½æ•°ä¸­è¿›è¡Œæ‰§è¡Œäº†ã€‚å› æ­¤Blockå’Œé€šçŸ¥,ä»£ç†ç­‰ä¸€æ ·éƒ½å…·æœ‰ä¼ é€’æ•°æ®çš„èƒ½åŠ›ã€‚ è¿™é‡Œæ‰€è¯´çš„å­çº¿ç¨‹å’Œä¸»çº¿ç¨‹åªæ˜¯ä¸ºäº†åŒºåˆ†æ–‡ä»¶,ä¸æ˜¯è¯´æœ‰ä»€ä¹ˆä¸»çº¿ç¨‹çš„.mã€‚ æ€ä¹ˆå†™ intæ˜¯è¿”å›å€¼ ^æ˜¯å£°æ˜blockçš„è¯­æ³• myBlockæ˜¯block*å˜é‡çš„åç§°,å®ƒçš„å€¼ä¸º{return num * multiplier;}* int numæ˜¯å‚æ•°å {return num \\ multiplier;}æ˜¯block*çš„å†…å®¹ Xcodeçš„blockä»£ç å—æç¤ºä¸º:inlineBlock ä½œå±æ€§1@property (nonatomic,copy) void (^responser)(NSString *res); å¦‚æœè§‰å¾—ä¸å¥½çœ‹,å¯ä»¥typedefå®šä¹‰ä¸€ä¸ªåˆ«åç±»å‹ 12typedef void (^Responser)(NSString *);@property (nonatomic,copy) Responser req; ä½œå‚æ•°123- (void)setReq:(void (^)(NSString *))req { } 123- (void)setReq:(Responser)req { } ä½œè¿”å›å€¼123- (void (^)(NSString *))req { return nil;} 123- (Responser)req { return nil;} Blockçš„ç±»å‹ å±æ€§:æ˜¯OCçš„ä¸€é¡¹ç‰¹æ€§,ç”¨äºå°è£…å¯¹è±¡ä¸­çš„æ•°æ®ã€‚ åŸå­æ€§([no]atomatic) è¯»å†™æƒé™(readwrite/readonly) å†…å­˜ç®¡ç†è¯­ä¹‰(retain,copy,assign,weak,strong,unsafe_unretained) æ–¹æ³•å(getter,setter) strong:ä¸ºè¯¥ç§å±æ€§è®¾ç½®æ–°å€¼æ—¶,è®¾ç½®æ–¹æ³•ä¼šå…ˆä¿ç•™æ–°å€¼å¹¶é‡Šæ”¾æ—§å€¼,ç„¶åå†å°†æ–°å€¼è®¾ç½®ä¸Šå»copy:ä¸strongç±»ä¼¼,ä½†æ˜¯ä¸ä¿ç•™æ–°å€¼,è€Œæ˜¯å°†å…¶â€æ‹·è´â€ã€‚å½“å±æ€§ç±»å‹ä¸ºNSStringæ—¶,å¸¸ç”¨è¯¥ç‰¹è´¨æ¥ä¿æŠ¤å…¶å°è£…æ€§ è¯¦æƒ…å¯ä»¥å‚è€ƒä¹¦ç±Effective Objective C 2.0 ç¬¬äºŒç« ç¬¬6æ¡ é€šè¿‡è¿™å„¿çš„5é“é¢˜å¯çŸ¥ Blockå¯æ ¹æ®å­˜å‚¨çš„åŒºåŸŸåˆ†ä¸º3ç§ç±»å‹:NSGlobalBlock,NSStackBlock,NSMallocBlock 123456789101112131415161718192021222324252627282930313233typedef void (^dBlock)();@interface MRCViewController ()@property (nonatomic,copy) dBlock dB;@end@implementation MRCViewController- (void)viewDidLoad { [super viewDidLoad]; dBlock b = ^{ printf(\"666\"); }; NSLog(@\"b=%@\",b); char d = 'D'; printf(\"dçš„addr:%p\\n\", &amp;d); dBlock b2 = ^{ printf(\"dçš„addr:%p\\n\", &amp;d); }; NSLog(@\"b2=%@\",b2); self.dB = b2; NSLog(@\"b2=%@\",b2); NSLog(@\"dB=%@\",self.dB); self.dB(); // MRCç¯å¢ƒä¸‹ dBlock dB2 = [[b2 copy] autorelease]; NSLog(@\"dB2=%@\",dB2); dB2();}... è¾“å‡ºç»“æœä¸º MRC ARC ç›®å‰ç»“è®º: ä¸ç»‘å®šå˜é‡æ—¶,MRCå’ŒARC*ç¯å¢ƒä¸‹éƒ½æ˜¯NSGlobalBlockç±»å‹ã€‚ ç»‘å®šéå¯¹è±¡å˜é‡çš„æƒ…å†µä¸‹,è¢«ç»‘å®šçš„å˜é‡éƒ½æ˜¯ä¼ å€¼çš„,åœ¨MRCç¯å¢ƒä¸‹,åˆ›å»ºBlocké»˜è®¤ä¼šå­˜å‚¨åœ¨æ ˆä¸­,å³ä¸ºNSStackBlockç±»å‹,ç”Ÿå‘½å‘¨æœŸä¸ºå‡½æ•°æˆ–æ–¹æ³•ä½“å†…æœ‰æ•ˆ,å½“ä½¿ç”¨copyä¿®é¥°çš„å±æ€§å¯¹å…¶è¿›è¡Œå¼•ç”¨æˆ–å¯¹Blockè°ƒç”¨copy + autoreleaseæ—¶,å°†ä¼šæ‹·è´ä¸€ä¸ªæ–°çš„Blockåˆ°å †ä¸­,å³ä¸ºNSMallocBlockç±»å‹,ç”Ÿå‘½å‘¨æœŸå°†ä¼šè¢«å»¶é•¿ã€‚åœ¨ARCç¯å¢ƒä¸‹,~~åˆ›å»ºBlocké»˜è®¤å­˜å‚¨åœ¨å †ä¸­,å³ä¸ºNSMallocBlockç±»å‹~~,å½“ä½¿ç”¨copy*ä¿®é¥°çš„å±æ€§å¯¹å…¶æ¥æ”¶æ—¶,å› ä¸ºå†…å­˜åœ°å€æ²¡å˜,æ‰€ä»¥åªè¿›è¡Œäº†æµ…æ‹·è´ã€‚ ä½†æ˜¯,æ ¹æ®è°ˆObjective-C blockçš„å®ç°ä¸­çš„è¯„è®º,åœ¨ARCç¯å¢ƒä¸‹ç…§ç€æ“ä½œå,è¾“å‡ºç¡®å®å¦‚æ­¤ã€‚å› æ­¤åˆè¿›è¡Œäº†ä»¥ä¸‹çš„ä»£ç æµ‹è¯• 123456789id arr;NSLog(@\"%@\", ^(){NSLog(@\"%@\", arr); }); // å¦‚æœç»‘å®šçš„ä¸æ˜¯å¯¹è±¡ä¼šæœ‰å½±å“å—?NSLog(@\"%@\",^{printf(\"dçš„addr:%p\\n\", &amp;d);}); dBlock b3 = nil;NSLog(@\"%@\",b3 = ^{printf(\"dçš„addr:%p\\n\", &amp;d);});b3(); è¾“å‡ºç»“æœ: ä¸è®ºBlock*ç»‘å®šçš„æ˜¯å¯¹è±¡è¿˜æ˜¯éå¯¹è±¡æ•°æ®ç±»å‹,ç»“æœéƒ½æ˜¯ä¸€æ ·çš„,ç›´æ¥è¾“å‡ºéƒ½æ˜¯NSStackBlockç±»å‹çš„,ä½†æ˜¯å½“è¿›è¡Œèµ‹å€¼æ“ä½œå,åœ¨ä¸Šé¢çš„æƒ…å†µä¸‹,ç”¨b3å»æ¥æ”¶Blockç±»å‹æ—¶,ARCå‘ç°è¿™ä¸ªBlockçš„ç”Ÿå‘½å‘¨æœŸå˜äº†,åœ¨è¾“å‡ºå,ä¾ç„¶åº”è¯¥å­˜åœ¨,æ‰€ä»¥å¯¹å…¶è¿›è¡Œæ‹·è´ä¸€ä»½åˆ°å †ä¸­,å› æ­¤b3ç±»å‹å˜ä¸ºNSMallocBlock*ã€‚ é€šè¿‡b3æ‰§è¡Œè¾“å‡ºçš„åœ°å€,ä¹Ÿä¸æ˜¯åŸæ¥çš„åœ°å€äº†,å› ä¸ºéå¯¹è±¡æ•°æ®ç±»å‹æ˜¯ä¼ å€¼çš„,é‚£ä¹ˆå¦‚æœæ¢æˆå¯¹è±¡,ä¼šæœ‰ä¸åŒå—?å†åˆ†åˆ«å†™äº†å¦‚ä¸‹æµ‹è¯•ä»£ç : 123456789NSString *d2 = @\"123\";printf(\"d2çš„addr%p\\n\",d2);dBlock b4 = ^ { printf(\"d2çš„addr:%p\\n\", d2);};b4();NSLog(@\"b4=%@\",b4);self.dB = b4;NSLog(@\"dB=%@\",self.dB); MRCç¯å¢ƒä¸‹è¾“å‡º ARCç¯å¢ƒä¸‹è¾“å‡º å¯ä»¥å¾—åˆ°ç»“æœ,å¯¹äºå¯¹è±¡çš„ç»‘å®šåœ¨MRCå’ŒARCéƒ½åªæ˜¯è¿›è¡Œäº†æµ…æ‹·è´ ç°åœ¨ç»‘å®šçš„æ˜¯å±€éƒ¨å˜é‡,å¦‚æœæ˜¯å¯¹è±¡çš„å±æ€§,ä¼šæœ‰å˜åŒ–å—? è¿›è¡Œå¦‚ä¸‹ä»£ç æµ‹è¯•: 123456789@property (nonatomic,strong) NSArray *dBTestArr;self.dBTestArr = @[@\"456\"];printf(\"dBTestArr:%p\",self.dBTestArr);dBlock b5 = ^ { NSLog(@\"dBTestArr:%p\",self.dBTestArr);};b5();NSLog(@\"b5=%@\",b5); MRCç¯å¢ƒè¾“å‡º ARCç¯å¢ƒè¾“å‡º åŒæ ·ä¹Ÿæ˜¯å¯¹å˜é‡è¿›è¡Œæµ…æ‹·è´ã€‚ å¦‚æœæ˜¯é™æ€å˜é‡å‘¢,ä¼šæœ‰å˜åŒ–å—? ä»£ç  123456789static NSArray *dBTestArr2;dBTestArr2 = @[@\"789\"];printf(\"dBTestArr2:%p\\n\",dBTestArr2);dBlock b6 = ^ { NSLog(@\"dBTestArr2:%p\",dBTestArr2);};b6();NSLog(@\"b6=%@\",b6); MRCç¯å¢ƒè¾“å‡º ARCç¯å¢ƒè¾“å‡º å˜é‡æ˜¯æµ…æ‹·è´çš„,åŒæ—¶Block*ç»Ÿä¸€éƒ½æ˜¯NSGlobalBlock*,è¿™ä¹Ÿå¾ˆå¥½ç†è§£,å› ä¸ºé™æ€å˜é‡åœ¨å†…å­˜ä¸­æ˜¯åˆ†é…åœ¨å…¨å±€åŒºçš„ã€‚ OCæ²¡æœ‰ç±»å±æ€§,ä½†æ˜¯æœ‰å…³è”å±æ€§,å¦‚æœå…³è”åˆ°ç±»å¯¹è±¡ä¸Š,ç”¨Blockè¿›è¡Œç»‘å®š,ä¼šæ€ä¹ˆæ ·å‘¢? ä»£ç  123456789#import &lt;objc/message.h&gt;static const char *dBTest3 = \"dbTest3\"; // static const char *dBTest4 = \"dbTest4\";objc_setAssociatedObject([self class], dBTest3, @[@\"0\"], OBJC_ASSOCIATION_RETAIN);printf(\"dBTest3:%p\\n\",objc_getAssociatedObject([self class], dBTest3));dBlock b7 = ^ { NSLog(@\"dBTest3:%p\",objc_getAssociatedObject([self class], dBTest3));};b7();NSLog(@\"b7=%@\",b7); MRCç¯å¢ƒ ARCç¯å¢ƒ åŒæ ·ä¹Ÿæ˜¯å¯¹å˜é‡æµ…æ‹·è´,MRC*ä¸‹æ˜¯NSStackBlock,ARCä¸‹æ˜¯NSMallocBlock* æ€»ç»“ä¸€ä¸‹,å¤§æ¦‚å¦‚ä¸‹è¡¨: ç»‘å®šå˜é‡ç±»å‹ MRC ARC ä¸ç»‘å®š NSGlobalBlock NSGlobalBlock å±€éƒ¨å˜é‡ NSStackBlock,copy*å±æ€§èµ‹å€¼ä¿®é¥°æ‹·è´ä¸€ä¸ªNSMallocBlock*å¯¹è±¡,éå¯¹è±¡ä¼ å€¼,å¯¹è±¡ä¼ å€ NSStackBlock,èµ‹å€¼åæ‹·è´ä¸€ä¸ªä¸ºNSMallocBlockå¯¹è±¡,éå¯¹è±¡ä¼ å€¼,å¯¹è±¡ä¼ å€ å±æ€§ NSStackBlock,éå¯¹è±¡ä¼ å€¼,å¯¹è±¡ä¼ å€ NSStackBlock,èµ‹å€¼åæ‹·è´ä¸€ä¸ªä¸ºNSMallocBlockå¯¹è±¡,éå¯¹è±¡ä¼ å€¼,å¯¹è±¡ä¼ å€ é™æ€å˜é‡ NSGlobalBlock,å˜é‡åœ°å€ NSGlobalBlock,å˜é‡åœ°å€ å…³è”å¯¹è±¡ NSStackBlock,å¯¹è±¡ä¼ å€ NSMallocBlock,å¯¹è±¡ä¼ å€ åˆ°è¿™é‡Œ,å…ˆåœä¸€ä¸‹,è¯´æ˜ä¸¤ä¸ªé—®é¢˜ åœ¨5é“ç»ƒä¹ é¢˜ä¸­çš„Example Bæœ‰ 12345678910111213void exampleB_addBlockToArray(NSMutableArray *array) { char b = 'B'; [array addObject:^{ printf(\"%cn\", b); }];}void exampleB() { NSMutableArray *array = [NSMutableArray array]; exampleB_addBlockToArray(array); void (^block)() = [array objectAtIndex:0]; block();} èƒ½æŠŠBlockæ·»åŠ åˆ°æ•°ç»„ä¸­,é‚£ä¹ˆBlockåº”è¯¥æ˜¯ä¸€ä¸ªå¯¹è±¡å§ã€‚ åœ¨JaviSoto/iOS10-Runtime-Headerså·¥ç¨‹ä¸­,æŸ¥æ‰¾å‘ç°Blockå¯¹è±¡çš„ç»§æ‰¿å…³ç³»ä¸º NSStackBlock =&gt; __NSStackBlock =&gt; NSBlock =&gt; NSObjectNSGlobalBlock =&gt; __NSGlobalBlock =&gt; NSBlock =&gt; NSObjectNSMallocBlock =&gt; __NSMallocBlock =&gt; NSBlock =&gt; NSObject å¯çŸ¥OCä¸­çš„Blockç¡®å®æ˜¯ä¸€ä¸ªå¯¹è±¡ è¿˜æœ‰ä¸€ä¸ªå°é—®é¢˜å°±æ˜¯å­˜åœ¨çš„åˆ°åº•æ˜¯NSConcreteGlobalBlock,NSConcreteStackBlock,è¿˜æ˜¯NSMallocBlockè¿™ç§ç±»å‹çš„? åœ¨13å¹´å‘è¡¨çš„,çŒœæµ‹å¯èƒ½è‹¹æœå¯¹Blockåº”è¯¥è¿›è¡Œä¿®æ”¹äº†,åˆæ ¹æ®clang-do åˆè§‰å¾—åå‘äºNSConcreteGlobalBlock,æˆ‘æš‚æ—¶è®¤ä¸ºåœ¨åº•å±‚å®é™…ä¸Šæ˜¯NSConcreteGlobalBlockè¿™ç§çš„,ç„¶ååœ¨OC*ä¸Šè¡¨ç°ä¸ºNSMallocBlock* __Block123456NSString *d2 = @\"123\";printf(\"d2çš„addr%p\\n\",d2);dBlock b4 = ^ { printf(\"d2çš„addr:%p\\n\", d2); d2 = @\"777\";}; ä»¥ä¸Šä»£ç å°†ä¼šæŠ¥Variable is not assignable (missing __block type specifier) ä¸ºä»€ä¹ˆå‘¢? åŒæ ·æ ¹æ®clang-doc,é‡Œé¢æœ‰è¿™æ ·çš„è¯´æ˜ å› ä¸ºå¦‚æœå˜é‡ä¸ç”¨__blockä¿®é¥°,é‚£ä¹ˆé»˜è®¤åœ¨æ‹·è´æ—¶,ä¼šæ·»åŠ constè¿›è¡Œä¿®é¥° Blockçš„å¾ªç¯å¼•ç”¨æ›´æ–°: 170402åœ¨ 5ä¸ªåŠ¨ç”»,ç†è§£å¸¸ç”¨åƒåœ¾å›æ”¶ç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ ä¸­æœ‰è¿™æ ·ä¸€æ®µè¯ å¼•ç”¨è®¡æ•°ç®—æ³•å­˜åœ¨å¾ˆå¤šé—®é¢˜ã€‚æœ€å¤§çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå®ƒæ— æ³•è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚è¿™ç§æƒ…å†µå¾ˆå¸¸è§ï¼Œçˆ¶å¯¹è±¡å’Œåå‘å¼•ç”¨ä¼šå½¢æˆå¼•ç”¨ç¯ã€‚ åŸæ¥çš„å…ˆæ„é€ ä¸€ä¸ªç®€å•çš„å¾ªç¯å¼•ç”¨ 1234@property (nonatomic,copy) dBlock dBCycle;self.dBCycle = ^ { NSLog(@\"%@\",self);}; æ­£å¸¸æƒ…å†µä¸‹,selfæ˜¯VC,è¢«å¯¼èˆªæ§åˆ¶å™¨çš„viewControllerså±æ€§æŒæœ‰,è€ŒselfæŒæœ‰dBCycleè¿™ä¸ªBlockå±æ€§,å½“popæ§åˆ¶å™¨å,selfçš„å¼•ç”¨è®¡æ•°ä¸º0,è¢«é‡Šæ”¾,ç„¶ådBCycleè®¡æ•°ä¹Ÿä¸º0,ä¹Ÿèƒ½è¢«é¡ºåˆ©é‡Šæ”¾ åœ¨ä¸Šé¢çš„å¾ªç¯å¼•ç”¨ä»£ç ä¸­,å½“popæ§åˆ¶å™¨å,selfè¢«dBCycleå±æ€§æŒæœ‰,æ‰€ä»¥ä¸èƒ½è¢«å›æ”¶,dBCycleæŒ‡å‘çš„Blockçš„å†…å­˜åœ°å€,åœ¨æ‰§è¡Œå®ŒBlockå,å› ä¸ºå®ƒçš„å¼•ç”¨è®¡æ•°è¿˜æ˜¯è‡³å°‘ä¸º1(selfæŒæœ‰),æ‰€ä»¥ä¹Ÿä¸ä¼šè¢«é‡Šæ”¾,æœ‰ç‚¹ç±»ä¼¼æ­»é”çš„æ¦‚å¿µ,åŒæ–¹äº’ç›¸ä¾èµ–å¯¹è±¡ã€‚deallocæ–¹æ³•ä¸ä¼šè¢«è°ƒç”¨ã€‚ çŸ¥é“åŸç†ä¹‹å,å…³æ³¨ä¸€ä¸‹AFNetworkingä¸­çš„successå›è°ƒBlock è¿›å…¥ 1234- (nullable NSURLSessionDataTask *)GET:(NSString *)URLString parameters:(nullable id)parameters success:(nullable void (^)(NSURLSessionDataTask *task, id _Nullable responseObject))success failure:(nullable void (^)(NSURLSessionDataTask * _Nullable task, NSError *error))failure DEPRECATED_ATTRIBUTE; å†è¿›å…¥ 12345- (NSURLSessionDataTask *)GET:(NSString *)URLString parameters:(id)parameters progress:(void (^)(NSProgress * _Nonnull))downloadProgress success:(void (^)(NSURLSessionDataTask * _Nonnull, id _Nullable))success failure:(void (^)(NSURLSessionDataTask * _Nullable, NSError * _Nonnull))failure 1234567- (NSURLSessionDataTask *)dataTaskWithHTTPMethod:(NSString *)method URLString:(NSString *)URLString parameters:(id)parameters uploadProgress:(nullable void (^)(NSProgress *uploadProgress)) uploadProgress downloadProgress:(nullable void (^)(NSProgress *downloadProgress)) downloadProgress success:(void (^)(NSURLSessionDataTask *, id))success failure:(void (^)(NSURLSessionDataTask *, NSError *))failure 1234567891011121314dataTask = [self dataTaskWithRequest:request uploadProgress:uploadProgress downloadProgress:downloadProgress completionHandler:^(NSURLResponse * __unused response, id responseObject, NSError *error) { if (error) { if (failure) { failure(dataTask, error); } } else { if (success) { success(dataTask, responseObject); } } }]; successå›è°ƒçš„Blockä½œå‚æ•°ä¼ é€’åˆ°completionHanderä¸­ 123456789101112131415- (NSURLSessionDataTask *)dataTaskWithRequest:(NSURLRequest *)request uploadProgress:(nullable void (^)(NSProgress *uploadProgress)) uploadProgressBlock downloadProgress:(nullable void (^)(NSProgress *downloadProgress)) downloadProgressBlock completionHandler:(nullable void (^)(NSURLResponse *response, id _Nullable responseObject, NSError * _Nullable error))completionHandler { __block NSURLSessionDataTask *dataTask = nil; url_session_manager_create_task_safely(^{ dataTask = [self.session dataTaskWithRequest:request]; }); // æ·»åŠ ä»£ç†å¯¹è±¡ [self addDelegateForDataTask:dataTask uploadProgress:uploadProgressBlock downloadProgress:downloadProgressBlock completionHandler:completionHandler]; return dataTask;} ä¼ é€’åˆ° 123456789- (void)addDelegateForDataTask:(NSURLSessionDataTask *)dataTask uploadProgress:(nullable void (^)(NSProgress *uploadProgress)) uploadProgressBlock downloadProgress:(nullable void (^)(NSProgress *downloadProgress)) downloadProgressBlock completionHandler:(void (^)(NSURLResponse *response, id responseObject, NSError *error))completionHandler{ AFURLSessionManagerTaskDelegate *delegate = [[AFURLSessionManagerTaskDelegate alloc] init]; delegate.manager = self; delegate.completionHandler = completionHandler; ... delegate.completionHandlerè¿™blockæŒæœ‰äº†æˆ‘ä»¬ä¼ é€’çš„successå›è°ƒçš„Block delegateè¢«self(AFHTTPSessionManager)å¯¹è±¡çš„mutableTaskDelegatesKeyedByTaskIdentifierå±æ€§æŒæœ‰ å¤§è‡´ç†è§£å¦‚ä¸‹ AFHTTPSessionManager_Obj.mutableTaskDelegatesKeyedByTaskIdentifier.delegate.completionHandler = ^ { succcess()} è‹¥ä½ åœ¨success()ä¸­ä½¿ç”¨äº†VCçš„self,å› ä¸º 12345678910111213141516171819202122232425262728+ (instancetype)manager { return [[[self class] alloc] initWithBaseURL:nil];}- (instancetype)initWithBaseURL:(NSURL *)url { return [self initWithBaseURL:url sessionConfiguration:nil];}- (instancetype)initWithBaseURL:(NSURL *)url sessionConfiguration:(NSURLSessionConfiguration *)configuration{ self = [super initWithSessionConfiguration:configuration]; if (!self) { return nil; } // Ensure terminal slash for baseURL path, so that NSURL +URLWithString:relativeToURL: works as expected if ([[url path] length] &gt; 0 &amp;&amp; ![[url absoluteString] hasSuffix:@\"/\"]) { url = [url URLByAppendingPathComponent:@\"\"]; } self.baseURL = url; self.requestSerializer = [AFHTTPRequestSerializer serializer]; self.responseSerializer = [AFJSONResponseSerializer serializer]; return self;} AFHTTPSessionManager_Objç­‰ä»·äºå±€éƒ¨å˜é‡,å½“æ–¹æ³•æ‰§è¡Œå®Œå,å˜é‡ä¼šè¢«é‡Šæ”¾,ç´§æ¥ç€Blockæ‰§è¡Œå®Œå,ä¼šè¢«å›æ”¶,å¯¹VCçš„selfæŒæœ‰ä¼šè¢«é‡Šæ”¾,å½“popå,selfå¯¹è±¡ä¹Ÿä¼šè¢«é‡Šæ”¾ã€‚ å‚è€ƒ Blocks Programming Topics Effective Objective C 2.0 http://blog.parse.com/learn/engineering/objective-c-blocks-quiz/ è°ˆObjective-C blockçš„å®ç° JaviSoto/iOS10-Runtime-Headers clang-doc","link":"/2017/03/03/iOSer-Understand-the-block/"},{"title":"æŸ¥çœ‹.ipaæ–‡ä»¶çš„Info.plist","text":"åœºæ™¯ å½“é€šè¿‡.ipaæ–‡ä»¶çš„Info.plistæ–‡ä»¶å»è·å¾—åº”ç”¨çš„é…ç½®ä¿¡æ¯æ—¶,è‹¥é€šè¿‡è§†å›¾æ–¹å¼å»æ‰¾åˆ°Info.plistæ–‡ä»¶,æ„Ÿè§‰ç•¥æ˜¾éº»çƒ¦,å› æ­¤å†³å®šä½¿ç”¨shellè„šæœ¬æ¥è§£å†³è¯¥é—®é¢˜ æ–¹æ¡ˆlook_info.sh123456789101112#!/bin/shtimestamp=$(date +%s)dir=`basename ${1} .ipa`_${timestamp}mkdir ./${dir}cp ${1} ./${dir}/${dir}.zipunzip -d ./${dir}/ ./${dir}/${dir}.zip &gt; /dev/null 2&gt;&amp;1cd ./${dir}/Payload/*.app/plutil -convert xml1 Info.plistcat Info.plist | less ç”¨æ³•1$ ./look_info.sh ./app_name.ipa æ•ˆæœå›¾ ä»£ç  å‚è€ƒ Linux Shell è„šæœ¬ä¸­å­—ç¬¦ä¸²çš„è¿æ¥æ–¹æ³• gzipå’Œunzip Linuxå‘½ä»¤-å»æ‰æ–‡ä»¶åçš„ç›®å½•å’Œåç¼€","link":"/2016/11/30/iOSer-View-the-Info.plist-of-the-.ipa-file/"},{"title":"WKWebView & UIWebView è¿›åº¦æ¡åŠ¨ç”»","text":"å¯¼è¯­ æœ¬æ–‡ç›®çš„æ˜¯å®ç°ä¸€ä¸ªç½‘ç»œè¯·æ±‚è¿›åº¦æ¡çš„åŠ¨ç”»æ•ˆæœï¼Œä¸»è¦ç»“æ„åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ† JAProgressWKWebView : ä½¿ç”¨ WKWebView çš„åœºæ™¯ JAProgressUIWebView : ä½¿ç”¨ UIWebView çš„åœºæ™¯ JAProgressView : ä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨ NSURLSession çš„åœºæ™¯ ç¯å¢ƒ macOS Sierra 10.12.4Xcode 8.3.2iPhone 6S (10.1.1)iPad Mini 2 (8.4) WKWebView A WKWebView object displays interactive web content, such as for an in-app browser. You can use the WKWebView class to embed web content in your app. To do so, create a WKWebView object, set it as the view, and send it a request to load web content.ImportantStarting in iOS 8.0 and OS X 10.10, use WKWebView to add web content to your app. Do not use UIWebView or WebView. WKWebView æ˜¯ Apple åœ¨ iOS 8 æ—¶ç”¨äºæ›¿ä»£ UIWebView çš„æ§ä»¶ åŸç† WKWebView æ§ä»¶æä¾›äº†å¦‚ä¸‹çš„å±æ€§,ç”¨äºæè¿°å½“å‰é¡µé¢çš„åŠ è½½è¿›åº¦ï¼Œé‡‡ç”¨ KVO çš„æ–¹å¼ï¼Œè·å¾—è¿›åº¦å€¼å¹¶è¿›è¡Œç›¸åº”çš„æ“ä½œã€‚ 1234567891011 WKWebView.h /*! @abstract An estimate of what fraction of the current navigation has been completed. @discussion This value ranges from 0.0 to 1.0 based on the total number of bytes expected to be received, including the main document and all of its potential subresources. After a navigation completes, the value remains at 1.0 until a new navigation starts, at which point it is reset to 0.0. @link WKWebView @/link is key-value observing (KVO) compliant for this property. */@property (nonatomic, readonly) double estimatedProgress; å®è·µ æ·»åŠ è§‚å¯Ÿè€… 1234567- (instancetype)initWithFrame:(CGRect)frame configuration:(WKWebViewConfiguration *)configuration { if (self = [super initWithFrame:frame configuration:configuration]) { [self setup]; [self addObserver:self forKeyPath:JAkEstimatedProgress options:NSKeyValueObservingOptionNew | NSKeyValueObservingOptionOld context:nil]; } return self;} åˆ·æ–°è¿›åº¦ 12345- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change context:(void *)context { double newKey = [[change objectForKey:NSKeyValueChangeNewKey] doubleValue]; [self.progressBarlayer flush:newKey];} ç§»é™¤è§‚å¯Ÿè€… 1234567- (void)dealloc { @try { [self removeObserver:self forKeyPath:JAkEstimatedProgress]; } @catch (NSException *exception) { // NSLog(@\"%@\",exception); }} ä½¿ç”¨ 123456789101112131415161718192021222324252627282930313233343536373839404142434445#import \"JAWKViewController.h\"#import \"JAProgressView.h\"@interface JAWKViewController () &lt;WKNavigationDelegate&gt;@property (nonatomic,strong) JAProgressWKWebView *webView;@end@implementation JAWKViewController- (void)viewDidLoad { [super viewDidLoad]; self.view.backgroundColor = [UIColor colorWithWhite:0.92 alpha:1.0]; self.automaticallyAdjustsScrollViewInsets = false; WKWebViewConfiguration *theConfiguration = [[WKWebViewConfiguration alloc] init]; JAProgressWKWebView *webView = [[JAProgressWKWebView alloc] initWithFrame:CGRectMake(0, 64, [UIScreen mainScreen].bounds.size.width, [UIScreen mainScreen].bounds.size.height - 64) configuration:theConfiguration]; webView.backgroundColor = [UIColor groupTableViewBackgroundColor]; webView.opaque = false; webView.navigationDelegate = self; [self.view addSubview:_webView = webView]; // [self.navigationController.navigationBar addSubview:webView.progressView];}- (void)viewWillAppear:(BOOL)animated { [super viewWillAppear:animated]; NSURL *nsurl=[NSURL URLWithString:self.urlString]; NSURLRequest *nsrequest=[NSURLRequest requestWithURL:nsurl]; [_webView loadRequest:nsrequest];}- (void)webView:(WKWebView *)webView didFinishNavigation:(WKNavigation *)navigation { NSLog(@\"åŠ è½½å®Œæˆ\");}- (void)webView:(WKWebView *)webView didFailNavigation:(WKNavigation *)navigation withError:(NSError *)error { NSLog(@\"åŠ è½½å¤±è´¥\"); [_webView finish];}- (void)didReceiveMemoryWarning { [super didReceiveMemoryWarning];}@end UIWebView You can use the UIWebView class to embed web content in your app. To do so, create a UIWebView object, attach it to a window, and send it a request to load web content. You can also use this class to move back and forward in the history of webpages, and you can even set some web content properties programmatically.NoteIn apps that run in iOS 8 and later, use the WKWebView class instead of using UIWebView. Additionally, consider setting the WKPreferences property javaScriptEnabled to NO if you render files that are not supposed to run JavaScript. åŸç† å…ˆå‰å¼€ä¸€ä¸‹è¯é¢˜ï¼Œçœ‹çœ‹é€ å¥½çš„è½®å­æ˜¯å¦‚ä½•å®ç°æ£€æµ‹ç½‘ç»œè¿›åº¦çš„ã€‚ä¸‹é¢ä»¥ AFNetworking ä¸ºä¾‹è¿›è¡Œè¯´æ˜ åœ¨ AFN ä¸­æœ‰ä¸€ä¸ª UIWebView+AFNetworking.h æ–‡ä»¶ï¼Œæ˜¯ä¸º UIWebView æ·»åŠ çš„åˆ†ç±»ï¼Œé‡Œé¢æœ‰ 1234- (void)loadRequest:(NSURLRequest *)request progress:(NSProgress * _Nullable __autoreleasing * _Nullable)progress success:(nullable NSString * (^)(NSHTTPURLResponse *response, NSString *HTML))success failure:(nullable void (^)(NSError *error))failure; æœ€ç»ˆè°ƒç”¨çš„æ˜¯è°ƒç”¨äº†ä¸‹é¢çš„æ–¹æ³• 123456- (void)loadRequest:(NSURLRequest *)request MIMEType:(nullable NSString *)MIMEType textEncodingName:(nullable NSString *)textEncodingName progress:(NSProgress * _Nullable __autoreleasing * _Nullable)progress success:(nullable NSData * (^)(NSHTTPURLResponse *response, NSData *data))success failure:(nullable void (^)(NSError *error))failure; å…³æ³¨ progress å‚æ•°ï¼Œè¦æ±‚ä¼ é€’çš„æ˜¯ä¸€ä¸ª progress å¯¹è±¡çš„åœ°å€ 1234567NSURLSessionDataTask *dataTask;...self.af_URLSessionTask = dataTask;if (progress != nil) { *progress = [self.sessionManager downloadProgressForTask:dataTask];}[self.af_URLSessionTask resume]; é¡¾åæ€ä¹‰ progress ä¼šæ¥æ”¶ downloadProgressForTask: æ–¹æ³•çš„è¿”å›å€¼ï¼Œå³æœ¬æ¬¡è¯·æ±‚çš„è¿›åº¦ è¿›åˆ° downloadProgressForTask: æ–¹æ³•ä¸­ 123- (NSProgress *)downloadProgressForTask:(NSURLSessionTask *)task { return [[self delegateForTask:task] downloadProgress];} æŸ¥çœ‹ downloadProgress å±æ€§åœ¨å“ªä¸ªç±»ä¸­ 123@interface AFURLSessionManagerTaskDelegate : NSObject &lt;NSURLSessionTaskDelegate, NSURLSessionDataDelegate, NSURLSessionDownloadDelegate&gt;...@property (nonatomic, strong) NSProgress *downloadProgress; åœ¨æ–‡ä»¶ä¸­ä»¥ downloadProgress è¿›è¡Œæœç´¢ä¼šå‘ç° 12345678910111213141516171819202122#pragma mark - NSProgress Tracking- (void)setupProgressForTask:(NSURLSessionTask *)task { __weak __typeof__(task) weakTask = task;... [task addObserver:self forKeyPath:NSStringFromSelector(@selector(countOfBytesReceived)) options:NSKeyValueObservingOptionNew context:NULL]; [task addObserver:self forKeyPath:NSStringFromSelector(@selector(countOfBytesExpectedToReceive)) options:NSKeyValueObservingOptionNew context:NULL];... [self.downloadProgress addObserver:self forKeyPath:NSStringFromSelector(@selector(fractionCompleted)) options:NSKeyValueObservingOptionNew context:NULL];... æ‰¾åˆ°å“åº”çš„æ–¹æ³• 12345678910111213- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSString *,id&gt; *)change context:(void *)context { if ([object isKindOfClass:[NSURLSessionTask class]] || [object isKindOfClass:[NSURLSessionDownloadTask class]]) { if ([keyPath isEqualToString:NSStringFromSelector(@selector(countOfBytesReceived))]) { self.downloadProgress.completedUnitCount = [change[NSKeyValueChangeNewKey] longLongValue]; } else if ([keyPath isEqualToString:NSStringFromSelector(@selector(countOfBytesExpectedToReceive))]) { self.downloadProgress.totalUnitCount = [change[NSKeyValueChangeNewKey] longLongValue]; } else if ([keyPath isEqualToString:NSStringFromSelector(@selector(countOfBytesSent))]) { self.uploadProgress.completedUnitCount = [change[NSKeyValueChangeNewKey] longLongValue]; } else if ([keyPath isEqualToString:NSStringFromSelector(@selector(countOfBytesExpectedToSend))]) { self.uploadProgress.totalUnitCount = [change[NSKeyValueChangeNewKey] longLongValue]; } } ... è¿›åº¦çš„è®¡ç®—æ˜¯æ ¹æ® NSURLSession çš„ä¸¤ä¸ªåªè¯»çš„å±æ€§ countOfBytesReceived &amp; countOfBytesExpectedToReceive ï¼Œå‰è€…æ˜¯å·²æ¥æ”¶åˆ°çš„æ•°æ®é•¿åº¦ï¼Œåè€…æ˜¯æœŸæœ›æ¥æ”¶åˆ°çš„æ€»é•¿åº¦ï¼Œæ¥è‡ªäº Http å¤´ä¸­çš„ Content-Length å­—æ®µï¼Œé€šè¿‡æ¥æ”¶è¿™ä¸¤ä¸ªå€¼çš„å˜åŒ–å¯¹åº”å»ä¿®æ”¹ NSProgress ä¸­çš„ completedUnitCount &amp; totalUnitCount è¿™ä¸¤ä¸ªå€¼ 123456/* The size of the job whose progress is being reported, and how much of it has been completed so far, respectively. For an NSProgress with a kind of NSProgressKindFile, the unit of these properties is bytes while the NSProgressFileTotalCountKey and NSProgressFileCompletedCountKey keys in the userInfo dictionary are used for the overall count of files. For any other kind of NSProgress, the unit of measurement you use does not matter as long as you are consistent. The values may be reported to the user in the localizedDescription and localizedAdditionalDescription. If the receiver NSProgress object is a \"leaf progress\" (no children), then the fractionCompleted is generally completedUnitCount / totalUnitCount. If the receiver NSProgress has children, the fractionCompleted will reflect progress made in child objects in addition to its own completedUnitCount. As children finish, the completedUnitCount of the parent will be updated.*/@property int64_t totalUnitCount;@property int64_t completedUnitCount; fractionCompleted å±æ€§æ˜¯æ ¹æ® completedUnitCount / totalUnitCount å¾—åˆ°çš„ã€‚ å› æ­¤å¾ˆè‡ªç„¶çš„ä¸€ç§æ€è·¯æ˜¯å»ç›‘å¬ä¼ é€’çš„ progress å‚æ•°çš„ fractionCompleted å†æ­¤ä¹‹å‰å…ˆè®¾æ–­ç‚¹è¯æ˜ä¸‹ç¡®å®èµ°äº† setupProgressForTask: åŒæ—¶å› ä¸º AFURLSessionManagerTaskDelegate å¹¶æ²¡æœ‰æš´éœ²ç»™å¤–éƒ¨ï¼Œä¸å»ä¿®æ”¹æ¡†æ¶æ¯”è¾ƒå¥½ KVO æ˜¯ä¸€å¯¹å¤šçš„ï¼Œä¹Ÿç®—æ¯”è¾ƒåˆé€‚ã€‚ å¯æ·»åŠ ç±»ä¼¼å¦‚ä¸‹çš„ä»£ç å¯¹ progress å‚æ•°çš„ fractionCompleted å±æ€§è¿›è¡Œè§‚å¯Ÿ 123456789101112131415161718- (void)viewWillAppear:(BOOL)animated { [super viewWillAppear:animated]; NSURL *nsurl=[NSURL URLWithString:self.urlString]; NSURLRequest *nsrequest=[NSURLRequest requestWithURL:nsurl]; NSProgress *progress = [[NSProgress alloc] init]; [_webView loadRequest:nsrequest progress:&amp;progress success:^NSString * _Nonnull(NSHTTPURLResponse * _Nonnull response, NSString * _Nonnull HTML) { return @\"\"; } failure:^(NSError * _Nonnull error) { }]; [progress addObserver:_webView forKeyPath:@\"fractionCompleted\" options:NSKeyValueObservingOptionNew context:NULL];}#pragma mark - UIWebViewDelegate- (void)webViewDidFinishLoad:(UIWebView *)webView { NSLog(@\"åŠ è½½å®Œæˆ\");} ä½†æ˜¯ä¼šå‘ç° _webView å¯¹è±¡ä¸­çš„æ–¹æ³• 123456789- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change context:(void *)context { dispatch_async(dispatch_get_main_queue(), ^{ double newKey = [[change objectForKey:NSKeyValueChangeNewKey] doubleValue]; [self.progressBarlayer flush:newKey]; if (1 - newKey &lt; 0.01) { [self finish]; } });} å¹¶æ²¡æœ‰è¢«æ‰§è¡Œï¼Œè·Ÿè¸ª AFNetowrking progress çš„ fractionCompleted ä¸€ç›´éƒ½ä¸º 0 å› ä¸º countOfBytesExpectedToReceive çš„æ€»é•¿åº¦æ˜¯ -1 (0xffffffffffffffff) è¿™ä¸€ç‚¹å¯ä»¥åœ¨ issues - Progress and KVO never called å¾—åˆ°ä½è¯ï¼Œä¸»è¦æ˜¯å› ä¸ºè¯·æ±‚å¤´çš„ Content-Length å­—æ®µæœªè®¾ç½®ã€‚ è®¿é—® https://www.baidu.com 123456789101112131415161718192021220x0000000000000b6d2925(lldb) po dataTask.response&lt;NSHTTPURLResponse: 0x174030160&gt; { URL: https://www.baidu.com/ } { status code: 200, headers { Connection = \"keep-alive\"; \"Content-Encoding\" = gzip; \"Content-Type\" = \"text/html\"; Date = \"Sat, 13 May 2017 09:14:00 GMT\"; P3p = \"CP=\\\" OTI DSP COR IVA OUR IND COM \\\"\"; Server = \"bfe/1.0.8.18\"; \"Set-Cookie\" = \"BAIDUID=623A610A25264EC09CC77FECD44A7CE4:FG=1; max-age=31536000; expires=Sun, 13-May-18 09:14:00 GMT; domain=.baidu.com; path=/; version=1, H_WISE_SIDS=102431; path=/; domain=.baidu.com, BDSVRTM=9; path=/, __bsi=13135479753770821857_00_33_N_N_11_0303_C02F_N_N_Y_0; expires=Sat, 13-May-17 09:14:05 GMT; domain=www.baidu.com; path=/\"; Traceid = 149466684009534243944441198276626132688; \"Transfer-Encoding\" = Identity; Vary = \"Accept-Encoding\";} }(lldb) po dataTask.countOfBytesExpectedToReceive2925(lldb) è®¿é—® https://www.bing.com 123456789101112131415161718192021220xffffffffffffffff-1(lldb) po dataTask.response&lt;NSHTTPURLResponse: 0x17022c6c0&gt; { URL: https://www.bing.com/ } { status code: 200, headers { \"Cache-Control\" = \"private, max-age=0\"; \"Content-Encoding\" = gzip; \"Content-Length\" = 32317; \"Content-Type\" = \"text/html; charset=utf-8\"; Date = \"Sat, 13 May 2017 09:16:11 GMT\"; P3P = \"CP=\\\"NON UNI COM NAV STA LOC CURa DEVa PSAa PSDa OUR IND\\\"\"; Server = \"Microsoft-IIS/10.0\"; \"Set-Cookie\" = \"_SS=SID=3C3C051FE4516B5A18710F9EE5F06A6F; domain=.bing.com; path=/, _EDGE_S=SID=3C3C051FE4516B5A18710F9EE5F06A6F; path=/; httponly; domain=bing.com\"; Vary = \"Accept-Encoding\"; \"X-MSEdge-Ref\" = \"Ref A: 0505C24953B941CA96CF74FAE726B298 Ref B: BJ1EDGE0322 Ref C: Sat May 13 02:16:11 2017 PST\";} }(lldb) po dataTask.countOfBytesExpectedToReceive-1(lldb) è®¿é—® https://www.google.com 123456789101112131415161718192021220xffffffffffffffff-1(lldb) po dataTask.response&lt;NSHTTPURLResponse: 0x170033180&gt; { URL: https://www.google.com/ } { status code: 200, headers { \"Alt-Svc\" = \"quic=\\\":443\\\"; ma=2592000; v=\\\"37,36,35\\\"\"; \"Cache-Control\" = private; \"Content-Encoding\" = gzip; \"Content-Type\" = \"text/html; charset=Big5\"; Date = \"Sat, 13 May 2017 09:24:46 GMT\"; Expires = \"Sat, 13 May 2017 09:24:46 GMT\"; P3P = \"CP=\\\"This is not a P3P policy! See https://www.google.com/support/accounts/answer/151657?hl=en for more info.\\\"\"; Server = gws; \"Set-Cookie\" = \"NID=103=adCbLI6_cKax8zD5WTTC6Xq-Vviron4fGJDZeVf1OEiQhvSD9L3Q53n8HrmZS8--BUJIIAbR_cb5UwweP0nvyOKD0J4tbOLf6tr-p_Vva5mnAiYyWKKzsOhqtc9SjBhW; expires=Sun, 12-Nov-2017 09:24:46 GMT; path=/; domain=.google.com; HttpOnly\"; \"Transfer-Encoding\" = Identity; \"X-Frame-Options\" = SAMEORIGIN; \"X-XSS-Protection\" = \"1; mode=block\";} }(lldb) po dataTask.countOfBytesExpectedToReceive-1 ç¬¬äºŒæ¬¡ 1234567891011121314151617181920212223242526270x0000000000002ae7- Hook 1 (expr -- @import UIKit)- Hook 2 ( target stop-hook disable)10983(lldb) po dataTask.response&lt;NSHTTPURLResponse: 0x17003cd60&gt; { URL: https://www.google.com/ } { status code: 200, headers { \"Alt-Svc\" = \"quic=\\\":443\\\"; ma=2592000; v=\\\"37,36,35\\\"\"; \"Cache-Control\" = private; \"Content-Encoding\" = gzip; \"Content-Type\" = \"text/html; charset=Big5\"; Date = \"Sat, 13 May 2017 10:09:01 GMT\"; Expires = \"Sat, 13 May 2017 10:09:01 GMT\"; P3P = \"CP=\\\"This is not a P3P policy! See https://www.google.com/support/accounts/answer/151657?hl=en for more info.\\\"\"; Server = gws; \"Set-Cookie\" = \"NID=103=f7RScaRo91vaPuGoStsjYJrDLUSANq6fwzBypLCvMeUasdsx443kwCfnzioj167ke0Buh6c6qVsA_xiT8olCjCvOtOd4P9drblpB5PkDMGiWg0J6qJnBuhoeFQIREDVT; expires=Sun, 12-Nov-2017 10:09:01 GMT; path=/; domain=.google.com; HttpOnly\"; \"Transfer-Encoding\" = Identity; \"X-Frame-Options\" = SAMEORIGIN; \"X-XSS-Protection\" = \"1; mode=block\";} }(lldb) po dataTask.countOfBytesExpectedToReceive10983 åç§° Content-Length countOfBytesExpectedToReceive https://www.baidu.com â âœ”ï¸ https://www.bing.com âœ”ï¸ â https://www.google.com â â / âœ”ï¸ æœç´¢ Content-Length å­—æ®µçš„ç›¸å…³å†…å®¹ rfc2616.html#header.content-length rfc2616.html#message.length åœ¨ HTTP 1.1 ä¸­åº”ç”¨å¯ä»¥é€šè¿‡ Content-Lenght å­—æ®µç¡®å®šæ¶ˆæ¯çš„é•¿åº¦ï¼Œ Content-Length å¤±æ•ˆçš„å‡ ç§æƒ…å†µ çŠ¶æ€ç ä¸º 1xx,204 å’Œ 304 è®¾ç½®äº† Transfer-Encoding ä¸”è¯¥å€¼ä¸ç­‰äº identity åŒæ—¶å­˜åœ¨ Transfer-Encoding å’Œ Content-Length å“åº”çš„æ•°æ®ç±»å‹ä¸º multipart/byteranges ä¸”æ²¡æœ‰æŒ‡å®š transfer-length æœåŠ¡å™¨å…³é—­è¿æ¥ åœ¨ è¿™é‡Œ 1ã€åœ¨Http 1.0åŠä¹‹å‰ç‰ˆæœ¬ä¸­ï¼Œcontent-lengthå­—æ®µå¯æœ‰å¯æ— ã€‚2ã€åœ¨http1.1åŠä¹‹åç‰ˆæœ¬ã€‚å¦‚æœæ˜¯keep aliveï¼Œåˆ™content-lengthå’Œchunkå¿…ç„¶æ˜¯äºŒé€‰ä¸€ã€‚è‹¥æ˜¯ékeep aliveï¼Œåˆ™å’Œhttp1.0ä¸€æ ·ã€‚content-lengthå¯æœ‰å¯æ— ã€‚ Transfer-Encoding ç”¨æ¥æŒ‡å®šæ•°æ®ä¼ è¾“çš„æ ¼å¼ï¼Œæœ‰å¦‚ä¸‹çš„æ ¼å¼ Transfer-Encoding: chunkedTransfer-Encoding: compressTransfer-Encoding: deflateTransfer-Encoding: gzipTransfer-Encoding: identity chunked çš„æ ¼å¼è¯¦æƒ…å¯ä»¥å‚è€ƒ Wiki-åˆ†å—ä¼ è¾“ç¼–ç  å¦‚æœä¸€ä¸ªHTTPæ¶ˆæ¯ï¼ˆè¯·æ±‚æ¶ˆæ¯æˆ–åº”ç­”æ¶ˆæ¯ï¼‰çš„Transfer-Encodingæ¶ˆæ¯å¤´çš„å€¼ä¸ºchunkedï¼Œé‚£ä¹ˆï¼Œæ¶ˆæ¯ä½“ç”±æ•°é‡æœªå®šçš„å—ç»„æˆï¼Œå¹¶ä»¥æœ€åä¸€ä¸ªå¤§å°ä¸º0çš„å—ä¸ºç»“æŸã€‚æ¯ä¸€ä¸ªéç©ºçš„å—éƒ½ä»¥è¯¥å—åŒ…å«æ•°æ®çš„å­—èŠ‚æ•°ï¼ˆå­—èŠ‚æ•°ä»¥åå…­è¿›åˆ¶è¡¨ç¤ºï¼‰å¼€å§‹ï¼Œè·Ÿéšä¸€ä¸ªCRLF ï¼ˆå›è½¦åŠæ¢è¡Œï¼‰ï¼Œç„¶åæ˜¯æ•°æ®æœ¬èº«ï¼Œæœ€åå—CRLFç»“æŸã€‚åœ¨ä¸€äº›å®ç°ä¸­ï¼Œå—å¤§å°å’ŒCRLFä¹‹é—´å¡«å……æœ‰ç™½ç©ºæ ¼ï¼ˆ0x20ï¼‰ã€‚æœ€åä¸€å—æ˜¯å•è¡Œï¼Œç”±å—å¤§å°ï¼ˆ0ï¼‰ï¼Œä¸€äº›å¯é€‰çš„å¡«å……ç™½ç©ºæ ¼ï¼Œä»¥åŠCRLFã€‚æœ€åä¸€å—ä¸å†åŒ…å«ä»»ä½•æ•°æ®ï¼Œä½†æ˜¯å¯ä»¥å‘é€å¯é€‰çš„å°¾éƒ¨ï¼ŒåŒ…æ‹¬æ¶ˆæ¯å¤´å­—æ®µã€‚æ¶ˆæ¯æœ€åä»¥CRLFç»“å°¾ã€‚ ä½†æ˜¯åˆ°è¿™é‡Œä¾ç„¶æ²¡å®Œå…¨è§£å†³æˆ‘çš„å›°æƒ‘ï¼Œåœ¨ iOS ä¸­å¦‚ä½•æ¯”è¾ƒè·å¾—ç½‘ç»œè¯·æ±‚çš„æ€»é•¿åº¦ï¼Ÿ å¯»æ‰¾å¤´æ–‡ä»¶åå‘ç°ï¼Œåœ¨ NSURLResponse å¯¹è±¡ä¸­ 1234567891011121314/*! @method expectedContentLength @abstract Returns the expected content length of the receiver. @discussion Some protocol implementations report a content length as part of delivering load metadata, but not all protocols guarantee the amount of data that will be delivered in actuality. Hence, this method returns an expected amount. Clients should use this value as an advisory, and should be prepared to deal with either more or less data. @result The expected content length of the receiver, or -1 if there is no expectation that can be arrived at regarding expected content length.*/@property (readonly) long long expectedContentLength; æˆ‘çš„æ–¹æ¡ˆ ç»è¿‡æµ‹è¯•,åœ¨ NSURLSessionDataDelegate çš„ä»£ç†æ–¹æ³•URLSession:dataTask:didReceiveData: , data å³ä¸ºæ¯æ¬¡è·å–çš„æ•°æ®,è€Œ dataTask ä¸­çš„ response å±æ€§çš„ expectedContentLength æœ‰æ—¶ä¼šåœ¨æ•°æ®å¹¶æ²¡æœ‰å®Œå…¨æ¥æ”¶åˆ°æ—¶å°±å¯ä»¥è·å¾—é•¿åº¦,å› æ­¤å¯¹ UIWebView ç”¨è¿™ä¸ªå€¼æ¥è·å–ç½‘ç»œè¯·æ±‚è¿›åº¦,é‡‡ç”¨çš„ä¸»è¦æ€è·¯æ˜¯ åœ¨æœªè·å¾— expectedContentLength é•¿åº¦æ—¶ï¼Œç”¨æ•°ç»„ä¿å­˜æ¯æ¬¡ data çš„å€¼ è·å–åˆ° expectedContentLength ï¼Œ æ ¹æ®æ•°ç»„ä¸­çš„å€¼ç®—å‡ºè¿›åº¦ï¼Œåœ¨æœ¬åœ°å®ç°åŠ¨ç”»ã€‚ ç½‘ç»œè¯·æ±‚æš‚æ—¶å†³å®šè¿˜æ˜¯ä¾èµ– AFNetworking , æ·»åŠ äº†ä¸€ä¸ªåˆ†ç±»ï¼Œåœ¨è¿è¡Œæ—¶æ›¿æ¢ URLSession:dataTask:didReceiveData: æ–¹æ³•æ¥å®ç° å®è·µ åˆ†ç±» AFHTTPSessionManager+JACoder.h 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758#import \"AFHTTPSessionManager+JACoder.h\"#import &lt;objc/message.h&gt;NSString *kAFJAReceiveDataNotification = @\"kAFNReceiveDataNotification\";NSString *kAFJAReceiveResponseNotification = @\"kAFJAReceiveResponseNotification\";@implementation AFHTTPSessionManager (JACoder)+ (void)load { Method originalMethod = class_getInstanceMethod(self, @selector(URLSession:dataTask:didReceiveData:)); Method swizzledMethod = class_getInstanceMethod(self, @selector(ja_URLSession:dataTask:didReceiveData:)); BOOL didAddMethod = class_addMethod(self, @selector(URLSession:dataTask:didReceiveData:), method_getImplementation(swizzledMethod), method_getTypeEncoding(swizzledMethod)); if (didAddMethod) { class_replaceMethod(self, @selector(ja_URLSession:dataTask:didReceiveData:), method_getImplementation(originalMethod), method_getTypeEncoding(originalMethod)); } else { method_exchangeImplementations(originalMethod, swizzledMethod); }}- (void)ja_URLSession:(NSURLSession *)session dataTask:(NSURLSessionDataTask *)dataTask didReceiveData:(NSData *)data { [self ja_URLSession:session dataTask:dataTask didReceiveData:data]; // ... if (dataTask.response.expectedContentLength != -1 &amp;&amp; self.isLock == false) {// NSLog(@\"data = %ld\",data.length);// NSLog(@\"dataTask = %lld\",dataTask.response.expectedContentLength); [[NSNotificationCenter defaultCenter] postNotificationName:kAFJAReceiveDataNotification object:data]; [[NSNotificationCenter defaultCenter] postNotificationName:kAFJAReceiveResponseNotification object:dataTask]; self.lock = true; }else { // NSLog(@\"data = %ld\",data.length); [[NSNotificationCenter defaultCenter] postNotificationName:kAFJAReceiveDataNotification object:data]; }}- (BOOL)isLock { return (BOOL)[objc_getAssociatedObject(self, @selector(isLock)) doubleValue];}- (void)setLock:(BOOL)lock { objc_setAssociatedObject(self, @selector(setLock:), @(lock), OBJC_ASSOCIATION_ASSIGN);}@end æ¥æ”¶åˆ°å·²è·å–æ€»é•¿åº¦çš„é€šçŸ¥åçš„ç›¸åº”å¤„ç†,ä¸ºäº†å’Œ WKWebView ç»Ÿä¸€ï¼Œåœ¨ç»§æ‰¿ UIWebView çš„å­ç±»ä¸­æ·»åŠ äº† estimatedProgress å±æ€§ï¼ŒåŒæ ·ç”¨ KVO å»å¤„ç†ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738- (void)receiveWithNotification:(NSNotification *)noti { if ([noti.object isKindOfClass:[NSURLSessionDataTask class]]) { NSURLSessionDataTask *dataTask = (NSURLSessionDataTask *)noti.object; self.expectedContentLength = dataTask.response.expectedContentLength; if (self.estimatedProgress == 0 ) { if (self.records.count == 0) { self.estimatedProgress = 1.0; }else { for (NSData *record in self.records) { self.estimatedProgress += (CGFloat)record.length / self.expectedContentLength; } self.records = [NSArray array]; } }else { for (NSData *record in self.records) { self.estimatedProgress += (CGFloat)record.length / self.expectedContentLength; } } // NSLog(@\"noti dataTask:%f\",self.estimatedProgress); } if ([noti.object isKindOfClass:[NSData class]]) { NSData *data = (NSData *)noti.object; if (self.expectedContentLength != -1 &amp;&amp; self.expectedContentLength != 0) { for (NSData *record in self.records) { self.estimatedProgress += (CGFloat)record.length / self.expectedContentLength; } self.estimatedProgress += (CGFloat)data.length / self.expectedContentLength; // NSLog(@\"noti data:%f\",self.estimatedProgress); self.records = [NSArray array]; }else { NSMutableArray *recordsM = [NSMutableArray arrayWithArray:self.records]; [recordsM addObject:data]; self.records = [recordsM copy]; } }} estimatedProgress å±æ€§å˜åŒ–çš„å¤„ç† 123456789- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change context:(void *)context { dispatch_async(dispatch_get_main_queue(), ^{ double newKey = [[change objectForKey:NSKeyValueChangeNewKey] doubleValue]; [self.progressBarlayer flush:newKey]; if (1 - newKey &lt; 0.01) { [self finish]; } });} UIView å¯¹äºä¸€èˆ¬çš„ App è¯·æ±‚,å¤§å¤šéƒ½æ˜¯è¿”å› JSON æ•°æ®çš„æ¥å£,ä¹Ÿå¯ä»¥åšä¸€ä¸ªè¿›åº¦æ¡çš„æ•ˆæœã€‚ åŸç† ä¸€äº‹ä¸çƒ¦äºŒä¸»ï¼Œä¹Ÿç”¨ AFNetworking åšè¯·æ±‚ã€‚ä¸Šé¢å·²ç»åˆ†æäº† AFNetworking å¦‚ä½•æ£€æµ‹è¯·æ±‚è¿›åº¦çš„, å¤§å¤šæ•°æƒ…å†µä¸‹çš„è¯·æ±‚è¿›åº¦è‚¯å®šæ˜¯æ²¡é—®é¢˜çš„ã€‚ å®è·µ ç”¨ AFNetworking å‘èµ·è¯·æ±‚ï¼Œæ ¹æ®å›è°ƒè¿”å›çš„ NSProgress å€¼å®ç°åˆ·æ–°æ“ä½œã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940#import \"JAUIViewController.h\"#import &lt;AFNetworking.h&gt;#import \"JAProgressView.h\"@interface JAUIViewController ()@property (nonatomic,strong) JAProgressView *progressView;@end@implementation JAUIViewController- (void)viewDidLoad { [super viewDidLoad]; self.view.backgroundColor = [UIColor colorWithWhite:0.92 alpha:1.0]; _progressView = [[JAProgressView alloc] init]; [self.navigationController.navigationBar addSubview:_progressView];}- (void)viewWillAppear:(BOOL)animated { [super viewWillAppear:animated]; [[AFHTTPSessionManager manager] GET:@\"http://api.map.baidu.com/telematics/v3/weather?location=%E5%98%89%E5%85%B4&amp;output=json&amp;ak=5slgyqGDENN7Sy7pw29IUvrZ\" parameters:nil progress:^(NSProgress * _Nonnull downloadProgress) { dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(0.5 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{ [_progressView flush:downloadProgress.fractionCompleted]; }); // or // [[NSNotificationCenter defaultCenter] postNotificationName:JAEstimatedProgressNotification object:downloadProgress]; } success:^(NSURLSessionDataTask * _Nonnull task, id _Nullable responseObject) { } failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) { }];}- (void)didReceiveMemoryWarning { [super didReceiveMemoryWarning];} ç›¸åº”çš„å¤„ç† 1234567891011121314// é€šçŸ¥- (void)receiveWithNotification:(NSNotification *)notifcation { dispatch_async(dispatch_get_main_queue(), ^{ if ([notifcation.object isKindOfClass:[NSProgress class]]) { NSProgress *progress = (NSProgress *)notifcation.object; [self.progressBarlayer flush:progress.fractionCompleted]; } });}// ä¼ å€¼- (void)flush:(CGFloat)progress { [self.progressBarlayer flush:progress];} æ•ˆæœå›¾ DEMO å‚è€ƒ Progress and KVO never called Wiki-åˆ†å—ä¼ è¾“ç¼–ç  MDN - Transfer-Encoding httpåè®®ä¸­content-length ä»¥åŠchunkedç¼–ç åˆ†æ","link":"/2017/05/13/iOSer-WKWebView-UIWebView-progress-monitoring/"},{"title":"Xcode8-æ’ä»¶å¤±æ•ˆ","text":"å‰è¨€ Xcode8 å‡ºäºå®‰å…¨åŸå› ,ç¦æ­¢äº†ç¬¬ä¸‰æ–¹æ’ä»¶,æ”¹ä¸º Xcode Source Editor &lt; Xcode81$ find ~/Library/Application\\ Support/Developer/Shared/Xcode/Plug-ins -name Info.plist -maxdepth 3 | xargs -I{} defaults write {} DVTPlugInCompatibilityUUIDs -array-add $ find ~/Library/Application\\ Support/Developer/Shared/Xcode/Plug-ins -name Info.plist -maxdepth 3 | xargs -I{} defaults write {} DVTPlugInCompatibilityUUIDs -array-add IDEå¸¸ç”¨æ’ä»¶ VVDocument æ–‡æ¡£æ³¨é‡Š , Xcode8 å·²æ”¯æŒ âŒ¥ + âŒ˜ + / MCLog è¾“å‡ºæ—¥å¿—è¿‡æ»¤, Xcode8 å·²æ”¯æŒ ActivatePowerMode æ‰“å­—é…·ç‚«æ•ˆæœ Xcode8ä¸Šä½¿ç”¨ç¬¬ä¸‰æ–¹æ’ä»¶â€œè§£å†³æ–¹æ¡ˆâ€ å‚è€ƒ Xcode 8 wonâ€™t load plug-ins Using and Extending the Xcode Source Editor","link":"/2016/11/20/iOSer-Xcode8-plugin-is-invalid/"},{"title":"iOSè¿œç¨‹æ¨é€æ€»ç»“","text":"å†…å®¹æ¦‚è¦ è¿œç¨‹æ¨é€çš„åŸç†è¿œç¨‹æ¨é€è¯ä¹¦æ ¼å¼åŠå…¶è½¬æ¢(.pem/.p12)è¿œç¨‹æ¨é€è¯ä¹¦çš„åˆ¶ä½œæµç¨‹å®ä¾‹ä¸ç¯å¢ƒ è¿œç¨‹æ¨é€çš„åŸç†å®˜æ–¹æ–‡æ¡£ A remote notification, also called a push notification, arrives from outside the device. It originates on a remote server that you manageâ€”the appâ€™s notification providerâ€”and is pushed to your app on a userâ€™s device via the Apple Push Notification service (APNs). è¿œç¨‹æ¨é€æ˜¯åŸºäºAPNs(è‹¹æœæ¨é€æœåŠ¡) é—®é¢˜â‘  APNsä¸ºä»€ä¹ˆèƒ½è¿œç¨‹æ¨é€?â‘¡ APNsæ€ä¹ˆçŸ¥é“è¦æ¨é€ç»™å“ªä¸ªè®¾å¤‡çš„å“ªä¸ªåº”ç”¨? APNs uses a persistent IP connection for implementing remote notifications. Apple Push Notification service (APNs) propagates remote notifications to devices having apps registered to receive those notifications. Each app on a device establishes an accredited and encrypted IP connection with the service and receives notifications over this persistent connection. With a TLS connection established between the device and APNs, APNs can then provide an app-specific device token to each app that registers for remote notifications. ç­”æ¡ˆâ‘  å­˜åœ¨ä¸€ä¸ªé•¿è¿æ¥â‘¡ è®¾å¤‡ä¸Šçš„æ¯ä¸ªappéƒ½å¯å»ºç«‹ä¸€ä¸ªåŠ å¯†çš„è®¸å¯ipç”¨äºè¿æ¥ä¸æ¥æ”¶è¿œç¨‹æ¨é€(deviceToken) åŸç†å›¾æ›´è¯¦ç»†çš„æ­¥éª¤(æ¥è‡ªäº’è”ç½‘) è®¾å¤‡ä¸Šçš„åº”ç”¨è¿æ¥APNsæœåŠ¡å™¨ APNsæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚ç”ŸæˆdeviceTokenåŠ å¯†åè¿”å›ç»™è®¾å¤‡ è®¾å¤‡ä¸Šåº”ç”¨è·å¾—deviceTokenåä¸ŠæŠ¥ç»™åº”ç”¨æœåŠ¡å™¨ åº”ç”¨æœåŠ¡å™¨è°ƒç”¨APNsçš„APIå¹¶å‘é€ deviceToken(Each notification that your provider sends to APNs must include the device token) APNsæœåŠ¡å™¨æ ¹æ®deviceTokenå°†æ¶ˆæ¯æ¨é€ç»™æŒ‡å®šè®¾å¤‡çš„å…·ä½“åº”ç”¨ Device tokens can change after updating the operating system, and always change when a deviceâ€™s data and settings are eraseddeviceTokenåœ¨æ›´æ–°ç³»ç»Ÿå’Œé‡æ–°å®‰è£…(å…ˆåˆ é™¤)ä¼šè¢«æ›´æ–° è¿œç¨‹æ¨é€è¯ä¹¦æ ¼å¼åŠå…¶è½¬æ¢ ä»ä¸Šå›¾å¯çŸ¥åº”ç”¨æœåŠ¡å™¨ä¸APNsä¼šæœ‰ä¸€ä¸ªTLSè®¤è¯,åœ¨ç”³è¯·è¯ä¹¦æ—¶,æåˆ°äº†ä½¿ç”¨CSRè·å¾—SSLè¯ä¹¦,æˆ‘ä»¬å…ˆæ¥äº†è§£å…¶ä»–ä¸€äº›ç›¸å…³çš„æ¦‚å¿µ SSL/TLSä¼ è¾“å±‚å®‰å…¨åè®®ï¼ˆè‹±è¯­ï¼šTransport Layer Securityï¼Œç¼©å†™ï¼šTLSï¼‰ï¼ŒåŠå…¶å‰èº«å®‰å…¨å¥—æ¥å±‚ï¼ˆSecure Sockets Layerï¼Œç¼©å†™ï¼šSSLï¼‰æ˜¯ä¸€ç§å®‰å…¨åè®®ï¼Œç›®çš„æ˜¯ç‚ºç½‘ç»œé€šä¿¡ï¼Œæä¾›å®‰å…¨åŠæ•°æ®å®Œæ•´æ€§ä¿éšœã€‚ 1.åå•†åŠ å¯†åè®® 1.1 å®¢æˆ·ç«¯ç”Ÿæˆéšæœºæ•°RNcå‘é€client_hello,åŒ…å«å®¢æˆ·ç«¯æ”¯æŒçš„åè®®,æ”¯æŒçš„å‹ç¼©ç®—æ³•ç­‰ 1.2 æœåŠ¡å™¨æ¥æ”¶åˆ°client_hello,å¹¶éšæœºç”Ÿæˆä¸€ä¸ªRNs,å‘é€server_hello,åŒ…å«æœåŠ¡å™¨æ”¯æŒçš„åè®®,æ”¯æŒçš„å‹ç¼©ç®—æ³•ç­‰(å¦‚æœæµè§ˆå™¨ä¸æœåŠ¡å™¨æ”¯æŒçš„ç‰ˆæœ¬ä¸ä¸€è‡´ï¼ŒæœåŠ¡å™¨å…³é—­åŠ å¯†é€šä¿¡) 1.3 å®¢æˆ·ç«¯æ”¶åˆ°RNs,å‡†å¤‡è¿›å…¥è¯ä¹¦äº¤æ¢é˜¶æ®µ 2.è¯ä¹¦äº¤æ¢ 2.1 æœåŠ¡å™¨å‘é€å…¬é’¥,å¹¶è¦æ±‚å®¢æˆ·ç«¯è¿”å›å…¶å…¬é’¥ 2.2 å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„å…¬é’¥,å¹¶æ£€æŸ¥å…¶è¯ä¹¦çš„æœ‰æ•ˆæ€§,é¢å‘è¯ä¹¦çš„æœºæ„æ˜¯å¦åˆæ³•ï¼Œè¯ä¹¦ä¸­åŒ…å«çš„ç½‘ç«™åœ°å€æ˜¯å¦ä¸æ­£åœ¨è®¿é—®çš„åœ°å€ä¸€è‡´ç­‰ 2.3 å®¢æˆ·ç«¯éªŒè¯è¯ä¹¦åˆæ³•åå°†å‘é€è‡ªå·±çš„å…¬é’¥,å¹¶hashå¤„ç†ä»¥å‰çš„æ¶ˆæ¯,æœ€åç”¨ç§é’¥ç­¾ååŠ å¯†å‘é€ç»™æœåŠ¡å™¨ 2.4 æœåŠ¡å™¨ä½¿ç”¨å®¢æˆ·ç«¯çš„å…¬é’¥è§£å¯†å¹¶é‡‡ç”¨ç›¸åŒçš„hashç®—æ³•éªŒè¯ 2.5 å®¢æˆ·ç«¯ç”ŸæˆéšæœºPMS(pre-master-secrect:ä¸€ä¸ªç”¨åœ¨å¯¹ç§°åŠ å¯†å¯†é’¥äº§ç”Ÿä¸­çš„46ä½å…ƒçµ„çš„ä¹±æ•°å­—),å¹¶ç”¨æœåŠ¡å™¨çš„å…¬é’¥åŠ å¯†å‘é€ç»™æœåŠ¡å™¨ 2.6 åŒæ–¹å„è‡ªä½¿ç”¨MS,RNc,RNså»åˆ›å»ºä¸€ä¸ªMSä½œä¸ºä¸»å¯†é’¥ 3.å¯¹ç§°å¯†é’¥çš„æ•°æ®ä¼ è¾“ä¿å¯† 3.1 å®¢æˆ·ç«¯é€šçŸ¥æœåŠ¡å™¨ä½¿ç”¨MSåškeyåŠ å¯† 3.2 æœåŠ¡å™¨é€šçŸ¥å®¢æˆ·ç«¯ä½¿ç”¨MSåškeyåŠ å¯† ç»“æœå¯èƒ½ä½¿ç”¨Diffie-Hellmanäº¤æ¢,æˆ–ç®€åŒ–çš„å…¬é’¥åŠ å¯†,åŒæ–¹å„è‡ªç”¨ç§é’¥è§£å¯†ã€‚æ‰€æœ‰å…¶ä»–å…³é”®æ•°æ®å‡ä½¿ç”¨MSåŠ å¯†Wiki åœ¨äº†è§£SSLçš„è¿‡ç¨‹ä¸­,æˆ‘ä»¬åˆç¢°åˆ°äº†RSA,X509ç­‰æ¦‚å¿µ,ä¸‹é¢ä¾æ¬¡è§£é‡Š RSARSAåŠ å¯†ç®—æ³•æ˜¯ç°åœ¨ä¸–ç•Œä¸Šè¿ç”¨æœ€å¹¿æ³›çš„éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œæ¯”å¦‚å¸¸ç”¨çš„httpsåè®®ã€é“¶è¡Œäº¤æ˜“ç­‰ç­‰ éå¯¹ç§°åŠ å¯†ç®—æ³• éå¯¹ç§°åŠ å¯†ç®—æ³•éœ€è¦ä¸¤ä¸ªå¯†é’¥ï¼šå…¬å¼€å¯†é’¥ï¼ˆpublickeyï¼‰å’Œç§æœ‰å¯†é’¥ï¼ˆprivatekeyï¼‰ã€‚å…¬å¼€å¯†é’¥ä¸ç§æœ‰å¯†é’¥æ˜¯ä¸€å¯¹ï¼Œå¦‚æœç”¨å…¬å¼€å¯†é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œåªæœ‰ç”¨å¯¹åº”çš„ç§æœ‰å¯†é’¥æ‰èƒ½è§£å¯†ï¼›å¦‚æœç”¨ç§æœ‰å¯†é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œé‚£ä¹ˆåªæœ‰ç”¨å¯¹åº”çš„å…¬å¼€å¯†é’¥æ‰èƒ½è§£å¯†ã€‚ ç”¨é€”1:å…¬é’¥åŠ å¯† ç”²æ–¹ç”Ÿæˆä¸€å¯¹å¯†é’¥å¹¶å°†å…¶ä¸­çš„ä¸€æŠŠä½œä¸ºå…¬ç”¨å¯†é’¥å‘å…¶å®ƒæ–¹å…¬å¼€ï¼›å¾—åˆ°è¯¥å…¬ç”¨å¯†é’¥çš„ä¹™æ–¹ä½¿ç”¨è¯¥å¯†é’¥å¯¹æœºå¯†ä¿¡æ¯è¿›è¡ŒåŠ å¯†åå†å‘é€ç»™ç”²æ–¹ï¼›ç”²æ–¹å†ç”¨è‡ªå·±ä¿å­˜çš„å¦ä¸€æŠŠä¸“ç”¨å¯†é’¥å¯¹åŠ å¯†åçš„ä¿¡æ¯è¿›è¡Œè§£å¯†ã€‚ ç”¨é€”2:æ•°å­—ç­¾å å¦ä¸€æ–¹é¢ï¼Œç”²æ–¹å¯ä»¥ä½¿ç”¨ä¹™æ–¹çš„å…¬é’¥å¯¹æœºå¯†ä¿¡æ¯è¿›è¡Œç­¾ååå†å‘é€ç»™ä¹™æ–¹ï¼›ä¹™æ–¹å†ç”¨è‡ªå·±çš„ç§åŒ™å¯¹æ•°æ®è¿›è¡ŒéªŒç­¾ã€‚ X509ä¸€ç§è¯ä¹¦æ ‡å‡†,ä¸»è¦å®šä¹‰äº†è¯ä¹¦ä¸­åº”è¯¥åŒ…å«å“ªäº›å†…å®¹ å‚è€ƒRFC5280 SSLä½¿ç”¨çš„å°±æ˜¯è¿™ç§è¯ä¹¦æ ‡å‡†,è¯¥æ ‡å‡†æœ‰ä¸¤ç§ç¼–ç æ ¼å¼(PEMå’ŒDER) PEMPEM - Privacy Enhanced Mail,æ‰“å¼€çœ‹æ–‡æœ¬æ ¼å¼,ä»¥â€â€”â€“BEGINâ€¦â€å¼€å¤´, â€œâ€”â€“ENDâ€¦â€ç»“å°¾,å†…å®¹æ˜¯BASE64ç¼–ç .æŸ¥çœ‹PEMæ ¼å¼è¯ä¹¦çš„ä¿¡æ¯:openssl x509 -in certificate.pem -text -nooutApacheå’Œ*NIXæœåŠ¡å™¨åå‘äºä½¿ç”¨è¿™ç§ç¼–ç æ ¼å¼. DERDER - Distinguished Encoding Rules,æ‰“å¼€çœ‹æ˜¯äºŒè¿›åˆ¶æ ¼å¼,ä¸å¯è¯».æŸ¥çœ‹DERæ ¼å¼è¯ä¹¦çš„ä¿¡æ¯:openssl x509 -in certificate.der -inform der -text -nooutJavaå’ŒWindowsæœåŠ¡å™¨åå‘äºä½¿ç”¨è¿™ç§ç¼–ç æ ¼å¼. è®©æˆ‘ä»¬é‡æ–°ç†è§£è¯ä¹¦ç”³è¯·çš„è¿‡ç¨‹(æ•°å­—è¯ä¹¦)1.ä»é’¥åŒ™ä¸²ä¸­å¯¼å‡ºCSRæ–‡ä»¶,åŒ…å«å…¬é’¥åŠå…¶ä»–ä¸€äº›ä¿¡æ¯,Appleå¼€å‘è€…ä¸­å¿ƒè¿›è¡Œç­¾åå,ç”Ÿæˆ.ceræ–‡ä»¶,è¿™æ˜¯ä¸€ä¸ªæ•°å­—è¯ä¹¦çš„ç­¾åè¿‡ç¨‹2.åœ¨å¯¼å‡ºCSRæ–‡ä»¶æ—¶,é™¤äº†å…¬é’¥ä¸Šä¼ ç»™Appleå¼€å‘è€…ä¸­å¿ƒ,é’¥åŒ™ä¸²ä¸­è¿˜å­˜åœ¨ç§é’¥,åœ¨åŒå‡»æ—¶,é€šè¿‡ç§é’¥å»åŒ¹é…ç­¾åè¯ä¹¦ä¸­çš„å…¬é’¥,ä¸€ä¸ªæ•°å­—è¯ä¹¦çš„ç­¾åä¸éªŒç­¾å°±å®Œæˆäº† .p12Personal Information Exchange Syntax Standard See RFC 7292. Defines a file format commonly used to store private keys with accompanying public key certificates, protected with a password-based symmetric key. PFX is a predecessor to PKCS #12.This container format can contain multiple embedded objects, such as multiple certificates. Usually protected/encrypted with a password. Usable as a format for the Java key store and to establish client authentication certificates in Mozilla Firefox. Usable by Apache Tomcat. ä»ä¸­å¯ä»¥è·çŸ¥p12æ–‡ä»¶(ä¸ªäººä¿¡æ¯äº¤æ¢æ ‡å‡†),åŒ…å«äº†ç§é’¥å’Œä¸ä¹‹ç›¸å…³çš„å…¬é’¥è¯ä¹¦,æœ‰å¯†ç ä½œä¿æŠ¤ ä»é’¥åŒ™ä¸²ä¸­å°†.p12æ–‡ä»¶å¯¼å‡ºå¹¶ä¸Šä¼ åˆ°æå…‰æœåŠ¡å™¨,å› ä¸ºè¯ä¹¦çš„é¢å‘æœºæ„å°±æ˜¯Apple,åœ¨æ£€æµ‹è¯ä¹¦æ˜¯å¦åˆæ³•å½“ç„¶æ²¡æœ‰é—®é¢˜,è‡ªç„¶ä¹Ÿå¯ä»¥ä¸Appleçš„APNsæœåŠ¡å™¨å»ºç«‹TLSé€šä¿¡ .pemå¤šç”¨äº*NIXæœåŠ¡å™¨.cer, .crt, .der â€“ usually in binary DER formè¿™äº›åç¼€åçš„æ–‡ä»¶ä¸€èˆ¬æ ¼å¼éƒ½ä¸ºDERä»Appleå¼€å‘è€…ä¸­å¿ƒä¸‹è½½çš„è¯ä¹¦å°±æ˜¯.ceræ ¼å¼çš„.pemä¸.cer/.crtçš„ä¸åŒå°±æ˜¯å®ƒæ˜¯ç”¨base64ç¼–ç æ¥è¡¨ç¤ºçš„,è€Œé‚£ä¸¤ä¸ªéƒ½æ˜¯ç”¨DERæ ¼å¼ç¼–ç çš„ éªŒè¯.ceræ–‡ä»¶ 123456789101112$ openssl x509 -in aps-3.cer -inform der -text -nooutCertificate: Data: Version: 3 (0x2) Serial Number: 21:91:22:78:63:a2:3a:8c Signature Algorithm: sha256WithRSAEncryption Issuer: C=US, O=Apple Inc., OU=Apple Worldwide Developer Relations, CN=Apple Worldwide Developer Relations Certification Authority Validity Not Before: Oct 24 06:26:06 2016 GMT Not After : Nov 23 06:26:06 2017 GMT ... è¯æ˜ä»Appleå¼€å‘è€…ä¸­å¿ƒä¸‹è½½çš„æ¨é€è¯ä¹¦æ˜¯ç”¨X.509ä¸­çš„DERæ ¼å¼ç¼–ç çš„ æ ¼å¼è½¬æ¢PEMâ€“p12(PEMâ€“PKCS#12) 12$ openssl pkcs12 -export -out Cert.p12 -in Cert.pem -inkey key.pem PFX/p12â€“CER/DER(PKCS#12â€“CER/DER) 123$ openssl pkcs12 -in certificate.p12 -out certificate.cerå¦‚æ— éœ€åŠ å¯†pemä¸­ç§é’¥ï¼Œå¯ä»¥æ·»åŠ é€‰é¡¹-nodesï¼›å¦‚æ— éœ€å¯¼å‡ºç§é’¥ï¼Œå¯ä»¥æ·»åŠ é€‰é¡¹-nokeys; CER/DERâ€“PEM(ç¼–ç DERâ€“BASE64) 1$ openssl x509 -inform der -in certificate.cer -out certificate.pem åº”ç”¨æœåŠ¡å™¨å’ŒAPNsæœåŠ¡å™¨é€šè¿‡TLSå»ºç«‹ä¿¡ä»»å·²ç»è¯´æ˜äº†,é¡ºä¾¿æä¸€ä¸‹è®¾å¤‡å’ŒAPNsæœåŠ¡å™¨çš„ä¿¡ä»»è¿‡ç¨‹ Trust between APNs and each device is established automatically by iOS upon initial device activation (and without participation by your app), as described in this section. Each device has a cryptographic certificate and a private cryptographic key, obtained at initial device activation and stored in the deviceâ€™s keychain. During activation, APNs uses the certificate and key to validate the deviceâ€™s connection using peer-to-peer authentication å¤§ä½“ä¸Šä¹Ÿæ˜¯APNsæœåŠ¡å™¨å‘é€å…¬é’¥è¯ä¹¦,ç„¶åç³»ç»ŸéªŒè¯è¯ä¹¦,é€šè¿‡åå‘é€è®¾å¤‡è¯ä¹¦,ä¸¤è€…å»ºç«‹ä¿¡ä»» è¯ä¹¦åˆ¶ä½œ ç™»é™†Appleå¼€å‘è€…ä¸­å¿ƒ åˆ›å»ºAppId ä½¿ç”¨é’¥åŒ™ä¸²å¯¼å‡º.certSigningRequestæ–‡ä»¶ åˆ›å»º &amp;&amp; ä¸‹è½½æ¨é€è¯ä¹¦(.ceræ–‡ä»¶) åªè¦æœ‰å¼€å‘è€…è´¦å·,åˆ›å»ºåŸºæœ¬æ²¡ä»€ä¹ˆé—®é¢˜,å…·ä½“çš„æˆªå›¾æµç¨‹å¯å‚è€ƒ æå…‰ .certSigningRequest A CSR or Certificate Signing request is a block of encoded text that is given to a Certificate Authority when applying for an SSL Certificate CSRæˆ–è¯ä¹¦ç­¾åè¯·æ±‚æ˜¯æˆ‘ä»¬ç”³è¯·SSLè¯ä¹¦æ—¶ç»™äºˆè®¤è¯æœºæ„çš„è¡¨æ˜èº«ä»½çš„ä¸€æ®µæ–‡æœ¬ å®ä¾‹ä¸ç¯å¢ƒæœ¬åœ°æœåŠ¡å™¨ [å‚è€ƒæ•™ç¨‹]æ•ˆæœå›¾: æ¨é€è¯ä¹¦ç›¸å…³å¤„ç† p12 é’¥åŒ™ä¸²å¯¼å‡º pem å°†ä¸‹è½½çš„.ceræ–‡ä»¶å¯¼å‡ºä¸º.pemæ ¼å¼çš„æ–‡ä»¶ å°†é’¥åŒ™ä¸²ä¸­çš„p12æ–‡ä»¶ä¸­çš„ç§é’¥å¯¼å‡ºä¸º.pemæ ¼å¼çš„æ–‡ä»¶ åˆå¹¶ä¸¤ä¸ªæ–‡ä»¶ 1234$ openssl x509 -in è¯ä¹¦åå­—.cer -inform der -out push_distribution_cer.pem// man pkcs12 å¯çŸ¥-nocerts å³ no certificates at all will be output.$ openssl pkcs12 -nocerts -out pushKey.pem -in p12åå­—.p12$ cat ä¸‹è½½è¯ä¹¦ç”Ÿæˆçš„.pem p12ç”Ÿæˆçš„.pem &gt; æœ€ç»ˆè¯ä¹¦çš„åå­—.pem æµ‹è¯•è¯ä¹¦çš„æœ‰æ•ˆæ€§1234ç”Ÿäº§ç¯å¢ƒ openssl s_client -connect gateway.push.apple.com:2195 -cert ä¸‹è½½è¯ä¹¦ç”Ÿæˆçš„.pem -key p12ç”Ÿæˆçš„.pemå¼€å‘ç¯å¢ƒæ—¶æœåŠ¡å™¨åœ°å€: gateway.sandbox.push.apple.com:2195 å°†åˆå¹¶åçš„è¯ä¹¦æ–‡ä»¶æ‹·è´åˆ°æœ¬åœ°æœåŠ¡å™¨çš„åˆé€‚ç›®å½•,åé¢ä¼šç”¨åˆ° PHPrecv.php è´Ÿè´£æ¥æ”¶ä»å®¢æˆ·ç«¯ä¸ŠæŠ¥çš„deviceToken12345678&lt;?php $myfile = fopen(\"testfile.txt\", \"w\") or die(\"Unable to open file!\"); $deviceToken = $_GET['deviceToken']; $result = [\"deviceToken\" =&gt; $deviceToken]; echo json_encode($result); fwrite($myfile,$deviceToken); fclose($myfile);?&gt; RemotePush.php è´Ÿè´£ä¸APNsæœåŠ¡å™¨äº¤äº’,å®ç°æ¨é€1234567891011121314151617181920212223242526272829303132333435&lt;?php $filename = \"testfile.txt\"; $myfile = fopen($filename, \"r\") or die(\"Unable to open file!\"); $contents = fread($myfile, filesize($filename)); $deviceToken= $contents; $body = array(\"aps\" =&gt; array(\"alert\" =&gt; 'æ¨é€çš„å†…å®¹',\"badge\" =&gt; 1,\"sound\"=&gt;'default')); //æ¨é€æ–¹å¼ï¼ŒåŒ…å«å†…å®¹å’Œå£°éŸ³ $ctx = stream_context_create(); //å¦‚æœåœ¨Windowsçš„æœåŠ¡å™¨ä¸Šï¼Œå¯»æ‰¾pemè·¯å¾„ä¼šæœ‰é—®é¢˜ï¼Œè·¯å¾„ä¿®æ”¹æˆè¿™æ ·çš„æ–¹æ³•ï¼š //$pem = dirname(__FILE__) . '/' . 'apns-dev.pem'; //linux çš„æœåŠ¡å™¨ç›´æ¥å†™pemçš„è·¯å¾„å³å¯ stream_context_set_option($ctx,\"ssl\",\"local_cert\",\"remote.pem\"); $pass = 'Apple123#@!'; stream_context_set_option($ctx, 'ssl', 'passphrase', $pass); //æ­¤å¤„æœ‰ä¸¤ä¸ªæœåŠ¡å™¨éœ€è¦é€‰æ‹©ï¼Œå¦‚æœæ˜¯å¼€å‘æµ‹è¯•ç”¨ï¼Œé€‰æ‹©ç¬¬äºŒåsandboxçš„æœåŠ¡å™¨å¹¶ä½¿ç”¨Devçš„pemè¯ä¹¦ï¼Œå¦‚æœæ˜¯æ­£æ˜¯å‘å¸ƒï¼Œä½¿ç”¨Productçš„pemå¹¶é€‰ç”¨æ­£å¼çš„æœåŠ¡å™¨ $fp = stream_socket_client(\"ssl://gateway.push.apple.com:2195\", $err, $errstr, 60, STREAM_CLIENT_CONNECT, $ctx); // $fp = stream_socket_client(\"ssl://gateway.sandbox.push.apple.com:2195\", $err, $errstr, 60, STREAM_CLIENT_CONNECT, $ctx); if (!$fp) { echo \"Failed to connect $err $errstrn\"; return; } print \"Connection OK\\n\"; $payload = json_encode($body); //è¿™è¾¹å¯ä»¥å¼„ä¸€ä¸ªå¾ªç¯å®ç°å¤šä¸ªdeviceToken å€¼,è¿™é‡Œæš‚ç”¨ä¸€ä¸ªtokenå€¼å¾—æ–¹æ³• $msg = chr(0) . pack(\"n\",32) . pack(\"H*\", str_replace(' ', '', $deviceToken)) . pack(\"n\",strlen($payload)) . $payload; echo \"sending message :\" . $payload .\"\\n\"; fwrite($fp, $msg); fclose($fp);?&gt; iOSå®¢æˆ·ç«¯AppDelegate.mimport iOS10ç‰¹æœ‰çš„UserNotificationæ¡†æ¶ 123#ifdef NSFoundationVersionNumber_iOS_9_x_Max#import &lt;UserNotifications/UserNotifications.h&gt;#endif 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions { if ([[UIDevice currentDevice].systemVersion floatValue] &gt;= 10.0) { //iOS10ç‰¹æœ‰ UNUserNotificationCenter *center = [UNUserNotificationCenter currentNotificationCenter]; // å¿…é¡»å†™ä»£ç†ï¼Œä¸ç„¶æ— æ³•ç›‘å¬é€šçŸ¥çš„æ¥æ”¶ä¸ç‚¹å‡» center.delegate = self; [center requestAuthorizationWithOptions:(UNAuthorizationOptionAlert | UNAuthorizationOptionBadge | UNAuthorizationOptionSound) completionHandler:^(BOOL granted, NSError * _Nullable error) { if (granted) { // ç‚¹å‡»å…è®¸ NSLog(@\"æ³¨å†ŒæˆåŠŸ\"); [center getNotificationSettingsWithCompletionHandler:^(UNNotificationSettings * _Nonnull settings) { NSLog(@\"%@\", settings); }]; } else { // ç‚¹å‡»ä¸å…è®¸ NSLog(@\"æ³¨å†Œå¤±è´¥\"); } }]; }else if ([[UIDevice currentDevice].systemVersion doubleValue] &gt;= 8.0) { // 1.æ³¨å†ŒUserNotification,ä»¥è·å–æ¨é€é€šçŸ¥çš„æƒé™ UIUserNotificationSettings *settings = [UIUserNotificationSettings settingsForTypes:UIUserNotificationTypeSound | UIUserNotificationTypeAlert | UIUserNotificationTypeBadge categories:nil]; [application registerUserNotificationSettings:settings]; // 2.æ³¨å†Œè¿œç¨‹æ¨é€ [application registerForRemoteNotifications]; } else { //iOS8ä¹‹å‰,æ³¨å†Œè¿œç¨‹æ¨é€çš„æ–¹æ³• [application registerForRemoteNotificationTypes:UIRemoteNotificationTypeNewsstandContentAvailability | UIRemoteNotificationTypeAlert | UIRemoteNotificationTypeBadge | UIRemoteNotificationTypeSound]; } return YES;}// è·å¾—deviceTokenæˆåŠŸ- (void)application:(UIApplication *)application didRegisterForRemoteNotificationsWithDeviceToken:(NSData *)deviceToken { NSString *deviceTokenStr = [[NSString stringWithFormat:@\"%@\",deviceToken] stringByReplacingOccurrencesOfString:@\" \" withString:@\"\"]; deviceTokenStr = [deviceTokenStr substringWithRange:NSMakeRange(1, deviceTokenStr.length - 2 )]; // [[[UIAlertView alloc] initWithTitle:@\"deviceToken\" message:deviceTokenStr delegate:nil cancelButtonTitle:@\"å–æ¶ˆ\" otherButtonTitles:nil] show]; NSURLSessionConfiguration *config = [NSURLSessionConfiguration defaultSessionConfiguration]; NSURLSession *session = [NSURLSession sessionWithConfiguration:config]; NSString *path = [NSString stringWithFormat:@\"http://192.168.198.104/~Jason/remotePush/recv.php?deviceToken=%@\",deviceTokenStr]; // NSLog(@\"%@\",deviceTokenStr); NSURLRequest *request = [NSURLRequest requestWithURL:[NSURL URLWithString:path]]; [[session dataTaskWithRequest:request completionHandler:^(NSData * _Nullable data, NSURLResponse * _Nullable response, NSError * _Nullable error) { if (!error) { NSDictionary *result = [NSJSONSerialization JSONObjectWithData:data options:0 error:nil]; NSLog(@\"æˆåŠŸ:%@\",result); } }] resume];}// è·å¾—Device Tokenå¤±è´¥- (void)application:(UIApplication *)applicationdidFailToRegisterForRemoteNotificationsWithError:(NSError *)error { NSLog(@\"did Fail To Register For Remote Notifications With Error: %@\", error);} Xcodeé…ç½® æ¨é€æµ‹è¯•123456Warning: stream_socket_client(): SSL operation failed with code 1. OpenSSL Error messages:error:14090086:SSL routines:SSL3_GET_SERVER_CERTIFICATE:certificate verify failed in /Users/Jason/Sites/remotePush/remotePush.php on line 19Warning: stream_socket_client(): Failed to enable crypto in /Users/Jason/Sites/remotePush/remotePush.php on line 19Warning: stream_socket_client(): unable to connect to ssl://gateway.sandbox.push.apple.com:2195 (Unknown error) in /Users/Jason/Sites/remotePush/remotePush.php on line 19 googleåå‘ç°å¯èƒ½æ˜¯mac OS Sierraçš„åŸå›  è§£å†³æ–¹æ¡ˆ123451. å‡çº§openssl [å¯é€‰]2. php -r \"print_r(openssl_get_cert_locations());\"3. wget http://curl.haxx.se/ca/cacert.pem // ç§»åŠ¨åˆ°2ä¸­è¾“å‡ºçš„default_cert_fileä¸­4. sudo mv cacert.pem /usr/local/libressl/etc/ssl/cert.pem ç»ˆç«¯æ¨é€1234$ php remotePush.phpConnection OKsending message :{\"aps\":{\"alert\":\"\\u63a8\\u9001\\u7684\\u5185\\u5bb9\",\"badge\":1,\"sound\":\"default\"}} å…¶ä»–è„šæœ¬PushMeBabypushtryç½‘ç«™ ç¯å¢ƒ macOS Sierra Version 10.12(16A323)Version 8.0 (8A218a)iPhone 6s 9.3.1 å‚è€ƒ What is a CSR (Certificate Signing Request)? Wiki-PKCS HTTPSçš„å·¥ä½œåŸç† Get Apache, MySQL, PHP and phpMyAdmin working on macOS Sierra ä¼ è¾“å±‚å®‰å…¨åè®® About Local and Remote Notifications - Apple Developer iOSå¼€å‘ iOS10æ¨é€å¿…çœ‹ APNs push notification with macOS Sierra Enabling Apple Push Notifications for ad hoc distribution environment","link":"/2016/11/20/iOSer-iOS-Remote-Push-Summary/"},{"title":"iOSæ‘‡ä¸€æ‘‡","text":"å‰è¨€ç®€å•å®ç°æ‘‡ä¸€æ‘‡åŠŸèƒ½ ç¯å¢ƒ &amp; å·¥å…· macOS Sierra 10.12.3Xcode 8.2.1cartool ç†è®º è®¾ç½®å¼•ç”¨å…è®¸æ‘‡ä¸€æ‘‡ è®¾ç½®ç¬¬ä¸€å“åº”è€… åœ¨è§¦å‘æ‘‡ä¸€æ‘‡åçš„äº‹ä»¶ä¸­æ·»åŠ ä»£ç å³å¯ å®è·µ å…ˆä»iTunesä¸­ä¸‹è½½ä¸€ä¸ªæœ‰æ‘‡ä¸€æ‘‡åŠŸèƒ½çš„App,æ‹†åŒ…æ‰¾èµ„æº,å‘ç°å›¾ç‰‡èµ„æºæ”¾åœ¨Assets.carä¸­äº†Googleå,å‘ç°è¿™ä¸ªcartoolå¯ä»¥,åŸç†æ˜¯ä½¿ç”¨äº†CoreUI.frameworkä¸­ç§æœ‰æ–¹æ³•,å› ä¸ºä¸ç®¡æ€ä¹ˆåŠ å¯†,æœ€ç»ˆçš„å·¥ç¨‹ä¸­è¦å¼•ç”¨æ­£å¸¸çš„å›¾ç‰‡,é‚£å¿…å®šæœ‰è§£å¯†çš„æ–¹æ³•,gitä¸‹æºä»£ç ,ç¼–è¯‘åå¾—åˆ°äºŒè¿›åˆ¶çš„å¯æ‰§è¡Œæ–‡ä»¶ ä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤å¯¼å‡ºAssets.carä¸­çš„å›¾ç‰‡èµ„æº 12# æ¡Œé¢ä¸Šæ–°å»ºäº†Assetsç›®å½•Â» ~/Desktop ./cartool Assets.car Assets æ‰¾åˆ°æˆ‘éœ€è¦çš„å›¾ç‰‡èµ„æº æ–°å»ºå·¥ç¨‹,ç¼–å†™ç›¸åº”çš„ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657- (void)viewDidLoad { [super viewDidLoad]; self.view.backgroundColor = [UIColor whiteColor]; // å…è®¸æ‘‡ä¸€æ‘‡ [UIApplication sharedApplication].applicationSupportsShakeToEdit = true; // æˆä¸ºç¬¬ä¸€å“åº”è€… [self becomeFirstResponder]; // è·å¾—å›¾ç‰‡ _shakeImageView = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@\"shakeImage\"]]; _shakeImageView.frame = self.view.bounds; _shakeImageView.contentMode = UIViewContentModeScaleAspectFit; [self.view addSubview:_shakeImageView]; // è‡ªåŠ¨è§¦å‘æ‘‡ä¸€æ‘‡ [self performSelector:@selector(motionBegan:withEvent:) withObject:nil];}- (void)motionBegan:(UIEventSubtype)motion withEvent:(UIEvent *)event { NSLog(@\"å¼€å§‹æ‘‡åŠ¨\"); [self shakeSender];}- (void)motionCancelled:(UIEventSubtype)motion withEvent:(UIEvent *)event { NSLog(@\"å–æ¶ˆæ‘‡åŠ¨\");}- (void)motionEnded:(UIEventSubtype)motion withEvent:(UIEvent *)event { if (event.subtype == UIEventSubtypeMotionShake) { // åˆ¤æ–­æ˜¯å¦æ˜¯æ‘‡åŠ¨ç»“æŸ NSLog(@\"æ‘‡åŠ¨ç»“æŸ\"); }}- (void)shakeSender { // ç»•ç€å‚ç›´äºæ‰‹æœºçš„zè½´æ—‹è½¬,å‘ˆç°çš„å°±æ˜¯æ‘‡ä¸€æ‘‡åŠ¨ç”» CABasicAnimation* shake = [CABasicAnimation animationWithKeyPath:@\"transform.rotation.z\"]; // è®¾ç½®æŠ–åŠ¨å¹…åº¦ shake.fromValue = [NSNumber numberWithFloat:-0.2]; shake.toValue = [NSNumber numberWithFloat:+0.2]; shake.duration = 0.2; shake.autoreverses = YES; //æ˜¯å¦é‡å¤ // æµ‹è¯•æ—¶ shake.repeatCount = 99; [_shakeImageView.layer addAnimation:shake forKey:@\"imageView\"]; _shakeImageView.alpha = 1.0; [UIView animateWithDuration:2.0 delay:2.0 options:UIViewAnimationOptionCurveEaseIn animations:^{} completion:nil];} æ•ˆæœå›¾ å·¥ç¨‹Demo å‚è€ƒ iOSã€Œæ‘‡ä¸€æ‘‡ã€åŠŸèƒ½çš„å®ç° æå–assets.carä¸­çš„å›¾ç‰‡ .caræ–‡ä»¶çš„è§£å‹","link":"/2017/03/10/iOSer-iOS-Shake/"},{"title":"ç†è®ºç¯‡ï¼šiOS åº”ç”¨é‡ç­¾å","text":"å¯¼è¯­ åœ¨æ•´ç†é˜…è¯»:iOS Appç­¾åçš„åŸç†äº†è§£äº†ç­¾åçš„è¿‡ç¨‹ï¼Œç°åœ¨é‡æ–°å›å¤´æ•´ç†ä¸€ä¸‹ iOS é‡ç­¾åçš„ä¸€äº›å†…å®¹ã€‚ ç¯å¢ƒ &amp; å·¥å…· macOS Sierra 10.12.4Xcode 8.3.1 æ•°å­—ç­¾å æ•°ä½ç­¾ç« ï¼ˆåˆç§°å…¬é’¥æ•°ä½ç­¾ç« ï¼Œè‹±è¯­ï¼šDigital Signature ï¼‰æ˜¯ä¸€ç§ç±»ä¼¼å†™åœ¨çº¸ä¸Šçš„æ™®é€šçš„ç‰©ç†ç­¾åï¼Œä½†æ˜¯ä½¿ç”¨äº†å…¬é’¥åŠ å¯†é¢†åŸŸçš„æŠ€æœ¯å®ç°ï¼Œç”¨äºé‰´åˆ«æ•°å­—ä¿¡æ¯çš„æ–¹æ³•ã€‚ åœ¨è¿™é‡ŒæŒ‡ codesign çš„å‚æ•° identity ï¼Œå®ƒçš„ç”Ÿæˆæ˜¯ç”¨ SHA-1 ç®—æ³•å¯¹æ•´ä¸ªæ•°å­—è¯ä¹¦å†…å®¹è¿›è¡Œæ‘˜è¦ç”Ÿæˆçš„ 40 ä½çš„ 16 è¿›åˆ¶çš„å­—ç¬¦åºåˆ—ã€‚ Entitlement åœ¨ ã€Šæ·±å…¥è§£æMac OS X &amp; iOS æ“ä½œç³»ç»Ÿã€‹ä¸€ä¹¦ä¸­æåˆ°: Entitlement æ˜¯ä¸€ç§æƒé™å£°æ˜æœºåˆ¶ï¼Œä»æ¦‚å¿µä¸Šéå¸¸åƒ .Net å’Œ Java ä¸­ä½¿ç”¨çš„å£°æ˜å¼æƒé™æœºåˆ¶ã€‚åœ¨ iOS ä¸­ entitlement plist æ˜¯ç›´æ¥åµŒå…¥åœ¨åº”ç”¨ç¨‹åºçš„äºŒè¿›åˆ¶ä¸­çš„ï¼Œå¹¶ä¸”ç”±è‹¹æœè¿›è¡Œæ•°å­—ç­¾å å…³äº Entitlement æ–‡ä»¶æ˜¯åµŒå…¥åˆ°åº”ç”¨ç¨‹åºçš„äºŒè¿›åˆ¶ä¸­çš„è®ºæ–­ï¼Œå·²è¿›è¡ŒéªŒè¯ã€‚ æè¿°æ–‡ä»¶ Apple ç”¨äºæè¿°ä¸ç®¡ç†åº”ç”¨å®‰è£…çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†è¯ä¹¦ï¼ŒåŒ…åï¼Œå¯å®‰è£…è®¾å¤‡ç­‰ä¿¡æ¯ã€‚ æ€»ç»“ æ•°å­—ç­¾å: ç”¨äºè§£å†³å·²è·å¾—æˆæƒçš„åº”ç”¨çš„å®Œæ•´æ€§ (æ˜¯å¦å®Œæ•´) æè¿°æ–‡ä»¶: ç”¨äºè§£å†³åº”ç”¨æ˜¯å¦èƒ½è¢«æˆæƒå®‰è£… (æ˜¯å¦å®‰è£…) Entitlement: ç”¨äºè§£å†³è¯¥åº”ç”¨çš„æƒé™ (æ˜¯å¦æœ‰æƒé™) è¿‡ç¨‹åˆ†æ ä¸€å¼€å§‹ä¸æ˜ç™½æ²¡äº‹ï¼Œæ€»æœ‰æ˜ç™½çš„ã€‚å…³äºç­¾åè¿™ä»¶äº‹ï¼ŒXcode æ˜¯äº†è§£çš„ï¼Œå› æ­¤è€ƒè™‘ä»å®ƒå…¥æ‰‹ã€‚ åœ¨ Xcode ä¸Šç”¨ âŒ˜ B å»ç¼–è¯‘ä¸€ä¸ª iOS çš„å·¥ç¨‹ï¼Œé€šè¿‡æŸ¥çœ‹æœ¬æ¬¡è¿è¡Œçš„æ—¥å¿—ä¿¡æ¯ä¸­çš„ç­¾åï¼ˆSignï¼‰éƒ¨åˆ†ã€‚æˆ‘ä»¬å¯ä»¥äº†è§£åˆ° iOS åº”ç”¨å¼€å‘æ—¶çš„ç­¾åå·¥ä½œæ˜¯ç”± macOS ä¸Šçš„ codesign è´Ÿè´£çš„ã€‚ â€œé¢„å¤„ç†â€ cd åˆ°å·¥ç¨‹ç›®å½• export CODESIGN_ALLOCATE å®šä¹‰ CODESIGN_ALLOCATE ç¯å¢ƒå˜é‡ export PATH : ä¸´æ—¶æ·»åŠ  PATH ç¯å¢ƒå˜é‡ï¼Œä¸»è¦ä¸ºäº†è®© Xcode ä¸­çš„ä¸€äº›æŒ‡ä»¤èƒ½è¢«æ‰¾åˆ° è¯»å–æè¿°æ–‡ä»¶ã€‚ æ­£æ–‡: codesign é€šè¿‡æŸ¥çœ‹ codesign çš„ man æ‰‹å†Œæ¥ç¡®å®šå‚æ•°çš„å…·ä½“å«ä¹‰ -f, â€“force When signing, causes codesign to replace any existing signature on the path(s) given. Without this option, existing signatures will not be replaced, and the signing oper-ation fails. ä½¿ç”¨ -fï¼Œ--force å‚æ•°ä¼šåœ¨ç­¾åæ—¶æ›¿æ¢æ‰åŸæœ‰çš„ç­¾åï¼Œå¤§çº¦å°±æ˜¯ä¸ªæ˜¯å¦è¿›è¡Œè¦†ç›–æ“ä½œçš„æ„æ€ã€‚ -s, â€“sign identity Sign the code at the path(s) given using this identity. See SIGNING IDENTITIES below. SIGNING IDENTITIES To be used for code signing, a digital identity must be stored in a keychain that is on the calling userâ€™s keychain search list. All keychain sources are supported if properly configured. In particular, it is possible to sign code with an identity stored on a supported smart card. If your signing identity is stored in a different form, you need to make it available in keychain form to sign code with it.â€¦ æ‰“å¼€é’¥åŒ™ä¸²ï¼Œ æ‰¾åˆ°ç­¾åçš„æ•°å­—è¯ä¹¦ï¼ŒæŒ‡ä»¤ä¸­ identity çš„å€¼æ˜¯ Fingerprints ä¸­ 40 ä½çš„ 16 è¿›åˆ¶ SHA-1 å€¼ã€‚ å…³äº SHA-1 å’Œ MD5 éƒ½æ˜¯æ•°å­—ç­¾åç®—æ³•ã€‚ Fingerprints æ˜¯æŒ‡çº¹çš„æ„æ€ï¼Œç®—éšå«å”¯ä¸€æ€§ã€‚ â€“entitlements path When signing, take the file at the given path and embed its con- tents in the signature as entitlement data. If the data at path does not already begin with a suitable binary (â€œblobâ€) header, one is attached automatically. æ‰¾åˆ°å¯¹åº”è·¯å¾„ä¸‹çš„ xxx.app.xcent æ–‡ä»¶ï¼Œå…·ä½“å†…å®¹å¤§æ¦‚å¦‚ä¸‹ 12345678910111213141516&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"&gt;&lt;plist version=\"1.0\"&gt;&lt;dict&gt; &lt;key&gt;application-identifier&lt;/key&gt; &lt;string&gt;XXX.åŒ…å&lt;/string&gt; &lt;key&gt;com.apple.developer.team-identifier&lt;/key&gt; &lt;string&gt;XXX&lt;/string&gt; &lt;key&gt;get-task-allow&lt;/key&gt; &lt;true/&gt; &lt;key&gt;keychain-access-groups&lt;/key&gt; &lt;array&gt; &lt;string&gt;XXX.åŒ…å&lt;/string&gt; &lt;/array&gt;&lt;/dict&gt;&lt;/plist&gt; get-task-allow ï¼šå…è®¸å…¶ä»–è¿›ç¨‹é™„ä¸Šè¯¥è¿›ç¨‹ï¼Œæ¯”å¦‚å¼€å‘ç¯å¢ƒä¸‹ Xcode ä¼šç”¨ lldb é™„ä¸Šè¿›ç¨‹è¿›è¡Œè°ƒè¯•ã€‚å·²éªŒè¯è¿‡åœ¨ AdHoc åŒ…ä¸­çš„è¯¥å­—æ®µä¹Ÿç¡®å®ä¼šå˜æˆ falseã€‚ keychain-access-groups ï¼š ä¸ºäº†å¼€å‘è€…èƒ½ç”¨é’¥åŒ™ä¸²åœ¨è‡ªå·±çš„åº”ç”¨é—´ä¼ é€’ä¿¡æ¯ï¼ˆæ¯”å¦‚:å¯†ç ï¼‰ã€‚ embedded.mobileprovision (æè¿°æ–‡ä»¶) æœ€åç”Ÿæˆçš„åŒ…ä¸­æœ‰ embedded.mobileprovision æ–‡ä»¶ï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬ä»è‹¹æœåå°ä¸‹è½½çš„æè¿°æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†åº”ç”¨çš„åŒ…åï¼Œè¯ä¹¦ï¼Œå¯å®‰è£…è®¾å¤‡ï¼Œè¿‡æœŸæ—¶é—´ç­‰ç­‰ä¿¡æ¯ï¼Œåœ¨ç­¾åæ—¶ä¼šè¢«æ‰“åŒ…åˆ°åº”ç”¨ä¸­ã€‚å› ä¸ºä¸ç­¾åXcode æ— æ³•é€šè¿‡ç¼–è¯‘ï¼Œæ— æ³•éªŒè¯ï¼Œå› æ­¤åªæ˜¯è§‰å¾—åº”è¯¥æ˜¯ç­¾åæ“ä½œæ—¶ç”Ÿæˆçš„ã€‚ åœ¨é‡ç­¾åè¿‡ç¨‹ä¸­ï¼Œç½‘ä¸Šä¼šè¯´ä»è‡ªå·±ä»¥å‰æ‰“åŒ…çš„åº”ç”¨é‡Œé¢æ‹·è´ï¼Œå½“ç„¶æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ä»è‹¹æœåå°ä¸‹è½½è¦é‡ç­¾åçš„æè¿°æ–‡ä»¶ï¼Œç„¶åé‡æ–°å‘½åä¸º embedded.mobileprovision ä¹Ÿæ˜¯ä¸€ä¸ªæ–¹æ¡ˆã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ª embedded.mobileprovision çš„ç¤ºä¾‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"&gt;&lt;plist version=\"1.0\"&gt;&lt;dict&gt; &lt;key&gt;AppIDName&lt;/key&gt; &lt;string&gt;XC Wildcard&lt;/string&gt; &lt;key&gt;ApplicationIdentifierPrefix&lt;/key&gt; &lt;array&gt; &lt;string&gt;ZEY3XXXXXX&lt;/string&gt; &lt;/array&gt; &lt;key&gt;CreationDate&lt;/key&gt; &lt;date&gt;2017-03-08T06:25:32Z&lt;/date&gt; &lt;key&gt;Platform&lt;/key&gt; &lt;array&gt; &lt;string&gt;iOS&lt;/string&gt; &lt;/array&gt; &lt;key&gt;DeveloperCertificates&lt;/key&gt; &lt;array&gt; &lt;data&gt;MIIF...fA=&lt;/data&gt; &lt;data&gt;MIIF...94=&lt;/data&gt; &lt;/array&gt; &lt;key&gt;Entitlements&lt;/key&gt; &lt;dict&gt; &lt;key&gt;keychain-access-groups&lt;/key&gt; &lt;array&gt; &lt;string&gt;ZEY3XXXXXX.*&lt;/string&gt; &lt;/array&gt; &lt;key&gt;get-task-allow&lt;/key&gt; &lt;true/&gt; &lt;key&gt;application-identifier&lt;/key&gt; &lt;string&gt;ZEY3XXXXXX.*&lt;/string&gt; &lt;key&gt;com.apple.developer.team-identifier&lt;/key&gt; &lt;string&gt;ZEY3XXXXXX&lt;/string&gt; &lt;/dict&gt; &lt;key&gt;ExpirationDate&lt;/key&gt; &lt;date&gt;2018-03-08T06:25:32Z&lt;/date&gt; &lt;key&gt;Name&lt;/key&gt; &lt;string&gt;iOS Team Provisioning Profile: *&lt;/string&gt; &lt;key&gt;ProvisionedDevices&lt;/key&gt; &lt;array&gt; &lt;string&gt;2b8ffa94ec91d9ce9c94da9ad423b88888888888&lt;/string&gt; &lt;/array&gt; &lt;key&gt;TeamIdentifier&lt;/key&gt; &lt;array&gt; &lt;string&gt;ZEY3XXXXXX&lt;/string&gt; &lt;/array&gt; &lt;key&gt;TeamName&lt;/key&gt; &lt;string&gt;Deliang Wang&lt;/string&gt; &lt;key&gt;TimeToLive&lt;/key&gt; &lt;integer&gt;365&lt;/integer&gt; &lt;key&gt;UUID&lt;/key&gt; &lt;string&gt;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&lt;/string&gt; &lt;key&gt;Version&lt;/key&gt; &lt;integer&gt;1&lt;/integer&gt;&lt;/dict&gt; æ€»ç»“ â€œé¢„å¤„ç†â€ åšå¥½ä¸€äº›å‰æœŸçš„å¤„ç†å·¥ä½œï¼ˆè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œè¯»å–æè¿°æ–‡ä»¶ç­‰ï¼‰ -sign çš„ SHA-1 å€¼ ï¼Œä»é’¥åŒ™ä¸²ä¸­æ‰¾åˆ°å¯¹åº”çš„æ•°å­—è¯ä¹¦ --entitlements ç¡®å®šåº”ç”¨çš„æƒé™ codesign æŒ‡ä»¤å¯¹åº”ç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œèµ„æºï¼ŒåŠ¨æ€åº“è¿›è¡Œç­¾åï¼ˆäºŒè¿›åˆ¶çš„ç­¾åä¿å­˜åœ¨è‡ªå·±å†…éƒ¨ï¼‰ å®‰è£…è¿‡ç¨‹ï¼š iOS è®¾å¤‡ç”¨éªŒè¯ embedded.mobileprovision æ–‡ä»¶çš„æ•°å­—è¯ä¹¦ï¼Œå–å‡ºå…¶ä¸­çš„å…¬é’¥ï¼Œèƒ½å–å‡ºè¯æ˜ç»è¿‡äº†è‹¹æœæœåŠ¡å™¨çš„æˆæƒï¼Œå³è¯¥å…¬é’¥æ˜¯æœ‰æ•ˆçš„ï¼Œç”¨è¯¥å…¬é’¥å»è§£å¯†æœ¬åœ°ç§é’¥åŠ å¯†çš„ä¿¡æ¯(_CodeSignature)ï¼Œå¾—åˆ°çœŸå®ç­¾åå€¼ï¼Œç„¶ååŒæ ·è®¡ç®—ï¼ŒéªŒè¯æ–‡ä»¶çš„å®Œæ•´æ€§ï¼Œå®Œæ•´æ€§é€šè¿‡åå°±å¯ä»¥å®‰è£…ã€‚ æ–¹æ¡ˆ é‡ç­¾åä¸€èˆ¬å°±æ˜¯åœ¨è‹¹æœè®¤å¯çš„ä½“ç³»ä¸‹: AppStore åˆ†å‘ å¼€å‘è€…è°ƒè¯•å®‰è£… AdHoc / ä¼ä¸šåŒ…åˆ†å‘ è®©åº”ç”¨é¡ºåˆ©å®‰è£…ã€‚ ä¸»è¦æ˜¯è®© iOS è®¾å¤‡è®¤ä¸ºå®Œæ•´æ€§æ²¡æœ‰è¢«ç ´å å…³äºå·¥å…· Apple å·²ç»æä¾›äº†ï¼Œå°±æ˜¯ codesign ã€‚ è¯´æ˜ ä¸€å¼€å§‹æˆ‘ä»¥ä¸ºé‡ç­¾åå¹¶æ²¡æœ‰å¤ªå¤šå¯ä»¥å†™çš„å†…å®¹ï¼Œæ¯•ç«Ÿç½‘ä¸Šå…³äºå¦‚ä½•é‡ç­¾åçš„èµ„æ–™è¿˜æ˜¯æŒºå¤šçš„ï¼Œä¹Ÿæœ‰ä¸å°‘ä¼˜ç§€çš„å·¥å…·å¯ä»¥å¾ˆæ–¹ä¾¿çš„å®Œæˆé‡ç­¾åçš„æ“ä½œã€‚ ä¸ºäº†è®©è‡ªå·±ç¡®å®šçŸ¥é“å“ªäº›å› ç´ ä¼šå½±å“é‡ç­¾åï¼Œæµ‹è¯•(æŠ˜è…¾)äº†æŒºä¹…æ‰å¤§è‡´äº†è§£äº†ç‚¹ï¼Œå› ä¸ºè¿™éƒ¨åˆ†ç›®å‰æ¯”è¾ƒä¹±ï¼Œéœ€è¦æ—¶é—´å»æ•´ç†ï¼Œè€Œä¸”å®é™…é‡ç­¾åæ“ä½œè¿˜æœ‰ä¸€äº›æƒ…å†µéœ€è¦è€ƒè™‘: å¤š target*ï¼Œæ³¨å…¥ *dylib ï¼Œæ‰€ä»¥æ‰“ç®—æ‹†æˆä¸¤ç¯‡ï¼ŒæŠŠå…·ä½“çš„å¦‚ä½•é‡ç­¾åçš„æ“ä½œåœ¨å®è·µç¯‡ä¸­å†è°ˆè°ˆã€‚ å‚è€ƒ Wiki - æ•°å­—ç­¾å What does get-task-allow do in Xcode? Simplifying using Keychain Access Groups","link":"/2017/04/09/iOSer-iOS-application-re-signature-theory-articles/"},{"title":"objc-706å·¥ç¨‹æ­å»º","text":"ç¯å¢ƒ macOS 10.12.1Xcode 8.1 ä»£ç å¯ç¼–è¯‘ &amp; è¿è¡Œçš„å·¥ç¨‹ objc-706 æµç¨‹æºä»£ç ä¸‹è½½ macOS10.12.1 objc4-706 ç¼–è¯‘ -&gt; å¤±è´¥ -&gt; ç¼–è¯‘ -&gt; å¤±è´¥â€¦ ç¼–è¯‘ -&gt; æˆåŠŸâœ˜ â€˜sys/reason.hâ€™ file not found (objc-os.h) Q1: ä¸ºä»€ä¹ˆ&lt;sys/param.h&gt;å¯ä»¥æ‰¾åˆ°? æŒ‰ä½âŒ˜ ç‚¹å‡»è¿›å…¥&lt;sys/param.h&gt; å®é™…è·¯å¾„ 1/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/sys/param.h Q2: ä¸ºä»€ä¹ˆä¼šå»æ‰¾è¿™ä¸ªè·¯å¾„? A2 : å†³å®šäºBuild Settingsä¸­çš„Use Standard System Header Directory Searchingå­—æ®µ Controls whether the standard system directories are searched for header files. When disabled, only the directories you have specified with -I options (and the directory of the current file, if appropriate) are searched. å®é™…ç›®å½•ä¸‹ç¡®å®æ²¡æœ‰ &lt;sys/reason.h&gt; A1: å®é™…ç›®å½•ä¸‹ç¡®å®æ²¡æœ‰ &lt;sys/reason.h&gt; åŸæ¥çš„å¤´æ–‡ä»¶æŸ¥æ‰¾ç›®å½•åœ¨/tmp*ä¸‹,ä¸ºäº†æ–¹ä¾¿,æ·»åŠ è·¯å¾„$(SRCROOT)/include* åœ¨objc-706å·¥ç¨‹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªincludeç›®å½•,å°†ç›¸å…³çš„å¤´æ–‡ä»¶æ”¾åœ¨è¿™é‡Œ Q3: å¦‚ä½•æ‰¾åˆ°å¯¹åº”çš„å¤´æ–‡ä»¶ A3: Google â xxx.h site:opensource.apple.com æ¯”å¦‚ reason.h site:opensource.apple.com ç»“æœå¦‚ä¸‹: çœ‹ä¸Šå»åº”è¯¥åœ¨xnuè¿™ä¸ªç›®å½•ä¸‹ æ ¹æ®æœ‰sysç›®å½•,æœ€åæ‰¾åˆ° [reason.h](https://opensource.apple.com/source/xnu/xnu-3789.21.4/bsd/sys/reason.h) æ›´å¥½çš„æ–¹æ³•æ˜¯å°†æ•´ä¸ªç›®å½•ä¸‹è½½ä¸‹æ¥é€šè¿‡ find/grep æŒ‡ä»¤å»æŸ¥æ‰¾ 12$ find ~/Downloads/objc-res/xnu-3789.21.4/* -name \"reason.h\"/Users/Jason/Downloads/objc-res/xnu-3789.21.4/bsd/sys/reason.h* åœ¨includeä¸‹åˆ›å»ºsysç›®å½• å°†reason.hæ‹·è´åˆ°sysç›®å½•ä¸‹ âŒ˜ + B* âœ˜ mach-o/dyld_priv.h file not found (objc-os.h)dyld_priv.h âŒ˜ + B âœ˜ os/lock_private.h file not found (objc-os.h) æ²¡æ‰¾åˆ°æ¢ä¸ªæ€è·¯,æ”¹æœgithub æ¯”è¾ƒè¿‡,ä¸¤ä¸ªéƒ½æ˜¯ä¸€æ ·çš„,é€‰æ‹©ä¸€ä¸ªå³å¯lock_private.hlock_private.h âŒ˜ + B âœ˜ â€˜System/pthread_machdep.hâ€™ file not found (objc-os.h) åº”è¯¥åœ¨Libcä¸­ ä½†macOS10.12.1çš„Libc-1158.20.4å¹¶æ²¡æœ‰pthreadsç›®å½•,æ‰¾ä»¥å‰çš„ç‰ˆæœ¬,åœ¨Libc-825.40.1æ‰¾åˆ°äº†pthreadç›®å½• pthread_machdep.h åœ¨includeç›®å½•ä¸‹æ–°å»ºSystemç›®å½•,æ‹·è´pthread_machdep.håˆ°è¯¥ç›®å½•ä¸‹ âŒ˜ + B âœ˜ System/machine/cpu_capabilities.h file not found (pthread_machdep.h)cpu_capabilities.h åœ¨Systemç›®å½•ä¸‹æ–°å»ºmachineç›®å½•,æ‹·è´cpu_capabilities.håˆ°è¯¥ç›®å½•ä¸‹ âŒ˜ + B âœ˜ CrashReporterClient.h file not found (objc-os.h)åœ¨Libc-825.40.1ä¸­å­˜åœ¨CrashReporterClient.h å°†å…¶æ‹·è´åˆ°includeç›®å½•ä¸‹ âŒ˜ + B âœ˜ CrashReporterClient.h file not found (CrashReporterClient.h)#include_next åŒ…å«æŒ‡å®šæ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„çš„åé¢è·¯å¾„çš„é‚£ä¸ªæ–‡ä»¶ ä¾‹å¦‚æœ‰ä¸ªæœç´¢è·¯å¾„é“¾ï¼Œåœ¨#includeä¸­ï¼Œå®ƒä»¬çš„æœç´¢é¡ºåºä¾æ¬¡æ˜¯Aï¼ŒBï¼ŒCï¼ŒDå’ŒEã€‚åœ¨Bç›®å½•ä¸­æœ‰ä¸ªå¤´æ–‡ä»¶å«a.hï¼Œåœ¨Dç›®å½•ä¸­ä¹Ÿæœ‰ä¸ªå¤´æ–‡ä»¶å«a.hï¼Œå¦‚æœåœ¨æˆ‘ä»¬çš„æºä»£ç ä¸­è¿™æ ·å†™#include &lt;a.h&gt;ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¼šåŒ…å«çš„æ˜¯Bç›®å½•ä¸­çš„a.hå¤´æ–‡ä»¶ï¼Œå¦‚æœæˆ‘ä»¬è¿™æ ·å†™#include_next &lt;a.h&gt;é‚£ä¹ˆæˆ‘ä»¬å°±ä¼šåŒ…å«çš„æ˜¯Dç›®å½•ä¸­çš„a.hå¤´æ–‡ä»¶ ä»£ç æœ‰å¦‚ä¸‹æ³¨é‡Š 1/* Include the real CrashReporterClient.h */ ä½†æˆ‘ä»¬æ²¡æœ‰çœŸæ­£çš„CrashReporterClient.h Build Settings-&gt;Preprocessor Macrosï¼ˆDebug &amp; Releaseï¼‰åŠ å…¥: LIBC_NO_LIBCRASHREPORTERCLIENT âŒ˜ + B é”™è¯¯å°±æœ‰äº›å¤šäº† å‚è€ƒ objc - ç¼–è¯‘Runtimeæºç å°†éœ€è¦çš„å‹ç¼©åŒ…å…ˆä¸‹è½½ä¸‹æ¥ å…ˆè§£å†³.hæ²¡æœ‰çš„é—®é¢˜ âœ˜ phread/workqueue_private.h file not found (objc-os.h)âœ”ï¸ ./libpthread-218.20.1/private/workqueue_private.håœ¨includeç›®å½•ä¸‹æ–°å»ºpthreadç›®å½•,æ‹·è´workqueue_private.håˆ°pthreadç›®å½•ä¸­âŒ˜ + B âœ˜ pthread/qos_private.h file not found (objc-os.h)./libpthread-218.20.1/private/qos_private.hâœ”ï¸ ./libpthread-218.20.1/sys/qos_private.hâŒ˜ + B âœ˜ sys/qos_private.h file not found (objc-os.h)./libpthread-218.20.1/private/qos_private.hâœ”ï¸ ./libpthread-218.20.1/sys/qos_private.hâŒ˜ + B âœ˜ objc-shared-cache.h file not found (objc-os.h)âœ”ï¸ ./dyld-421.2/include/objc-shared-cache.hâŒ˜ + B ç»ˆäºä¸æŠ¥xxx.h not foundçš„é”™è¯¯äº† ç»§ç»­,è§£å†³å˜é‡æœªå®šä¹‰çš„é—®é¢˜ ç”¨grepçš„æ–¹å¼å»æ‰¾å‡ºæ¥ 1$ grep -rne \"#define.*_PTHREAD_TSD_SLOT_MACH_THREAD_SELF\" . âœ”ï¸ /libpthread-218.20.1/private/tsd_private.h workqueue_private.h*ä¹Ÿæ˜¯æ¥è‡ªäº/libpthread-218.20.1/private,æ‹·è´åˆ°äº†pthreadç›®å½•ä¸‹,å°†tsd_private.hä¹Ÿæ‹·è´è‡³pthread*ç›®å½•ä¸‹ è¿˜æ˜¯æŠ¥é”™,ä»”ç»†æ£€æŸ¥objc-os.h å‘ç°å¹¶æœªå¼•å…¥tsd_private.hå¤´æ–‡ä»¶ åœ¨ç¬¬34è¡Œä¸Šä¸‹åŠ ä¸€å¥ 1#include &lt;pthread/tsd_private.h&gt; âŒ˜ + B âœ˜ â€˜os/tsd.hâ€™ file not found (tsd_private.h)./libdispatch-703.20.1/src/shims/tsd.hâœ”ï¸ ./xnu-3789.21.4/libsyscall/os/tsd.hâŒ˜ + B âœ˜ â€˜pthread/spinlock_private.hâ€™ file not found (tsd_private.h)âœ”ï¸./libpthread-218.20.1/private/spinlock_private.hâŒ˜ + B é”™è¯¯â€å˜å¤šäº†â€,çœ‹è­¦å‘Š,å‘ç°é‡å¤å®šä¹‰äº†,å‚è€ƒä¸Šé¢çš„blog é‡å¤å®šä¹‰äº†pthread_lock_tï¼Œåˆ‡æ¢åˆ°Terminalï¼ŒâŒ˜+Tæ‰“å¼€æ–°çš„ä¸€ä¸ªTabï¼Œcdåˆ°objc4-680/include/é‚£grepä¸€ä¸‹å°±å¥½äº†:cd ../objc4-680/include/grep -rne â€œtypedef.*pthread_lock_tâ€ .ç»“æœ:./pthread/spinlock_private.h:59:typedef volatile OSSpinLock pthread_lock_t;./System/pthread_machdep.h:214:typedef int pthread_lock_t;ä»ç»“æœå‘ç°æˆ‘ä»¬ä¹‹å‰å¼•å…¥çš„pthread_machdep.hå·²ç»typedefè¿‡äº†ã€‚æ³¨é‡Šæ‰å…¶ä¸­ä¸€ä¸ªå°±å¥½ã€‚ä½†æˆ‘è¿™é‡Œé€‰æ‹©æ³¨é‡Šæ‰pthread_machdep.hçš„ï¼Œåœ¨Line 214ï¼š//typedef int pthread_lock_t;ä¸ºä»€ä¹ˆæ˜¯å®ƒå‘¢ï¼Ÿå› ä¸ºå®ƒæ˜¯æˆ‘ä»¬ä»Libcæ‹·è¿‡æ¥çš„ï¼Œè€ŒLibcæˆ‘ä»¬ä¸‹è½½äº†è¾ƒæ—§çš„ç‰ˆæœ¬ã€‚â€¦ å› æ­¤æ³¨é‡Šæ‰pthread_machdep.hä¸­é‡å®šä¹‰çš„éƒ¨åˆ† æ ¹æ®é‡å®šä¹‰pthread_lock_tçš„é”™è¯¯ 1$ grep -rne \"typedef.*pthread_lock_t\" . ./Libc-825.40.1/fbsdcompat/spinlock.h:65:typedef pthread_lock_t spinlock_t;./Libc-825.40.1/pthreads/pthread_machdep.h:214:typedef int pthread_lock_t;âœ”ï¸ ./libpthread-218.20.1/private/spinlock_private.h:59:typedef volatile OSSpinLock pthread_lock_t __deprecated_msg(â€œUse &lt;os/lock.h&gt; insteadâ€);./libpthread-218.20.1/tests/cond_hang3.c:14:typedef long pthread_lock_t; âŒ˜ + B âœ˜ Unknown type name â€˜pthread_priority_tâ€™ (objc-os.h)1$ grep -rne \"pthread_priority_t;\" . ./libdispatch-703.20.1/src/shims.h:42:typedef unsigned long pthread_priority_t;./libdispatch-703.20.1/src/shims.h:80:typedef unsigned long pthread_priority_t;âœ”ï¸ ./libpthread-218.20.1/private/qos_private.h:38:typedef unsigned long pthread_priority_t; 1#include &lt;pthread/qos_private.h&gt; âŒ˜ + B 1$ grep -rne \"os_unfair_lock\" . ./libpthread-218.20.1/src/internal.h:105:typedef os_unfair_lock _pthread_lock;./libpthread-218.20.1/src/internal.h:108:#define _PTHREAD_LOCK(lock) os_unfair_lock_lock_with_options_inline(&amp;(lock), OS_UNFAIR_LOCK_DATA_SYNCHRONIZATION)./libpthread-218.20.1/src/internal.h:109:#define _PTHREAD_LOCK_FROM_MACH_THREAD(lock) os_unfair_lock_lock_inline_no_tsd_4libpthread(&amp;(lock))./libpthread-218.20.1/src/internal.h:110:#define _PTHREAD_UNLOCK(lock) os_unfair_lock_unlock_inline(&amp;(lock))./libpthread-218.20.1/src/internal.h:111:#define _PTHREAD_UNLOCK_FROM_MACH_THREAD(lock) os_unfair_lock_unlock_inline_no_tsd_4libpthread(&amp;(lock)) è¿™é‡Œè·¯å¾„æ˜¯src,æœ‰ç‚¹ä¸ä¸€æ ·,å…ˆä¸è¦å¼•å…¥internal.h,å…ˆGoogleä¸€ä¸‹,os_unfair_lock OSSpinlock is depreciatedos_unfair_lock æ˜¯ä¸ªç»“æ„ä½“,åœ¨facebook/folly - macOS Sierra issuesä¸­æåˆ°äº†warning: â€˜OSSpinLockUnlockâ€™ is deprecated: first deprecated in macOS 10.12 - Use os_unfair_lock_unlock() from &lt;os/lock.h&gt; instead [-Wdeprecated-declarations] æ‰€ä»¥å¼•å…¥ 1#include &lt;os/lock.h&gt; âŒ˜ + B grepåå‘ç°åˆåœ¨internal.hä¸­,æ ¹æ®lock.h,ä¿®æ”¹ä¸€ä¸‹lock() &amp; unlock()æ–¹æ³• ä¿®æ”¹å âŒ˜ + B âœ˜ â€˜_simple.hâ€™ file not found (objc-errors.mm)âœ”ï¸ ./Libc-825.40.1/gen/_simple.hâŒ˜ + B âœ˜ Use of undeclared identifier â€˜os_unfair_lock_assert_ownerâ€™ (objc-lockdebug.mm)1$ grep -rne \"os_unfair_lock_assert_owner\" . æ²¡æœ‰åŒ¹é…é¡¹ Googleäº†æœªå‘ç°,å…ˆå°†è¯¥å‡½æ•°çš„åŠŸèƒ½ä¿®æ”¹ä¸ºè¾“å‡ºæ—¥å¿— âŒ˜ + B âœ˜ â€˜Block_private.hâ€™ file not found (objc-block-trampolines.mm)âœ”ï¸ ./libclosure-67/Block_private.hâŒ˜ + B é“¾æ¥åŠ¨æ€åº“çš„æ—¶å€™ä¸èƒ½æ‰“å¼€libobjc.order,æŸ¥çœ‹åœ¨å¯¹åº”è·¯å¾„ä¸‹å¹¶æ²¡æœ‰libobjc.orderæ–‡ä»¶,å‘ç°objcå·¥ç¨‹å·²ç»æœ‰libobjc.order,åº”è¯¥ä¼šæœ‰å­—æ®µè¯´æ˜è¦å¼•ç”¨çš„è·¯å¾„,æƒ³åŠæ³•è®©å·¥ç¨‹å¼•å…¥æœ¬èº«çš„libobjc.orderæ–‡ä»¶ æœ€åæ‰¾åˆ°Build Settingsçš„Order File å°†è¯¥å­—æ®µç»Ÿä¸€ä¿®æ”¹ä¸º$(PROJECT_DIR)/libobjc.order âŒ˜ + B å› ä¸ºå·¥ç¨‹ä¸­å¹¶æ²¡æœ‰CrashReporterClientçš„åº“å°†Other Linker flags*ä¸­çš„-lCrashReporterClientå‚æ•°å»æ‰*âŒ˜ + B** ç»ˆäºç¼–è¯‘æˆåŠŸäº†â˜º,ç„¶ååˆ›å»ºä¸€ä¸ªdebug-objcçš„target,å¯¼å…¥ä¿®æ”¹çš„libobjc.A.dylib âŒ˜ + Ræ­£å¸¸è¿è¡Œå¹¶è¾“å‡º,lockdebug_mutex_assert_lockedè¢«è°ƒç”¨äº†å¾ˆå¤šæ¬¡,ä½†ä¸ä¼šå½±å“,å¯æ³¨é‡Šæ‰å®ƒçš„è¾“å‡º OK,å·²ç»å¯ä»¥è¿›è¡Œè°ƒè¯•äº† ç»­å¯ä»¥è°ƒè¯•,ä½†æ˜¯åœ¨debug-objcå·¥ç¨‹ä¸­è¿˜æ˜¯æ— æ³•è®¿é—®objc_class è¿›è¡Œä»¥ä¸‹æ“ä½œ æ·»åŠ ä»£ç  123objc_class *obj_1 = (objc_class *)[NSObject class];objc_class *obj_2 = (objc_class *)[NSString class];NSLog(@\"%p,%p\",obj_1,obj_2); main.m å¼•å…¥#import â€œobjc-private.hâ€ // ä¼šæŠ¥é”™ main.m -&gt; main.mm å› ä¸º objc-private.h æ˜¯objetive-c++ç±»å‹çš„ CrashReporterClient.h æŠ¥é”™ -&gt; åŒ objc-706 å·¥ç¨‹ç±»ä¼¼å¤„ç†,åœ¨ buildsetting ,è®¾ç½®LIBC_NO_LIBCRASHREPORTERCLIENT objc-probes.h file not found =&gt; ä»ç½‘ä¸Šæ‰¾åˆ°æ–‡ä»¶æ”¾åˆ°å·¥ç¨‹çš„ include ç›®å½•,å¹¶åœ¨ debug-objc æ·»åŠ  $(SRCROOT)/include maptable.h file not found(&lt;objc/maptable.h&gt;) =&gt; ä»ç½‘ä¸Šæ‰¾åˆ°æ–‡ä»¶åæ”¾åˆ°å·¥ç¨‹çš„ include/objc(ç›®å½•æ²¡æœ‰è¦åˆ›å»º) ç¼–è¯‘æˆåŠŸ æˆªå›¾å¦‚ä¸‹: å‚è€ƒ gccï¼šé¢„å¤„ç†è¯­å¥ï¼ï¼#includeå’Œ#include_next Appleå¼€æº objc - ç¼–è¯‘Runtimeæºç ","link":"/2017/02/11/iOSer-objc-706-project-structures/"},{"title":"objc4-709å·¥ç¨‹æ­å»º","text":"å¯¼è¯­objc è¿è¡Œæ—¶çš„æœ€æ–°ç‰ˆæœ¬ä¸º 709 ï¼Œä¸€å›ç”Ÿ,äºŒå›ç†Ÿï¼Œç®€å•çš„è®°å½•ä¸€ä¸‹è¿‡ç¨‹ã€‚ ç¯å¢ƒ &amp; å·¥å…· macOS Sierra 10.12.4Xcode 8.3.2objc-709æ­å»º objc-706 æ—¶çš„å¤´æ–‡ä»¶ æµç¨‹âœ˜ 'sys/reason.hâ€™ file not found (objc-os.h) å› ä¸ºæ‰“ç®—æŠŠç¼ºå°‘çš„å¤´æ–‡ä»¶ç»Ÿä¸€æ”¾åˆ°å·¥ç¨‹ä¸‹çš„ include ç›®å½•ä¸‹,å› æ­¤åœ¨ Building Setting &gt; Header Search Paths æ·»åŠ  $(SRCROOT)/include å­—æ®µ 12âœ cd /path/to/objc4-709âœ objc4-709 mkdir -p include/sys é€’å½’åˆ›å»ºç›®å½•,å°† reason.h æ‹·è´åˆ° sys ç›®å½•ä¸­ âœ˜ mach-o/dyld_priv.h file not found (objc-os.h)åŒç†,åˆ›å»º mach-o ç›®å½• &amp; æ‹·è´ dyld_priv.h åˆ° mach-o ä¸­ âœ˜ os/lock_private.h file not found (objc-os.h)åˆ›å»ºç›®å½• &amp; æ‹·è´ lock_private.h âœ˜ 'System/pthread_machdep.hâ€™ file not found (objc-os.h)åˆ›å»ºç›®å½• &amp; æ‹·è´ pthread_machdep.h âœ˜ System/machine/cpu_capabilities.h file not found (pthread_machdep.h)åˆ›å»ºç›®å½• &amp; æ‹·è´ cpu_capabilities.h âœ˜ CrashReporterClient.h file not found (objc-os.h)åˆ›å»ºç›®å½• &amp; æ‹·è´ cpu_capabilities.h âœ˜ CrashReporterClient.h file not found (CrashReporterClient.h)æ ¹æ® objc-706 çš„ç»éªŒ åœ¨ Build Settings-&gt;Preprocessor Macrosï¼ˆDebug &amp; Releaseï¼‰ åŠ å…¥: LIBC_NO_LIBCRASHREPORTERCLIENT ç¼–è¯‘æŠ¥äº†å¾ˆå¤šé”™,å…ˆè§£å†³ç¼ºå°‘å¤´æ–‡ä»¶çš„é—®é¢˜ âœ˜ phread/workqueue_private.h file not found (objc-os.h)åˆ›å»ºç›®å½• &amp; æ‹·è´ workqueue_private.h âœ˜ pthread/qos_private.h file not found (objc-os.h)æ‹·è´ qos_private.h åˆ° pthread ç›®å½• âœ˜ sys/qos_private.h file not found (objc-os.h)æ‹·è´ qos_private.h åˆ° sys ç›®å½• âœ˜ objc-shared-cache.h file not found (objc-os.h)æ‹·è´ objc-shared-cache.h åˆ° include ç›®å½•ï¼Œä¸æŠ¥ç¼ºå°‘å¤´æ–‡ä»¶çš„é”™è¯¯äº†ï¼Œç»§ç»­è§£å†³å˜é‡æœªå®šä¹‰çš„é—®é¢˜ï¼Œç”¨ grep çš„æ–¹å¼å»æ‰¾å‡ºæ¥ 1âœ grep -rne \"#define.*_PTHREAD_TSD_SLOT_MACH_THREAD_SELF\" . âœ”ï¸ /libpthread-218.20.1/private/tsd_private.h workqueue_private.h ä¹Ÿæ˜¯æ¥è‡ªäº /libpthread-218.20.1/private ,å·²æ‹·è´åˆ° pthread ç›®å½•,å°† tsd_private.h ä¹Ÿæ‹·è´è‡³pthreadç›®å½•ä¸‹ è¿˜æ˜¯æŠ¥é”™,æ£€æŸ¥ objc-os.h å‘ç°å¹¶æœªå¼•å…¥ tsd_private.h å¤´æ–‡ä»¶ åœ¨ç¬¬ 34 è¡Œä¸Šä¸‹åŠ ä¸€å¥ 1#include &lt;pthread/tsd_private.h&gt; âœ˜ 'os/tsd.hâ€™ file not found (tsd_private.h)æ‹·è´ tsd.h åˆ° os ç›®å½• âœ˜ 'pthread/spinlock_private.hâ€™ file not found (tsd_private.h)æ‹·è´ spinlock_private.h åˆ° pthread ç›®å½• å› ä¸ºæˆ‘æ‹·è´çš„æ˜¯åŸæ¥è‡ªå·±å·²ç»å¤„ç†è¿‡çš„æ–‡ä»¶,æ‰€ä»¥æ²¡æœ‰å‡ºç°é‡å¤å®šä¹‰çš„é”™è¯¯ âœ˜ Unknown type name 'pthread_priority_tâ€™ (objc-os.h) å¼•å…¥ qos_private.h å¤´æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤º 1234567891011#include &lt;pthread/qos_private.h&gt;#if SUPPORT_QOS_HACKstatic inline pthread_priority_t pthread_self_priority_direct() { pthread_priority_t pri = (pthread_priority_t) _pthread_getspecific_direct(_PTHREAD_TSD_SLOT_PTHREAD_QOS_CLASS); return pri &amp; ~_PTHREAD_PRIORITY_FLAGS_MASK;}#endif âœ˜ Unknown type name 'os_unfair_lock (objc-os.h)'åŒæ ·çš„é—®é¢˜,å·²ç»åœ¨ objc-706 ä¸­å‡ºç°è¿‡äº† è§£å†³æ–¹æ³•æ˜¯: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364#include \"objc-lockdebug.h\"// å¼•å…¥è¿™ä¸ªæ–‡ä»¶#include &lt;os/lock.h&gt;template &lt;bool Debug&gt;class mutex_tt : nocopy_t { os_unfair_lock mLock; public: mutex_tt() : mLock(OS_UNFAIR_LOCK_INIT) { }// void lock() {// lockdebug_mutex_lock(this);//// os_unfair_lock_lock(&amp;mLock);// os_unfair_lock_lock_with_options_inline// (&amp;mLock, OS_UNFAIR_LOCK_DATA_SYNCHRONIZATION);// }// void unlock() {// lockdebug_mutex_unlock(this);//// os_unfair_lock_unlock_inline(&amp;mLock);// } void lock() { lockdebug_mutex_lock(this); os_unfair_lock_lock(&amp;mLock); } void unlock() { lockdebug_mutex_unlock(this); os_unfair_lock_unlock(&amp;mLock); } void assertLocked() { lockdebug_mutex_assert_locked(this); } void assertUnlocked() { lockdebug_mutex_assert_unlocked(this); } // Address-ordered lock discipline for a pair of locks. static void lockTwo(mutex_tt *lock1, mutex_tt *lock2) { if (lock1 &gt; lock2) { lock1-&gt;lock(); lock2-&gt;lock(); } else { lock2-&gt;lock(); if (lock2 != lock1) lock1-&gt;lock(); } } static void unlockTwo(mutex_tt *lock1, mutex_tt *lock2) { lock1-&gt;unlock(); if (lock2 != lock1) lock2-&gt;unlock(); }}; âœ˜ '_simple.hâ€™ file not found (objc-errors.mm)æ‹·è´ _simple.h åˆ° include ç›®å½• âœ˜ 'Block_private.hâ€™ file not found (objc-block-trampolines.mm)æ‹·è´ Block_private.h åˆ° include ç›®å½• æŠ¥ libobjc.order é“¾æ¥å¤±è´¥ è§£å†³åŠæ³•æ˜¯å°† Building Settings ä¸­çš„ Order File çš„å­—æ®µ æ”¹ä¸º $(PROJECT_DIR)/libobjc.order å› ä¸ºå·¥ç¨‹ä¸­å¹¶æ²¡æœ‰ CrashReporterClient çš„åº“å°† Other Linker flags ä¸­çš„ -lCrashReporterClient å‚æ•°å»æ‰ ç¼–è¯‘é€šè¿‡ åˆ›å»ºä¸€ä¸ª debug-objc çš„ target ,å¯¼å…¥ä¿®æ”¹çš„ libobjc.A.dylibï¼Œå°±åˆå¯ä»¥æ„‰å¿«çš„è°ƒè¯•äº†ã€‚ objc-709 å‚è€ƒ objc-706å·¥ç¨‹æ­å»º","link":"/2017/05/05/iOSer-objc-709-project-structures/"},{"title":"Windowsä¸Macç«¯æ•°æ®å…±äº«","text":"èƒŒæ™¯åœ¨winä¸Šè®¿é—®å¤–éƒ¨çš„ç½‘ç«™ç½‘é€Ÿæ¯”è¾ƒå¿«,ä½†æ˜¯æ—¥å¸¸å¼€å‘åˆåœ¨macbookä¸Š,å› æ­¤éœ€è¦ä¸¤å°ç”µè„‘èƒ½æ•°æ®å…±äº«ï¼Œä¸€å¼€å§‹æ˜¯æƒ³é€šè¿‡å¾®ä¿¡çš„,ä½†æ˜¯åŒä¸€ä¸ªè´¦å·ä¸èƒ½åŒæ—¶ç™»é™†ï¼›ç”¨ç½‘ç›˜ä¼ è¾“ä¹‹ç±»çš„ï¼Œåˆè¦é¢å¤–ä¸‹è½½åº”ç”¨æˆ–è€…ä¾èµ–æµè§ˆå™¨ã€‚æ—¢ç„¶æ˜¯ä¸ªäººä½¿ç”¨,å¯ä»¥ç›´æ¥åœ¨winä¸Šåˆ›å»ºå…±äº«ç›®å½•æ¥è§£å†³ã€‚ æ“ä½œè®¾ç½®å…±äº«ç›®å½•åœ¨winä¸Šè®¾ç½®ä¸ªäººç›®å½• ç”¨ipconfigå‘½ä»¤è·å–winçš„å†…ç½‘IP è®¿é—®åœ¨macä¸Šä½¿ç”¨Finder è¾“å…¥ smb://winçš„IP å¡«å†™ç”¨æˆ·å + å¯†ç ç™»é™†æˆåŠŸåï¼Œé€‰æ‹©è¦è®¿é—®çš„å…±äº«ç›®å½• æœ€åå°±èƒ½æŒ‚è½½æˆåŠŸï¼Œå®ç°winä¸macé—´çš„æ–‡ä»¶å…±äº«","link":"/2025/03/28/Technology-win-mac-brige/"},{"title":"å­¦ä¹ ç¬”è®° - Flask - 02","text":"å‰è¨€å¾…ä¸šå®¶ä¸­ç»§ç»­å­¦ä¹ ã€‚ Flask é¡¹ç›®ç»“æ„1234567891011121314151617181920212223my_flask_app/â”‚â”œâ”€â”€ app/â”‚ â”œâ”€â”€ __init__.pyâ”‚ â”œâ”€â”€ routes/ -- å°†ä¸åŒåŠŸèƒ½æ¨¡å—çš„è·¯ç”±åˆ†å¼€ç®¡ç†â”‚ â”‚ â”œâ”€â”€ __init__.pyâ”‚ â”‚ â”œâ”€â”€ main.py -- ä¸»æ¨¡å—çš„è·¯ç”±â”‚ â”‚ â””â”€â”€ auth.py -- è®¤è¯ç›¸å…³çš„è·¯ç”±â”‚ â”œâ”€â”€ models/ -- ç®¡ç†æ•°æ®æ¨¡å‹,é€šå¸¸ä¸æ•°æ®æ“ä½œç›¸å…³â”‚ â”‚ â”œâ”€â”€ __init__.py â”‚ â”‚ â””â”€â”€ user.py -- ç”¨æˆ·æ¨¡å‹â”‚ â”œâ”€â”€ templates/ -- å­˜æ”¾ HTML æ¨¡æ¿æ–‡ä»¶â”‚ â”‚ â”œâ”€â”€ layout.html -- å¸ƒå±€ç›¸å…³â”‚ â”‚ â””â”€â”€ home.htmlâ”‚ â””â”€â”€ static/ -- å­˜æ”¾é™æ€æ–‡ä»¶,å¦‚CSSå’ŒJavaScriptâ”‚ â”œâ”€â”€ css/â”‚ â””â”€â”€ js/â”‚â”œâ”€â”€ config.py -- é…ç½®æ–‡ä»¶,åŒ…å«åº”ç”¨çš„é…ç½®ä¿¡æ¯â”œâ”€â”€ requirements.txt -- åˆ—å‡ºé¡¹ç›®çš„ä¾èµ–åº“â”œâ”€â”€ migrations/â”‚ â””â”€â”€ ...â””â”€â”€ run.py -- ç”¨äºå¯åŠ¨Flaskåº”ç”¨ å¦‚ä½•åœ¨Trae IDEä¸­é…ç½®Pythonè§£é‡Šå™¨çœ‹åˆ°app.py æŠ¥é”™,å› ä¸ºæ²¡æœ‰å¯¼å…¥flaskåº“,ä½†æˆ‘çš„è®¾å¤‡å·²ç»å®‰è£…äº†,æ‰€ä»¥åº”è¯¥æ˜¯éœ€è¦é…ç½®ä¸‹ã€‚åœ¨è®¾ç½®ä¸­æ‰¾åŠå¤©æ²¡æœ‰æ‰¾åˆ°,åæ¥æœç´¢æ‰çŸ¥é“åŸæ¥æ˜¯åœ¨Editorä¸­ï¼Œæœç´¢python,ç„¶åå°† Python: Default Interpreter Pathçš„è·¯å¾„è®¾ç½®ä¸ºè®¾å¤‡å®‰è£…çš„è·¯å¾„ã€‚ è—çš„æœ‰ç‚¹æ·±,å¯èƒ½ä»äº§å“çš„è§’åº¦ä¸Šçœ‹æ˜¯ä¸æƒ³å±€é™åœ¨æŸç§è¯­è¨€,å¯ä»¥åœ¨Editorè®¾ç½®çš„è¯´æ˜æ–‡æ¡ˆéƒ¨åˆ†å¢åŠ ç¼–è¯‘å™¨,è§£é‡Šå™¨ã€‚ è·¯ç”±Flask è·¯ç”±æ˜¯Flaskåº”ç”¨çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œç”¨äºå¤„ç†ä¸åŒURLçš„è¯·æ±‚ï¼Œå¹¶å°†è¯·æ±‚çš„å¤„ç†å§”æ‰˜ç»™ç›¸åº”çš„è§†å›¾å‡½æ•° è·¯ç”±çš„ç›¸å…³è¯´æ˜ å®šä¹‰è·¯ç”±: ä½¿ç”¨ @app.route(â€˜/pathâ€™) è£…é¥°å™¨å®šä¹‰URLå’Œè§†å›¾å‡½æ•°çš„æ˜ å°„ã€‚ è·¯ç”±å‚æ•°: é€šè¿‡åŠ¨æ€éƒ¨åˆ†åœ¨URLä¸­ä¼ é€’å‚æ•°çš„ç±»å‹ è·¯ç”±è§„åˆ™: ä½¿ç”¨ç±»å‹è½¬æ¢å™¨æŒ‡å®šURLå‚æ•°çš„ç±»å‹ è¯·æ±‚æ–¹æ³•: æŒ‡å®šå…è®¸çš„HTTPè¯·æ±‚æ–¹æ³•ã€‚ï¼ˆGET,POST,DELETE,PUT) è·¯ç”±å‡½æ•°è¿”å›: è§†å›¾å‡½æ•°å¯ä»¥è¿”å›ä¸åŒç±»å‹çš„å“åº” é™æ€æ–‡ä»¶å’Œæ¨¡æ¿: ç®¡ç†é™æ€æ–‡ä»¶å’ŒåŠ¨æ€æ¸²æŸ“ HTML æ¨¡æ¿ è·¯ç”±ä¼˜å…ˆçº§: ç¡®ä¿è·¯ç”±é¡ºåºæ­£ç¡®ï¼Œä»¥é¿å…æ„å¤–çš„åŒ¹é…ç»“æœ å®šä¹‰è·¯ç”±12345678910from flask import Flaskapp = Flask(__name__)@app.route('/') # è£…é¥°å™¨ï¼Œç”¨äºå®šä¹‰è·¯ç”±ã€‚/ è¡¨ç¤ºæ ¹ URLdef home(): return 'Welcome to the Home Page!'if __name__ == '__main__': app.run(debug=True) è·¯ç”±å‚æ•°12345678...@app.route('/greet/&lt;name&gt;') # åŠ¨æ€è·¯ç”±ï¼Œ&lt;name&gt; æ˜¯ä¸€ä¸ªå˜é‡def greet(name): return f'Hello, {name}!'if __name__ == '__main__': app.run(debug=True) è·¯ç”±è§„åˆ™è·¯ç”±è§„åˆ™æ”¯æŒä¸åŒ å­—ç¬¦ä¸²(é»˜è®¤): åŒ¹é…ä»»æ„å­—ç¬¦ä¸² æ•´æ•°(int:name): åŒ¹é…æ•´æ•°å€¼ æµ®ç‚¹æ•°float:value): åŒ¹é…æµ®ç‚¹æ•°å€¼ path(path:name): åŒ¹é…ä»»æ„å­—ç¬¦ï¼ŒåŒ…æ‹¬æ–œæ†/ 12345678910111213141516171819202122# è®¿é—®/user/1 èƒ½æ­£å¸¸è¾“å‡ºUser ID:1@app.route('/user/&lt;int:user_id&gt;')def user_profile(user_id): return f'User ID: {user_id}'# è®¿é—®/user/1 èƒ½æ­£å¸¸è¾“å‡ºUser ID:1@app.route('/user/&lt;user_id&gt;')def user_profile(user_id): return f'User ID: {user_id}'# è®¿é—®/user/1 intå’Œuser_idåŒæ—¶å­˜åœ¨æ—¶èµ°int@app.route('/user/&lt;user_id&gt;')def user_profile2(user_id): return f'User ID2: {user_id}' # æ¢æˆfloatï¼Œè®¿é—®/user/1# Not Found# The requested URL was not found on the server. If you entered the URL # manually please check your spelling and try again.@app.route('/user/&lt;float:user_id&gt;')def user_profile(user_id): return f'User ID: {user_id}' è¯·æ±‚æ–¹æ³•Flask è·¯ç”±æ”¯æŒä¸åŒçš„ HTTP è¯·æ±‚æ–¹æ³•ï¼Œå¦‚ GETã€POSTã€PUTã€DELETE ç­‰ã€‚å¯ä»¥é€šè¿‡ methods å‚æ•°æŒ‡å®šå…è®¸çš„è¯·æ±‚æ–¹æ³•ã€‚ 123@app.route('/submit', methods=['POST'])def submit(): return 'Form submitted!' æ­¤æ—¶è®¾ç½®äº†æ˜¯POSTè¯·æ±‚ï¼Œå¦‚æœç”¨Traeè‡ªå¸¦çš„æµè§ˆå™¨è®¿é—®,å› ä¸ºå®é™…æ˜¯GETè¯·æ±‚,ä¼šæŠ¥405é”™è¯¯ç ä¸å…è®¸ ä½¿ç”¨postmanå‘é€postè¯·æ±‚éªŒè¯èƒ½è·å¾—æ­£å¸¸çš„è¿”å› è·¯ç”±å‡½æ•°è¿”å› å­—ç¬¦ä¸²: è¿”å›çº¯æ–‡æœ¬å“åº” HTML: è¿”å›HTMLé¡µé¢ JSON: è¿”å›JSONæ•°æ® Responseå¯¹è±¡: è‡ªå®šä¹‰å“åº” 123456789101112from flask import jsonify, Response@app.route('/json')def json_response(): data = {'key': 'value'} return jsonify(data)@app.route('/custom')def custom_response(): response = Response('Custom response with headers', status=200) response.headers['X-Custom-Header'] = 'Value' return response è¿”å›json è¿”å›è‡ªå®šä¹‰å“åº” é™æ€æ–‡ä»¶å’Œæ¨¡æ¿é™æ€æ–‡ä»¶ï¼ˆå¦‚ CSSã€JavaScriptã€å›¾ç‰‡ï¼‰å¯ä»¥é€šè¿‡ static è·¯ç”±è®¿é—®ã€‚æ¨¡æ¿æ–‡ä»¶åˆ™é€šè¿‡ templates æ–‡ä»¶å¤¹ç»„ç»‡ï¼Œç”¨äºæ¸²æŸ“ HTML é¡µé¢ã€‚ styles.css 1&lt;link rel=\"stylesheet\" href=\"{{ url_for('static', filename='styles.css') }}\"&gt; 123p { color: #940f0f;} è¿™ä¸ªæ ¼å¼é»˜è®¤æ˜¯åœ¨æ‰¾å·¥ç¨‹ä¸‹çš„staticç›®å½•ä¸‹çš„styles.css app.py 123@app.route('/tutorial02/&lt;name&gt;')def hello(name): return render_template('02.html', name=name) 02.html 1234567891011121314&lt;html lang=\"en\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt; &lt;link rel=\"stylesheet\" href=\"{{ url_for('static', filename='styles.css') }}\"&gt; &lt;title&gt;02&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;h1&gt;02&lt;/h1&gt; &lt;p&gt; {{ name }} &lt;/p&gt;&lt;/body&gt;&lt;/html&gt; è·¯ç”±ä¼˜å…ˆçº§Flask æŒ‰ç…§å®šä¹‰çš„é¡ºåºåŒ¹é…è·¯ç”±ï¼Œç¬¬ä¸€ä¸ªåŒ¹é…æˆåŠŸçš„è·¯ç”±å°†è¢«å¤„ç†ã€‚ç¡®ä¿æ›´å…·ä½“çš„è·¯ç”±æ”¾åœ¨æ›´ä¸€èˆ¬çš„è·¯ç”±ä¹‹å‰ã€‚ 1234567@app.route('/user/&lt;int:user_id&gt;')def user_profile(user_id): return f'User ID: {user_id}'@app.route('/user')def user_list(): return 'User List' /user/123 å°†åŒ¹é…åˆ° /user/&lt;int:user_id&gt;ï¼Œè€Œ /user å°†åŒ¹é…åˆ° user_listã€‚ å‚è€ƒ Flaské¡¹ç›®ç»“æ„ Flaskè·¯ç”±","link":"/2025/04/01/Technology-learn-flask-02/"}],"tags":[],"categories":[{"name":"Technology","slug":"Technology","link":"/categories/Technology/"},{"name":"iOSer","slug":"iOSer","link":"/categories/iOSer/"},{"name":"Clang","slug":"Clang","link":"/categories/Clang/"}]}