<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/favicon.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="前言在 WWDC 2016 - Session 228    - iOS 中提到了 3D Touch,对它简单定义是  3D Touch 为 iOS 用户界面添加了一个全新的维度，并引入了一种全新的与 iPhone 交互的方式。   设备限制: iPhone 6s+  系统限制: iOS 9+">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS - 实现 3D Touch 功能">
<meta property="og:url" content="http://yoursite.com/2017/03/18/iOSer-Realize-3d-Touch-on-iOS/index.html">
<meta property="og:site_name" content="👨🏻‍💻&#39;s 博客">
<meta property="og:description" content="前言在 WWDC 2016 - Session 228    - iOS 中提到了 3D Touch,对它简单定义是  3D Touch 为 iOS 用户界面添加了一个全新的维度，并引入了一种全新的与 iPhone 交互的方式。   设备限制: iPhone 6s+  系统限制: iOS 9+">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/03/18/58cd140f3ec07.jpg">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/03/18/58cd14156dd71.png">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/03/18/58cd1411ab54d.png">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/03/18/58cd1411ac296.png">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/03/18/58cd1412d5e61.jpg">
<meta property="article:published_time" content="2017-03-18T11:05:21.000Z">
<meta property="article:modified_time" content="2025-04-26T14:01:51.598Z">
<meta property="article:author" content="忘川三">
<meta property="article:tag" content="UI">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ooo.0o0.ooo/2017/03/18/58cd140f3ec07.jpg">

<link rel="canonical" href="http://yoursite.com/2017/03/18/iOSer-Realize-3d-Touch-on-iOS/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>iOS - 实现 3D Touch 功能 | 👨🏻‍💻's 博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">👨🏻‍💻's 博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">慢品人间烟火色，闲观万事岁月长</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/18/iOSer-Realize-3d-Touch-on-iOS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="忘川三">
      <meta itemprop="description" content="404~ ~ ~就多走一步">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="👨🏻‍💻's 博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          iOS - 实现 3D Touch 功能
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-03-18 19:05:21" itemprop="dateCreated datePublished" datetime="2017-03-18T19:05:21+08:00">2017-03-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-04-26 22:01:51" itemprop="dateModified" datetime="2025-04-26T22:01:51+08:00">2025-04-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在 <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2016/228/"><em>WWDC 2016 - Session 228    - iOS</em></a> 中提到了 <em>3D Touch</em>,对它简单定义是</p>
<blockquote>
<p><em>3D Touch</em> 为 <em>iOS</em> 用户界面添加了一个全新的维度，并引入了一种全新的与 <em>iPhone</em> 交互的方式。</p>
</blockquote>
<ul>
<li>设备限制: <em>iPhone 6s+</em> </li>
<li>系统限制: <em>iOS 9+</em></li>
</ul>
<span id="more"></span>

<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><blockquote>
<p>macOS Sierra 10.12.3<br>Xcode 8.2.1<br>iPhone 6s 10.1.1</p>
</blockquote>
<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><p>在 <a target="_blank" rel="noopener" href="https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/Adopting3DTouchOniPhone/3DTouchAPIs.html"><em>3d Touch APIs</em></a> 文档中,提到了</p>
<blockquote>
<p>The Home screen quick action API is for adding shortcuts to your app icon that anticipate and accelerate a user’s interaction with your app.<br>The UIKit peek and pop API lets you provide easy access, within your app, to additional content while maintaining the user’s context. Use the peek quick actions API to provide a press-enabled replacement to your app’s touch-and-hold actions.<br>The Web view peek and pop API lets you enable system-mediated previews of HTML link destinations.<br>The UITouch force properties let you add customized force-based user interaction to your app.</p>
</blockquote>
<p><em>3d Touch</em> 大概有 <em>3</em> 个应用场景,主屏快速启动,而 <em>UIKit peek and pop</em> 和 <em>Web view peek and pop</em> 可以合并为一个预览的功能， 可以根据 <em>force properties</em> 按压属性值做其它交互上的操作。</p>
<h3 id="主屏快速启动-Home-Screen-Quick-Actions"><a href="#主屏快速启动-Home-Screen-Quick-Actions" class="headerlink" title="主屏快速启动(Home Screen Quick Actions)"></a>主屏快速启动(Home Screen Quick Actions)</h3><p>关于这个功能,很多应用都是有的，长按并保持几秒就可以触发，算是一个应用功能的快速入口，当你觉得应用的某些功能很重要时，让用户能快速定位到这个功能，就可以添加到这儿。</p>
<p>关于数量上的限制，我查了一下资料，在 <a target="_blank" rel="noopener" href="https://developer.apple.com/reference/uikit/uiapplicationshortcutitem">Class - UIApplication​Shortcut​Item</a> 中有如下内容</p>
<blockquote>
<p>The system limits the number quick actions displayed when a user presses a Home screen app icon. Within the limited set of displayed quick action titles, your* <strong>static quick actions</strong> are shown first, starting at the topmost position in the list. If your static items do not consume the permissible number for display and you have also defined dynamic quick actions using this class, then one or more of your <strong>dynamic quick actions</strong> is displayed.</p>
</blockquote>
<p><strong>结论:</strong></p>
<ul>
<li>系统会限制 <em>Quick Actions</em> 的显示数量，</li>
<li>在 <em>iOS 9</em> 上最多显示 <em>4</em> 个，有些应用确实可以显示5个。</li>
</ul>
<p><em>Quick Actions</em> 截图</p>
<p><img src="https://ooo.0o0.ooo/2017/03/18/58cd140f3ec07.jpg"></p>
<h3 id="预览与弹出窗口-Peek-and-Pop"><a href="#预览与弹出窗口-Peek-and-Pop" class="headerlink" title="预览与弹出窗口(Peek and Pop)"></a>预览与弹出窗口(Peek and Pop)</h3><p><em>Peek and Pop</em> 让 <em>Google</em> 直接翻译意思是偷看和流行，很明显不是苹果想表达的意思。<br><em>Peek</em> 英文解释为 <em>look quickly or furtively</em> 快速偷偷的瞥一眼，大约就是预览的意思，<em>doc</em> 上有的这一句</p>
<blockquote>
<p>Optional navigation to the view shown in the preview—known as a pop</p>
</blockquote>
<p>大概明白是什么意思了。就像微信中这个这个样子</p>
<p><img src="https://ooo.0o0.ooo/2017/03/18/58cd14156dd71.png" alt="IMG_0978"></p>
<p>上面这个效果在未联网状态下不受影响，而</p>
<p><img src="https://ooo.0o0.ooo/2017/03/18/58cd1411ab54d.png" alt="IMG_0980"></p>
<p>加载的是网络资源,当未联网时,就无法实现预览功能, 属于 <em>Web view peek and pop</em></p>
<h3 id="按压属性-force-properties"><a href="#按压属性-force-properties" class="headerlink" title="按压属性(force properties)"></a>按压属性(force properties)</h3><p><em>iOS9.0</em> 为我们提供了一个新的交互参数:力度。我们可以检测某一交互的力度值，来做相应的交互处理</p>
<p>比如系统的联系人</p>
<p><img src="https://ooo.0o0.ooo/2017/03/18/58cd1411ac296.png" alt="IMG_0981"></p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="关于主屏快速启动"><a href="#关于主屏快速启动" class="headerlink" title="关于主屏快速启动"></a>关于主屏快速启动</h3><p>上面引用的一段话提到了 <em>static quick actions</em> 和 <em>dynamic quick actions</em> ，也就是说快速启动的设置方法有静态和动态。</p>
<h4 id="静态"><a href="#静态" class="headerlink" title="静态"></a>静态</h4><blockquote>
<p>配置 <em>info.plist</em> 文件</p>
</blockquote>
<p>摘一段酷狗的 <em>info.plist</em> 的配置方法，应该就一目了然了</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>UIApplicationShortcutItems<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">key</span>&gt;</span>UIApplicationShortcutItemTitle<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">string</span>&gt;</span>听歌识曲<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">key</span>&gt;</span>UIApplicationShortcutItemType<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">string</span>&gt;</span>com.kugou.shortcut.recognize<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">key</span>&gt;</span>UIApplicationShortcutItemIconFile<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">string</span>&gt;</span>3d_touch_recognize.png<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">key</span>&gt;</span>UIApplicationShortcutItemTitle<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">string</span>&gt;</span>继续播放<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">key</span>&gt;</span>UIApplicationShortcutItemType<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">string</span>&gt;</span>com.kugou.shortcut.playmusic<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">key</span>&gt;</span>UIApplicationShortcutItemIconFile<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">string</span>&gt;</span>3d_touch_playmusic.png<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">key</span>&gt;</span>UIApplicationShortcutItemTitle<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">string</span>&gt;</span>搜索<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">key</span>&gt;</span>UIApplicationShortcutItemType<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">string</span>&gt;</span>com.kugou.shortcut.search<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">key</span>&gt;</span>UIApplicationShortcutItemIconFile<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">string</span>&gt;</span>3d_touch_search.png<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">key</span>&gt;</span>UIApplicationShortcutItemTitle<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">string</span>&gt;</span>播放本地音乐<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">key</span>&gt;</span>UIApplicationShortcutItemType<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">string</span>&gt;</span>com.kugou.shortcut.local<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">key</span>&gt;</span>UIApplicationShortcutItemIconFile<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">string</span>&gt;</span>3d_touch_localmusic.png<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>UIApplicationShortcutItems 数组类型 快捷启动的 <em>key</em></li>
<li>UIApplicationShortcutItemTitle 标题(必填) [可监听该项判断用户是从哪一个标签进入App]</li>
<li>UIApplicationShortcutItemType 类型(必填 [可监听该项判断用户是从哪一个标签进入App]</li>
<li>UIApplicationShortcutItemIconFile 图标(默认是一个黑色的圆点)</li>
</ul>
<h4 id="动态"><a href="#动态" class="headerlink" title="动态"></a>动态</h4><p>每一项快速启动对应一个 <em>UIApplicationShortcutItem</em> 对象</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NS_CLASS_AVAILABLE_IOS</span>(<span class="number">9</span>_0) __TVOS_PROHIBITED</span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UIApplicationShortcutItem</span> : <span class="title">NSObject</span> &lt;<span class="title">NSCopying</span>, <span class="title">NSMutableCopying</span>&gt;</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)init <span class="built_in">NS_UNAVAILABLE</span>;</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithType:(<span class="built_in">NSString</span> *)type localizedTitle:(<span class="built_in">NSString</span> *)localizedTitle localizedSubtitle:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)localizedSubtitle icon:(<span class="keyword">nullable</span> <span class="built_in">UIApplicationShortcutIcon</span> *)icon userInfo:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span> *)userInfo <span class="built_in">NS_DESIGNATED_INITIALIZER</span>;</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithType:(<span class="built_in">NSString</span> *)type localizedTitle:(<span class="built_in">NSString</span> *)localizedTitle;</span><br><span class="line"></span><br><span class="line"><span class="comment">// An application-specific string that identifies the type of action to perform.</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">NSString</span> *type;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Properties controlling how the item should be displayed on the home screen.</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">NSString</span> *localizedTitle;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">NSString</span> *localizedSubtitle;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">UIApplicationShortcutIcon</span> *icon;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Application-specific information needed to perform the action.</span></span><br><span class="line"><span class="comment">// Will throw an exception if the NSDictionary is not plist-encodable.</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="type">id</span> &lt;<span class="built_in">NSSecureCoding</span>&gt;&gt; *userInfo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>快速启动项的图标对应的是 <em>UIApplicationShortcutIcon</em> 类</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NS_CLASS_AVAILABLE_IOS</span>(<span class="number">9</span>_0) __TVOS_PROHIBITED</span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UIApplicationShortcutIcon</span> : <span class="title">NSObject</span> &lt;<span class="title">NSCopying</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Create an icon using a system-defined image.</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)iconWithType:(<span class="built_in">UIApplicationShortcutIconType</span>)type;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create an icon from a custom image.</span></span><br><span class="line"><span class="comment">// The provided image named will be loaded from the app&#x27;s bundle</span></span><br><span class="line"><span class="comment">// and will be masked to conform to the system-defined icon style.</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)iconWithTemplateImageName:(<span class="built_in">NSString</span> *)templateImageName;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>创建 <em>UIApplicationShortcutItem</em> 对象后，可以通过 <em>UIApplication</em> 的 <em>shortcutItems</em> 属性进行关联。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UIApplication</span> (<span class="title">UIShortcutItems</span>)</span></span><br><span class="line"><span class="comment">// Register shortcuts to display on the home screen, or retrieve currently registered shortcuts.</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSArray</span>&lt;<span class="built_in">UIApplicationShortcutItem</span> *&gt; *shortcutItems <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">9</span>_0) __TVOS_PROHIBITED;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>比如用如下代码动态创建酷狗的第 <em>5</em> 个 分享”酷狗”音乐</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">	 <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  通过代码实现动态菜单</span></span><br><span class="line"><span class="comment">     *  一般情况下设置主标题、图标、type等，副标题是不设置的 - 简约原则</span></span><br><span class="line"><span class="comment">     *  iconWithTemplateImageName 自定义的icon</span></span><br><span class="line"><span class="comment">     *  iconWithType 系统的icon</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">	 <span class="built_in">UIApplicationShortcutIcon</span> *share = [<span class="built_in">UIApplicationShortcutIcon</span> iconWithType:<span class="built_in">UIApplicationShortcutIconTypeFavorite</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">UIApplicationShortcutItem</span> *itemShare = [[<span class="built_in">UIApplicationShortcutItem</span> alloc] initWithType:<span class="string">@&quot;share&quot;</span> localizedTitle:<span class="string">@&quot;分享 “酷狗”音乐&quot;</span> localizedSubtitle:<span class="literal">nil</span> icon:share userInfo:<span class="literal">nil</span>];</span><br><span class="line">	</span><br><span class="line">	[<span class="built_in">UIApplication</span> sharedApplication].shortcutItems = @[itemShare];</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>但是最后发现还是只有 <em>4</em> 个,看来快速启动的数量确实是有限制。</p>
<blockquote>
<p>问题: 如何区分点击具体要跳转到哪个功能界面?</p>
</blockquote>
<p>必定存在信息的传递</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Called when the user activates your application by selecting a shortcut on the home screen,</span></span><br><span class="line"><span class="comment">// except when -application:willFinishLaunchingWithOptions: or -application:didFinishLaunchingWithOptions returns NO.</span></span><br><span class="line">- (<span class="type">void</span>)application:(<span class="built_in">UIApplication</span> *)application performActionForShortcutItem:(<span class="built_in">UIApplicationShortcutItem</span> *)shortcutItem completionHandler:(<span class="type">void</span>(^)(<span class="type">BOOL</span> succeeded))completionHandler <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">9</span>_0) __TVOS_PROHIBITED;</span><br></pre></td></tr></table></figure>

<p>当用户通过快速启动的方式激活应用时，会触发 <em>UIApplicationDelegate</em> 的这个方法</p>
<p>实现该方法,并设置断点，通过快速启动激活应用，输出 <em>shortcutItem</em> 参数</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">UIApplicationShortcutItem</span>: <span class="number">0x17026f380</span>; type: com.kugou.shortcut.local, title: 播放本地音乐&gt;</span><br></pre></td></tr></table></figure>

<p>我们可以知道至少可以通过 <em>type</em> 和 <em>title</em> 去区分不同的快速启动按钮。</p>
<h3 id="关于预览与弹出窗口"><a href="#关于预览与弹出窗口" class="headerlink" title="关于预览与弹出窗口"></a>关于预览与弹出窗口</h3><p>经过授权的应用视图控制器可响应用户不同的按压力量，随着按压力量的增加，<br>会有三个交互阶段：</p>
<blockquote>
<p>暗示预览功能可用，会有一个虚化的效果<br>Peek：重按一下后出现的预览，展示预览的视图以及快捷菜单<br>Pop：跳转到预览的视图控制器，是在Peek后进一步按压后进入预览的视图控制器</p>
</blockquote>
<h4 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h4><ul>
<li>主视图控制器 用于显示 <em>Peek</em> 弹窗的视图控制器</li>
<li><em>Peek</em> 视图控制器，用于提供预览的弹窗视图</li>
</ul>
<p>主视图</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="string">&quot;ViewController.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="string">&quot;PreviewViewController.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">UIViewControllerPreviewingDelegate</span>,<span class="title">UITableViewDataSource</span>,<span class="title">UITableViewDelegate</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) <span class="built_in">UITableView</span> *tableView;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) <span class="built_in">NSArray</span> *datas;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="variable language_">super</span> viewDidLoad];</span><br><span class="line">    _tableView = [[<span class="built_in">UITableView</span> alloc] initWithFrame:<span class="keyword">self</span>.view.bounds style:<span class="built_in">UITableViewStylePlain</span>];</span><br><span class="line">    _tableView.dataSource = <span class="keyword">self</span>;</span><br><span class="line">    _tableView.delegate = <span class="keyword">self</span>;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:_tableView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    <span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:<span class="string">@&quot;peekpop&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (cell == <span class="literal">nil</span>) &#123;</span><br><span class="line">        cell = [[<span class="built_in">UITableViewCell</span> alloc] initWithStyle:<span class="built_in">UITableViewCellStyleDefault</span> reuseIdentifier:<span class="string">@&quot;peekpop&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    cell.textLabel.text = <span class="keyword">self</span>.datas[indexPath.row];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  UIForceTouchCapability 检测是否支持3D Touch</span></span><br><span class="line"><span class="comment">     *  支持3D Touch</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.traitCollection.forceTouchCapability == <span class="built_in">UIForceTouchCapabilityAvailable</span>) &#123;</span><br><span class="line">        <span class="comment">// 系统所有cell可实现预览（peek）</span></span><br><span class="line">        [<span class="keyword">self</span> registerForPreviewingWithDelegate:<span class="keyword">self</span> sourceView:cell]; <span class="comment">// 注册cell</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">- (<span class="type">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView didSelectRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath&#123;</span><br><span class="line">    [tableView deselectRowAtIndexPath:indexPath animated:<span class="literal">YES</span>];</span><br><span class="line">    </span><br><span class="line">    PreviewViewController *webVC = [[PreviewViewController alloc] init];</span><br><span class="line">    webVC.webUrl = <span class="keyword">self</span>.datas[indexPath.row];</span><br><span class="line">    </span><br><span class="line">    webVC.hidesBottomBarWhenPushed = <span class="literal">true</span>;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.navigationController pushViewController:webVC animated:<span class="literal">true</span>];</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> mark - UIViewControllerPreviewingDelegate</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">UIViewController</span> *)previewingContext:(<span class="type">id</span> &lt;<span class="built_in">UIViewControllerPreviewing</span>&gt;)previewingContext viewControllerForLocation:(<span class="built_in">CGPoint</span>)location&#123;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">// 转化坐标</span></span><br><span class="line">    location = [<span class="keyword">self</span>.tableView convertPoint:location fromView:[previewingContext sourceView]];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据locaton获取位置</span></span><br><span class="line">    <span class="built_in">NSIndexPath</span> *indexPath = [<span class="keyword">self</span>.tableView indexPathForRowAtPoint:location];</span><br><span class="line">    </span><br><span class="line">    PreviewViewController *webVC = [[PreviewViewController alloc] init];</span><br><span class="line">    webVC.webUrl = <span class="keyword">self</span>.datas[indexPath.row];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> webVC;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">- (<span class="type">void</span>)previewingContext:(<span class="type">id</span> &lt;<span class="built_in">UIViewControllerPreviewing</span>&gt;)previewingContext commitViewController:(<span class="built_in">UIViewController</span> *)viewControllerToCommit&#123;</span><br><span class="line">    </span><br><span class="line">    viewControllerToCommit.hidesBottomBarWhenPushed = <span class="literal">YES</span>;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.navigationController pushViewController:viewControllerToCommit animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta"># <span class="keyword">pragma</span> mark - 懒加载</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)datas &#123;</span><br><span class="line">    <span class="keyword">if</span> (_datas == <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="built_in">NSMutableArray</span> *dataM = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:<span class="number">30</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">            [dataM addObject:<span class="string">@&quot;https://www.baidu.com&quot;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        _datas = [dataM <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _datas;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p><em>Peek</em> 视图控制器</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="string">&quot;PreviewViewController.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">PreviewViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) <span class="built_in">UIWebView</span> *webView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">PreviewViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="variable language_">super</span> viewDidLoad];</span><br><span class="line">    _webView = [[<span class="built_in">UIWebView</span> alloc] initWithFrame:<span class="keyword">self</span>.view.bounds];</span><br><span class="line">    [_webView loadRequest:[<span class="built_in">NSURLRequest</span> requestWithURL:[<span class="built_in">NSURL</span> URLWithString:_webUrl]]];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:_webView];</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">- (<span class="built_in">NSArray</span>&lt;<span class="type">id</span>&lt;<span class="built_in">UIPreviewActionItem</span>&gt;&gt; *)previewActionItems&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 赞</span></span><br><span class="line">    <span class="built_in">UIPreviewAction</span> *admire = [<span class="built_in">UIPreviewAction</span> actionWithTitle:<span class="string">@&quot;赞&quot;</span> style:<span class="built_in">UIPreviewActionStyleDefault</span> handler:^(<span class="built_in">UIPreviewAction</span> * _Nonnull action, <span class="built_in">UIViewController</span> * _Nonnull previewViewController) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;点赞成功&quot;</span>);</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 举报</span></span><br><span class="line">    <span class="built_in">UIPreviewAction</span> *report = [<span class="built_in">UIPreviewAction</span> actionWithTitle:<span class="string">@&quot;举报&quot;</span> style:<span class="built_in">UIPreviewActionStyleDestructive</span> handler:^(<span class="built_in">UIPreviewAction</span> * _Nonnull action, <span class="built_in">UIViewController</span> * _Nonnull previewViewController) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;举报成功&quot;</span>);</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 收藏</span></span><br><span class="line">    <span class="built_in">UIPreviewAction</span> *collect = [<span class="built_in">UIPreviewAction</span> actionWithTitle:<span class="string">@&quot;收藏&quot;</span> style:<span class="built_in">UIPreviewActionStyleSelected</span> handler:^(<span class="built_in">UIPreviewAction</span> * _Nonnull action, <span class="built_in">UIViewController</span> * _Nonnull previewViewController) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;收藏成功&quot;</span>);</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> @[admire,report,collect];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>对以上的代码进行简答说明：</p>
<ol>
<li>主视图遵守 <em>UIViewControllerPreviewingDelegate</em></li>
<li>注册触发 <em>Peek</em> 的视图对象</li>
<li>设置 <em>Peek</em> 视图控制器的操作 (可选)</li>
</ol>
<p>该协议有两个方法</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NS_CLASS_AVAILABLE_IOS</span>(<span class="number">9</span>_0) <span class="class"><span class="keyword">@protocol</span> <span class="title">UIViewControllerPreviewingDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// If you return nil, a preview presentation will not be performed</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">UIViewController</span> *)previewingContext:(<span class="type">id</span> &lt;<span class="built_in">UIViewControllerPreviewing</span>&gt;)previewingContext viewControllerForLocation:(<span class="built_in">CGPoint</span>)location <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">9</span>_0);</span><br><span class="line">- (<span class="type">void</span>)previewingContext:(<span class="type">id</span> &lt;<span class="built_in">UIViewControllerPreviewing</span>&gt;)previewingContext commitViewController:(<span class="built_in">UIViewController</span> *)viewControllerToCommit <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">9</span>_0);</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>根据<a target="_blank" rel="noopener" href="https://developer.apple.com/reference/uikit/uiviewcontrollerpreviewingdelegate?language=objc">API-UIView​Controller​Previewing​Delegate</a>,中可知</p>
<blockquote>
<p>previewing​Context:​view​Controller​For​Location:​<br>Called when the user has pressed a source view in a previewing view controller, thereby obtaining a surrounding blur to indicate that a preview (peek) is available.</p>
</blockquote>
<blockquote>
<p>previewing​Context:​commit​View​Controller:​<br>Called to let you prepare the presentation of a commit (pop) view from your commit view controller.</p>
</blockquote>
<p>这两个方法将会分别在用户按压操作注册了 <em>Peek</em> 的视图对象与 <em>Peek</em> 视图即将从主视图 <em>Pop</em> 时触发。</p>
<p>参数说明</p>
<blockquote>
<p>previewingContext<br>The context object for the previewing view controller.</p>
</blockquote>
<p>预览视图控制器的上下文对象，负责实现一系列预览的效果，其中的 <em>sourceView</em> 属性指向主视图中触发预览操作的视图对象</p>
<blockquote>
<p>location<br>The location of the touch in the source view’s coordinate system.</p>
</blockquote>
<p><em>location</em> 在 <em>sourceView</em> 视图的坐标系中触摸的位置，比如在下面那张截图中代理方法传递进来的 <em>locaiton</em> 参数的值为 <em>(x = 95, y = 33.5)</em> 这个是相对于点击的 <em>cell</em> 为了确定点击的具体是哪个 <em>cell</em> 需要对进行转换，转换后的结果为 <em>(x = 95, y = 77.5)</em></p>
<p>将来自于 <em>fromView:</em> 视图的坐标 <em>location</em> 转为相对于 <em>self.tableView</em> 的 <em>location</em></p>
<blockquote>
<p>Return<br>The view controller whose view you want to provide as the preview (peek), or nil to disable preview..</p>
</blockquote>
<p><em>Peek</em> 预览的视图控制器</p>
<p><img src="https://ooo.0o0.ooo/2017/03/18/58cd1412d5e61.jpg"></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*  UIForceTouchCapability 检测是否支持3D Touch</span></span><br><span class="line"><span class="comment">*  支持3D Touch</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.traitCollection.forceTouchCapability == <span class="built_in">UIForceTouchCapabilityAvailable</span>) &#123;</span><br><span class="line">   <span class="comment">// 系统所有cell可实现预览（peek）</span></span><br><span class="line">   [<span class="keyword">self</span> registerForPreviewingWithDelegate:<span class="keyword">self</span> sourceView:cell]; <span class="comment">// 注册cell</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注册与取消注册 <em>API</em></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UIViewController</span> (<span class="title">UIViewControllerPreviewingRegistration</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Registers a view controller to participate with 3D Touch preview (peek) and commit (pop).</span></span><br><span class="line">- (<span class="type">id</span> &lt;<span class="built_in">UIViewControllerPreviewing</span>&gt;)registerForPreviewingWithDelegate:(<span class="type">id</span>&lt;<span class="built_in">UIViewControllerPreviewingDelegate</span>&gt;)delegate sourceView:(<span class="built_in">UIView</span> *)sourceView <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">9</span>_0);</span><br><span class="line">- (<span class="type">void</span>)unregisterForPreviewingWithContext:(<span class="type">id</span> &lt;<span class="built_in">UIViewControllerPreviewing</span>&gt;)previewing <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">9</span>_0);</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>在 <em>Peek</em> 视图控制器中添加代码</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSArray</span>&lt;<span class="type">id</span>&lt;<span class="built_in">UIPreviewActionItem</span>&gt;&gt; *)previewActionItems&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 赞</span></span><br><span class="line">    <span class="built_in">UIPreviewAction</span> *admire = [<span class="built_in">UIPreviewAction</span> actionWithTitle:<span class="string">@&quot;赞&quot;</span> style:<span class="built_in">UIPreviewActionStyleDefault</span> handler:^(<span class="built_in">UIPreviewAction</span> * _Nonnull action, <span class="built_in">UIViewController</span> * _Nonnull previewViewController) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;点赞成功&quot;</span>);</span><br><span class="line">    &#125;];</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> @[admire,report,collect];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为对预览的视图的操作写在 <em>Peek</em> 视图控制器是很正常</p>
<p><em>Swift</em> 的实现风格的可以参考文章后的链接 <em>ViewControllerPreviews: Using the UIViewController previewing APIs</em>。</p>
<h2 id="关于按压属性"><a href="#关于按压属性" class="headerlink" title="关于按压属性"></a>关于按压属性</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Force of the touch, where 1.0 represents the force of an average touch</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">readonly</span>) <span class="built_in">CGFloat</span> force <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">9</span>_0);</span><br><span class="line"><span class="comment">// Maximum possible force with this input mechanism</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">readonly</span>) <span class="built_in">CGFloat</span> maximumPossibleForce <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">9</span>_0);</span><br></pre></td></tr></table></figure>

<p>按压实现预览本质上也是一种根据按压实现的交互。在此就不在赘述了。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/32904809/is-there-a-limit-to-how-many-uiapplicationshortcutitems-you-can-have">Is there a limit to how many UIApplicationShortcutItems you can have?</a></li>
<li><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/34643054/3d-touch-quick-action-4-item-limit">3D Touch Quick Action 4 Item Limit?</a></li>
<li><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/018d0c226134">iOS之实现3D Touch</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/reference/uikit/uiviewcontrollerpreviewingdelegate?language=objc">API-UIView​Controller​Previewing​Delegate</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/content/samplecode/ViewControllerPreviews/Introduction/Intro.html">ViewControllerPreviews: Using the UIViewController previewing APIs</a></li>
<li><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/15109958/understanding-convertpointtoview">Understanding convertPoint:toView:</a></li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/UI/" rel="tag"># UI</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2017/03/12/Technology-IntelliJ-IDEA-main-function-pass/" rel="prev" title="IntelliJ IDEA Main函数传参">
      <i class="fa fa-chevron-left"></i> IntelliJ IDEA Main函数传参
    </a></div>
      <div class="post-nav-item">
    <a href="/2017/03/21/Technology-Analysis-of-Https-protocol/" rel="next" title="HTTPS协议">
      HTTPS协议 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83"><span class="nav-number">2.</span> <span class="nav-text">环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">3.</span> <span class="nav-text">应用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E5%B1%8F%E5%BF%AB%E9%80%9F%E5%90%AF%E5%8A%A8-Home-Screen-Quick-Actions"><span class="nav-number">3.1.</span> <span class="nav-text">主屏快速启动(Home Screen Quick Actions)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%84%E8%A7%88%E4%B8%8E%E5%BC%B9%E5%87%BA%E7%AA%97%E5%8F%A3-Peek-and-Pop"><span class="nav-number">3.2.</span> <span class="nav-text">预览与弹出窗口(Peek and Pop)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%89%E5%8E%8B%E5%B1%9E%E6%80%A7-force-properties"><span class="nav-number">3.3.</span> <span class="nav-text">按压属性(force properties)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0"><span class="nav-number">4.</span> <span class="nav-text">实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E%E4%B8%BB%E5%B1%8F%E5%BF%AB%E9%80%9F%E5%90%AF%E5%8A%A8"><span class="nav-number">4.1.</span> <span class="nav-text">关于主屏快速启动</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%99%E6%80%81"><span class="nav-number">4.1.1.</span> <span class="nav-text">静态</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A8%E6%80%81"><span class="nav-number">4.1.2.</span> <span class="nav-text">动态</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E%E9%A2%84%E8%A7%88%E4%B8%8E%E5%BC%B9%E5%87%BA%E7%AA%97%E5%8F%A3"><span class="nav-number">4.2.</span> <span class="nav-text">关于预览与弹出窗口</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B"><span class="nav-number">4.2.1.</span> <span class="nav-text">流程</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E%E6%8C%89%E5%8E%8B%E5%B1%9E%E6%80%A7"><span class="nav-number">5.</span> <span class="nav-text">关于按压属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">6.</span> <span class="nav-text">参考</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">忘川三</p>
  <div class="site-description" itemprop="description">404~ ~ ~就多走一步</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">82</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">忘川三</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
