<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/favicon.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="å‰è¨€ã€€ã€€æ•´ç†ä¸€äº›æ¦‚å¿µ ã€€ ç¯å¢ƒ Xcode 8.2.1macOS Sierra 10.12.3  æ˜¯ä»€ä¹ˆ Block objects are a C-level syntactic and runtime feature. They are similar to standard C functions, but in addition to executable code they may al">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS - ç†è§£Block(ä¸Š)">
<meta property="og:url" content="http://yoursite.com/2017/03/03/iOSer-Understand-the-block/index.html">
<meta property="og:site_name" content="ğŸ‘¨ğŸ»â€ğŸ’»&#39;s åšå®¢">
<meta property="og:description" content="å‰è¨€ã€€ã€€æ•´ç†ä¸€äº›æ¦‚å¿µ ã€€ ç¯å¢ƒ Xcode 8.2.1macOS Sierra 10.12.3  æ˜¯ä»€ä¹ˆ Block objects are a C-level syntactic and runtime feature. They are similar to standard C functions, but in addition to executable code they may al">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/03/03/58b8f38b167ec.jpg">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/03/03/58b8f38bceb74.jpg">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/03/03/58b8f38bcdcc1.jpg">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/03/03/58b8f38b95d45.jpg">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/03/03/58b8f38b93d05.jpg">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/03/03/58b8f38bce8aa.jpg">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/03/03/58b8f38b6b761.jpg">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/03/03/58b8f38bce373.jpg">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/03/03/58b8f38c00445.jpg">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/03/03/58b8f391c3b7c.jpg">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/03/03/58b8f38c04d34.jpg">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/03/03/58b8f39206373.jpg">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/03/03/58b8f391aebc8.jpg">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/03/03/58b8f391c8bf4.jpg">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/03/03/58b8f391b92e6.jpg">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/03/03/58b8f391d4e14.jpg">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/03/03/58b8f391ddc1d.jpg">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/03/03/58b8f391e86d4.jpg">
<meta property="article:published_time" content="2017-03-03T04:43:02.000Z">
<meta property="article:modified_time" content="2025-04-26T14:05:26.551Z">
<meta property="article:author" content="å¿˜å·ä¸‰">
<meta property="article:tag" content="ObjC">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ooo.0o0.ooo/2017/03/03/58b8f38b167ec.jpg">

<link rel="canonical" href="http://yoursite.com/2017/03/03/iOSer-Understand-the-block/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>iOS - ç†è§£Block(ä¸Š) | ğŸ‘¨ğŸ»â€ğŸ’»'s åšå®¢</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">ğŸ‘¨ğŸ»â€ğŸ’»'s åšå®¢</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">æ…¢å“äººé—´çƒŸç«è‰²ï¼Œé—²è§‚ä¸‡äº‹å²æœˆé•¿</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/03/iOSer-Understand-the-block/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="å¿˜å·ä¸‰">
      <meta itemprop="description" content="404~ ~ ~å°±å¤šèµ°ä¸€æ­¥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸ‘¨ğŸ»â€ğŸ’»'s åšå®¢">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          iOS - ç†è§£Block(ä¸Š)
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-03-03 12:43:02" itemprop="dateCreated datePublished" datetime="2017-03-03T12:43:02+08:00">2017-03-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-04-26 22:05:26" itemprop="dateModified" datetime="2025-04-26T22:05:26+08:00">2025-04-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ã€€ã€€æ•´ç†ä¸€äº›æ¦‚å¿µ
ã€€</p>
<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><blockquote>
<p>Xcode 8.2.1<br>macOS Sierra 10.12.3</p>
</blockquote>
<h2 id="æ˜¯ä»€ä¹ˆ"><a href="#æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h2><blockquote>
<p>Block objects are a <strong>C-level syntactic and runtime feature</strong>. They are similar to <strong>standard C functions</strong>, but in addition to executable code they may also contain variable <strong>bindings</strong> to automatic (stack) or managed (heap) memory. A block can therefore maintain a set of state (data) that it can use to impact behavior when executed.</p>
</blockquote>
<span id="more"></span>

<p><em>Block</em>æ˜¯ä¸ª<em>C</em>è¯­è¨€çº§åˆ«çš„è¯­æ³•ä¸è¿è¡Œæ—¶ç‰¹æ€§ã€‚å®ƒå’Œå‡½æ•°ç±»ä¼¼,èƒ½æ‰§è¡Œä»£ç ,ä½†æ›´é‡è¦çš„æ˜¯èƒ½<strong>ç»‘å®š</strong>å †æ ˆä¸­çš„å˜é‡,é€šè¿‡è®¾ç½®è¿™äº›å˜é‡æ¥æ”¹å˜ä»£ç çš„è¡Œä¸ºã€‚</p>
<h2 id="ç”¨åœ¨å“ª"><a href="#ç”¨åœ¨å“ª" class="headerlink" title="ç”¨åœ¨å“ª"></a>ç”¨åœ¨å“ª</h2><blockquote>
<p>You can use blocks to compose function expressions that can be passed to API, optionally stored, and <strong>used by multiple threads</strong>. Blocks are particularly useful as a callback because the block carries both the code to be executed on callback and the data needed during that execution.</p>
</blockquote>
<p><em>Block</em>å¸¸è¢«ç”¨åœ¨å¤šçº¿ç¨‹ä¸­,åœ¨åº”ç”¨å¼€å‘æ—¶,å¤§å¤šæ•°æƒ…å†µä¸‹ä¸èƒ½å› ä¸ºç½‘ç»œè¯·æ±‚è€Œé˜»å¡ä¸ç”¨æˆ·çš„äº¤äº’,å¾…å“åº”è¿”å›å,åˆéœ€è¦æ ¹æ®å“åº”çš„ç»“æœå¯¹é¡µé¢è¿›è¡Œè°ƒæ•´ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹,å¯ä»¥è®©ä¸»çº¿ç¨‹å¯ä»¥æä¾›ä¸€ä¸ª<em>Block</em>åˆ°å­çº¿ç¨‹ã€‚</p>
<h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ul>
<li>ä¸»çº¿ç¨‹:å®ç°å¼‚æ­¥,æ— éœ€å…³æ³¨ç½‘ç»œè¯·æ±‚çš„ç»†èŠ‚éƒ¨åˆ†,åªè¦è€ƒè™‘è¯·æ±‚ç»“æœå¯¹ç•Œé¢çš„å½±å“,é¢„å…ˆåšå¥½å¤„ç†æ–¹å¼ã€‚</li>
<li>å­çº¿ç¨‹:è´Ÿè´£ç½‘ç»œè¯·æ±‚,å®ƒæ¸…æ¥šç½‘ç»œè¯·æ±‚ä½•æ—¶å®Œæˆ,ç”±å®ƒæ¥é€šçŸ¥ä¸»çº¿ç¨‹è¿›è¡Œé¡µé¢åˆ·æ–°æ“ä½œæ˜¯æ¯”è¾ƒåˆé€‚çš„ã€‚</li>
</ul>
<p>è€Œå®ƒä»¬çš„è”ç»“ç‚¹å°±æ˜¯<em>Block</em>,ä¸»çº¿ç¨‹æä¾›<em>Block</em>,å­çº¿ç¨‹è´Ÿè´£åœ¨åˆé€‚æ—¶æœºè°ƒç”¨<em>Block</em></p>
<h3 id="å¦‚æœæ²¡æœ‰Block"><a href="#å¦‚æœæ²¡æœ‰Block" class="headerlink" title="å¦‚æœæ²¡æœ‰Block"></a>å¦‚æœæ²¡æœ‰<em>Block</em></h3><p>å› ä¸º<em>Block</em>å’Œå‡½æ•°ç±»ä¼¼,ç”¨å‡½æ•°æ¥å®ç°å›è°ƒåŠŸèƒ½,åŒæ—¶å› ä¸º<em>OC</em>æ˜¯é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€,ä¸ºäº†èƒ½ä¸å…¶ä»–æ–¹æ³•äº¤äº’,æ›´è´´è¿‘ç°å®æƒ…å½¢,å†™äº†å¦‚ä¸‹ä»£ç </p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸»çº¿ç¨‹ .m å‡½æ•°å®šä¹‰</span></span><br><span class="line"><span class="type">void</span> completedFunc(<span class="built_in">NSString</span> *response) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;Hello %@&quot;</span>,response);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å‡½æ•°è°ƒç”¨</span></span><br><span class="line">SubViewController *subVC = [[SubViewController alloc] init];</span><br><span class="line">[subVC setCompletedFunc:completedFunc];</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">3</span>);</span><br><span class="line">    </span><br><span class="line">[<span class="keyword">self</span>.navigationController pushViewController:subVC animated:<span class="literal">true</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­çº¿ç¨‹.h</span></span><br><span class="line">- (<span class="type">void</span>)setCompletedFunc:(<span class="type">void</span> (<span class="built_in">NSString</span> *))r;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­çº¿ç¨‹.m</span></span><br><span class="line"><span class="comment">// æ¥æ”¶å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">copy</span>) <span class="built_in">NSString</span> *httpResponse;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) Response reponser;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)setCompletedFunc:(<span class="type">void</span> (<span class="built_in">NSString</span> *))r &#123;</span><br><span class="line">    _reponser = r;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨åˆé€‚çš„æ—¶æœºè°ƒç”¨å›è°ƒæ–¹æ³•æ¯”å¦‚viewDidLoad</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;å‘é€ç½‘ç»œè¯·æ±‚&quot;</span>);</span><br><span class="line"><span class="comment">// æ¥æ”¶ç½‘ç»œè¯·æ±‚æ•°æ®</span></span><br><span class="line">_httpResponse = <span class="string">@&quot;test,test,test&quot;</span>;</span><br><span class="line"><span class="comment">// æ‰§è¡Œå›è°ƒ</span></span><br><span class="line">_reponser(_httpResponse);</span><br></pre></td></tr></table></figure>

<p><img src="https://ooo.0o0.ooo/2017/03/03/58b8f38b167ec.jpg"></p>
<p>å¦‚æœç”¨<em>Block</em>æ–¹å¼æ”¹å†™,å¯ä»¥å°†å‡½æ•°çš„å®šä¹‰ä¸å‡½æ•°å‚æ•°çš„ä¼ é€’ç»“åˆåœ¨ä¸€èµ·,å’ŒåŒ¿åå‡½æ•°å·®ä¸å¤š,å› ä¸ºä¸»çº¿ç¨‹ä¸­å¹¶ä¸å…³å¿ƒå‡½æ•°çš„åç§°,ä¸»è¦è¿˜æ˜¯å…¶ä¸­æ‰§è¡Œçš„ä»£ç ,å­çº¿ç¨‹ä¸­æ˜¯è¦å±æ€§å¼•ç”¨æ¥æ‰§è¡Œ,è¿˜æ˜¯ç›´æ¥æ‰§è¡Œ,é‚£æ˜¯å­çº¿ç¨‹éœ€è¦è€ƒè™‘çš„äº‹æƒ…ã€‚è€Œ<em>httpResponse</em>æ˜¯å­çº¿ç¨‹ä¸­çš„å˜é‡,è¢«ä¼ é€’åˆ°ä¸»çº¿ç¨‹çš„å‡½æ•°ä¸­è¿›è¡Œæ‰§è¡Œäº†ã€‚å› æ­¤<em>Block</em>å’Œé€šçŸ¥,ä»£ç†ç­‰ä¸€æ ·éƒ½å…·æœ‰ä¼ é€’æ•°æ®çš„èƒ½åŠ›ã€‚</p>
<blockquote>
<p>è¿™é‡Œæ‰€è¯´çš„å­çº¿ç¨‹å’Œä¸»çº¿ç¨‹åªæ˜¯ä¸ºäº†åŒºåˆ†æ–‡ä»¶,ä¸æ˜¯è¯´æœ‰ä»€ä¹ˆä¸»çº¿ç¨‹çš„*.m*ã€‚</p>
</blockquote>
<h2 id="æ€ä¹ˆå†™"><a href="#æ€ä¹ˆå†™" class="headerlink" title="æ€ä¹ˆå†™"></a>æ€ä¹ˆå†™</h2><p><img src="https://ooo.0o0.ooo/2017/03/03/58b8f38bceb74.jpg"></p>
<ul>
<li><em>int</em>æ˜¯è¿”å›å€¼</li>
<li><em>^</em>æ˜¯å£°æ˜<em>block</em>çš„è¯­æ³•</li>
<li><em>myBlock</em>æ˜¯<em>block</em>å˜é‡çš„åç§°,å®ƒçš„å€¼ä¸º*{return num * multiplier;}*</li>
<li><em>int num</em>æ˜¯å‚æ•°å</li>
<li><em>{return num * multiplier;}<em>æ˜¯</em>block</em>çš„å†…å®¹</li>
</ul>
<p><em>Xcode</em>çš„<em>block</em>ä»£ç å—æç¤ºä¸º:<em>inlineBlock</em></p>
<h3 id="ä½œå±æ€§"><a href="#ä½œå±æ€§" class="headerlink" title="ä½œå±æ€§"></a>ä½œå±æ€§</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">copy</span>) <span class="type">void</span> (^responser)(<span class="built_in">NSString</span> *res);</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè§‰å¾—ä¸å¥½çœ‹,å¯ä»¥<em>typedef</em>å®šä¹‰ä¸€ä¸ªåˆ«åç±»å‹</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">void</span> (^Responser)(<span class="built_in">NSString</span> *);</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">copy</span>) Responser req;</span><br></pre></td></tr></table></figure>

<h3 id="ä½œå‚æ•°"><a href="#ä½œå‚æ•°" class="headerlink" title="ä½œå‚æ•°"></a>ä½œå‚æ•°</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)setReq:(<span class="type">void</span> (^)(<span class="built_in">NSString</span> *))req &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)setReq:(Responser)req &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä½œè¿”å›å€¼"><a href="#ä½œè¿”å›å€¼" class="headerlink" title="ä½œè¿”å›å€¼"></a>ä½œè¿”å›å€¼</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span> (^)(<span class="built_in">NSString</span> *))req &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (Responser)req &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Blockçš„ç±»å‹"><a href="#Blockçš„ç±»å‹" class="headerlink" title="Blockçš„ç±»å‹"></a>Blockçš„ç±»å‹</h2><blockquote>
<p>å±æ€§:æ˜¯<em>OC</em>çš„ä¸€é¡¹ç‰¹æ€§,ç”¨äºå°è£…å¯¹è±¡ä¸­çš„æ•°æ®ã€‚</p>
</blockquote>
<ul>
<li>åŸå­æ€§([<em>no</em>]<em>atomatic</em>)</li>
<li>è¯»å†™æƒé™(<em>readwrite/readonly</em>)</li>
<li>å†…å­˜ç®¡ç†è¯­ä¹‰(<em>retain,copy,assign,weak,strong,unsafe_unretained</em>)</li>
<li>æ–¹æ³•å(<em>getter,setter</em>)</li>
</ul>
<p><strong>strong</strong>:ä¸ºè¯¥ç§å±æ€§è®¾ç½®æ–°å€¼æ—¶,è®¾ç½®æ–¹æ³•ä¼šå…ˆä¿ç•™æ–°å€¼å¹¶é‡Šæ”¾æ—§å€¼,ç„¶åå†å°†æ–°å€¼è®¾ç½®ä¸Šå»<br><strong>copy</strong>:ä¸strongç±»ä¼¼,ä½†æ˜¯ä¸ä¿ç•™æ–°å€¼,è€Œæ˜¯å°†å…¶â€æ‹·è´â€ã€‚å½“å±æ€§ç±»å‹ä¸º<em>NSString</em>æ—¶,å¸¸ç”¨è¯¥ç‰¹è´¨æ¥ä¿æŠ¤å…¶å°è£…æ€§</p>
<p>è¯¦æƒ…å¯ä»¥å‚è€ƒä¹¦ç±<em>Effective Objective C 2.0</em> ç¬¬äºŒç« ç¬¬<em>6</em>æ¡</p>
<p>é€šè¿‡<a target="_blank" rel="noopener" href="http://blog.parse.com/2013/02/05/objective-c-blocks-quiz/">è¿™å„¿</a>çš„<em>5</em>é“é¢˜å¯çŸ¥</p>
<p><em>Block</em>å¯æ ¹æ®å­˜å‚¨çš„åŒºåŸŸåˆ†ä¸º3ç§ç±»å‹:<em>NSGlobalBlock</em>,<em>NSStackBlock</em>,<em>NSMallocBlock</em></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">void</span> (^dBlock)();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MRCViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">copy</span>) dBlock dB;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MRCViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="variable language_">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    dBlock b = ^&#123;</span><br><span class="line">        printf(<span class="string">&quot;666&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;b=%@&quot;</span>,b);</span><br><span class="line">    <span class="type">char</span> d = <span class="string">&#x27;D&#x27;</span>;</span><br><span class="line">    printf(<span class="string">&quot;dçš„addr:%p\n&quot;</span>, &amp;d);</span><br><span class="line">    dBlock b2 = ^&#123;</span><br><span class="line">        printf(<span class="string">&quot;dçš„addr:%p\n&quot;</span>, &amp;d);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;b2=%@&quot;</span>,b2);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.dB = b2;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;b2=%@&quot;</span>,b2);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;dB=%@&quot;</span>,<span class="keyword">self</span>.dB);</span><br><span class="line">    <span class="keyword">self</span>.dB();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MRCç¯å¢ƒä¸‹</span></span><br><span class="line">    dBlock dB2 = [[b2 <span class="keyword">copy</span>] autorelease];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;dB2=%@&quot;</span>,dB2);</span><br><span class="line">    dB2();</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœä¸º</p>
<p><em>MRC</em><br><img src="https://ooo.0o0.ooo/2017/03/03/58b8f38bcdcc1.jpg"></p>
<p><em>ARC</em><br><img src="https://ooo.0o0.ooo/2017/03/03/58b8f38b95d45.jpg"></p>
<p>ç›®å‰ç»“è®º:<br>ã€€ã€€ä¸ç»‘å®šå˜é‡æ—¶,<em>MRC</em>å’Œ<em>ARC</em>ç¯å¢ƒä¸‹éƒ½æ˜¯*<strong>NSGlobalBlock</strong><em>ç±»å‹ã€‚<br>ã€€ã€€ç»‘å®šéå¯¹è±¡å˜é‡çš„æƒ…å†µä¸‹,è¢«ç»‘å®šçš„å˜é‡éƒ½æ˜¯ä¼ å€¼çš„,åœ¨</em>MRC<em>ç¯å¢ƒä¸‹,åˆ›å»º</em>Block<em>é»˜è®¤ä¼šå­˜å‚¨åœ¨æ ˆä¸­,å³ä¸º</em><strong>NSStackBlock</strong><em>ç±»å‹,ç”Ÿå‘½å‘¨æœŸä¸ºå‡½æ•°æˆ–æ–¹æ³•ä½“å†…æœ‰æ•ˆ,å½“ä½¿ç”¨</em>copy<em>ä¿®é¥°çš„å±æ€§å¯¹å…¶è¿›è¡Œå¼•ç”¨æˆ–å¯¹</em>Block<em>è°ƒç”¨</em>copy + autorelease<em>æ—¶,å°†ä¼šæ‹·è´ä¸€ä¸ªæ–°çš„</em>Block<em>åˆ°å †ä¸­,å³ä¸º</em><strong>NSMallocBlock</strong><em>ç±»å‹,ç”Ÿå‘½å‘¨æœŸå°†ä¼šè¢«å»¶é•¿ã€‚åœ¨</em>ARC<em>ç¯å¢ƒä¸‹,~~åˆ›å»º</em>Block<em>é»˜è®¤å­˜å‚¨åœ¨å †ä¸­,å³ä¸º</em>NSMallocBlock<em>ç±»å‹~~,å½“ä½¿ç”¨</em>copy*ä¿®é¥°çš„å±æ€§å¯¹å…¶æ¥æ”¶æ—¶,å› ä¸ºå†…å­˜åœ°å€æ²¡å˜,æ‰€ä»¥åªè¿›è¡Œäº†æµ…æ‹·è´ã€‚</p>
<p><img src="https://ooo.0o0.ooo/2017/03/03/58b8f38b93d05.jpg"></p>
<p>ä½†æ˜¯,æ ¹æ®<a target="_blank" rel="noopener" href="http://blog.devtang.com/2013/07/28/a-look-inside-blocks/">è°ˆObjective-C blockçš„å®ç°</a>ä¸­çš„è¯„è®º,åœ¨<em>ARC</em>ç¯å¢ƒä¸‹ç…§ç€æ“ä½œå,è¾“å‡ºç¡®å®å¦‚æ­¤ã€‚å› æ­¤åˆè¿›è¡Œäº†ä»¥ä¸‹çš„ä»£ç æµ‹è¯•</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">id</span> arr;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>, ^()&#123;<span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>, arr); &#125;);</span><br><span class="line">    </span><br><span class="line"><span class="comment">// å¦‚æœç»‘å®šçš„ä¸æ˜¯å¯¹è±¡ä¼šæœ‰å½±å“å—?</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>,^&#123;printf(<span class="string">&quot;dçš„addr:%p\n&quot;</span>, &amp;d);&#125;);</span><br><span class="line">    </span><br><span class="line">dBlock b3 = <span class="literal">nil</span>;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>,b3 = ^&#123;printf(<span class="string">&quot;dçš„addr:%p\n&quot;</span>, &amp;d);&#125;);</span><br><span class="line">b3();</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœ:<br><img src="https://ooo.0o0.ooo/2017/03/03/58b8f38bce8aa.jpg"></p>
<p>ä¸è®º<em>Block</em>ç»‘å®šçš„æ˜¯å¯¹è±¡è¿˜æ˜¯éå¯¹è±¡æ•°æ®ç±»å‹,ç»“æœéƒ½æ˜¯ä¸€æ ·çš„,ç›´æ¥è¾“å‡ºéƒ½æ˜¯*<strong>NSStackBlock</strong><em>ç±»å‹çš„,ä½†æ˜¯å½“è¿›è¡Œèµ‹å€¼æ“ä½œå,åœ¨ä¸Šé¢çš„æƒ…å†µä¸‹,ç”¨</em>b3<em>å»æ¥æ”¶</em>Block<em>ç±»å‹æ—¶,<em>ARC</em>å‘ç°è¿™ä¸ª</em>Block<em>çš„ç”Ÿå‘½å‘¨æœŸå˜äº†,åœ¨è¾“å‡ºå,ä¾ç„¶åº”è¯¥å­˜åœ¨,æ‰€ä»¥å¯¹å…¶è¿›è¡Œæ‹·è´ä¸€ä»½åˆ°å †ä¸­,å› æ­¤</em>b3<em>ç±»å‹å˜ä¸º</em><strong>NSMallocBlock</strong>*ã€‚</p>
<p>é€šè¿‡<em>b3</em>æ‰§è¡Œè¾“å‡ºçš„åœ°å€,ä¹Ÿä¸æ˜¯åŸæ¥çš„åœ°å€äº†,å› ä¸ºéå¯¹è±¡æ•°æ®ç±»å‹æ˜¯ä¼ å€¼çš„,é‚£ä¹ˆå¦‚æœæ¢æˆå¯¹è±¡,ä¼šæœ‰ä¸åŒå—?å†åˆ†åˆ«å†™äº†å¦‚ä¸‹æµ‹è¯•ä»£ç :</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *d2 = <span class="string">@&quot;123&quot;</span>;</span><br><span class="line">printf(<span class="string">&quot;d2çš„addr%p\n&quot;</span>,d2);</span><br><span class="line">dBlock b4 = ^ &#123;</span><br><span class="line">   printf(<span class="string">&quot;d2çš„addr:%p\n&quot;</span>, d2);</span><br><span class="line">&#125;;</span><br><span class="line">b4();</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;b4=%@&quot;</span>,b4);</span><br><span class="line"><span class="keyword">self</span>.dB = b4;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;dB=%@&quot;</span>,<span class="keyword">self</span>.dB);</span><br></pre></td></tr></table></figure>

<p><em>MRC</em>ç¯å¢ƒä¸‹è¾“å‡º</p>
<p><img src="https://ooo.0o0.ooo/2017/03/03/58b8f38b6b761.jpg"></p>
<p><em>ARC</em>ç¯å¢ƒä¸‹è¾“å‡º<br><img src="https://ooo.0o0.ooo/2017/03/03/58b8f38bce373.jpg"></p>
<p>å¯ä»¥å¾—åˆ°ç»“æœ,å¯¹äºå¯¹è±¡çš„ç»‘å®šåœ¨<em>MRC</em>å’Œ<em>ARC</em>éƒ½åªæ˜¯è¿›è¡Œäº†æµ…æ‹·è´</p>
<p>ç°åœ¨ç»‘å®šçš„æ˜¯å±€éƒ¨å˜é‡,å¦‚æœæ˜¯å¯¹è±¡çš„å±æ€§,ä¼šæœ‰å˜åŒ–å—?</p>
<p>è¿›è¡Œå¦‚ä¸‹ä»£ç æµ‹è¯•:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) <span class="built_in">NSArray</span> *dBTestArr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">self</span>.dBTestArr = @[<span class="string">@&quot;456&quot;</span>];</span><br><span class="line">printf(<span class="string">&quot;dBTestArr:%p&quot;</span>,<span class="keyword">self</span>.dBTestArr);</span><br><span class="line">dBlock b5 = ^ &#123;</span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@&quot;dBTestArr:%p&quot;</span>,<span class="keyword">self</span>.dBTestArr);</span><br><span class="line">&#125;;</span><br><span class="line">b5();</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;b5=%@&quot;</span>,b5);</span><br></pre></td></tr></table></figure>

<p><em>MRC</em>ç¯å¢ƒè¾“å‡º</p>
<p><img src="https://ooo.0o0.ooo/2017/03/03/58b8f38c00445.jpg"></p>
<p><em>ARC</em>ç¯å¢ƒè¾“å‡º<br><img src="https://ooo.0o0.ooo/2017/03/03/58b8f391c3b7c.jpg"></p>
<p>åŒæ ·ä¹Ÿæ˜¯å¯¹å˜é‡è¿›è¡Œæµ…æ‹·è´ã€‚</p>
<p>å¦‚æœæ˜¯é™æ€å˜é‡å‘¢,ä¼šæœ‰å˜åŒ–å—?</p>
<p>ä»£ç </p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="built_in">NSArray</span> *dBTestArr2;</span><br><span class="line"></span><br><span class="line">dBTestArr2 = @[<span class="string">@&quot;789&quot;</span>];</span><br><span class="line">printf(<span class="string">&quot;dBTestArr2:%p\n&quot;</span>,dBTestArr2);</span><br><span class="line">dBlock b6 = ^ &#123;</span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@&quot;dBTestArr2:%p&quot;</span>,dBTestArr2);</span><br><span class="line">&#125;;</span><br><span class="line">b6();</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;b6=%@&quot;</span>,b6);</span><br></pre></td></tr></table></figure>

<p><em>MRC</em>ç¯å¢ƒè¾“å‡º</p>
<p><img src="https://ooo.0o0.ooo/2017/03/03/58b8f38c04d34.jpg"></p>
<p><em>ARC</em>ç¯å¢ƒè¾“å‡º<br><img src="https://ooo.0o0.ooo/2017/03/03/58b8f39206373.jpg"></p>
<p>å˜é‡æ˜¯æµ…æ‹·è´çš„,åŒæ—¶<em>Block</em>ç»Ÿä¸€éƒ½æ˜¯*<strong>NSGlobalBlock</strong>*,è¿™ä¹Ÿå¾ˆå¥½ç†è§£,å› ä¸ºé™æ€å˜é‡åœ¨å†…å­˜ä¸­æ˜¯åˆ†é…åœ¨å…¨å±€åŒºçš„ã€‚</p>
<p><em>OC</em>æ²¡æœ‰ç±»å±æ€§,ä½†æ˜¯æœ‰å…³è”å±æ€§,å¦‚æœå…³è”åˆ°ç±»å¯¹è±¡ä¸Š,ç”¨<em>Block</em>è¿›è¡Œç»‘å®š,ä¼šæ€ä¹ˆæ ·å‘¢?</p>
<p>ä»£ç </p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="string">&lt;objc/message.h&gt;</span></span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="type">char</span> *dBTest3 = <span class="string">&quot;dbTest3&quot;</span>; <span class="comment">// static const char *dBTest4 = &quot;dbTest4&quot;;</span></span><br><span class="line">objc_setAssociatedObject([<span class="keyword">self</span> <span class="keyword">class</span>], dBTest3, @[<span class="string">@&quot;0&quot;</span>], OBJC_ASSOCIATION_RETAIN);</span><br><span class="line">printf(<span class="string">&quot;dBTest3:%p\n&quot;</span>,objc_getAssociatedObject([<span class="keyword">self</span> <span class="keyword">class</span>], dBTest3));</span><br><span class="line">dBlock b7 = ^ &#123;</span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@&quot;dBTest3:%p&quot;</span>,objc_getAssociatedObject([<span class="keyword">self</span> <span class="keyword">class</span>], dBTest3));</span><br><span class="line">&#125;;</span><br><span class="line">b7();</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;b7=%@&quot;</span>,b7);</span><br></pre></td></tr></table></figure>

<p><em>MRC</em>ç¯å¢ƒ</p>
<p><img src="https://ooo.0o0.ooo/2017/03/03/58b8f391aebc8.jpg"></p>
<p><em>ARC</em>ç¯å¢ƒ</p>
<p><img src="https://ooo.0o0.ooo/2017/03/03/58b8f391c8bf4.jpg"></p>
<p>åŒæ ·ä¹Ÿæ˜¯å¯¹å˜é‡æµ…æ‹·è´,<em>MRC</em>ä¸‹æ˜¯*<strong>NSStackBlock</strong><em>,<em>ARC</em>ä¸‹æ˜¯</em><strong>NSMallocBlock</strong>*</p>
<p>æ€»ç»“ä¸€ä¸‹,å¤§æ¦‚å¦‚ä¸‹è¡¨:</p>
<table>
<thead>
<tr>
<th align="center">ç»‘å®šå˜é‡ç±»å‹</th>
<th align="center"><em>MRC</em></th>
<th align="center"><em>ARC</em></th>
</tr>
</thead>
<tbody><tr>
<td align="center">ä¸ç»‘å®š</td>
<td align="center"><em><strong>NSGlobalBlock</strong></em></td>
<td align="center"><em><strong>NSGlobalBlock</strong></em></td>
</tr>
<tr>
<td align="center">å±€éƒ¨å˜é‡</td>
<td align="center"><em><strong>NSStackBlock</strong></em>,<em>copy</em>å±æ€§èµ‹å€¼ä¿®é¥°æ‹·è´ä¸€ä¸ª*<strong>NSMallocBlock</strong>*å¯¹è±¡,éå¯¹è±¡ä¼ å€¼,å¯¹è±¡ä¼ å€</td>
<td align="center"><em><strong>NSStackBlock</strong></em>,èµ‹å€¼åæ‹·è´ä¸€ä¸ªä¸º*<strong>NSMallocBlock</strong>*å¯¹è±¡,éå¯¹è±¡ä¼ å€¼,å¯¹è±¡ä¼ å€</td>
</tr>
<tr>
<td align="center">å±æ€§</td>
<td align="center"><em><strong>NSStackBlock</strong></em>,éå¯¹è±¡ä¼ å€¼,å¯¹è±¡ä¼ å€</td>
<td align="center"><em><strong>NSStackBlock</strong></em>,èµ‹å€¼åæ‹·è´ä¸€ä¸ªä¸º*<strong>NSMallocBlock</strong>*å¯¹è±¡,éå¯¹è±¡ä¼ å€¼,å¯¹è±¡ä¼ å€</td>
</tr>
<tr>
<td align="center">é™æ€å˜é‡</td>
<td align="center"><em><strong>NSGlobalBlock</strong></em>,å˜é‡åœ°å€</td>
<td align="center"><em><strong>NSGlobalBlock</strong></em>,å˜é‡åœ°å€</td>
</tr>
<tr>
<td align="center">å…³è”å¯¹è±¡</td>
<td align="center"><em><strong>NSStackBlock</strong></em>,å¯¹è±¡ä¼ å€</td>
<td align="center"><em><strong>NSMallocBlock</strong></em>,å¯¹è±¡ä¼ å€</td>
</tr>
</tbody></table>
<p>åˆ°è¿™é‡Œ,å…ˆåœä¸€ä¸‹,è¯´æ˜ä¸¤ä¸ªé—®é¢˜</p>
<blockquote>
<p>åœ¨5é“ç»ƒä¹ é¢˜ä¸­çš„<em>Example B</em>æœ‰</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> exampleB_addBlockToArray(<span class="built_in">NSMutableArray</span> *array) &#123;</span><br><span class="line">  <span class="type">char</span> b = <span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">  [array addObject:^&#123;</span><br><span class="line">    printf(<span class="string">&quot;%cn&quot;</span>, b);</span><br><span class="line">  &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> exampleB() &#123;</span><br><span class="line">  <span class="built_in">NSMutableArray</span> *array = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">  exampleB_addBlockToArray(array);</span><br><span class="line">  <span class="type">void</span> (^block)() = [array objectAtIndex:<span class="number">0</span>];</span><br><span class="line">  block();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>èƒ½æŠŠ<em>Block</em>æ·»åŠ åˆ°æ•°ç»„ä¸­,é‚£ä¹ˆ<em>Block</em>åº”è¯¥æ˜¯ä¸€ä¸ªå¯¹è±¡å§ã€‚</p>
<p>åœ¨<a target="_blank" rel="noopener" href="https://github.com/JaviSoto/iOS10-Runtime-Headers/">JaviSoto/iOS10-Runtime-Headers</a>å·¥ç¨‹ä¸­,æŸ¥æ‰¾å‘ç°<em>Block</em>å¯¹è±¡çš„ç»§æ‰¿å…³ç³»ä¸º</p>
<p><em><strong>NSStackBlock</strong></em>  =&gt; <em>__NSStackBlock</em>  =&gt; <em>NSBlock</em> =&gt; <em>NSObject</em><br><em><strong>NSGlobalBlock</strong></em> =&gt; <em>__NSGlobalBlock</em> =&gt; <em>NSBlock</em> =&gt; <em>NSObject</em><br><em><strong>NSMallocBlock</strong></em> =&gt; <em>__NSMallocBlock</em> =&gt; <em>NSBlock</em> =&gt; <em>NSObject</em></p>
<p>å¯çŸ¥OCä¸­çš„<em>Block</em>ç¡®å®æ˜¯ä¸€ä¸ªå¯¹è±¡</p>
<blockquote>
<p>è¿˜æœ‰ä¸€ä¸ªå°é—®é¢˜å°±æ˜¯å­˜åœ¨çš„åˆ°åº•æ˜¯<em>NSConcreteGlobalBlock</em>,<em>NSConcreteStackBlock</em>,è¿˜æ˜¯*<strong>NSMallocBlock</strong>*è¿™ç§ç±»å‹çš„?</p>
</blockquote>
<p><img src="https://ooo.0o0.ooo/2017/03/03/58b8f391b92e6.jpg"><br>åœ¨13å¹´å‘è¡¨çš„,çŒœæµ‹å¯èƒ½è‹¹æœå¯¹<em>Block</em>åº”è¯¥è¿›è¡Œä¿®æ”¹äº†,åˆæ ¹æ®<a target="_blank" rel="noopener" href="https://clang.llvm.org/docs/Block-ABI-Apple.html">clang-do</a></p>
<p><img src="https://ooo.0o0.ooo/2017/03/03/58b8f391d4e14.jpg"></p>
<p>åˆè§‰å¾—åå‘äº<em>NSConcreteGlobalBlock</em>,æˆ‘æš‚æ—¶è®¤ä¸ºåœ¨åº•å±‚å®é™…ä¸Šæ˜¯<em>NSConcreteGlobalBlock</em>è¿™ç§çš„,ç„¶ååœ¨<em>OC</em>ä¸Šè¡¨ç°ä¸º*<strong>NSMallocBlock</strong>*</p>
<h2 id="Block"><a href="#Block" class="headerlink" title="__Block"></a>__Block</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *d2 = <span class="string">@&quot;123&quot;</span>;</span><br><span class="line">printf(<span class="string">&quot;d2çš„addr%p\n&quot;</span>,d2);</span><br><span class="line">dBlock b4 = ^ &#123;</span><br><span class="line">   printf(<span class="string">&quot;d2çš„addr:%p\n&quot;</span>, d2);</span><br><span class="line">   d2 = <span class="string">@&quot;777&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç å°†ä¼šæŠ¥<em>Variable is not assignable (missing __block type specifier)</em></p>
<blockquote>
<p>ä¸ºä»€ä¹ˆå‘¢?</p>
</blockquote>
<p>åŒæ ·æ ¹æ®<a target="_blank" rel="noopener" href="https://clang.llvm.org/docs/Block-ABI-Apple.html">clang-doc</a>,é‡Œé¢æœ‰è¿™æ ·çš„è¯´æ˜</p>
<p><img src="https://ooo.0o0.ooo/2017/03/03/58b8f391ddc1d.jpg"></p>
<p>å› ä¸ºå¦‚æœå˜é‡ä¸ç”¨*__block<em>ä¿®é¥°,é‚£ä¹ˆé»˜è®¤åœ¨æ‹·è´æ—¶,ä¼šæ·»åŠ </em>const*è¿›è¡Œä¿®é¥°</p>
<h2 id="Blockçš„å¾ªç¯å¼•ç”¨"><a href="#Blockçš„å¾ªç¯å¼•ç”¨" class="headerlink" title="Blockçš„å¾ªç¯å¼•ç”¨"></a>Blockçš„å¾ªç¯å¼•ç”¨</h2><h3 id="æ›´æ–°-170402"><a href="#æ›´æ–°-170402" class="headerlink" title="æ›´æ–°: 170402"></a>æ›´æ–°: 170402</h3><p>åœ¨ <a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s/f1VB0-go0WDUil2zmPVJfA">5ä¸ªåŠ¨ç”»,ç†è§£å¸¸ç”¨åƒåœ¾å›æ”¶ç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹</a> ä¸­æœ‰è¿™æ ·ä¸€æ®µè¯</p>
<blockquote>
<p>å¼•ç”¨è®¡æ•°ç®—æ³•å­˜åœ¨å¾ˆå¤šé—®é¢˜ã€‚æœ€å¤§çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå®ƒæ— æ³•è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚è¿™ç§æƒ…å†µå¾ˆå¸¸è§ï¼Œ<strong>çˆ¶å¯¹è±¡å’Œåå‘å¼•ç”¨ä¼šå½¢æˆå¼•ç”¨ç¯</strong>ã€‚</p>
</blockquote>
<hr>
<h3 id="åŸæ¥çš„"><a href="#åŸæ¥çš„" class="headerlink" title="åŸæ¥çš„"></a>åŸæ¥çš„</h3><p>å…ˆæ„é€ ä¸€ä¸ªç®€å•çš„å¾ªç¯å¼•ç”¨</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">copy</span>) dBlock dBCycle;</span><br><span class="line"><span class="keyword">self</span>.dBCycle = ^ &#123;</span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>,<span class="keyword">self</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ã€€ã€€æ­£å¸¸æƒ…å†µä¸‹,<em>self</em>æ˜¯<em>VC</em>,è¢«å¯¼èˆªæ§åˆ¶å™¨çš„<em>viewControllers</em>å±æ€§æŒæœ‰,è€Œ<em>self</em>æŒæœ‰<em>dBCycle</em>è¿™ä¸ª<em>Block</em>å±æ€§,å½“<em>pop</em>æ§åˆ¶å™¨å,<em>self</em>çš„å¼•ç”¨è®¡æ•°ä¸º0,è¢«é‡Šæ”¾,ç„¶å<em>dBCycle</em>è®¡æ•°ä¹Ÿä¸º0,ä¹Ÿèƒ½è¢«é¡ºåˆ©é‡Šæ”¾<br>ã€€ã€€<br><img src="https://ooo.0o0.ooo/2017/03/03/58b8f391e86d4.jpg"></p>
<p>åœ¨ä¸Šé¢çš„å¾ªç¯å¼•ç”¨ä»£ç ä¸­,å½“<em>pop</em>æ§åˆ¶å™¨å,<em>self</em>è¢«<em>dBCycle</em>å±æ€§æŒæœ‰,æ‰€ä»¥ä¸èƒ½è¢«å›æ”¶,<em>dBCycle</em>æŒ‡å‘çš„<em>Block</em>çš„å†…å­˜åœ°å€,åœ¨æ‰§è¡Œå®Œ<em>Block</em>å,å› ä¸ºå®ƒçš„å¼•ç”¨è®¡æ•°è¿˜æ˜¯è‡³å°‘ä¸º<em>1</em>(<em>self</em>æŒæœ‰),æ‰€ä»¥ä¹Ÿä¸ä¼šè¢«é‡Šæ”¾,æœ‰ç‚¹ç±»ä¼¼æ­»é”çš„æ¦‚å¿µ,åŒæ–¹äº’ç›¸ä¾èµ–å¯¹è±¡ã€‚<em>dealloc</em>æ–¹æ³•ä¸ä¼šè¢«è°ƒç”¨ã€‚</p>
<p>çŸ¥é“åŸç†ä¹‹å,å…³æ³¨ä¸€ä¸‹<em>AFNetworking</em>ä¸­çš„<em>success</em>å›è°ƒ<em>Block</em></p>
<p>è¿›å…¥</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">NSURLSessionDataTask</span> *)GET:(<span class="built_in">NSString</span> *)URLString</span><br><span class="line">                   parameters:(<span class="keyword">nullable</span> <span class="type">id</span>)parameters</span><br><span class="line">                      success:(<span class="keyword">nullable</span> <span class="type">void</span> (^)(<span class="built_in">NSURLSessionDataTask</span> *task, <span class="type">id</span> _Nullable responseObject))success</span><br><span class="line">                      failure:(<span class="keyword">nullable</span> <span class="type">void</span> (^)(<span class="built_in">NSURLSessionDataTask</span> * _Nullable task, <span class="built_in">NSError</span> *error))failure DEPRECATED_ATTRIBUTE;</span><br></pre></td></tr></table></figure>

<p>å†è¿›å…¥</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSURLSessionDataTask</span> *)GET:(<span class="built_in">NSString</span> *)URLString</span><br><span class="line">                   parameters:(<span class="type">id</span>)parameters</span><br><span class="line">                     progress:(<span class="type">void</span> (^)(<span class="built_in">NSProgress</span> * _Nonnull))downloadProgress</span><br><span class="line">                      success:(<span class="type">void</span> (^)(<span class="built_in">NSURLSessionDataTask</span> * _Nonnull, <span class="type">id</span> _Nullable))success</span><br><span class="line">                      failure:(<span class="type">void</span> (^)(<span class="built_in">NSURLSessionDataTask</span> * _Nullable, <span class="built_in">NSError</span> * _Nonnull))failure</span><br></pre></td></tr></table></figure>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSURLSessionDataTask</span> *)dataTaskWithHTTPMethod:(<span class="built_in">NSString</span> *)method</span><br><span class="line">                                       URLString:(<span class="built_in">NSString</span> *)URLString</span><br><span class="line">                                      parameters:(<span class="type">id</span>)parameters</span><br><span class="line">                                  uploadProgress:(<span class="keyword">nullable</span> <span class="type">void</span> (^)(<span class="built_in">NSProgress</span> *uploadProgress)) uploadProgress</span><br><span class="line">                                downloadProgress:(<span class="keyword">nullable</span> <span class="type">void</span> (^)(<span class="built_in">NSProgress</span> *downloadProgress)) downloadProgress</span><br><span class="line">                                         success:(<span class="type">void</span> (^)(<span class="built_in">NSURLSessionDataTask</span> *, <span class="type">id</span>))success</span><br><span class="line">                                         failure:(<span class="type">void</span> (^)(<span class="built_in">NSURLSessionDataTask</span> *, <span class="built_in">NSError</span> *))failure</span><br></pre></td></tr></table></figure>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">dataTask = [<span class="keyword">self</span> dataTaskWithRequest:request</span><br><span class="line">                          uploadProgress:uploadProgress</span><br><span class="line">                        downloadProgress:downloadProgress</span><br><span class="line">                       completionHandler:^(<span class="built_in">NSURLResponse</span> * __unused response, <span class="type">id</span> responseObject, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">        <span class="keyword">if</span> (error) &#123;</span><br><span class="line">            <span class="keyword">if</span> (failure) &#123;</span><br><span class="line">                failure(dataTask, error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (success) &#123;</span><br><span class="line">                success(dataTask, responseObject);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br></pre></td></tr></table></figure>

<p><em>success</em>å›è°ƒçš„<em>Block</em>ä½œå‚æ•°ä¼ é€’åˆ°<em>completionHander</em>ä¸­</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSURLSessionDataTask</span> *)dataTaskWithRequest:(<span class="built_in">NSURLRequest</span> *)request</span><br><span class="line">                               uploadProgress:(<span class="keyword">nullable</span> <span class="type">void</span> (^)(<span class="built_in">NSProgress</span> *uploadProgress)) uploadProgressBlock</span><br><span class="line">                             downloadProgress:(<span class="keyword">nullable</span> <span class="type">void</span> (^)(<span class="built_in">NSProgress</span> *downloadProgress)) downloadProgressBlock</span><br><span class="line">                            completionHandler:(<span class="keyword">nullable</span> <span class="type">void</span> (^)(<span class="built_in">NSURLResponse</span> *response, <span class="type">id</span> _Nullable responseObject,  <span class="built_in">NSError</span> * _Nullable error))completionHandler &#123;</span><br><span class="line"></span><br><span class="line">    __block <span class="built_in">NSURLSessionDataTask</span> *dataTask = <span class="literal">nil</span>;</span><br><span class="line">    url_session_manager_create_task_safely(^&#123;</span><br><span class="line">        dataTask = [<span class="keyword">self</span>.session dataTaskWithRequest:request];</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ·»åŠ ä»£ç†å¯¹è±¡</span></span><br><span class="line">    [<span class="keyword">self</span> addDelegateForDataTask:dataTask uploadProgress:uploadProgressBlock downloadProgress:downloadProgressBlock completionHandler:completionHandler];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dataTask;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¼ é€’åˆ°</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)addDelegateForDataTask:(<span class="built_in">NSURLSessionDataTask</span> *)dataTask</span><br><span class="line">                uploadProgress:(<span class="keyword">nullable</span> <span class="type">void</span> (^)(<span class="built_in">NSProgress</span> *uploadProgress)) uploadProgressBlock</span><br><span class="line">              downloadProgress:(<span class="keyword">nullable</span> <span class="type">void</span> (^)(<span class="built_in">NSProgress</span> *downloadProgress)) downloadProgressBlock</span><br><span class="line">             completionHandler:(<span class="type">void</span> (^)(<span class="built_in">NSURLResponse</span> *response, <span class="type">id</span> responseObject, <span class="built_in">NSError</span> *error))completionHandler</span><br><span class="line">&#123;</span><br><span class="line">    AFURLSessionManagerTaskDelegate *delegate = [[AFURLSessionManagerTaskDelegate alloc] init];</span><br><span class="line">    delegate.manager = <span class="keyword">self</span>;</span><br><span class="line">    delegate.completionHandler = completionHandler;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p><em>delegate.completionHandler</em>è¿™<em>block</em>æŒæœ‰äº†æˆ‘ä»¬ä¼ é€’çš„<em>success</em>å›è°ƒçš„<em>Block</em></p>
<p><em>delegate</em>è¢«<em>self</em>(<em>AFHTTPSessionManager</em>)å¯¹è±¡çš„<em>mutableTaskDelegatesKeyedByTaskIdentifier</em>å±æ€§æŒæœ‰</p>
<p>å¤§è‡´ç†è§£å¦‚ä¸‹</p>
<p><em>AFHTTPSessionManager_Obj.mutableTaskDelegatesKeyedByTaskIdentifier.delegate.completionHandler</em> = ^ {<br>ã€€ã€€<em>succcess()</em><br>}</p>
<p>è‹¥ä½ åœ¨<em>success()<em>ä¸­ä½¿ç”¨äº†</em>VC</em>çš„<em>self</em>,å› ä¸º</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">instancetype</span>)manager &#123;</span><br><span class="line">    <span class="keyword">return</span> [[[<span class="keyword">self</span> <span class="keyword">class</span>] alloc] initWithBaseURL:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithBaseURL:(<span class="built_in">NSURL</span> *)url &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> initWithBaseURL:url sessionConfiguration:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithBaseURL:(<span class="built_in">NSURL</span> *)url</span><br><span class="line">           sessionConfiguration:(<span class="built_in">NSURLSessionConfiguration</span> *)configuration</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="variable language_">super</span> initWithSessionConfiguration:configuration];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Ensure terminal slash for baseURL path, so that NSURL +URLWithString:relativeToURL: works as expected</span></span><br><span class="line">    <span class="keyword">if</span> ([[url path] length] &gt; <span class="number">0</span> &amp;&amp; ![[url absoluteString] hasSuffix:<span class="string">@&quot;/&quot;</span>]) &#123;</span><br><span class="line">        url = [url URLByAppendingPathComponent:<span class="string">@&quot;&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">self</span>.baseURL = url;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">self</span>.requestSerializer = [AFHTTPRequestSerializer serializer];</span><br><span class="line">    <span class="keyword">self</span>.responseSerializer = [AFJSONResponseSerializer serializer];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>AFHTTPSessionManager_Obj</em>ç­‰ä»·äºå±€éƒ¨å˜é‡,å½“æ–¹æ³•æ‰§è¡Œå®Œå,å˜é‡ä¼šè¢«é‡Šæ”¾,ç´§æ¥ç€<em>Block</em>æ‰§è¡Œå®Œå,ä¼šè¢«å›æ”¶,å¯¹VCçš„<em>self</em>æŒæœ‰ä¼šè¢«é‡Šæ”¾,å½“<em>pop</em>å,<em>self</em>å¯¹è±¡ä¹Ÿä¼šè¢«é‡Šæ”¾ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Blocks/Articles/00_Introduction.html#//apple_ref/doc/uid/TP40007502">Blocks Programming Topics</a></li>
<li>Effective Objective C 2.0</li>
<li><a target="_blank" rel="noopener" href="http://blog.parse.com/2013/02/05/objective-c-blocks-quiz/">http://blog.parse.com/learn/engineering/objective-c-blocks-quiz/</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.devtang.com/2013/07/28/a-look-inside-blocks/">è°ˆObjective-C blockçš„å®ç°</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/JaviSoto/iOS10-Runtime-Headers/">JaviSoto/iOS10-Runtime-Headers</a></li>
<li><a target="_blank" rel="noopener" href="https://clang.llvm.org/docs/Block-ABI-Apple.html">clang-doc</a></li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/ObjC/" rel="tag"># ObjC</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2017/03/01/iOSer-UIView-init-and-initWithFrame-call-relationship/" rel="prev" title="iOS - UIViewçš„initä¸initWithFrame:çš„è°ƒç”¨å…³ç³»">
      <i class="fa fa-chevron-left"></i> iOS - UIViewçš„initä¸initWithFrame:çš„è°ƒç”¨å…³ç³»
    </a></div>
      <div class="post-nav-item">
    <a href="/2017/03/06/Technology-FFmpeg-study-notes-01-environmental-building/" rel="next" title="FFmpegå­¦ä¹ ç¬”è®°01(ç¯å¢ƒæ­å»º)">
      FFmpegå­¦ä¹ ç¬”è®°01(ç¯å¢ƒæ­å»º) <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">å‰è¨€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83"><span class="nav-number">2.</span> <span class="nav-text">ç¯å¢ƒ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">3.</span> <span class="nav-text">æ˜¯ä»€ä¹ˆ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8%E5%9C%A8%E5%93%AA"><span class="nav-number">4.</span> <span class="nav-text">ç”¨åœ¨å“ª</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E7%82%B9"><span class="nav-number">4.1.</span> <span class="nav-text">ä¼˜ç‚¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89Block"><span class="nav-number">4.2.</span> <span class="nav-text">å¦‚æœæ²¡æœ‰Block</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%8E%E4%B9%88%E5%86%99"><span class="nav-number">5.</span> <span class="nav-text">æ€ä¹ˆå†™</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%9C%E5%B1%9E%E6%80%A7"><span class="nav-number">5.1.</span> <span class="nav-text">ä½œå±æ€§</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%9C%E5%8F%82%E6%95%B0"><span class="nav-number">5.2.</span> <span class="nav-text">ä½œå‚æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%9C%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="nav-number">5.3.</span> <span class="nav-text">ä½œè¿”å›å€¼</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Block%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="nav-number">6.</span> <span class="nav-text">Blockçš„ç±»å‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Block"><span class="nav-number">7.</span> <span class="nav-text">__Block</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Block%E7%9A%84%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8"><span class="nav-number">8.</span> <span class="nav-text">Blockçš„å¾ªç¯å¼•ç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0-170402"><span class="nav-number">8.1.</span> <span class="nav-text">æ›´æ–°: 170402</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E6%9D%A5%E7%9A%84"><span class="nav-number">8.2.</span> <span class="nav-text">åŸæ¥çš„</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">9.</span> <span class="nav-text">å‚è€ƒ</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">å¿˜å·ä¸‰</p>
  <div class="site-description" itemprop="description">404~ ~ ~å°±å¤šèµ°ä¸€æ­¥</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">85</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">å¿˜å·ä¸‰</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
