<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/favicon.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="å‰è¨€ã€€ã€€ä»¥å‰æƒ³è·å–åº”ç”¨çš„ .ipa æ–‡ä»¶å¯ä»¥ä» iTunes ä¸‹è½½ï¼ŒmacOS ä¸Šçš„ iTunes  å‡çº§æˆ 12.7 å,æ— æ³•å†è·å¾— .ipa æ–‡ä»¶, è€ŒiOS 9 åå°±ä¸èƒ½ä» iTools ä¹‹ç±»çš„è¾…åŠ©å·¥å…·ä¸­å¯¼å‡º .ipa æ–‡ä»¶ã€‚ ã€€ã€€åé¢ Apple å®˜ç½‘åˆæä¾›äº†ä¸€ä¸ª 12.6.3 çš„é“¾æ¥ã€€ã€€ã€€ã€€å‡ºäºå¥½å¥‡å¿ƒ,æƒ³è¯•è¯•ç›´æ¥å¯¼å‡º.ipaæ–‡ä»¶,å¹¶é‡ç­¾åå®‰è£…åˆ°æœªè¶Šç‹±çš„è®¾å¤‡ä¸Šã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS - è¶Šç‹± iPhone è®¾å¤‡å¯¼å‡º ipa &amp;&amp; é‡ç­¾å">
<meta property="og:url" content="http://yoursite.com/2017/11/28/iOS-Escape-iPhone-device-export-ipa-resign/index.html">
<meta property="og:site_name" content="ğŸ‘¨ğŸ»â€ğŸ’»&#39;s åšå®¢">
<meta property="og:description" content="å‰è¨€ã€€ã€€ä»¥å‰æƒ³è·å–åº”ç”¨çš„ .ipa æ–‡ä»¶å¯ä»¥ä» iTunes ä¸‹è½½ï¼ŒmacOS ä¸Šçš„ iTunes  å‡çº§æˆ 12.7 å,æ— æ³•å†è·å¾— .ipa æ–‡ä»¶, è€ŒiOS 9 åå°±ä¸èƒ½ä» iTools ä¹‹ç±»çš„è¾…åŠ©å·¥å…·ä¸­å¯¼å‡º .ipa æ–‡ä»¶ã€‚ ã€€ã€€åé¢ Apple å®˜ç½‘åˆæä¾›äº†ä¸€ä¸ª 12.6.3 çš„é“¾æ¥ã€€ã€€ã€€ã€€å‡ºäºå¥½å¥‡å¿ƒ,æƒ³è¯•è¯•ç›´æ¥å¯¼å‡º.ipaæ–‡ä»¶,å¹¶é‡ç­¾åå®‰è£…åˆ°æœªè¶Šç‹±çš„è®¾å¤‡ä¸Šã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/11/28/5a1cd5bd1e20d.jpg">
<meta property="og:image" content="https://i.loli.net/2017/11/28/5a1cd5bd4fa59.png">
<meta property="article:published_time" content="2017-11-28T03:15:45.000Z">
<meta property="article:modified_time" content="2025-04-26T14:35:33.676Z">
<meta property="article:author" content="å¿˜å·ä¸‰">
<meta property="article:tag" content="Reverse">
<meta property="article:tag" content="Mechanism">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ooo.0o0.ooo/2017/11/28/5a1cd5bd1e20d.jpg">

<link rel="canonical" href="http://yoursite.com/2017/11/28/iOS-Escape-iPhone-device-export-ipa-resign/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>iOS - è¶Šç‹± iPhone è®¾å¤‡å¯¼å‡º ipa && é‡ç­¾å | ğŸ‘¨ğŸ»â€ğŸ’»'s åšå®¢</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">ğŸ‘¨ğŸ»â€ğŸ’»'s åšå®¢</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">æ…¢å“äººé—´çƒŸç«è‰²ï¼Œé—²è§‚ä¸‡äº‹å²æœˆé•¿</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/28/iOS-Escape-iPhone-device-export-ipa-resign/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="å¿˜å·ä¸‰">
      <meta itemprop="description" content="404~ ~ ~å°±å¤šèµ°ä¸€æ­¥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸ‘¨ğŸ»â€ğŸ’»'s åšå®¢">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          iOS - è¶Šç‹± iPhone è®¾å¤‡å¯¼å‡º ipa && é‡ç­¾å
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-11-28 11:15:45" itemprop="dateCreated datePublished" datetime="2017-11-28T11:15:45+08:00">2017-11-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-04-26 22:35:33" itemprop="dateModified" datetime="2025-04-26T22:35:33+08:00">2025-04-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ã€€ã€€ä»¥å‰æƒ³è·å–åº”ç”¨çš„ <code>.ipa</code> æ–‡ä»¶å¯ä»¥ä» <code>iTunes</code> ä¸‹è½½ï¼Œ<code>macOS</code> ä¸Šçš„ <code>iTunes</code>  å‡çº§æˆ <code>12.7</code> å,æ— æ³•å†è·å¾— <code>.ipa</code> æ–‡ä»¶, è€Œ<code>iOS 9</code> åå°±ä¸èƒ½ä» <code>iTools</code> ä¹‹ç±»çš„è¾…åŠ©å·¥å…·ä¸­å¯¼å‡º <code>.ipa</code> æ–‡ä»¶ã€‚</p>
<p>ã€€ã€€åé¢ <code>Apple</code> å®˜ç½‘åˆæä¾›äº†ä¸€ä¸ª <a target="_blank" rel="noopener" href="https://support.apple.com/en-us/HT208079">12.6.3 çš„é“¾æ¥</a><br>ã€€ã€€<br>ã€€ã€€å‡ºäºå¥½å¥‡å¿ƒ,æƒ³è¯•è¯•ç›´æ¥å¯¼å‡º<code>.ipa</code>æ–‡ä»¶,å¹¶é‡ç­¾åå®‰è£…åˆ°æœªè¶Šç‹±çš„è®¾å¤‡ä¸Šã€‚</p>
<span id="more"></span>

<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><blockquote>
<p>macOS Sierra 10.12.6<br>iPhone 6 Plus (11.0)<br>Xcode Version 9.0 (9A235)<br>iPhone 5s(9.3.3 å·²è¶Šç‹±)</p>
</blockquote>
<h2 id="è¶Šç‹±è®¾å¤‡ä¸­å¯¼å‡º-ipa"><a href="#è¶Šç‹±è®¾å¤‡ä¸­å¯¼å‡º-ipa" class="headerlink" title="è¶Šç‹±è®¾å¤‡ä¸­å¯¼å‡º .ipa"></a>è¶Šç‹±è®¾å¤‡ä¸­å¯¼å‡º <code>.ipa</code></h2><p><code>SSH</code> åˆ°è¶Šç‹±è®¾å¤‡,ä½¿ç”¨<a target="_blank" rel="noopener" href="http://www.cycript.org/">Cycript</a> æ‰¾åˆ°<code>xxx.app</code> çš„ä½ç½®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iPhone:~ root# ps -ef | grep WeChat</span><br><span class="line">  501   714     1   0   0:00.00 ??         0:29.04 /var/containers/Bundle/Application/41A6836F-CFC9-4DC1-8A9C-ED4DE09F9A66/WeChat.app/WeChat</span><br><span class="line">    0   807   805   0   0:00.00 ttys001    0:00.01 grep WeChat</span><br></pre></td></tr></table></figure>

<p>æ‰¾åˆ°åä½¿ç”¨ <code>tar</code> å°† <code>xxx.app</code> æ‰“åŒ…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">iPhone:~ root# <span class="built_in">cd</span> /var/containers/Bundle/Application/41A6836F-CFC9-4DC1-8A9C-ED4DE09F9A66/</span><br><span class="line">iPhone:/var/containers/Bundle/Application/41A6836F-CFC9-4DC1-8A9C-ED4DE09F9A66 root# <span class="built_in">ls</span></span><br><span class="line">WeChat.app  iTunesArtwork  iTunesMetadata.plist</span><br><span class="line">iPhone:/var/containers/Bundle/Application/41A6836F-CFC9-4DC1-8A9C-ED4DE09F9A66 root# tar -cvf /tmp/WeChat.tar ./</span><br><span class="line">./</span><br><span class="line">./.com.apple.mobile_container_manager.metadata.plist</span><br><span class="line">./WeChat.app/</span><br><span class="line">./WeChat.app/AppIcon60x60@2x.png</span><br><span class="line">...</span><br><span class="line">./WeChat.app/zh_TW.lproj/network_setting.html</span><br><span class="line">./iTunesArtwork</span><br><span class="line">./iTunesMetadata.plist</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>scp</code> å‘é€æ‰“åŒ…æ–‡ä»¶åˆ° <code>mac</code> ä¸Š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">âœ  ~ scp root@192.168.199.132:/tmp/WeChat.tar ~/Desktop/WeChat.tar</span><br><span class="line">root@192.168.199.132<span class="string">&#x27;s password:</span></span><br><span class="line"><span class="string">WeChat.tar                                                        100%   97MB   1.7MB/s   00:58</span></span><br></pre></td></tr></table></figure>

<p>é‡ç­¾åè¦æ±‚å¯æ‰§è¡Œæ–‡ä»¶è¦å…ˆè„±å£³</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">// è·å¾—æ²™ç›’åœ°å€</span><br><span class="line">iPhone:~ root# cycript -p WeChat</span><br><span class="line">cy# [[NSFileManager defaultManager] URLsForDirectory:NSDocumentDirectory inDomains:NSUserDomainMask][0]</span><br><span class="line"><span class="comment">#&quot;file://s&quot;</span></span><br><span class="line">cy# <span class="built_in">exit</span>(0)</span><br><span class="line"></span><br><span class="line">// è·å¾—åº”ç”¨åœ°å€</span><br><span class="line">iPhone:~ root# ps -ef | grep WeChat</span><br><span class="line">  501   714     1   0   0:00.00 ??         0:03.25 /var/containers/Bundle/Application/41A6836F-CFC9-4DC1-8A9C-ED4DE09F9A66/WeChat.app/WeChat</span><br><span class="line">    0   717   699   0   0:00.00 ttys000    0:00.01 grep WeChat</span><br><span class="line"></span><br><span class="line">// DYLD_INSERT_LIBRARIES=dumpdecrypted.dylib path/to/App</span><br><span class="line">iPhone:/var/mobile/Containers/Data/Application/E7DE74DA-2FC9-4A86-A4D7-F993A88AB225/Documents root# su mobile</span><br><span class="line">iPhone:~/Containers/Data/Application/E7DE74DA-2FC9-4A86-A4D7-F993A88AB225/Documents mobile$ DYLD_INSERT_LIBRARIES=dumpdecrypted.dylib /var/containers/Bundle/Application/41A6836F-CFC9-4DC1-8A9C-ED4DE09F9A66/WeChat.app/WeChat</span><br><span class="line">mach-o decryption dumper</span><br><span class="line"></span><br><span class="line">DISCLAIMER: This tool is only meant <span class="keyword">for</span> security research purposes, not <span class="keyword">for</span> application crackers.</span><br><span class="line"></span><br><span class="line">[+] detected 64bit ARM binary <span class="keyword">in</span> memory.</span><br><span class="line">[+] offset to cryptid found: @0x100028ca8(from 0x100028000) = ca8</span><br><span class="line">[+] Found encrypted data at address 00004000 of length 56131584 bytes - <span class="built_in">type</span> 1.</span><br><span class="line">[+] Opening /private/var/containers/Bundle/Application/41A6836F-CFC9-4DC1-8A9C-ED4DE09F9A66/WeChat.app/WeChat <span class="keyword">for</span> reading.</span><br><span class="line">[+] Reading header</span><br><span class="line">[+] Detecting header <span class="built_in">type</span></span><br><span class="line">[+] Executable is a plain MACH-O image</span><br><span class="line">[+] Opening WeChat.decrypted <span class="keyword">for</span> writing.</span><br><span class="line">[+] Copying the not encrypted start of the file</span><br><span class="line">[+] Dumping the decrypted data into the file</span><br><span class="line">[+] Copying the not encrypted remainder of the file</span><br><span class="line">[+] Setting the LC_ENCRYPTION_INFO-&gt;cryptid to 0 at offset ca8</span><br><span class="line">[+] Closing original file</span><br><span class="line">[+] Closing dump file</span><br></pre></td></tr></table></figure>

<p>åŸç‰ˆçš„ <a target="_blank" rel="noopener" href="https://github.com/stefanesser/dumpdecrypted">dumpdecrypted</a> æ— æ³•åº”å¯¹æœ‰ <code>Frameworks</code> çš„æƒ…å†µ,ä¸è¿‡æœ‰ä¸€ä¸ªåˆ†æ”¯ç‰ˆæœ¬<a target="_blank" rel="noopener" href="https://github.com/conradev/dumpdecrypted">dumpdecrypted</a> æä¾›äº†è§£å†³çš„æ–¹æ³•,ä½†æ˜¯è¿˜æœ‰<code>Plugins</code>,å¹¸è€Œè¿˜æœ‰ä¸€ä¸ªåˆ†æ”¯æä¾›äº†ä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/CarinaTT/dumpdecrypted">dumpdecryptd</a> å¯¹ <code>.extension</code> æ–‡ä»¶è¿›è¡Œè„±å£³(<code>today</code>é‚£ç§å°æ’ä»¶,ç”¨è¿™ä¸ªç‰ˆæœ¬è„±å£³å°è¯•ä¸æˆåŠŸ,æ‰¾äº†XXåŠ©æ‰‹å»ä¸‹è½½è„±å£³çš„éƒ¨åˆ†),è¯¦æƒ…å¯å‚è€ƒ<a target="_blank" rel="noopener" href="https://nianxi.net/ios/dump-decrypted-ios-app-extensions.html">App Extensionçš„è„±å£³åŠæ³•</a>ã€‚éƒ½èƒ½æ”¯æŒçš„ç‰ˆæœ¬ä¹Ÿå·²ç»æœ‰äº†<a target="_blank" rel="noopener" href="https://github.com/AloneMonkey/dumpdecrypted">dumpdecrypted</a></p>
<h3 id="åˆ†æ”¯"><a href="#åˆ†æ”¯" class="headerlink" title="åˆ†æ”¯"></a>åˆ†æ”¯</h3><p>å¯¹ <code>dumpdecrypted</code> æœ‰äº›éƒ¨åˆ†çš„ä»£ç ä¸ç†è§£</p>
<ul>
<li>åŸç‰ˆçš„ <code>dumptofile</code> çš„å‡½æ•°å‚æ•°æ˜¯æ€ä¹ˆæ¥çš„? </li>
<li><code>Frameworks</code>åˆ†æ”¯ç‰ˆæœ¬åšäº†ä»€ä¹ˆ?</li>
<li><code>extension</code> åˆ†æ”¯ç‰ˆæœ¬åšäº†ä»€ä¹ˆ?</li>
</ul>
<p>åœ¨è¿™ä¸ª<code>dumpdecrypted</code>çš„<code>Frameworks</code> åˆ†æ”¯ç‰ˆæœ¬ä¸­</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__attribute__((constructor))</span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">dumpexecutable</span><span class="params">()</span> &#123;</span><br><span class="line">		...</span><br><span class="line">		_dyld_register_func_for_add_image(&amp;image_added);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="attribute-constructor"><a href="#attribute-constructor" class="headerlink" title="__attribute__((constructor))"></a><code>__attribute__((constructor))</code></h4><p>æ ¹æ® <a target="_blank" rel="noopener" href="http://www.jianshu.com/p/dd425b9dc9db"><strong>attribute</strong>((constructor))ç”¨æ³•è§£æ</a>,å¾—åˆ°çš„<a target="_blank" rel="noopener" href="https://gcc.gnu.org/onlinedocs/gcc-6.2.0/gcc/Common-Function-Attributes.html#Common-Function-Attributes">GNUçš„æ–‡æ¡£</a> å¯çŸ¥ <code>dumpexecutable()</code> æ–¹æ³•åœ¨ <code>main</code> å‡½æ•°ä¹‹å‰æ‰§è¡Œ</p>
<h4 id="dyld-register-func-for-add-image"><a href="#dyld-register-func-for-add-image" class="headerlink" title="_dyld_register_func_for_add_image"></a><code>_dyld_register_func_for_add_image</code></h4><p>æ‰¾äº† <code>github</code> ä¸Šçš„ <a target="_blank" rel="noopener" href="https://github.com/opensource-apple/dyld">dyld</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * _dyld_register_func_for_add_image registers the specified function to be</span></span><br><span class="line"><span class="comment"> * called when a new image is added (a bundle or a dynamic shared library) to</span></span><br><span class="line"><span class="comment"> * the program.  When this function is first registered it is called for once</span></span><br><span class="line"><span class="comment"> * for each image that is currently part of the program.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span></span><br><span class="line">_dyld_register_func_for_add_image(</span><br><span class="line"><span class="type">void</span> (*func)(<span class="type">const</span> <span class="keyword">struct</span> mach_header *mh, <span class="type">intptr_t</span> vmaddr_slide))</span><br><span class="line">&#123;</span><br><span class="line">	DYLD_LOCK_THIS_BLOCK;</span><br><span class="line">	<span class="keyword">typedef</span> <span class="title function_">void</span> <span class="params">(*<span class="type">callback_t</span>)</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> mach_header *mh, <span class="type">intptr_t</span> vmaddr_slide)</span>;</span><br><span class="line">    <span class="type">static</span> <span class="title function_">void</span> <span class="params">(*p)</span><span class="params">(<span class="type">callback_t</span> func)</span> = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(p == <span class="literal">NULL</span>)</span><br><span class="line">	    _dyld_func_lookup(<span class="string">&quot;__dyld_register_func_for_add_image&quot;</span>, (<span class="type">void</span>**)&amp;p);</span><br><span class="line">	p(func);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>dyld</code> ä¼šè´Ÿè´£ä¼ é€’ <code>mh</code> å’Œ <code>intptr_t</code> å‚æ•°</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// usr/include/sys/_types/_intptr_t.h</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">__darwin_intptr_t</span>	<span class="type">intptr_t</span>;</span><br><span class="line"><span class="comment">// usr/include/arm/_types.h</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span>			<span class="type">__darwin_intptr_t</span>; </span><br></pre></td></tr></table></figure>

<p>å› æ­¤ <code>intptr_t</code> å°±æ˜¯ <code>long</code> ç±»å‹</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">image_added</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> mach_header *mh, <span class="type">intptr_t</span> slide)</span> &#123;</span><br><span class="line">	Dl_info image_info;</span><br><span class="line">	<span class="type">int</span> result = dladdr(mh, &amp;image_info);</span><br><span class="line">	dumptofile(image_info.dli_fname, mh);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨ <code>dumptofile</code> å‡½æ•°, åœ¨ <code>_dyld_register_func_for_add_image</code> å‡½æ•°çš„æ³¨é‡Šä¸­æåˆ°äº† <code>called when a new image is added (a bundle or a dynamic shared library)</code> å› æ­¤å¯ä»¥å°† <code>framework</code> ä¹Ÿä¸€èµ·å¯¼å‡ºã€‚</p>
<p>æŸ¥æ‰¾ <code>dyld</code> åå‘ç°åœ¨ <code>ImageLoader.h</code> å¤´æ–‡ä»¶ä¸­,æœ‰</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="title function_">void</span> <span class="params">(*Initializer)</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span>* argv[], <span class="type">const</span> <span class="type">char</span>* envp[], <span class="type">const</span> <span class="type">char</span>* apple[], <span class="type">const</span> ProgramVars* vars)</span>;</span><br></pre></td></tr></table></figure>

<p>åœ¨ <code>ImageLoaderMachO.cpp</code> ä¸­æœ‰å¦‚ä¸‹çš„å‡½æ•°å®ç°</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">ImageLoaderMachO::doImageInit</span><span class="params">(<span class="type">const</span> LinkContext&amp; context)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> ( fHasDashInit ) &#123;</span><br><span class="line">		<span class="type">const</span> <span class="type">uint32_t</span> cmd_count = ((macho_header*)fMachOData)-&gt;ncmds;</span><br><span class="line">		<span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">load_command</span>* <span class="title">const</span> <span class="title">cmds</span> =</span> (<span class="keyword">struct</span> load_command*)&amp;fMachOData[<span class="keyword">sizeof</span>(macho_header)];</span><br><span class="line">		<span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">load_command</span>* <span class="title">cmd</span> =</span> cmds;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">uint32_t</span> i = <span class="number">0</span>; i &lt; cmd_count; ++i) &#123;</span><br><span class="line">			<span class="keyword">switch</span> (cmd-&gt;cmd) &#123;</span><br><span class="line">				<span class="keyword">case</span> LC_ROUTINES_COMMAND:</span><br><span class="line">					Initializer func = (Initializer)(((<span class="keyword">struct</span> macho_routines_command*)cmd)-&gt;init_address + fSlide);</span><br><span class="line">					<span class="comment">// &lt;rdar://problem/8543820&amp;9228031&gt; verify initializers are in image</span></span><br><span class="line">					<span class="keyword">if</span> ( ! this-&gt;containsAddress((<span class="type">void</span>*)func) ) &#123;</span><br><span class="line">						dyld::throwf(<span class="string">&quot;initializer function %p not in mapped image for %s\n&quot;</span>, func, this-&gt;getPath());</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">if</span> ( context.verboseInit )</span><br><span class="line">						dyld::<span class="built_in">log</span>(<span class="string">&quot;dyld: calling -init function %p in %s\n&quot;</span>, func, this-&gt;getPath());</span><br><span class="line">					func(context.argc, context.argv, context.envp, context.apple, &amp;context.programVars);</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			cmd = (<span class="type">const</span> <span class="keyword">struct</span> load_command*)(((<span class="type">char</span>*)cmd)+cmd-&gt;cmdsize);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®å‡½æ•°å‘½åçŸ¥é“è¿™åº”è¯¥æ˜¯ç»™é•œåƒåšåˆå§‹åŒ–çš„,é‡Œé¢ <code>func</code> å‡½æ•°æ˜¯ <code>Initializer</code> ç±»å‹çš„,é€šè¿‡ <code>context</code> å‚æ•°è·å–ä¸Šä¸‹æ–‡ä¿¡æ¯,åŸç‰ˆçš„ <code>dumptofile</code> å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸ºä»€ä¹ˆä¼šæ˜¯ <code>(int argc, const char **argv, const char **envp, const char **apple, struct ProgramVars *pvars)</code>  åˆ°è¿™é‡Œå°±å¯çŸ¥ä¸€äºŒã€‚</p>
<p><code>.extension</code> è„±å£³çš„ <code>dumpdecrypted</code> ç‰ˆæœ¬ä¸åŸç‰ˆçš„åŒºåˆ«ä¸»è¦æ˜¯</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">strlcpy(npath, cachePath.UTF8String, <span class="keyword">sizeof</span>(npath));</span><br><span class="line">strlcat(npath, tmp, <span class="keyword">sizeof</span>(npath));</span><br><span class="line">strlcat(npath, <span class="string">&quot;.decrypted&quot;</span>, <span class="keyword">sizeof</span>(npath));</span><br><span class="line">strlcpy(buffer, npath, <span class="keyword">sizeof</span>(buffer));</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>æŒ‡æ˜å°†è„±å£³çš„åŒ…å¯¼å‡ºåˆ°åº”ç”¨æ²™ç›’çš„ <code>.../Library/Caches</code> ç›®å½•ä¸‹</p>
<p><code>/Library/MobileSubstrate/DynamicLibraries/</code> ä¸‹çš„åŠ¨æ€åº“ä¼šè¢«<a target="_blank" rel="noopener" href="http://iphonedevwiki.net/index.php/Cydia_Substrate">MobileSubstrate.dylib</a> è‡ªåŠ¨åŠ è½½ã€‚</p>
<p>åœ¨åŸç‰ˆçš„ <code>dumpdecrypted</code> æ·»åŠ ä¸€äº›è¾“å‡º,ä½¿ç”¨ <code>printf</code> æ—¶,æ®è¯´åœ¨åé¢æ·»åŠ ä¸€ä¸ª <code>\n</code> å¯ä»¥åœ¨æ—¥å¿—ä¸­çœ‹åˆ°,ä½†æ˜¯è¯•äº†ä¼¼ä¹æ²¡æ•ˆæœ,å› æ­¤ä½¿ç”¨ <code>NSLog</code> è¿›è¡Œè¾“å‡º,æ·»åŠ  </p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="string">&lt;Foundation/Foundation.h&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>åŒæ—¶ä¿®æ”¹ <code>Makefile</code> æ–‡ä»¶, æŒ‡æ˜è¦é“¾æ¥ <code>Foundation</code> æ¡†æ¶</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-framework Foundation</span><br></pre></td></tr></table></figure>

<p><code>make</code>  &amp;&amp; <code>ldid</code> ç­¾å,å‘é€åˆ° <code>/Library/MobileSubstrate/DynamicLibraries/</code> é…ç½®å¥½å¯¹åº”çš„ <code>.plist</code> æ–‡ä»¶,å¯åŠ¨,ç„¶åé—ªé€€,æŸ¥çœ‹æ—¥å¿—</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Nov 20 09:13:29 Jasons-iPhone QQReaderUI[1237] &lt;Notice&gt;: MS:Notice: Injecting: com.tencent.qqreaderiphone [QQReaderUI] (1290.11)</span><br><span class="line">Nov 20 09:13:29 Jasons-iPhone QQReaderUI[1237] &lt;Notice&gt;: MS:Notice: Loading: /Library/MobileSubstrate/DynamicLibraries/dumpdecrypted.dylib</span><br><span class="line">Nov 20 09:13:29 Jasons-iPhone QQReaderUI[1237] &lt;Warning&gt;: [TEST]:rpath = /private/var/containers/Bundle/Application/E276C2C9-20FE-4450-915A-86EBE07798AC/QQReaderUI.app/QQReaderUI</span><br><span class="line">Nov 20 09:13:29 Jasons-iPhone QQReaderUI[1237] &lt;Warning&gt;: [TEST]:fd = 4</span><br><span class="line">Nov 20 09:13:29 Jasons-iPhone QQReaderUI[1237] &lt;Warning&gt;: [TEST]:npath = QQReaderUI</span><br><span class="line">Nov 20 09:13:29 Jasons-iPhone QQReaderUI[1237] &lt;Warning&gt;: [TEST]:npath = QQReaderUI.decrypted</span><br><span class="line">Nov 20 09:13:29 Jasons-iPhone QQReaderUI[1237] &lt;Warning&gt;: [TEST]:outfd = -1</span><br><span class="line">Nov 20 09:13:29 Jasons-iPhone QQReaderUI[1237] &lt;Warning&gt;: [TEST]:outfd = -1</span><br><span class="line">Nov 20 09:13:29 Jasons-iPhone com.apple.xpc.launchd[1] (UIKitApplication:com.tencent.qqreaderiphone[0xc2a3][1237]) &lt;Warning&gt;: Service exited with abnormal code: 1</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ä¸ª <code>outfd = -1</code> </p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">outfd = open(npath, O_RDWR|O_CREAT|O_TRUNC, <span class="number">0644</span>);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;[TEST]:outfd = %d\n&quot;</span>,outfd);</span><br></pre></td></tr></table></figure>
<p>å°è¯•åœ¨å½“å‰ç›®å½•ä¸‹(<code>/Library/MobileSubstrate/DynamicLibraries/</code>),æ‰“å¼€(åˆ›å»º)ä¸€ä¸ª <code>QQReaderUI.decrypted</code>,å› ä¸ºæƒé™çš„é—®é¢˜å¤±è´¥äº†ã€‚</p>
<p>ç¬¬äºŒä¸ª <code>outfd = -1</code></p>
<p>åé¢ <code>dumpdecrypted.dylib</code> è¿˜ä¼šåˆ¤æ–­æ˜¯ä¸æ˜¯åœ¨<code>/private/var/mobile/Applications</code>(é€šè¿‡AppStoreå’ŒiTuneså®‰è£…çš„ç¨‹åºéƒ½åœ¨é‡Œé¢ã€‚),ä½†æ˜¾ç„¶ä¸æ˜¯,å› æ­¤ä¹Ÿå¤±è´¥äº†</p>
<p>è°ƒç”¨ <code>_exit(1)</code> é—ªé€€</p>
<p>æ‰¾åˆ°ä¸€ä¸ªæ¯”è¾ƒå…·ä½“çš„<a target="_blank" rel="noopener" href="http://www.iosre.com/t/dumpdecrypted/465">è§£é‡Š</a>,æ’ç‰ˆä¸å¤ªå¥½â€¦</p>
<h3 id="å›åˆ°æ­£é¢˜"><a href="#å›åˆ°æ­£é¢˜" class="headerlink" title="å›åˆ°æ­£é¢˜"></a>å›åˆ°æ­£é¢˜</h3><p>å°†è„±å£³åçš„å¯æ‰§è¡Œæ–‡ä»¶åŒæ ·çš„å‘é€åˆ° <code>mac</code> ä¸Š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">âœ  ~ scp root@192.168.199.132:/var/mobile/Containers/Data/Application/E7DE74DA-2FC9-4A86-A4D7-F993A88AB225/Documents/WeChat.decrypted ~/Desktop</span><br><span class="line">root@192.168.199.132<span class="string">&#x27;s password:</span></span><br><span class="line"><span class="string">WeChat.decrypted                                                   100%   68MB 444.4KB/s   02:36</span></span><br><span class="line"><span class="string">âœ  ~ cd Desktop</span></span><br><span class="line"><span class="string">âœ  Desktop file WeChat.decrypted</span></span><br><span class="line"><span class="string">WeChat.decrypted: Mach-O 64-bit executable arm64</span></span><br></pre></td></tr></table></figure>

<h3 id="å¦‚ä½•åˆ¤æ–­æ˜¯å¦å·²è„±å£³"><a href="#å¦‚ä½•åˆ¤æ–­æ˜¯å¦å·²è„±å£³" class="headerlink" title="å¦‚ä½•åˆ¤æ–­æ˜¯å¦å·²è„±å£³"></a>å¦‚ä½•åˆ¤æ–­æ˜¯å¦å·²è„±å£³</h3><p>åˆ¤æ–­äºŒè¿›åˆ¶æ˜¯å¦è¢«åŠ å¯†å¯ä»¥ä½¿ç”¨ <code>otool</code> å·¥å…·</p>
<blockquote>
<p>otool - object file displaying tool</p>
</blockquote>
<blockquote>
<p>otoolå¯ä»¥è¾“å‡ºappçš„load commandsï¼Œç„¶åé€šè¿‡æŸ¥çœ‹cryptidè¿™ä¸ªæ ‡å¿—ä½æ¥åˆ¤æ–­appæ˜¯å¦è¢«åŠ å¯†ã€‚1ä»£è¡¨åŠ å¯†äº†ï¼Œ0ä»£è¡¨è¢«è§£å¯†äº†</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// ç›´æ¥ä»æ‰‹æœºä¸­å¯¼å‡ºçš„ WeChat </span><br><span class="line">âœ  Wechat otool -l WeChat.app/WeChat | grep -B 2 crypt</span><br><span class="line">(standard input)-489-          cmd LC_ENCRYPTION_INFO</span><br><span class="line">(standard input)-490-      cmdsize 20</span><br><span class="line">(standard input):491:     cryptoff 16384</span><br><span class="line">(standard input):492:    cryptsize 46907392</span><br><span class="line">(standard input):493:      cryptid 1</span><br><span class="line"></span><br><span class="line">// è„±å£³åçš„ WeChat</span><br><span class="line">âœ  Wechat otool -l WeChat.decrypted | grep -B 2 crypt</span><br><span class="line">(standard input):1:WeChat.decrypted:</span><br><span class="line">--</span><br><span class="line">(standard input)-489-          cmd LC_ENCRYPTION_INFO</span><br><span class="line">(standard input)-490-      cmdsize 20</span><br><span class="line">(standard input):491:     cryptoff 16384</span><br><span class="line">(standard input):492:    cryptsize 46907392</span><br><span class="line">(standard input):493:      cryptid 0</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºæ‰‹æœºå¯¼å‡ºçš„åªæœ‰å½“å‰æ¶æ„çš„,è€Œè„±å£³ä¹Ÿåªé’ˆå¯¹å½“å‰è¿è¡Œçš„æ¶æ„,ç›´æ¥ä» <code>iTunes</code> ä¸‹è½½çš„ <code>.ipa</code> æ–‡ä»¶ä¸­çš„äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°å¤§çº¦æ˜¯ä»æ‰‹æœºå¯¼å‡ºçš„ä¸¤å€,å› ä¸ºå®ƒåŒ…å«äº†å…¶ä»–çš„æ¶æ„ã€‚</p>
<h2 id="äº†è§£é‡ç­¾å"><a href="#äº†è§£é‡ç­¾å" class="headerlink" title="äº†è§£é‡ç­¾å"></a>äº†è§£é‡ç­¾å</h2><p>å­¦ä¹ ä¸€èˆ¬éƒ½æ˜¯ä»æ¨¡ä»¿å¼€å§‹çš„,çœ‹çœ‹ <code>Xcode</code> æ˜¯æ€ä¹ˆç­¾åçš„,åˆ›å»ºæ–°å·¥ç¨‹,<code>âŒ˜ + B</code> ç¼–è¯‘ä¸€ä¸‹,ç„¶åæŸ¥çœ‹æ—¥å¿—</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/// ç­¾å</span><br><span class="line">CodeSign /Users/Jason/Library/Developer/Xcode/DerivedData/JustForTest-ggxnkdgkdklojofwwsifymqzfwqo/Build/Products/Debug-iphoneos/JustForTest.app</span><br><span class="line"></span><br><span class="line">/// <span class="built_in">cd</span> åˆ°å·¥ç¨‹ç›®å½•</span><br><span class="line">    <span class="built_in">cd</span> path/to/project</span><br><span class="line"></span><br><span class="line">/// æ‰©å±•ç¯å¢ƒå˜é‡</span><br><span class="line">    <span class="built_in">export</span> CODESIGN_ALLOCATE=/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/codesign_allocate</span><br><span class="line">    <span class="built_in">export</span> PATH=<span class="string">&quot;/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin:/Applications/Xcode.app/Contents/Developer/usr/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin&quot;</span></span><br><span class="line"></span><br><span class="line">/// ç­¾åçš„èº«ä»½ + æè¿°æ–‡ä»¶è¯´æ˜   </span><br><span class="line">Signing Identity:     <span class="string">&quot;iPhone Developer: å¼€å‘è€…å (å¼€å‘è€…ID)&quot;</span></span><br><span class="line">Provisioning Profile: <span class="string">&quot;iOS Team Provisioning Profile: com.coder.bk123&quot;</span></span><br><span class="line">                      (c8748c6c-9d07-41ce-8d55-ff5ca9999999)</span><br><span class="line"></span><br><span class="line">// ä½¿ç”¨ codesign æ‰§è¡Œç­¾åæ“ä½œ</span><br><span class="line">    /usr/bin/codesign --force --sign ç­¾åå€¼ --entitlements /Users/Jason/Library/Developer/Xcode/DerivedData/JustForTest-ggxnkdgkdklojofwwsifymqzfwqo/Build/Intermediates.noindex/JustForTest.build/Debug-iphoneos/JustForTest.build/JustForTest.app.xcent --timestamp=none /Users/Jason/Library/Developer/Xcode/DerivedData/JustForTest-ggxnkdgkdklojofwwsifymqzfwqo/Build/Products/Debug-iphoneos/JustForTest.app</span><br></pre></td></tr></table></figure>

<h3 id="force"><a href="#force" class="headerlink" title="--force"></a><code>--force</code></h3><p>å¼ºåˆ¶ä»£æ›¿å·²å­˜åœ¨çš„ç­¾å</p>
<h3 id="timestamp"><a href="#timestamp" class="headerlink" title="--timestamp"></a><code>--timestamp</code></h3><p>æ—¶é—´æˆ³</p>
<h3 id="sign"><a href="#sign" class="headerlink" title="--sign"></a><code>--sign</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-s, --sign identity</span><br><span class="line">        Sign the code at the path(s) given using this identity. See SIGNING IDENTI-</span><br><span class="line">        TIES below.</span><br></pre></td></tr></table></figure>

<p>è¯¦æƒ…å¯ä½¿ç”¨ <code>man codesign</code> æŸ¥çœ‹</p>
<p>æ‰“å¼€é’¥åŒ™ä¸²åº”ç”¨,æ‰¾åˆ°å¼€å‘è€…è¯ä¹¦,å› ä¸ºæˆ‘æ˜¯<code>Debug</code>çŠ¶æ€ä¸‹è¿è¡Œçš„,æ‰€ä»¥çœ‹å¼€å‘è¯ä¹¦,<code>sign</code> çš„å€¼å°±æ˜¯æŒ‡çº¹ä¸­çš„ <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/SHA-1">SHA1</a> ç­¾å,<code>20</code>ä¸ª<code>16</code>è¿›åˆ¶ æ­£å¥½æ˜¯<code>40</code>ä½</p>
<h3 id="entitlements"><a href="#entitlements" class="headerlink" title="--entitlements"></a><code>--entitlements</code></h3><p>å‚æ•°å€¼å¯¹åº”çš„ <code>xxx.app.xcent</code> æ–‡ä»¶å†…å®¹å¦‚ä¸‹ </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">plist</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//Apple//DTD PLIST 1.0//EN&quot;</span> <span class="string">&quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plist</span> <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>application-identifier<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>XXXXX.åŒ…å<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>com.apple.developer.team-identifier<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>XXXXX<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>get-task-allow<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>keychain-access-groups<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>XXXXX.åŒ…å<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plist</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ <code>XXXXX</code> æ˜¯å‘å¸ƒè¯ä¹¦ä¸­å¼€å‘è€…çš„èº«ä»½<code>ID</code> å³ <code>com.apple.developer.team-identifier</code> ä¸­çš„å­—æ®µå€¼</p>
<p>åœ¨ <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2016/401/">WWDC16 Session 401 Whatâ€™s New in Xcode App Signing</a> æœ‰å¦‚ä¸‹çš„å†…å®¹</p>
<blockquote>
<p>There are three things that you need in order to sign your apps. The first thing is a <strong>signing certificate</strong>. Signing certificates establish your identity as a developer.<br><strong>Provisioning profiles</strong> are all about your apps, and they grant permissions. And <strong>entitlements</strong> declare support for capabilities.<br>Like iCloud or Wallet. So certificates. These are issued by Apple.<br>And this is important because the device needs a trust chain back to Apple so it can install the app. And certificates come in two forms.</p>
</blockquote>
<p><code>signing certificate</code>: å¼€å‘è€…èº«ä»½æ˜¯å¦å¯ä¿¡<br><code>Provisioning profiles</code>: å“ªäº›è®¾å¤‡å¯å®‰è£…<br><code>entitlements</code>: æœ‰å“ªäº›èƒ½åŠ›,æ¯”å¦‚æ¨é€,åº”ç”¨é—´åˆ†äº«â€¦.</p>
<p>åœ¨æ–°åˆ›å»ºçš„å·¥ç¨‹ <code>Product</code> ç›®å½•ä¸‹ <code>Show in Finder</code> æ¥æŸ¥çœ‹ <code>xxx.app</code> æ–‡ä»¶,å¯ä»¥å‘ç°é‡Œé¢åŒ…å«ä¸€ä¸ª <code>embedded.mobileprovision</code>  æ–‡ä»¶,å¯ä»¥é€šè¿‡</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ  security cms -D -i embedded.mobileprovision</span><br></pre></td></tr></table></figure>

<p>ç»“æœå¦‚ä¸‹:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">plist</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//Apple//DTD PLIST 1.0//EN&quot;</span> <span class="string">&quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plist</span> <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>AppIDName<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>Resign01<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>ApplicationIdentifierPrefix<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>å‘å¸ƒæ—¶çš„å¼€å‘è€…ID<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>CreationDate<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">date</span>&gt;</span>2017-11-15T03:42:41Z<span class="tag">&lt;/<span class="name">date</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>Platform<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>iOS<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>DeveloperCertificates<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">data</span>&gt;</span>ç­¾åè¯ä¹¦<span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">data</span>&gt;</span>...<span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>Entitlements<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">key</span>&gt;</span>keychain-access-groups<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">string</span>&gt;</span>å‘å¸ƒæ—¶çš„å¼€å‘è€…ID.*<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">key</span>&gt;</span>get-task-allow<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">key</span>&gt;</span>application-identifier<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>å‘å¸ƒæ—¶çš„å¼€å‘è€…ID.com.coder.Resign01<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">key</span>&gt;</span>com.apple.developer.healthkit<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">key</span>&gt;</span>com.apple.security.application-groups<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">string</span>&gt;</span>group.com.coder.Resign01<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">key</span>&gt;</span>com.apple.developer.team-identifier<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>å‘å¸ƒæ—¶çš„å¼€å‘è€…ID<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">key</span>&gt;</span>aps-environment<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>development<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>ExpirationDate<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">date</span>&gt;</span>2018-11-15T03:42:41Z<span class="tag">&lt;/<span class="name">date</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>iOS Team Provisioning Profile: com.coder.Resign01<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>ProvisionedDevices<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>å…è®¸å®‰è£…çš„è®¾å¤‡çš„UDID<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>....<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>TeamIdentifier<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>å‘å¸ƒæ—¶çš„å¼€å‘è€…ID<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>TeamName<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>å¼€å‘è€…å<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>TimeToLive<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">integer</span>&gt;</span>365<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>UUID<span class="tag">&lt;/<span class="name">key</span>&gt;</span> &lt;-- æè¿°æ–‡ä»¶ --&gt;</span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>c8748c6c-9d07-41ce-8d55-ff5ca999999<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>Version<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">integer</span>&gt;</span>1<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plist</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ <code>Xcode</code> æ—¥å¿—çš„æè¿°æ–‡ä»¶åºåˆ—å·åœ¨ <code>~/Library/MobileDevice/Provisioning Profiles/</code> ç›®å½•æŸ¥æ‰¾,ç„¶åç”¨å¯¹æ¯”å·¥å…·è¿›è¡Œæ¯”è¾ƒ,å‘ç°ä¸¤è€…æ˜¯ç›¸åŒçš„,</p>
<p>ä»ä¸­å¯ä»¥çœ‹å‡º,å¼€å‘çš„æƒ…å†µä¸‹,ç­¾åçš„è¿‡ç¨‹ä¼šå°†æˆ‘ä»¬ä» <code>Apple</code> å¼€å‘è€…åå°ä¸‹è½½çš„æè¿°æ–‡ä»¶<code>embedded.mobileprovision</code> æ”¾åˆ°åŒ…ä¸­,ç”¨äºå®‰è£…æ—¶çš„éªŒè¯ã€‚</p>
<p>æˆ‘ä»¬åœ¨ <code>Apple</code> å¼€å‘è€…åå°ç”Ÿæˆè¯ä¹¦æ—¶è¦æ±‚ä¸Šä¼ ä¸€ä¸ª <code>.csr</code> æ–‡ä»¶,<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Certificate_signing_request">Certificate_signing_request</a></p>
<blockquote>
<p>Before creating a CSR, the applicant first generates a <strong>key pair</strong>, keeping the <strong>private key secret</strong>. The CSR contains information identifying the applicant (such as a distinguished name in the case of an X.509 certificate) which must be signed using the applicantâ€™s private key. The CSR also contains the <strong>public key</strong> chosen by the applicant. The CSR may be accompanied by other credentials or proofs of identity required by the certificate authority, and the certificate authority may contact the applicant for further information.</p>
</blockquote>
<p>åˆ›å»º <code>.csr</code> æ–‡ä»¶å‰,ä¼šç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•ç”Ÿæˆä¸€å¯¹å¯†é’¥,åˆ†åˆ«æ˜¯å…¬é’¥å’Œç§é’¥,ç§é’¥å­˜æ”¾åœ¨æœ¬åœ°,è€Œå…¬é’¥ä¸ä¸€äº›è¡¨æ˜èƒ½è‡ªèº«èº«ä»½çš„ä¿¡æ¯ä¸€èµ·ç”¨äºç”Ÿæˆ <code>.csr</code> æ–‡ä»¶ã€‚</p>
<p><code>Apple</code> å¼€å‘è€…åå°ç›¸å½“äºä¸€ä¸ª <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Certificate_authority">CA</a></p>
<blockquote>
<p>Trusted certificates can be used to create secure connections to a server via the Internet. A certificate is essential in order to circumvent a malicious party which happens to be on the route to a target server which acts as if it were the target. Such a scenario is commonly referred to as a man-in-the-middle attack. The client uses the CA certificate to authenticate the CA signature on the server certificate, as part of the authorizations before launching a secure connection. Usually, client softwareâ€”for example, browsersâ€”include a set of trusted CA certificates. This makes sense, as many users need to trust their client software. A malicious or compromised client can skip any security check and still fool its users into believing otherwise.</p>
</blockquote>
<p>å…³äºç­¾åçš„åŸç†,è¯·çœ‹ä¸‹å›¾</p>
<p><img src="https://ooo.0o0.ooo/2017/11/28/5a1cd5bd1e20d.jpg"><br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/QbILp8uGmpGlqL5eY5pABQ">æ¥è‡ª-iOS App ç­¾åçš„åŸç†</a></p>
<p>æµ‹è¯•ç¯å¢ƒä¸‹(Ad Hoc)å¦‚ä½•ä¿è¯åº”ç”¨èƒ½æ­£å¸¸è¿è¡Œ?</p>
<p><img src="https://i.loli.net/2017/11/28/5a1cd5bd4fa59.png"></p>
<p><a target="_blank" rel="noopener" href="https://developer.apple.com/library/content/documentation/IDEs/Conceptual/AppDistributionGuide/TestingYouriOSApp/TestingYouriOSApp.html">æ¥è‡ª developer.apple.com</a></p>
<p><del>è¯ä¹¦å’Œ <code>device ID</code> ä¸€èˆ¬åº”è¯¥éƒ½ä¸ä¼šæœ‰é—®é¢˜,éƒ½æ˜¯ä» <code>Apple</code> å¼€å‘è€…åå°è·å–çš„,æ‰€ä»¥ä¸»è¦å»è€ƒè™‘çš„æ˜¯ <code>bundle ID</code> å’Œ <code>entitlements</code></del></p>
<p>åé¢å®è·µå‘ç°å¯¹ <code>entitlements.plist</code> æ–‡ä»¶æ·»åŠ æƒé™,åˆ é™¤æƒé™,ä¼šå½±å“åˆ°å¯¹åº”çš„<code>embedded.mobileprovision</code>,ä½†æ˜¯ä¾ç„¶å¯ä»¥æˆåŠŸå®‰è£…å¹¶è¿è¡Œã€‚</p>
<p>çœ‹äº†æ–‡å­—çš„è¯´æ˜</p>
<blockquote>
<p>The app successfully launches if the appâ€™s bundle ID matches the App ID, the signature matches the distribution certificate, and the device is in the device list of the ad hoc provisioning profile.</p>
</blockquote>
<p>åªæåˆ°äº† <code>3</code> ç‚¹,åŒ…ååŒ¹é…,è¯ä¹¦åŒ¹é…(<code>--sign</code> å¯¹åº”çš„è¯ä¹¦ç­¾å<code>embedded.mobileprovision</code> æ–‡ä»¶ä¸­åŒ…å«çš„è¯ä¹¦),æè¿°æ–‡ä»¶çš„è®¾å¤‡åˆ—è¡¨åŒ…å«å½“å‰è®¾å¤‡</p>
<h3 id="å“ªäº›æ–‡ä»¶éœ€è¦å‚ä¸ç­¾å"><a href="#å“ªäº›æ–‡ä»¶éœ€è¦å‚ä¸ç­¾å" class="headerlink" title="å“ªäº›æ–‡ä»¶éœ€è¦å‚ä¸ç­¾å"></a>å“ªäº›æ–‡ä»¶éœ€è¦å‚ä¸ç­¾å</h3><blockquote>
<p>Nested code , æ¯”å¦‚ .a é™æ€åº“, .frameworks (å…ˆç­¾å)<br>Mach-O executables , äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶<br>Resources , èµ„æºæ–‡ä»¶ï¼Œå°±æ˜¯ CodeResources çš„éƒ¨åˆ†<br>To apply the signature, the codesign utility adds the signature directly to the executable file.</p>
</blockquote>
<p><code>.ipa</code> åŒ…é‡Œæœ‰ä¸€ä¸ª <code>_CodeSignature</code> çš„æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­æœ‰ä¸ª <code>CodeResources</code> æ–‡ä»¶</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">plist</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//Apple//DTD PLIST 1.0//EN&quot;</span> <span class="string">&quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plist</span> <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>files<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">		...</span><br><span class="line">	<span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>files2<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">		...</span><br><span class="line">	<span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>rules<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">		...</span><br><span class="line">	<span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>rules2<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">		...</span><br><span class="line">	<span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plist</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>rules å’Œ files æ˜¯ä¸ºè€ç‰ˆæœ¬å‡†å¤‡çš„ï¼Œè€Œ files2 å’Œ rules2æ˜¯ä¸ºæ–°çš„ç¬¬äºŒç‰ˆçš„ä»£ç ç­¾åå‡†å¤‡çš„ã€‚æœ€ä¸»è¦çš„åŒºåˆ«æ˜¯åœ¨æ–°ç‰ˆæœ¬ä¸­ä½ æ— æ³•å†å°†æŸäº›èµ„æºæ–‡ä»¶æ’é™¤åœ¨ä»£ç ç­¾åä¹‹å¤–ã€‚+<br>äºŒè¿›åˆ¶çš„ç­¾åä¼šè¢«æ”¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­</p>
</blockquote>
<p>å‚è€ƒçš„é‚£ç¯‡æ–‡ç« çš„é“¾æ¥æŒ‚äº†â€¦ </p>
<p><a target="_blank" rel="noopener" href="https://xiuchundao.me/post/code-resources-and-embedded-mobileprovision-included-in-ipa-file">https://xiuchundao.me/post/code-resources-and-embedded-mobileprovision-included-in-ipa-file</a></p>
<blockquote>
<p>Mach-O executables. â€¦ To apply the signature, the codesign utility adds the signature directly to the executable file. </p>
</blockquote>
<p>å¯ä»¥çŸ¥é“äºŒè¿›åˆ¶æ–‡ä»¶çš„ç­¾åç¡®å®æ˜¯ç›´æ¥åœ¨æ–‡ä»¶ä¸­çš„</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li>ç­¾åå·¥å…·: <code>codesign</code>,éœ€è¦æä¾› <strong>è¯ä¹¦çš„<code>SHA1</code>ç­¾åå€¼</strong> å’Œ <strong>entitlements.plist</strong></li>
<li><code>embedded.mobileprovision</code> å°±æ˜¯ä» <code>Apple</code> å¼€å‘è€…åå°ä¸‹è½½çš„æè¿°æ–‡ä»¶, åŒæ—¶åœ¨ç¼–è¯‘æ—¶ä¼šè¢«æ‹·è´åˆ°åŒ…ä¸­</li>
<li>é‡ç­¾åçš„åº”ç”¨è¦æˆåŠŸè¿è¡Œè¦ä¿è¯åŒ…ååŒ¹é…,è¯ä¹¦åŒ¹é…(<code>--sign</code> å¯¹åº”çš„è¯ä¹¦ç­¾å<code>embedded.mobileprovision</code> æ–‡ä»¶ä¸­åŒ…å«çš„è¯ä¹¦),æè¿°æ–‡ä»¶çš„è®¾å¤‡åˆ—è¡¨åŒ…å«å½“å‰è®¾å¤‡</li>
<li>å‚ä¸ç­¾åçš„æœ‰å†…åµŒçš„æ¡†æ¶,èµ„æºæ–‡ä»¶,äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶</li>
</ul>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/SHA-1">Wiki-SHA1</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/content/documentation/IDEs/Conceptual/AppDistributionGuide/AddingCapabilities/AddingCapabilities.html">App Distribution Guide - Adding Capabilities</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Urinx/iOSAppHook">iOSAppHook</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/content/documentation/Security/Conceptual/CodeSigningGuide/Procedures/Procedures.html">Code Signing Tasks</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/content/documentation/IDEs/Conceptual/AppDistributionGuide/MaintainingProfiles/MaintainingProfiles.html">Maintaining Identifiers, Devices, and Profiles</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/content/documentation/IDEs/Conceptual/AppDistributionGuide/Introduction/Introduction.html">AppDistributionGuide-Introduction</a></li>
<li><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/dd425b9dc9db"><strong>attribute</strong>((constructor))ç”¨æ³•è§£æ</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/43438056/how-do-you-compile-and-run-an-objective-c-file-outside-xcode">How do you compile and run an objective-c file outside Xcode?</a></li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Reverse/" rel="tag"># Reverse</a>
              <a href="/tags/Mechanism/" rel="tag"># Mechanism</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2017/09/24/Technology-router-cascade-magnified-wifi/" rel="prev" title="è·¯ç”±å™¨çº§è”æ”¾å¤§Wifiä¿¡å·">
      <i class="fa fa-chevron-left"></i> è·¯ç”±å™¨çº§è”æ”¾å¤§Wifiä¿¡å·
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/12/24/Topic-Clang-Learn-Clang-01/" rel="next" title="Clangå­¦ä¹ å†ç¨‹ æ¦‚è¿°">
      Clangå­¦ä¹ å†ç¨‹ æ¦‚è¿° <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">å‰è¨€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83"><span class="nav-number">2.</span> <span class="nav-text">ç¯å¢ƒ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B6%8A%E7%8B%B1%E8%AE%BE%E5%A4%87%E4%B8%AD%E5%AF%BC%E5%87%BA-ipa"><span class="nav-number">3.</span> <span class="nav-text">è¶Šç‹±è®¾å¤‡ä¸­å¯¼å‡º .ipa</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E6%94%AF"><span class="nav-number">3.1.</span> <span class="nav-text">åˆ†æ”¯</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#attribute-constructor"><span class="nav-number">3.1.1.</span> <span class="nav-text">__attribute__((constructor))</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dyld-register-func-for-add-image"><span class="nav-number">3.1.2.</span> <span class="nav-text">_dyld_register_func_for_add_image</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9E%E5%88%B0%E6%AD%A3%E9%A2%98"><span class="nav-number">3.2.</span> <span class="nav-text">å›åˆ°æ­£é¢˜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E5%B7%B2%E8%84%B1%E5%A3%B3"><span class="nav-number">3.3.</span> <span class="nav-text">å¦‚ä½•åˆ¤æ–­æ˜¯å¦å·²è„±å£³</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%86%E8%A7%A3%E9%87%8D%E7%AD%BE%E5%90%8D"><span class="nav-number">4.</span> <span class="nav-text">äº†è§£é‡ç­¾å</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#force"><span class="nav-number">4.1.</span> <span class="nav-text">--force</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#timestamp"><span class="nav-number">4.2.</span> <span class="nav-text">--timestamp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sign"><span class="nav-number">4.3.</span> <span class="nav-text">--sign</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#entitlements"><span class="nav-number">4.4.</span> <span class="nav-text">--entitlements</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%AA%E4%BA%9B%E6%96%87%E4%BB%B6%E9%9C%80%E8%A6%81%E5%8F%82%E4%B8%8E%E7%AD%BE%E5%90%8D"><span class="nav-number">4.5.</span> <span class="nav-text">å“ªäº›æ–‡ä»¶éœ€è¦å‚ä¸ç­¾å</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">5.</span> <span class="nav-text">æ€»ç»“</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">6.</span> <span class="nav-text">å‚è€ƒ</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">å¿˜å·ä¸‰</p>
  <div class="site-description" itemprop="description">404~ ~ ~å°±å¤šèµ°ä¸€æ­¥</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">88</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">å¿˜å·ä¸‰</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
