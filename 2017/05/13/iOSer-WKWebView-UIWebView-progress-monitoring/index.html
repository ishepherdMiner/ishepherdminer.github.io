<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/favicon.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="å¯¼è¯­ã€€ æœ¬æ–‡ç›®çš„æ˜¯å®ç°ä¸€ä¸ªç½‘ç»œè¯·æ±‚è¿›åº¦æ¡çš„åŠ¨ç”»æ•ˆæœï¼Œä¸»è¦ç»“æ„åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†  JAProgressWKWebView : ä½¿ç”¨ WKWebView çš„åœºæ™¯ JAProgressUIWebView : ä½¿ç”¨ UIWebView çš„åœºæ™¯ JAProgressView : ä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨ NSURLSession çš„åœºæ™¯  ç¯å¢ƒã€€  macOS Sierra 10.12.4Xcode 8.3.2iPh">
<meta property="og:type" content="article">
<meta property="og:title" content="WKWebView &amp; UIWebView è¿›åº¦æ¡åŠ¨ç”»">
<meta property="og:url" content="http://yoursite.com/2017/05/13/iOSer-WKWebView-UIWebView-progress-monitoring/index.html">
<meta property="og:site_name" content="ğŸ‘¨ğŸ»â€ğŸ’»&#39;s åšå®¢">
<meta property="og:description" content="å¯¼è¯­ã€€ æœ¬æ–‡ç›®çš„æ˜¯å®ç°ä¸€ä¸ªç½‘ç»œè¯·æ±‚è¿›åº¦æ¡çš„åŠ¨ç”»æ•ˆæœï¼Œä¸»è¦ç»“æ„åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†  JAProgressWKWebView : ä½¿ç”¨ WKWebView çš„åœºæ™¯ JAProgressUIWebView : ä½¿ç”¨ UIWebView çš„åœºæ™¯ JAProgressView : ä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨ NSURLSession çš„åœºæ™¯  ç¯å¢ƒã€€  macOS Sierra 10.12.4Xcode 8.3.2iPh">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/05/13/5916e500b91bb.jpg">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/05/13/5916e4f730186.jpg">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/05/13/5916e5003f081.jpg">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/05/13/5916e5c5a6442.gif">
<meta property="article:published_time" content="2017-05-13T10:48:11.000Z">
<meta property="article:modified_time" content="2025-04-26T14:07:04.034Z">
<meta property="article:author" content="å¿˜å·ä¸‰">
<meta property="article:tag" content="UI">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ooo.0o0.ooo/2017/05/13/5916e500b91bb.jpg">

<link rel="canonical" href="http://yoursite.com/2017/05/13/iOSer-WKWebView-UIWebView-progress-monitoring/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>WKWebView & UIWebView è¿›åº¦æ¡åŠ¨ç”» | ğŸ‘¨ğŸ»â€ğŸ’»'s åšå®¢</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">ğŸ‘¨ğŸ»â€ğŸ’»'s åšå®¢</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">æ…¢å“äººé—´çƒŸç«è‰²ï¼Œé—²è§‚ä¸‡äº‹å²æœˆé•¿</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/13/iOSer-WKWebView-UIWebView-progress-monitoring/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="å¿˜å·ä¸‰">
      <meta itemprop="description" content="404~ ~ ~å°±å¤šèµ°ä¸€æ­¥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸ‘¨ğŸ»â€ğŸ’»'s åšå®¢">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          WKWebView & UIWebView è¿›åº¦æ¡åŠ¨ç”»
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-05-13 18:48:11" itemprop="dateCreated datePublished" datetime="2017-05-13T18:48:11+08:00">2017-05-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-04-26 22:07:04" itemprop="dateModified" datetime="2025-04-26T22:07:04+08:00">2025-04-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="å¯¼è¯­"><a href="#å¯¼è¯­" class="headerlink" title="å¯¼è¯­"></a>å¯¼è¯­</h2><p>ã€€</p>
<p>æœ¬æ–‡ç›®çš„æ˜¯å®ç°ä¸€ä¸ªç½‘ç»œè¯·æ±‚è¿›åº¦æ¡çš„åŠ¨ç”»æ•ˆæœï¼Œä¸»è¦ç»“æ„åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†</p>
<ul>
<li><em>JAProgressWKWebView</em> : ä½¿ç”¨ <em>WKWebView</em> çš„åœºæ™¯</li>
<li><em>JAProgressUIWebView</em> : ä½¿ç”¨ <em>UIWebView</em> çš„åœºæ™¯</li>
<li><em>JAProgressView</em> : ä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨ <em>NSURLSession</em> çš„åœºæ™¯</li>
</ul>
<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>ã€€</p>
<blockquote>
<p>macOS Sierra 10.12.4<br>Xcode 8.3.2<br>iPhone 6S (10.1.1)<br>iPad Mini 2 (8.4)</p>
</blockquote>
<span id="more"></span>

<h2 id="WKWebView"><a href="#WKWebView" class="headerlink" title="WKWebView"></a>WKWebView</h2><p>ã€€</p>
<blockquote>
<p>A WKWebView object displays interactive web content, such as for an in-app browser. You can use the WKWebView class to embed web content in your app. To do so, create a WKWebView object, set it as the view, and send it a request to load web content.<br>Important<br>Starting in iOS 8.0 and OS X 10.10, use WKWebView to add web content to your app. Do not use UIWebView or WebView.</p>
</blockquote>
<p><em>WKWebView</em> æ˜¯ <em>Apple</em> åœ¨ <em>iOS 8</em> æ—¶ç”¨äºæ›¿ä»£ <em>UIWebView</em> çš„æ§ä»¶</p>
<h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>ã€€</p>
<p> <em>WKWebView</em> æ§ä»¶æä¾›äº†å¦‚ä¸‹çš„å±æ€§,ç”¨äºæè¿°å½“å‰é¡µé¢çš„åŠ è½½è¿›åº¦ï¼Œé‡‡ç”¨ <em>KVO</em> çš„æ–¹å¼ï¼Œè·å¾—è¿›åº¦å€¼å¹¶è¿›è¡Œç›¸åº”çš„æ“ä½œã€‚</p>
<p> ã€€</p>
 <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="built_in">WKWebView</span>.h</span><br><span class="line"> </span><br><span class="line"> <span class="comment">/*! @abstract An estimate of what fraction of the current navigation has been completed.</span></span><br><span class="line"><span class="comment"> @discussion This value ranges from 0.0 to 1.0 based on the total number of</span></span><br><span class="line"><span class="comment"> bytes expected to be received, including the main document and all of its</span></span><br><span class="line"><span class="comment"> potential subresources. After a navigation completes, the value remains at 1.0</span></span><br><span class="line"><span class="comment"> until a new navigation starts, at which point it is reset to 0.0.</span></span><br><span class="line"><span class="comment"> @link WKWebView @/link is key-value observing (KVO) compliant for this</span></span><br><span class="line"><span class="comment"> property.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="type">double</span> estimatedProgress;</span><br></pre></td></tr></table></figure>


<h3 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h3><p>ã€€</p>
<p>æ·»åŠ è§‚å¯Ÿè€…</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">instancetype</span>)initWithFrame:(<span class="built_in">CGRect</span>)frame configuration:(<span class="built_in">WKWebViewConfiguration</span> *)configuration &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="variable language_">super</span> initWithFrame:frame configuration:configuration]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> setup];</span><br><span class="line">        [<span class="keyword">self</span> addObserver:<span class="keyword">self</span> forKeyPath:JAkEstimatedProgress options:<span class="built_in">NSKeyValueObservingOptionNew</span> | <span class="built_in">NSKeyValueObservingOptionOld</span> context:<span class="literal">nil</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ·æ–°è¿›åº¦</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath ofObject:(<span class="type">id</span>)object change:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSKeyValueChangeKey</span>,<span class="type">id</span>&gt; *)change context:(<span class="type">void</span> *)context &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="type">double</span> newKey = [[change objectForKey:<span class="built_in">NSKeyValueChangeNewKey</span>] doubleValue];</span><br><span class="line">    [<span class="keyword">self</span>.progressBarlayer flush:newKey];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç§»é™¤è§‚å¯Ÿè€…</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)dealloc &#123;</span><br><span class="line">    <span class="keyword">@try</span> &#123;</span><br><span class="line">        [<span class="keyword">self</span> removeObserver:<span class="keyword">self</span> forKeyPath:JAkEstimatedProgress];</span><br><span class="line">    &#125; <span class="keyword">@catch</span> (<span class="built_in">NSException</span> *exception) &#123;</span><br><span class="line">        <span class="comment">// NSLog(@&quot;%@&quot;,exception);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="string">&quot;JAWKViewController.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="string">&quot;JAProgressView.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JAWKViewController</span> () &lt;<span class="title">WKNavigationDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) JAProgressWKWebView *webView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JAWKViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="variable language_">super</span> viewDidLoad];</span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> colorWithWhite:<span class="number">0.92</span> alpha:<span class="number">1.0</span>];</span><br><span class="line">    <span class="keyword">self</span>.automaticallyAdjustsScrollViewInsets = <span class="literal">false</span>;</span><br><span class="line">    <span class="built_in">WKWebViewConfiguration</span> *theConfiguration = [[<span class="built_in">WKWebViewConfiguration</span> alloc] init];</span><br><span class="line">    JAProgressWKWebView *webView = [[JAProgressWKWebView alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">64</span>, [<span class="built_in">UIScreen</span> mainScreen].bounds.size.width, [<span class="built_in">UIScreen</span> mainScreen].bounds.size.height - <span class="number">64</span>) configuration:theConfiguration];</span><br><span class="line">    webView.backgroundColor = [<span class="built_in">UIColor</span> groupTableViewBackgroundColor];</span><br><span class="line">    webView.opaque = <span class="literal">false</span>;</span><br><span class="line">    webView.navigationDelegate = <span class="keyword">self</span>;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:_webView = webView];</span><br><span class="line">    <span class="comment">// [self.navigationController.navigationBar addSubview:webView.progressView];</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)viewWillAppear:(<span class="type">BOOL</span>)animated &#123;</span><br><span class="line">    [<span class="variable language_">super</span> viewWillAppear:animated];</span><br><span class="line">    <span class="built_in">NSURL</span> *nsurl=[<span class="built_in">NSURL</span> URLWithString:<span class="keyword">self</span>.urlString];</span><br><span class="line">    <span class="built_in">NSURLRequest</span> *nsrequest=[<span class="built_in">NSURLRequest</span> requestWithURL:nsurl];</span><br><span class="line">    [_webView loadRequest:nsrequest];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)webView:(<span class="built_in">WKWebView</span> *)webView didFinishNavigation:(<span class="built_in">WKNavigation</span> *)navigation &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;åŠ è½½å®Œæˆ&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)webView:(<span class="built_in">WKWebView</span> *)webView didFailNavigation:(<span class="built_in">WKNavigation</span> *)navigation withError:(<span class="built_in">NSError</span> *)error &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;åŠ è½½å¤±è´¥&quot;</span>);</span><br><span class="line">    [_webView finish];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)didReceiveMemoryWarning &#123;</span><br><span class="line">    [<span class="variable language_">super</span> didReceiveMemoryWarning];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<h2 id="UIWebView"><a href="#UIWebView" class="headerlink" title="UIWebView"></a>UIWebView</h2><p>ã€€</p>
<blockquote>
<p>You can use the UIWebView class to embed web content in your app. To do so, create a UIWebView object, attach it to a window, and send it a request to load web content. You can also use this class to move back and forward in the history of webpages, and you can even set some web content properties programmatically.<br>Note<br>In apps that run in iOS 8 and later, use the WKWebView class instead of using UIWebView. Additionally, consider setting the WKPreferences property javaScriptEnabled to NO if you render files that are not supposed to run JavaScript.</p>
</blockquote>
<h3 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>ã€€</p>
<p>å…ˆå‰å¼€ä¸€ä¸‹è¯é¢˜ï¼Œçœ‹çœ‹é€ å¥½çš„è½®å­æ˜¯å¦‚ä½•å®ç°æ£€æµ‹ç½‘ç»œè¿›åº¦çš„ã€‚ä¸‹é¢ä»¥ <a target="_blank" rel="noopener" href="https://github.com/AFNetworking/AFNetworking">AFNetworking</a> ä¸ºä¾‹è¿›è¡Œè¯´æ˜</p>
<p>åœ¨ <em>AFN</em> ä¸­æœ‰ä¸€ä¸ª <em>UIWebView+AFNetworking.h</em> æ–‡ä»¶ï¼Œæ˜¯ä¸º <em>UIWebView</em> æ·»åŠ çš„åˆ†ç±»ï¼Œé‡Œé¢æœ‰</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)loadRequest:(<span class="built_in">NSURLRequest</span> *)request</span><br><span class="line">           progress:(<span class="built_in">NSProgress</span> * _Nullable __autoreleasing * _Nullable)progress</span><br><span class="line">            success:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> * (^)(<span class="built_in">NSHTTPURLResponse</span> *response, <span class="built_in">NSString</span> *HTML))success</span><br><span class="line">            failure:(<span class="keyword">nullable</span> <span class="type">void</span> (^)(<span class="built_in">NSError</span> *error))failure;</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆè°ƒç”¨çš„æ˜¯è°ƒç”¨äº†ä¸‹é¢çš„æ–¹æ³•</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)loadRequest:(<span class="built_in">NSURLRequest</span> *)request</span><br><span class="line">           MIMEType:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)MIMEType</span><br><span class="line">   textEncodingName:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)textEncodingName</span><br><span class="line">           progress:(<span class="built_in">NSProgress</span> * _Nullable __autoreleasing * _Nullable)progress</span><br><span class="line">            success:(<span class="keyword">nullable</span> <span class="built_in">NSData</span> * (^)(<span class="built_in">NSHTTPURLResponse</span> *response, <span class="built_in">NSData</span> *data))success</span><br><span class="line">            failure:(<span class="keyword">nullable</span> <span class="type">void</span> (^)(<span class="built_in">NSError</span> *error))failure; </span><br></pre></td></tr></table></figure>

<p>å…³æ³¨ <em>progress</em> å‚æ•°ï¼Œè¦æ±‚ä¼ é€’çš„æ˜¯ä¸€ä¸ª <em>progress</em> å¯¹è±¡çš„åœ°å€</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSURLSessionDataTask</span> *dataTask;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">self</span>.af_URLSessionTask = dataTask;</span><br><span class="line"><span class="keyword">if</span> (progress != <span class="literal">nil</span>) &#123;</span><br><span class="line">   *progress = [<span class="keyword">self</span>.sessionManager downloadProgressForTask:dataTask];</span><br><span class="line">&#125;</span><br><span class="line">[<span class="keyword">self</span>.af_URLSessionTask resume];</span><br></pre></td></tr></table></figure>

<p>é¡¾åæ€ä¹‰ <em>progress</em> ä¼šæ¥æ”¶ <em>downloadProgressForTask:</em> æ–¹æ³•çš„è¿”å›å€¼ï¼Œå³æœ¬æ¬¡è¯·æ±‚çš„è¿›åº¦</p>
<p>è¿›åˆ° <em>downloadProgressForTask:</em> æ–¹æ³•ä¸­</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSProgress</span> *)downloadProgressForTask:(<span class="built_in">NSURLSessionTask</span> *)task &#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> delegateForTask:task] downloadProgress];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹ <em>downloadProgress</em> å±æ€§åœ¨å“ªä¸ªç±»ä¸­</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AFURLSessionManagerTaskDelegate</span> : <span class="title">NSObject</span> &lt;<span class="title">NSURLSessionTaskDelegate</span>, <span class="title">NSURLSessionDataDelegate</span>, <span class="title">NSURLSessionDownloadDelegate</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSProgress</span> *downloadProgress;</span><br></pre></td></tr></table></figure>

<p>åœ¨æ–‡ä»¶ä¸­ä»¥ <em>downloadProgress</em> è¿›è¡Œæœç´¢ä¼šå‘ç°</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> mark - NSProgress Tracking</span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)setupProgressForTask:(<span class="built_in">NSURLSessionTask</span> *)task &#123;</span><br><span class="line">    __<span class="keyword">weak</span> __typeof__(task) weakTask = task;</span><br><span class="line">...    </span><br><span class="line">    [task addObserver:<span class="keyword">self</span></span><br><span class="line">           forKeyPath:<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(countOfBytesReceived))</span><br><span class="line">              options:<span class="built_in">NSKeyValueObservingOptionNew</span></span><br><span class="line">              context:<span class="literal">NULL</span>];</span><br><span class="line">              </span><br><span class="line">    [task addObserver:<span class="keyword">self</span></span><br><span class="line">         forKeyPath:<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(countOfBytesExpectedToReceive))</span><br><span class="line">              options:<span class="built_in">NSKeyValueObservingOptionNew</span></span><br><span class="line">              context:<span class="literal">NULL</span>];</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">    [<span class="keyword">self</span>.downloadProgress addObserver:<span class="keyword">self</span></span><br><span class="line">                            forKeyPath:<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(fractionCompleted))</span><br><span class="line">                               options:<span class="built_in">NSKeyValueObservingOptionNew</span></span><br><span class="line">                               context:<span class="literal">NULL</span>];</span><br><span class="line">...                               </span><br></pre></td></tr></table></figure>

<p>æ‰¾åˆ°å“åº”çš„æ–¹æ³•</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath ofObject:(<span class="type">id</span>)object change:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *,<span class="type">id</span>&gt; *)change context:(<span class="type">void</span> *)context &#123;</span><br><span class="line">    <span class="keyword">if</span> ([object isKindOfClass:[<span class="built_in">NSURLSessionTask</span> <span class="keyword">class</span>]] || [object isKindOfClass:[<span class="built_in">NSURLSessionDownloadTask</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">if</span> ([keyPath isEqualToString:<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(countOfBytesReceived))]) &#123;</span><br><span class="line">            <span class="keyword">self</span>.downloadProgress.completedUnitCount = [change[<span class="built_in">NSKeyValueChangeNewKey</span>] longLongValue];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([keyPath isEqualToString:<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(countOfBytesExpectedToReceive))]) &#123;</span><br><span class="line">            <span class="keyword">self</span>.downloadProgress.totalUnitCount = [change[<span class="built_in">NSKeyValueChangeNewKey</span>] longLongValue];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([keyPath isEqualToString:<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(countOfBytesSent))]) &#123;</span><br><span class="line">            <span class="keyword">self</span>.uploadProgress.completedUnitCount = [change[<span class="built_in">NSKeyValueChangeNewKey</span>] longLongValue];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([keyPath isEqualToString:<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(countOfBytesExpectedToSend))]) &#123;</span><br><span class="line">            <span class="keyword">self</span>.uploadProgress.totalUnitCount = [change[<span class="built_in">NSKeyValueChangeNewKey</span>] longLongValue];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>è¿›åº¦çš„è®¡ç®—æ˜¯æ ¹æ® <em>NSURLSession</em>  çš„ä¸¤ä¸ªåªè¯»çš„å±æ€§ <em>countOfBytesReceived</em> &amp; <em>countOfBytesExpectedToReceive</em> ï¼Œå‰è€…æ˜¯å·²æ¥æ”¶åˆ°çš„æ•°æ®é•¿åº¦ï¼Œåè€…æ˜¯æœŸæœ›æ¥æ”¶åˆ°çš„æ€»é•¿åº¦ï¼Œæ¥è‡ªäº <em>Http</em> å¤´ä¸­çš„ <em>Content-Length</em> å­—æ®µï¼Œé€šè¿‡æ¥æ”¶è¿™ä¸¤ä¸ªå€¼çš„å˜åŒ–å¯¹åº”å»ä¿®æ”¹ <em>NSProgress</em> ä¸­çš„ <em>completedUnitCount</em> &amp; <em>totalUnitCount</em> è¿™ä¸¤ä¸ªå€¼</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* The size of the job whose progress is being reported, and how much of it has been completed so far, respectively. For an NSProgress with a kind of NSProgressKindFile, the unit of these properties is bytes while the NSProgressFileTotalCountKey and NSProgressFileCompletedCountKey keys in the userInfo dictionary are used for the overall count of files. For any other kind of NSProgress, the unit of measurement you use does not matter as long as you are consistent. The values may be reported to the user in the localizedDescription and localizedAdditionalDescription.</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">   If the receiver NSProgress object is a &quot;leaf progress&quot; (no children), then the fractionCompleted is generally completedUnitCount / totalUnitCount. If the receiver NSProgress has children, the fractionCompleted will reflect progress made in child objects in addition to its own completedUnitCount. As children finish, the completedUnitCount of the parent will be updated.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">@property</span> int64_t totalUnitCount;</span><br><span class="line"><span class="keyword">@property</span> int64_t completedUnitCount;</span><br></pre></td></tr></table></figure>

<p><em>fractionCompleted</em> å±æ€§æ˜¯æ ¹æ® <em>completedUnitCount</em> / <em>totalUnitCount</em> å¾—åˆ°çš„ã€‚</p>
<p><del>å› æ­¤å¾ˆè‡ªç„¶çš„ä¸€ç§æ€è·¯æ˜¯å»ç›‘å¬ä¼ é€’çš„ <em>progress</em> å‚æ•°çš„ <em>fractionCompleted</em></del></p>
<p>å†æ­¤ä¹‹å‰å…ˆè®¾æ–­ç‚¹è¯æ˜ä¸‹ç¡®å®èµ°äº† <em>setupProgressForTask:</em></p>
<p><img src="https://ooo.0o0.ooo/2017/05/13/5916e500b91bb.jpg"></p>
<p><img src="https://ooo.0o0.ooo/2017/05/13/5916e4f730186.jpg"></p>
<p>åŒæ—¶å› ä¸º <em>AFURLSessionManagerTaskDelegate</em> å¹¶æ²¡æœ‰æš´éœ²ç»™å¤–éƒ¨ï¼Œä¸å»ä¿®æ”¹æ¡†æ¶æ¯”è¾ƒå¥½ <em>KVO</em> æ˜¯ä¸€å¯¹å¤šçš„ï¼Œä¹Ÿç®—æ¯”è¾ƒåˆé€‚ã€‚</p>
<p>å¯æ·»åŠ ç±»ä¼¼å¦‚ä¸‹çš„ä»£ç å¯¹ <em>progress</em> å‚æ•°çš„ <em>fractionCompleted</em> å±æ€§è¿›è¡Œè§‚å¯Ÿ</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)viewWillAppear:(<span class="type">BOOL</span>)animated &#123;</span><br><span class="line">    [<span class="variable language_">super</span> viewWillAppear:animated];</span><br><span class="line">    <span class="built_in">NSURL</span> *nsurl=[<span class="built_in">NSURL</span> URLWithString:<span class="keyword">self</span>.urlString];</span><br><span class="line">    <span class="built_in">NSURLRequest</span> *nsrequest=[<span class="built_in">NSURLRequest</span> requestWithURL:nsurl];</span><br><span class="line">    <span class="built_in">NSProgress</span> *progress = [[<span class="built_in">NSProgress</span> alloc] init];</span><br><span class="line">    [_webView loadRequest:nsrequest progress:&amp;progress success:^<span class="built_in">NSString</span> * _Nonnull(<span class="built_in">NSHTTPURLResponse</span> * _Nonnull response, <span class="built_in">NSString</span> * _Nonnull HTML) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">@&quot;&quot;</span>;</span><br><span class="line">    &#125; failure:^(<span class="built_in">NSError</span> * _Nonnull error) &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    [progress addObserver:_webView forKeyPath:<span class="string">@&quot;fractionCompleted&quot;</span> options:<span class="built_in">NSKeyValueObservingOptionNew</span> context:<span class="literal">NULL</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> mark - UIWebViewDelegate</span></span><br><span class="line">- (<span class="type">void</span>)webViewDidFinishLoad:(<span class="built_in">UIWebView</span> *)webView &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;åŠ è½½å®Œæˆ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ä¼šå‘ç° <em>_webView</em> å¯¹è±¡ä¸­çš„æ–¹æ³•</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath ofObject:(<span class="type">id</span>)object change:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSKeyValueChangeKey</span>,<span class="type">id</span>&gt; *)change context:(<span class="type">void</span> *)context &#123;</span><br><span class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        <span class="type">double</span> newKey = [[change objectForKey:<span class="built_in">NSKeyValueChangeNewKey</span>] doubleValue];        </span><br><span class="line">        [<span class="keyword">self</span>.progressBarlayer flush:newKey];</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">1</span> - newKey &lt; <span class="number">0.01</span>) &#123;</span><br><span class="line">            [<span class="keyword">self</span> finish];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¹¶æ²¡æœ‰è¢«æ‰§è¡Œï¼Œè·Ÿè¸ª <em>AFNetowrking</em></p>
<p><img src="https://ooo.0o0.ooo/2017/05/13/5916e5003f081.jpg"></p>
<p><em>progress</em> çš„ <em>fractionCompleted</em> ä¸€ç›´éƒ½ä¸º <em>0</em> å› ä¸º <em>countOfBytesExpectedToReceive</em> çš„æ€»é•¿åº¦æ˜¯ <em>-1</em> (<em>0xffffffffffffffff</em>) è¿™ä¸€ç‚¹å¯ä»¥åœ¨ <a target="_blank" rel="noopener" href="https://github.com/AFNetworking/AFNetworking/issues/1844">issues - Progress and KVO never called</a> å¾—åˆ°ä½è¯ï¼Œä¸»è¦æ˜¯å› ä¸ºè¯·æ±‚å¤´çš„ <em>Content-Length</em> å­—æ®µæœªè®¾ç½®ã€‚</p>
<p>è®¿é—® <em><a target="_blank" rel="noopener" href="https://www.baidu.com/">https://www.baidu.com</a></em></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x0000000000000b6d</span></span><br><span class="line"></span><br><span class="line"><span class="number">2925</span></span><br><span class="line"></span><br><span class="line">(lldb) po dataTask.response</span><br><span class="line">&lt;<span class="built_in">NSHTTPURLResponse</span>: <span class="number">0x174030160</span>&gt; &#123; URL: https:<span class="comment">//www.baidu.com/ &#125; &#123; status code: 200, headers &#123;</span></span><br><span class="line">    Connection = <span class="string">&quot;keep-alive&quot;</span>;</span><br><span class="line">    <span class="string">&quot;Content-Encoding&quot;</span> = gzip;</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span> = <span class="string">&quot;text/html&quot;</span>;</span><br><span class="line">    Date = <span class="string">&quot;Sat, 13 May 2017 09:14:00 GMT&quot;</span>;</span><br><span class="line">    P3p = <span class="string">&quot;CP=\&quot; OTI DSP COR IVA OUR IND COM \&quot;&quot;</span>;</span><br><span class="line">    Server = <span class="string">&quot;bfe/1.0.8.18&quot;</span>;</span><br><span class="line">    <span class="string">&quot;Set-Cookie&quot;</span> = <span class="string">&quot;BAIDUID=623A610A25264EC09CC77FECD44A7CE4:FG=1; max-age=31536000; expires=Sun, 13-May-18 09:14:00 GMT; domain=.baidu.com; path=/; version=1, H_WISE_SIDS=102431; path=/; domain=.baidu.com, BDSVRTM=9; path=/, __bsi=13135479753770821857_00_33_N_N_11_0303_C02F_N_N_Y_0; expires=Sat, 13-May-17 09:14:05 GMT; domain=www.baidu.com; path=/&quot;</span>;</span><br><span class="line">    Traceid = <span class="number">149466684009534243944441198276626132688</span>;</span><br><span class="line">    <span class="string">&quot;Transfer-Encoding&quot;</span> = Identity;</span><br><span class="line">    Vary = <span class="string">&quot;Accept-Encoding&quot;</span>;</span><br><span class="line">&#125; &#125;</span><br><span class="line"></span><br><span class="line">(lldb) po dataTask.countOfBytesExpectedToReceive</span><br><span class="line"><span class="number">2925</span></span><br><span class="line"></span><br><span class="line">(lldb) </span><br></pre></td></tr></table></figure>

<p>è®¿é—® <em><a target="_blank" rel="noopener" href="https://www.bing.com/">https://www.bing.com</a></em></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0xffffffffffffffff</span></span><br><span class="line"></span><br><span class="line"><span class="number">-1</span></span><br><span class="line"></span><br><span class="line">(lldb) po dataTask.response</span><br><span class="line">&lt;<span class="built_in">NSHTTPURLResponse</span>: <span class="number">0x17022c6c0</span>&gt; &#123; URL: https:<span class="comment">//www.bing.com/ &#125; &#123; status code: 200, headers &#123;</span></span><br><span class="line">    <span class="string">&quot;Cache-Control&quot;</span> = <span class="string">&quot;private, max-age=0&quot;</span>;</span><br><span class="line">    <span class="string">&quot;Content-Encoding&quot;</span> = gzip;</span><br><span class="line">    <span class="string">&quot;Content-Length&quot;</span> = <span class="number">32317</span>;</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span> = <span class="string">&quot;text/html; charset=utf-8&quot;</span>;</span><br><span class="line">    Date = <span class="string">&quot;Sat, 13 May 2017 09:16:11 GMT&quot;</span>;</span><br><span class="line">    P3P = <span class="string">&quot;CP=\&quot;NON UNI COM NAV STA LOC CURa DEVa PSAa PSDa OUR IND\&quot;&quot;</span>;</span><br><span class="line">    Server = <span class="string">&quot;Microsoft-IIS/10.0&quot;</span>;</span><br><span class="line">    <span class="string">&quot;Set-Cookie&quot;</span> = <span class="string">&quot;_SS=SID=3C3C051FE4516B5A18710F9EE5F06A6F; domain=.bing.com; path=/, _EDGE_S=SID=3C3C051FE4516B5A18710F9EE5F06A6F; path=/; httponly; domain=bing.com&quot;</span>;</span><br><span class="line">    Vary = <span class="string">&quot;Accept-Encoding&quot;</span>;</span><br><span class="line">    <span class="string">&quot;X-MSEdge-Ref&quot;</span> = <span class="string">&quot;Ref A: 0505C24953B941CA96CF74FAE726B298 Ref B: BJ1EDGE0322 Ref C: Sat May 13 02:16:11 2017 PST&quot;</span>;</span><br><span class="line">&#125; &#125;</span><br><span class="line"></span><br><span class="line">(lldb) po dataTask.countOfBytesExpectedToReceive</span><br><span class="line"><span class="number">-1</span></span><br><span class="line"></span><br><span class="line">(lldb) </span><br></pre></td></tr></table></figure>

<p>è®¿é—® <em><a target="_blank" rel="noopener" href="https://www.google.com/">https://www.google.com</a></em></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0xffffffffffffffff</span></span><br><span class="line"></span><br><span class="line"><span class="number">-1</span></span><br><span class="line"></span><br><span class="line">(lldb) po dataTask.response</span><br><span class="line">&lt;<span class="built_in">NSHTTPURLResponse</span>: <span class="number">0x170033180</span>&gt; &#123; URL: https:<span class="comment">//www.google.com/ &#125; &#123; status code: 200, headers &#123;</span></span><br><span class="line">    <span class="string">&quot;Alt-Svc&quot;</span> = <span class="string">&quot;quic=\&quot;:443\&quot;; ma=2592000; v=\&quot;37,36,35\&quot;&quot;</span>;</span><br><span class="line">    <span class="string">&quot;Cache-Control&quot;</span> = private;</span><br><span class="line">    <span class="string">&quot;Content-Encoding&quot;</span> = gzip;</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span> = <span class="string">&quot;text/html; charset=Big5&quot;</span>;</span><br><span class="line">    Date = <span class="string">&quot;Sat, 13 May 2017 09:24:46 GMT&quot;</span>;</span><br><span class="line">    Expires = <span class="string">&quot;Sat, 13 May 2017 09:24:46 GMT&quot;</span>;</span><br><span class="line">    P3P = <span class="string">&quot;CP=\&quot;This is not a P3P policy! See https://www.google.com/support/accounts/answer/151657?hl=en for more info.\&quot;&quot;</span>;</span><br><span class="line">    Server = gws;</span><br><span class="line">    <span class="string">&quot;Set-Cookie&quot;</span> = <span class="string">&quot;NID=103=adCbLI6_cKax8zD5WTTC6Xq-Vviron4fGJDZeVf1OEiQhvSD9L3Q53n8HrmZS8--BUJIIAbR_cb5UwweP0nvyOKD0J4tbOLf6tr-p_Vva5mnAiYyWKKzsOhqtc9SjBhW; expires=Sun, 12-Nov-2017 09:24:46 GMT; path=/; domain=.google.com; HttpOnly&quot;</span>;</span><br><span class="line">    <span class="string">&quot;Transfer-Encoding&quot;</span> = Identity;</span><br><span class="line">    <span class="string">&quot;X-Frame-Options&quot;</span> = SAMEORIGIN;</span><br><span class="line">    <span class="string">&quot;X-XSS-Protection&quot;</span> = <span class="string">&quot;1; mode=block&quot;</span>;</span><br><span class="line">&#125; &#125;</span><br><span class="line"></span><br><span class="line">(lldb) po dataTask.countOfBytesExpectedToReceive</span><br><span class="line"><span class="number">-1</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒæ¬¡</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x0000000000002ae7</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- Hook <span class="number">1</span> (expr -- <span class="keyword">@import</span> <span class="built_in">UIKit</span>)</span><br><span class="line"></span><br><span class="line">- Hook <span class="number">2</span> ( target stop-hook disable)</span><br><span class="line"><span class="number">10983</span></span><br><span class="line"></span><br><span class="line">(lldb) po dataTask.response</span><br><span class="line">&lt;<span class="built_in">NSHTTPURLResponse</span>: <span class="number">0x17003cd60</span>&gt; &#123; URL: https:<span class="comment">//www.google.com/ &#125; &#123; status code: 200, headers &#123;</span></span><br><span class="line">    <span class="string">&quot;Alt-Svc&quot;</span> = <span class="string">&quot;quic=\&quot;:443\&quot;; ma=2592000; v=\&quot;37,36,35\&quot;&quot;</span>;</span><br><span class="line">    <span class="string">&quot;Cache-Control&quot;</span> = private;</span><br><span class="line">    <span class="string">&quot;Content-Encoding&quot;</span> = gzip;</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span> = <span class="string">&quot;text/html; charset=Big5&quot;</span>;</span><br><span class="line">    Date = <span class="string">&quot;Sat, 13 May 2017 10:09:01 GMT&quot;</span>;</span><br><span class="line">    Expires = <span class="string">&quot;Sat, 13 May 2017 10:09:01 GMT&quot;</span>;</span><br><span class="line">    P3P = <span class="string">&quot;CP=\&quot;This is not a P3P policy! See https://www.google.com/support/accounts/answer/151657?hl=en for more info.\&quot;&quot;</span>;</span><br><span class="line">    Server = gws;</span><br><span class="line">    <span class="string">&quot;Set-Cookie&quot;</span> = <span class="string">&quot;NID=103=f7RScaRo91vaPuGoStsjYJrDLUSANq6fwzBypLCvMeUasdsx443kwCfnzioj167ke0Buh6c6qVsA_xiT8olCjCvOtOd4P9drblpB5PkDMGiWg0J6qJnBuhoeFQIREDVT; expires=Sun, 12-Nov-2017 10:09:01 GMT; path=/; domain=.google.com; HttpOnly&quot;</span>;</span><br><span class="line">    <span class="string">&quot;Transfer-Encoding&quot;</span> = Identity;</span><br><span class="line">    <span class="string">&quot;X-Frame-Options&quot;</span> = SAMEORIGIN;</span><br><span class="line">    <span class="string">&quot;X-XSS-Protection&quot;</span> = <span class="string">&quot;1; mode=block&quot;</span>;</span><br><span class="line">&#125; &#125;</span><br><span class="line"></span><br><span class="line">(lldb) po dataTask.countOfBytesExpectedToReceive</span><br><span class="line"><span class="number">10983</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="center">åç§°</th>
<th align="center"><em>Content-Length</em></th>
<th align="center"><em>countOfBytesExpectedToReceive</em></th>
</tr>
</thead>
<tbody><tr>
<td align="center"><em><a target="_blank" rel="noopener" href="https://www.baidu.com/">https://www.baidu.com</a></em></td>
<td align="center">â</td>
<td align="center">âœ”ï¸</td>
</tr>
<tr>
<td align="center"><em><a target="_blank" rel="noopener" href="https://www.bing.com/">https://www.bing.com</a></em></td>
<td align="center">âœ”ï¸</td>
<td align="center">â</td>
</tr>
<tr>
<td align="center"><em><a target="_blank" rel="noopener" href="https://www.google.com/">https://www.google.com</a></em></td>
<td align="center">â</td>
<td align="center">â / âœ”ï¸</td>
</tr>
</tbody></table>
<p>æœç´¢ <em>Content-Length</em> å­—æ®µçš„ç›¸å…³å†…å®¹</p>
<p><a target="_blank" rel="noopener" href="http://greenbytes.de/tech/webdav/rfc2616.html#header.content-length">rfc2616.html#header.content-length</a></p>
<p><a target="_blank" rel="noopener" href="http://greenbytes.de/tech/webdav/rfc2616.html#message.length">rfc2616.html#message.length</a></p>
<p>åœ¨ <em>HTTP 1.1</em> ä¸­åº”ç”¨å¯ä»¥é€šè¿‡ <em>Content-Lenght</em> å­—æ®µç¡®å®šæ¶ˆæ¯çš„é•¿åº¦ï¼Œ</p>
<p><em>Content-Length</em> å¤±æ•ˆçš„å‡ ç§æƒ…å†µ</p>
<ul>
<li>çŠ¶æ€ç ä¸º <em>1xx</em>,<em>204</em> å’Œ <em>304</em></li>
<li>è®¾ç½®äº† <em>Transfer-Encoding</em> ä¸”è¯¥å€¼ä¸ç­‰äº <em>identity</em></li>
<li>åŒæ—¶å­˜åœ¨ <em>Transfer-Encoding</em> å’Œ <em>Content-Length</em> </li>
<li>å“åº”çš„æ•°æ®ç±»å‹ä¸º <em>multipart/byteranges</em> ä¸”æ²¡æœ‰æŒ‡å®š <em>transfer-length</em> </li>
<li>æœåŠ¡å™¨å…³é—­è¿æ¥ </li>
</ul>
<p>åœ¨ <a target="_blank" rel="noopener" href="http://blog.csdn.net/yankai0219/article/details/8269922">è¿™é‡Œ</a></p>
<blockquote>
<p>1ã€åœ¨Http 1.0åŠä¹‹å‰ç‰ˆæœ¬ä¸­ï¼Œcontent-lengthå­—æ®µå¯æœ‰å¯æ— ã€‚<br>2ã€åœ¨http1.1åŠä¹‹åç‰ˆæœ¬ã€‚å¦‚æœæ˜¯keep aliveï¼Œåˆ™content-lengthå’Œchunkå¿…ç„¶æ˜¯äºŒé€‰ä¸€ã€‚è‹¥æ˜¯ékeep aliveï¼Œåˆ™å’Œhttp1.0ä¸€æ ·ã€‚content-lengthå¯æœ‰å¯æ— ã€‚</p>
</blockquote>
<h4 id="Transfer-Encoding"><a href="#Transfer-Encoding" class="headerlink" title="Transfer-Encoding"></a><code>Transfer-Encoding</code></h4><p>ã€€</p>
<p>ç”¨æ¥æŒ‡å®šæ•°æ®ä¼ è¾“çš„æ ¼å¼ï¼Œæœ‰å¦‚ä¸‹çš„æ ¼å¼</p>
<blockquote>
<p>Transfer-Encoding: chunked<br>Transfer-Encoding: compress<br>Transfer-Encoding: deflate<br>Transfer-Encoding: gzip<br>Transfer-Encoding: identity</p>
</blockquote>
<p><em>chunked</em> çš„æ ¼å¼è¯¦æƒ…å¯ä»¥å‚è€ƒ <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-hans/%E5%88%86%E5%9D%97%E4%BC%A0%E8%BE%93%E7%BC%96%E7%A0%81">Wiki-åˆ†å—ä¼ è¾“ç¼–ç </a></p>
<blockquote>
<p>å¦‚æœä¸€ä¸ªHTTPæ¶ˆæ¯ï¼ˆè¯·æ±‚æ¶ˆæ¯æˆ–åº”ç­”æ¶ˆæ¯ï¼‰çš„Transfer-Encodingæ¶ˆæ¯å¤´çš„å€¼ä¸ºchunkedï¼Œé‚£ä¹ˆï¼Œæ¶ˆæ¯ä½“ç”±æ•°é‡æœªå®šçš„å—ç»„æˆï¼Œå¹¶ä»¥æœ€åä¸€ä¸ªå¤§å°ä¸º0çš„å—ä¸ºç»“æŸã€‚<br>æ¯ä¸€ä¸ªéç©ºçš„å—éƒ½ä»¥è¯¥å—åŒ…å«æ•°æ®çš„å­—èŠ‚æ•°ï¼ˆå­—èŠ‚æ•°ä»¥åå…­è¿›åˆ¶è¡¨ç¤ºï¼‰å¼€å§‹ï¼Œè·Ÿéšä¸€ä¸ªCRLF ï¼ˆå›è½¦åŠæ¢è¡Œï¼‰ï¼Œç„¶åæ˜¯æ•°æ®æœ¬èº«ï¼Œæœ€åå—CRLFç»“æŸã€‚åœ¨ä¸€äº›å®ç°ä¸­ï¼Œå—å¤§å°å’ŒCRLFä¹‹é—´å¡«å……æœ‰ç™½ç©ºæ ¼ï¼ˆ0x20ï¼‰ã€‚<br>æœ€åä¸€å—æ˜¯å•è¡Œï¼Œç”±å—å¤§å°ï¼ˆ0ï¼‰ï¼Œä¸€äº›å¯é€‰çš„å¡«å……ç™½ç©ºæ ¼ï¼Œä»¥åŠCRLFã€‚æœ€åä¸€å—ä¸å†åŒ…å«ä»»ä½•æ•°æ®ï¼Œä½†æ˜¯å¯ä»¥å‘é€å¯é€‰çš„å°¾éƒ¨ï¼ŒåŒ…æ‹¬æ¶ˆæ¯å¤´å­—æ®µã€‚<br>æ¶ˆæ¯æœ€åä»¥CRLFç»“å°¾ã€‚</p>
</blockquote>
<p>ä½†æ˜¯åˆ°è¿™é‡Œä¾ç„¶æ²¡å®Œå…¨è§£å†³æˆ‘çš„å›°æƒ‘ï¼Œåœ¨ <em>iOS</em> ä¸­å¦‚ä½•æ¯”è¾ƒè·å¾—ç½‘ç»œè¯·æ±‚çš„æ€»é•¿åº¦ï¼Ÿ</p>
<p>å¯»æ‰¾å¤´æ–‡ä»¶åå‘ç°ï¼Œåœ¨ <em>NSURLResponse</em> å¯¹è±¡ä¸­</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*! </span></span><br><span class="line"><span class="comment">    @method expectedContentLength</span></span><br><span class="line"><span class="comment">    @abstract Returns the expected content length of the receiver.</span></span><br><span class="line"><span class="comment">    @discussion Some protocol implementations report a content length</span></span><br><span class="line"><span class="comment">    as part of delivering load metadata, but not all protocols</span></span><br><span class="line"><span class="comment">    guarantee the amount of data that will be delivered in actuality.</span></span><br><span class="line"><span class="comment">    Hence, this method returns an expected amount. Clients should use</span></span><br><span class="line"><span class="comment">    this value as an advisory, and should be prepared to deal with</span></span><br><span class="line"><span class="comment">    either more or less data.</span></span><br><span class="line"><span class="comment">    @result The expected content length of the receiver, or -1 if</span></span><br><span class="line"><span class="comment">    there is no expectation that can be arrived at regarding expected</span></span><br><span class="line"><span class="comment">    content length.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="type">long</span> <span class="type">long</span> expectedContentLength;</span><br></pre></td></tr></table></figure>

<h4 id="æˆ‘çš„æ–¹æ¡ˆ"><a href="#æˆ‘çš„æ–¹æ¡ˆ" class="headerlink" title="æˆ‘çš„æ–¹æ¡ˆ"></a>æˆ‘çš„æ–¹æ¡ˆ</h4><p>ã€€</p>
<p>ç»è¿‡æµ‹è¯•,åœ¨ <em>NSURLSessionDataDelegate</em> çš„ä»£ç†æ–¹æ³•<em>URLSession:dataTask:didReceiveData:</em> , <em>data</em> å³ä¸ºæ¯æ¬¡è·å–çš„æ•°æ®,è€Œ <em>dataTask</em> ä¸­çš„ <em>response</em> å±æ€§çš„ <em>expectedContentLength</em> æœ‰æ—¶ä¼šåœ¨æ•°æ®å¹¶æ²¡æœ‰å®Œå…¨æ¥æ”¶åˆ°æ—¶å°±å¯ä»¥è·å¾—é•¿åº¦,å› æ­¤å¯¹ <em>UIWebView</em> ç”¨è¿™ä¸ªå€¼æ¥è·å–ç½‘ç»œè¯·æ±‚è¿›åº¦,é‡‡ç”¨çš„ä¸»è¦æ€è·¯æ˜¯</p>
<ul>
<li>åœ¨æœªè·å¾— <em>expectedContentLength</em> é•¿åº¦æ—¶ï¼Œç”¨æ•°ç»„ä¿å­˜æ¯æ¬¡ <em>data</em> çš„å€¼</li>
<li>è·å–åˆ° <em>expectedContentLength</em> ï¼Œ æ ¹æ®æ•°ç»„ä¸­çš„å€¼ç®—å‡ºè¿›åº¦ï¼Œåœ¨æœ¬åœ°å®ç°åŠ¨ç”»ã€‚</li>
</ul>
<p>ç½‘ç»œè¯·æ±‚æš‚æ—¶å†³å®šè¿˜æ˜¯ä¾èµ– <em>AFNetworking</em> , æ·»åŠ äº†ä¸€ä¸ªåˆ†ç±»ï¼Œåœ¨è¿è¡Œæ—¶æ›¿æ¢ <em>URLSession:dataTask:didReceiveData:</em> æ–¹æ³•æ¥å®ç°</p>
<h3 id="å®è·µ-1"><a href="#å®è·µ-1" class="headerlink" title="å®è·µ"></a>å®è·µ</h3><p>ã€€</p>
<p>åˆ†ç±» <em>AFHTTPSessionManager+JACoder.h</em></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="string">&quot;AFHTTPSessionManager+JACoder.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="string">&lt;objc/message.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *kAFJAReceiveDataNotification =  <span class="string">@&quot;kAFNReceiveDataNotification&quot;</span>;</span><br><span class="line"><span class="built_in">NSString</span> *kAFJAReceiveResponseNotification = <span class="string">@&quot;kAFJAReceiveResponseNotification&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AFHTTPSessionManager</span> (<span class="title">JACoder</span>)</span></span><br><span class="line"></span><br><span class="line">+ (<span class="type">void</span>)load &#123;</span><br><span class="line">    Method originalMethod = class_getInstanceMethod(<span class="keyword">self</span>, <span class="keyword">@selector</span>(URLSession:dataTask:didReceiveData:));</span><br><span class="line">    Method swizzledMethod = class_getInstanceMethod(<span class="keyword">self</span>, <span class="keyword">@selector</span>(ja_URLSession:dataTask:didReceiveData:));</span><br><span class="line">    <span class="type">BOOL</span> didAddMethod =</span><br><span class="line">    class_addMethod(<span class="keyword">self</span>,</span><br><span class="line">                    <span class="keyword">@selector</span>(URLSession:dataTask:didReceiveData:),</span><br><span class="line">                    method_getImplementation(swizzledMethod),</span><br><span class="line">                    method_getTypeEncoding(swizzledMethod));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (didAddMethod) &#123;</span><br><span class="line">        class_replaceMethod(<span class="keyword">self</span>,</span><br><span class="line">                            <span class="keyword">@selector</span>(ja_URLSession:dataTask:didReceiveData:),</span><br><span class="line">                            method_getImplementation(originalMethod),</span><br><span class="line">                            method_getTypeEncoding(originalMethod));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        method_exchangeImplementations(originalMethod, swizzledMethod);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)ja_URLSession:(<span class="built_in">NSURLSession</span> *)session</span><br><span class="line">             dataTask:(<span class="built_in">NSURLSessionDataTask</span> *)dataTask</span><br><span class="line">       didReceiveData:(<span class="built_in">NSData</span> *)data &#123;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span> ja_URLSession:session dataTask:dataTask didReceiveData:data];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">if</span> (dataTask.response.expectedContentLength != <span class="number">-1</span> &amp;&amp; <span class="keyword">self</span>.isLock == <span class="literal">false</span>) &#123;</span><br><span class="line"><span class="comment">//        NSLog(@&quot;data = %ld&quot;,data.length);</span></span><br><span class="line"><span class="comment">//        NSLog(@&quot;dataTask = %lld&quot;,dataTask.response.expectedContentLength);</span></span><br><span class="line">        [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:kAFJAReceiveDataNotification object:data];</span><br><span class="line">        [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:kAFJAReceiveResponseNotification object:dataTask];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.lock = <span class="literal">true</span>;</span><br><span class="line">        </span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        </span><br><span class="line"><span class="comment">//        NSLog(@&quot;data = %ld&quot;,data.length);</span></span><br><span class="line">        [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:kAFJAReceiveDataNotification object:data];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">BOOL</span>)isLock &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">BOOL</span>)[objc_getAssociatedObject(<span class="keyword">self</span>, <span class="keyword">@selector</span>(isLock)) doubleValue];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)setLock:(<span class="type">BOOL</span>)lock &#123;</span><br><span class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, <span class="keyword">@selector</span>(setLock:), @(lock), OBJC_ASSOCIATION_ASSIGN);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>æ¥æ”¶åˆ°å·²è·å–æ€»é•¿åº¦çš„é€šçŸ¥åçš„ç›¸åº”å¤„ç†,ä¸ºäº†å’Œ <em>WKWebView</em> ç»Ÿä¸€ï¼Œåœ¨ç»§æ‰¿ <em>UIWebView</em> çš„å­ç±»ä¸­æ·»åŠ äº† <em>estimatedProgress</em> å±æ€§ï¼ŒåŒæ ·ç”¨ <em>KVO</em> å»å¤„ç†ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)receiveWithNotification:(<span class="built_in">NSNotification</span> *)noti &#123;</span><br><span class="line">    <span class="keyword">if</span> ([noti.object isKindOfClass:[<span class="built_in">NSURLSessionDataTask</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="built_in">NSURLSessionDataTask</span> *dataTask = (<span class="built_in">NSURLSessionDataTask</span> *)noti.object;</span><br><span class="line">        <span class="keyword">self</span>.expectedContentLength = dataTask.response.expectedContentLength;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.estimatedProgress == <span class="number">0</span> ) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">self</span>.records.count == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">self</span>.estimatedProgress = <span class="number">1.0</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">NSData</span> *record <span class="keyword">in</span> <span class="keyword">self</span>.records) &#123;</span><br><span class="line">                    <span class="keyword">self</span>.estimatedProgress += (<span class="built_in">CGFloat</span>)record.length / <span class="keyword">self</span>.expectedContentLength;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">self</span>.records = [<span class="built_in">NSArray</span> array];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">NSData</span> *record <span class="keyword">in</span> <span class="keyword">self</span>.records) &#123;</span><br><span class="line">                <span class="keyword">self</span>.estimatedProgress += (<span class="built_in">CGFloat</span>)record.length / <span class="keyword">self</span>.expectedContentLength;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// NSLog(@&quot;noti dataTask:%f&quot;,self.estimatedProgress);</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ([noti.object isKindOfClass:[<span class="built_in">NSData</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="built_in">NSData</span> *data = (<span class="built_in">NSData</span> *)noti.object;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.expectedContentLength != <span class="number">-1</span> &amp;&amp; <span class="keyword">self</span>.expectedContentLength != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">NSData</span> *record <span class="keyword">in</span> <span class="keyword">self</span>.records) &#123;</span><br><span class="line">                <span class="keyword">self</span>.estimatedProgress += (<span class="built_in">CGFloat</span>)record.length / <span class="keyword">self</span>.expectedContentLength;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">self</span>.estimatedProgress += (<span class="built_in">CGFloat</span>)data.length / <span class="keyword">self</span>.expectedContentLength;</span><br><span class="line">            <span class="comment">// NSLog(@&quot;noti data:%f&quot;,self.estimatedProgress);</span></span><br><span class="line">            <span class="keyword">self</span>.records = [<span class="built_in">NSArray</span> array];</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">NSMutableArray</span> *recordsM = [<span class="built_in">NSMutableArray</span> arrayWithArray:<span class="keyword">self</span>.records];</span><br><span class="line">            [recordsM addObject:data];</span><br><span class="line">            <span class="keyword">self</span>.records = [recordsM <span class="keyword">copy</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>estimatedProgress</em> å±æ€§å˜åŒ–çš„å¤„ç†</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath ofObject:(<span class="type">id</span>)object change:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSKeyValueChangeKey</span>,<span class="type">id</span>&gt; *)change context:(<span class="type">void</span> *)context &#123;</span><br><span class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        <span class="type">double</span> newKey = [[change objectForKey:<span class="built_in">NSKeyValueChangeNewKey</span>] doubleValue];        </span><br><span class="line">        [<span class="keyword">self</span>.progressBarlayer flush:newKey];</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">1</span> - newKey &lt; <span class="number">0.01</span>) &#123;</span><br><span class="line">            [<span class="keyword">self</span> finish];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="UIView"><a href="#UIView" class="headerlink" title="UIView"></a>UIView</h2><p>ã€€</p>
<p>å¯¹äºä¸€èˆ¬çš„ <em>App</em> è¯·æ±‚,å¤§å¤šéƒ½æ˜¯è¿”å› <em>JSON</em> æ•°æ®çš„æ¥å£,ä¹Ÿå¯ä»¥åšä¸€ä¸ªè¿›åº¦æ¡çš„æ•ˆæœã€‚</p>
<h3 id="åŸç†-2"><a href="#åŸç†-2" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>ã€€</p>
<p>ä¸€äº‹ä¸çƒ¦äºŒä¸»ï¼Œä¹Ÿç”¨ <em>AFNetworking</em> åšè¯·æ±‚ã€‚ä¸Šé¢å·²ç»åˆ†æäº† <em>AFNetworking</em> å¦‚ä½•æ£€æµ‹è¯·æ±‚è¿›åº¦çš„, å¤§å¤šæ•°æƒ…å†µä¸‹çš„è¯·æ±‚è¿›åº¦è‚¯å®šæ˜¯æ²¡é—®é¢˜çš„ã€‚</p>
<h3 id="å®è·µ-2"><a href="#å®è·µ-2" class="headerlink" title="å®è·µ"></a>å®è·µ</h3><p>ã€€</p>
<p>ç”¨ <em>AFNetworking</em> å‘èµ·è¯·æ±‚ï¼Œæ ¹æ®å›è°ƒè¿”å›çš„ <em>NSProgress</em> å€¼å®ç°åˆ·æ–°æ“ä½œã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="string">&quot;JAUIViewController.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="string">&lt;AFNetworking.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="string">&quot;JAProgressView.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JAUIViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) JAProgressView *progressView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JAUIViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="variable language_">super</span> viewDidLoad];</span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> colorWithWhite:<span class="number">0.92</span> alpha:<span class="number">1.0</span>];</span><br><span class="line">    _progressView = [[JAProgressView alloc] init];</span><br><span class="line">    [<span class="keyword">self</span>.navigationController.navigationBar addSubview:_progressView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)viewWillAppear:(<span class="type">BOOL</span>)animated &#123;</span><br><span class="line">    [<span class="variable language_">super</span> viewWillAppear:animated];</span><br><span class="line">    [[AFHTTPSessionManager manager] GET:<span class="string">@&quot;http://api.map.baidu.com/telematics/v3/weather?location=%E5%98%89%E5%85%B4&amp;output=json&amp;ak=5slgyqGDENN7Sy7pw29IUvrZ&quot;</span> parameters:<span class="literal">nil</span> progress:^(<span class="built_in">NSProgress</span> * _Nonnull downloadProgress) &#123;</span><br><span class="line">        </span><br><span class="line">        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">0.5</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            [_progressView flush:downloadProgress.fractionCompleted];</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// or</span></span><br><span class="line">        <span class="comment">// [[NSNotificationCenter defaultCenter] postNotificationName:JAEstimatedProgressNotification object:downloadProgress];</span></span><br><span class="line"></span><br><span class="line">    &#125; success:^(<span class="built_in">NSURLSessionDataTask</span> * _Nonnull task, <span class="type">id</span>  _Nullable responseObject) &#123;</span><br><span class="line"></span><br><span class="line">    &#125; failure:^(<span class="built_in">NSURLSessionDataTask</span> * _Nullable task, <span class="built_in">NSError</span> * _Nonnull error) &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)didReceiveMemoryWarning &#123;</span><br><span class="line">    [<span class="variable language_">super</span> didReceiveMemoryWarning];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç›¸åº”çš„å¤„ç†</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šçŸ¥</span></span><br><span class="line">- (<span class="type">void</span>)receiveWithNotification:(<span class="built_in">NSNotification</span> *)notifcation &#123;</span><br><span class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        <span class="keyword">if</span> ([notifcation.object isKindOfClass:[<span class="built_in">NSProgress</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">            <span class="built_in">NSProgress</span> *progress = (<span class="built_in">NSProgress</span> *)notifcation.object;</span><br><span class="line">            [<span class="keyword">self</span>.progressBarlayer flush:progress.fractionCompleted];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼ å€¼</span></span><br><span class="line">- (<span class="type">void</span>)flush:(<span class="built_in">CGFloat</span>)progress &#123;</span><br><span class="line">    [<span class="keyword">self</span>.progressBarlayer flush:progress];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h2><p>ã€€</p>
<p><img src="https://ooo.0o0.ooo/2017/05/13/5916e5c5a6442.gif"></p>
<p><a target="_blank" rel="noopener" href="https://github.com/ishepherdMiner/JAProgressBar">DEMO</a></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>ã€€</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/AFNetworking/AFNetworking/issues/1844">Progress and KVO never called</a></li>
<li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-hans/%E5%88%86%E5%9D%97%E4%BC%A0%E8%BE%93%E7%BC%96%E7%A0%81">Wiki-åˆ†å—ä¼ è¾“ç¼–ç </a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Transfer-Encoding">MDN - Transfer-Encoding</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/yankai0219/article/details/8269922">httpåè®®ä¸­content-length ä»¥åŠchunkedç¼–ç åˆ†æ</a></li>
</ol>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/UI/" rel="tag"># UI</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2017/05/05/iOSer-objc-709-project-structures/" rel="prev" title="iOS - objc4-709å·¥ç¨‹æ­å»º">
      <i class="fa fa-chevron-left"></i> iOS - objc4-709å·¥ç¨‹æ­å»º
    </a></div>
      <div class="post-nav-item">
    <a href="/2017/05/20/iOS-Analysis-of-UIButton-s-imageEdgeInsets-with-titleEdgeInsets/" rel="next" title="iOS - UIButtonçš„imageEdgeInsetsä¸titleEdgeInsets">
      iOS - UIButtonçš„imageEdgeInsetsä¸titleEdgeInsets <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%BC%E8%AF%AD"><span class="nav-number">1.</span> <span class="nav-text">å¯¼è¯­</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83"><span class="nav-number">2.</span> <span class="nav-text">ç¯å¢ƒ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WKWebView"><span class="nav-number">3.</span> <span class="nav-text">WKWebView</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86"><span class="nav-number">3.1.</span> <span class="nav-text">åŸç†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E8%B7%B5"><span class="nav-number">3.2.</span> <span class="nav-text">å®è·µ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UIWebView"><span class="nav-number">4.</span> <span class="nav-text">UIWebView</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-1"><span class="nav-number">4.1.</span> <span class="nav-text">åŸç†</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Transfer-Encoding"><span class="nav-number">4.1.1.</span> <span class="nav-text">Transfer-Encoding</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%88%91%E7%9A%84%E6%96%B9%E6%A1%88"><span class="nav-number">4.1.2.</span> <span class="nav-text">æˆ‘çš„æ–¹æ¡ˆ</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E8%B7%B5-1"><span class="nav-number">4.2.</span> <span class="nav-text">å®è·µ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UIView"><span class="nav-number">5.</span> <span class="nav-text">UIView</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-2"><span class="nav-number">5.1.</span> <span class="nav-text">åŸç†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E8%B7%B5-2"><span class="nav-number">5.2.</span> <span class="nav-text">å®è·µ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%88%E6%9E%9C%E5%9B%BE"><span class="nav-number">6.</span> <span class="nav-text">æ•ˆæœå›¾</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">7.</span> <span class="nav-text">å‚è€ƒ</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">å¿˜å·ä¸‰</p>
  <div class="site-description" itemprop="description">404~ ~ ~å°±å¤šèµ°ä¸€æ­¥</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">89</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">å¿˜å·ä¸‰</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
