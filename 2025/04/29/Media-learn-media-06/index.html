<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/favicon.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="环境 iOS 18 Xcode 16.3 swift-driver version: 1.120.5 Apple Swift version 6.1 (swiftlang-6.1.0.110.21 clang-1700.0.13.3)Target: x86_64-apple-macosx15.0  Core Audio 的架构">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS - 音频:Core Audio - 播放">
<meta property="og:url" content="http://yoursite.com/2025/04/29/Media-learn-media-06/index.html">
<meta property="og:site_name" content="👨🏻‍💻&#39;s 博客">
<meta property="og:description" content="环境 iOS 18 Xcode 16.3 swift-driver version: 1.120.5 Apple Swift version 6.1 (swiftlang-6.1.0.110.21 clang-1700.0.13.3)Target: x86_64-apple-macosx15.0  Core Audio 的架构">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2025/04/29/TZ5sagyqVLxz4PC.jpg">
<meta property="og:image" content="https://s2.loli.net/2025/04/29/olvmfILXGU4y9Fj.jpg">
<meta property="og:image" content="https://s2.loli.net/2025/04/29/kWo1veRMxwIp5Gr.jpg">
<meta property="og:image" content="https://s2.loli.net/2025/04/29/uBIr2otD4cnCxjd.jpg">
<meta property="og:image" content="https://s2.loli.net/2025/04/29/wbSraiz4noTHkNW.png">
<meta property="article:published_time" content="2025-04-29T00:34:55.000Z">
<meta property="article:modified_time" content="2025-04-29T00:51:45.429Z">
<meta property="article:author" content="忘川三">
<meta property="article:tag" content="Mechanism">
<meta property="article:tag" content="CoreAudio">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2025/04/29/TZ5sagyqVLxz4PC.jpg">

<link rel="canonical" href="http://yoursite.com/2025/04/29/Media-learn-media-06/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>iOS - 音频:Core Audio - 播放 | 👨🏻‍💻's 博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">👨🏻‍💻's 博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">慢品人间烟火色，闲观万事岁月长</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2025/04/29/Media-learn-media-06/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="忘川三">
      <meta itemprop="description" content="404~ ~ ~就多走一步">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="👨🏻‍💻's 博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          iOS - 音频:Core Audio - 播放
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-04-29 08:34:55 / 修改时间：08:51:45" itemprop="dateCreated datePublished" datetime="2025-04-29T08:34:55+08:00">2025-04-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><blockquote>
<p>iOS 18</p>
<p>Xcode 16.3</p>
<p>swift-driver version: 1.120.5 Apple Swift version 6.1 (swiftlang-6.1.0.110.21 clang-1700.0.13.3)<br>Target: x86_64-apple-macosx15.0</p>
</blockquote>
<h2 id="Core-Audio-的架构"><a href="#Core-Audio-的架构" class="headerlink" title="Core Audio 的架构"></a>Core Audio 的架构</h2><p><img src="https://s2.loli.net/2025/04/29/TZ5sagyqVLxz4PC.jpg" alt="17457393790996.jpg"></p>
<span id="more"></span>

<h3 id="声音数据的描述"><a href="#声音数据的描述" class="headerlink" title="声音数据的描述"></a>声音数据的描述</h3><p><strong>sample</strong>: 一个声道采样的值,采样率定义了每秒从<strong>连续</strong>信号中提取并组成<strong>离散</strong>信号的<strong>采样个数</strong>，它用赫兹（Hz）来表示。</p>
<p><img src="https://s2.loli.net/2025/04/29/olvmfILXGU4y9Fj.jpg" alt="17458195551416.jpg"></p>
<p><img src="https://s2.loli.net/2025/04/29/kWo1veRMxwIp5Gr.jpg" alt="17458196263841.jpg"></p>
<p><strong>frame</strong>: 一个时间常量内的<strong>sample</strong>的集合<br><strong>packet</strong>: 一个或多个连续的帧</p>
<h4 id="AudioStreamBasicDescription"><a href="#AudioStreamBasicDescription" class="headerlink" title="AudioStreamBasicDescription"></a>AudioStreamBasicDescription</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CoreAudioBaseTypes.h</span></span><br><span class="line"><span class="comment">// 音频的格式信息</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AudioStreamBasicDescription</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    Float64             mSampleRate;  <span class="comment">// 采样率</span></span><br><span class="line">    AudioFormatID       mFormatID;    <span class="comment">// 采样格式类型</span></span><br><span class="line">    AudioFormatFlags    mFormatFlags; <span class="comment">// 采样格式标志位</span></span><br><span class="line">    UInt32              mBytesPerPacket;   <span class="comment">// 每个packet的字节数</span></span><br><span class="line">    <span class="comment">// 每个packet的frame数，在未压缩的音频中 mFramesPerPacket == 1 </span></span><br><span class="line">    UInt32              mFramesPerPacket;</span><br><span class="line">    UInt32              mBytesPerFrame;    <span class="comment">// 每个frame的字节数</span></span><br><span class="line">    UInt32              mChannelsPerFrame; <span class="comment">// 每个frame的声道数</span></span><br><span class="line">    UInt32              mBitsPerChannel;   <span class="comment">// 每个通道的比特数</span></span><br><span class="line">    UInt32              mReserved;         <span class="comment">// 保留</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">AudioStreamBasicDescription</span>  <span class="title">AudioStreamBasicDescription</span>;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">CF_ENUM(AudioFormatID)</span><br><span class="line">&#123;</span><br><span class="line">    kAudioFormatLinearPCM               = <span class="string">&#x27;lpcm&#x27;</span>,</span><br><span class="line">    kAudioFormatAC3                     = <span class="string">&#x27;ac-3&#x27;</span>,</span><br><span class="line">    kAudioFormat60958AC3                = <span class="string">&#x27;cac3&#x27;</span>,</span><br><span class="line">    kAudioFormatAppleIMA4               = <span class="string">&#x27;ima4&#x27;</span>,</span><br><span class="line">    kAudioFormatMPEG4AAC                = <span class="string">&#x27;aac&#x27;</span>,</span><br><span class="line">    kAudioFormatMPEG4CELP               = <span class="string">&#x27;celp&#x27;</span>,</span><br><span class="line">    kAudioFormatMPEG4HVXC               = <span class="string">&#x27;hvxc&#x27;</span>,</span><br><span class="line">    kAudioFormatMPEG4TwinVQ             = <span class="string">&#x27;twvq&#x27;</span>,</span><br><span class="line">    kAudioFormatMACE3                   = <span class="string">&#x27;MAC3&#x27;</span>,</span><br><span class="line">    kAudioFormatMACE6                   = <span class="string">&#x27;MAC6&#x27;</span>,</span><br><span class="line">    kAudioFormatULaw                    = <span class="string">&#x27;ulaw&#x27;</span>,</span><br><span class="line">    kAudioFormatALaw                    = <span class="string">&#x27;alaw&#x27;</span>,</span><br><span class="line">    kAudioFormatQDesign                 = <span class="string">&#x27;QDMC&#x27;</span>,</span><br><span class="line">    kAudioFormatQDesign2                = <span class="string">&#x27;QDM2&#x27;</span>,</span><br><span class="line">    kAudioFormatQUALCOMM                = <span class="string">&#x27;Qclp&#x27;</span>,</span><br><span class="line">    kAudioFormatMPEGLayer1              = <span class="string">&#x27;.mp1&#x27;</span>,</span><br><span class="line">    kAudioFormatMPEGLayer2              = <span class="string">&#x27;.mp2&#x27;</span>,</span><br><span class="line">    kAudioFormatMPEGLayer3              = <span class="string">&#x27;.mp3&#x27;</span>,</span><br><span class="line">    kAudioFormatTimeCode                = <span class="string">&#x27;time&#x27;</span>,</span><br><span class="line">    kAudioFormatMIDIStream              = <span class="string">&#x27;midi&#x27;</span>,</span><br><span class="line">    kAudioFormatParameterValueStream    = <span class="string">&#x27;apvs&#x27;</span>,</span><br><span class="line">    kAudioFormatAppleLossless           = <span class="string">&#x27;alac&#x27;</span>,</span><br><span class="line">    kAudioFormatMPEG4AAC_HE             = <span class="string">&#x27;aach&#x27;</span>,</span><br><span class="line">    kAudioFormatMPEG4AAC_LD             = <span class="string">&#x27;aacl&#x27;</span>,</span><br><span class="line">    kAudioFormatMPEG4AAC_ELD            = <span class="string">&#x27;aace&#x27;</span>,</span><br><span class="line">    kAudioFormatMPEG4AAC_ELD_SBR        = <span class="string">&#x27;aacf&#x27;</span>,</span><br><span class="line">    kAudioFormatMPEG4AAC_ELD_V2         = <span class="string">&#x27;aacg&#x27;</span>,</span><br><span class="line">    kAudioFormatMPEG4AAC_HE_V2          = <span class="string">&#x27;aacp&#x27;</span>,</span><br><span class="line">    kAudioFormatMPEG4AAC_Spatial        = <span class="string">&#x27;aacs&#x27;</span>,</span><br><span class="line">    kAudioFormatMPEGD_USAC              = <span class="string">&#x27;usac&#x27;</span>,</span><br><span class="line">    kAudioFormatAMR                     = <span class="string">&#x27;samr&#x27;</span>,</span><br><span class="line">    kAudioFormatAMR_WB                  = <span class="string">&#x27;sawb&#x27;</span>,</span><br><span class="line">    kAudioFormatAudible                 = <span class="string">&#x27;AUDB&#x27;</span>,</span><br><span class="line">    kAudioFormatiLBC                    = <span class="string">&#x27;ilbc&#x27;</span>,</span><br><span class="line">    kAudioFormatDVIIntelIMA             = <span class="number">0x6D730011</span>,</span><br><span class="line">    kAudioFormatMicrosoftGSM            = <span class="number">0x6D730031</span>,</span><br><span class="line">    kAudioFormatAES3                    = <span class="string">&#x27;aes3&#x27;</span>,</span><br><span class="line">    kAudioFormatEnhancedAC3             = <span class="string">&#x27;ec-3&#x27;</span>,</span><br><span class="line">    kAudioFormatFLAC                    = <span class="string">&#x27;flac&#x27;</span>,</span><br><span class="line">    kAudioFormatOpus                    = <span class="string">&#x27;opus&#x27;</span>,</span><br><span class="line">    kAudioFormatAPAC                    = <span class="string">&#x27;apac&#x27;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">CF_ENUM(AudioFormatFlags)</span><br><span class="line">&#123;</span><br><span class="line">    kAudioFormatFlagIsFloat                     = (<span class="number">1U</span> &lt;&lt; <span class="number">0</span>),     <span class="comment">// 0x1</span></span><br><span class="line">    kAudioFormatFlagIsBigEndian                 = (<span class="number">1U</span> &lt;&lt; <span class="number">1</span>),     <span class="comment">// 0x2</span></span><br><span class="line">    kAudioFormatFlagIsSignedInteger             = (<span class="number">1U</span> &lt;&lt; <span class="number">2</span>),     <span class="comment">// 0x4</span></span><br><span class="line">    kAudioFormatFlagIsPacked                    = (<span class="number">1U</span> &lt;&lt; <span class="number">3</span>),     <span class="comment">// 0x8</span></span><br><span class="line">    kAudioFormatFlagIsAlignedHigh               = (<span class="number">1U</span> &lt;&lt; <span class="number">4</span>),     <span class="comment">// 0x10</span></span><br><span class="line">    kAudioFormatFlagIsNonInterleaved            = (<span class="number">1U</span> &lt;&lt; <span class="number">5</span>),     <span class="comment">// 0x20</span></span><br><span class="line">    kAudioFormatFlagIsNonMixable                = (<span class="number">1U</span> &lt;&lt; <span class="number">6</span>),     <span class="comment">// 0x40</span></span><br><span class="line">    kAudioFormatFlagsAreAllClear                = <span class="number">0x80000000</span>,</span><br><span class="line">	</span><br><span class="line">    kLinearPCMFormatFlagIsFloat                 = kAudioFormatFlagIsFloat,</span><br><span class="line">    kLinearPCMFormatFlagIsBigEndian             = kAudioFormatFlagIsBigEndian,</span><br><span class="line">    kLinearPCMFormatFlagIsSignedInteger         = kAudioFormatFlagIsSignedInteger,</span><br><span class="line">    kLinearPCMFormatFlagIsPacked                = kAudioFormatFlagIsPacked,</span><br><span class="line">    kLinearPCMFormatFlagIsAlignedHigh           = kAudioFormatFlagIsAlignedHigh,</span><br><span class="line">    kLinearPCMFormatFlagIsNonInterleaved        = kAudioFormatFlagIsNonInterleaved,</span><br><span class="line">    kLinearPCMFormatFlagIsNonMixable            = kAudioFormatFlagIsNonMixable,</span><br><span class="line">    kLinearPCMFormatFlagsSampleFractionShift    = <span class="number">7</span>,</span><br><span class="line">    kLinearPCMFormatFlagsSampleFractionMask     = (<span class="number">0x3F</span> &lt;&lt; kLinearPCMFormatFlagsSampleFractionShift),</span><br><span class="line">    kLinearPCMFormatFlagsAreAllClear            = kAudioFormatFlagsAreAllClear,</span><br><span class="line">	</span><br><span class="line">    kAppleLosslessFormatFlag_16BitSourceData    = <span class="number">1</span>,</span><br><span class="line">    kAppleLosslessFormatFlag_20BitSourceData    = <span class="number">2</span>,</span><br><span class="line">    kAppleLosslessFormatFlag_24BitSourceData    = <span class="number">3</span>,</span><br><span class="line">    kAppleLosslessFormatFlag_32BitSourceData    = <span class="number">4</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>About the name: Although this data type has “stream” in its name, you use it in every instance where you need to represent an audio data format in Core Audio—including in non-streamed, standard files. You could think of it as the “audio format basic description” data type. The “stream” in the name refers to the fact that audio formats come into play whenever you need to move (that is, stream) audio data around in hardware or software.</p>
</blockquote>
<p>类型中的stream只是表示播放的概念,这里定义的就是iOS音频格式的描述</p>
<h5 id="获取声音的格式信息"><a href="#获取声音的格式信息" class="headerlink" title="获取声音的格式信息"></a>获取声音的格式信息</h5><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">func</span> <span class="title function_">audioFormat</span>() -&gt; <span class="type">AudioStreamBasicDescription</span>? &#123;</span><br><span class="line">        <span class="keyword">var</span> size: <span class="type">UInt32</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">var</span> audioFile: <span class="type">AudioFileID</span>? <span class="comment">// 使用可选类型</span></span><br><span class="line">        <span class="keyword">var</span> status <span class="operator">=</span> <span class="type">AudioFileOpenURL</span>(<span class="keyword">self</span>.path <span class="keyword">as</span> <span class="type">CFURL</span>, .readPermission, <span class="number">0</span>, <span class="operator">&amp;</span>audioFile)</span><br><span class="line">        <span class="keyword">guard</span> status <span class="operator">==</span> noErr <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;*** Error *** filePath: <span class="subst">\(<span class="keyword">self</span>.path)</span> -- code: <span class="subst">\(status)</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取音频数据格式</span></span><br><span class="line">        <span class="keyword">var</span> dataFormat <span class="operator">=</span> <span class="type">AudioStreamBasicDescription</span>()</span><br><span class="line">        size <span class="operator">=</span> <span class="type">UInt32</span>(<span class="type">MemoryLayout</span>&lt;<span class="type">AudioStreamBasicDescription</span>&gt;.size)</span><br><span class="line">        </span><br><span class="line">        status <span class="operator">=</span> <span class="type">AudioFileGetProperty</span>(</span><br><span class="line">            audioFile<span class="operator">!</span>,</span><br><span class="line">            kAudioFilePropertyDataFormat,</span><br><span class="line">            <span class="operator">&amp;</span>size,</span><br><span class="line">            <span class="operator">&amp;</span>dataFormat</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 可选：检查属性获取是否成功</span></span><br><span class="line">        <span class="keyword">guard</span> status <span class="operator">==</span> noErr <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Failed to get data format: <span class="subst">\(status)</span>&quot;</span>)</span><br><span class="line">            <span class="type">AudioFileClose</span>(audioFile<span class="operator">!</span>) <span class="comment">// 关闭文件防止泄漏</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> dataFormat</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2025/04/29/uBIr2otD4cnCxjd.jpg" alt="17457511066160.jpg"></p>
<p>我加载的是一个44.1kHz,双声道的mp3文件<br>778924083 = 0x2E6D7033 =&gt; “.mp3”</p>
<h4 id="AudioStreamPacketDescription"><a href="#AudioStreamPacketDescription" class="headerlink" title="AudioStreamPacketDescription"></a>AudioStreamPacketDescription</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CoreAudioBaseTypes.h</span></span><br><span class="line"><span class="comment">// 表示每个音频packet的数据</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span>  <span class="title">AudioStreamPacketDescription</span> &#123;</span></span><br><span class="line">    <span class="comment">// For example, if the data buffer contains 5 bytes of data, with one byte per packet, then the start offset for the last packet is 4. There are 4 bytes in the buffer before the start of the last packet.</span></span><br><span class="line">    <span class="comment">// 偏移量</span></span><br><span class="line">    <span class="comment">// 比如缓冲区有5字节的数据,当每个packet包含1个字节,那最后一个包的这个值就是4</span></span><br><span class="line">    SInt64  mStartOffset;</span><br><span class="line">    UInt32  mVariableFramesInPacket; <span class="comment">// frame的个数,如果是格式是CBR按常量编码的,这个值设置为0</span></span><br><span class="line">    UInt32  mDataByteSize; <span class="comment">// 字节数</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">AudioStreamPacketDescription</span> <span class="title">AudioStreamPacketDescription</span>;</span></span><br></pre></td></tr></table></figure>

<h4 id="Proxy-Objects-Properties-Scopes-Elements"><a href="#Proxy-Objects-Properties-Scopes-Elements" class="headerlink" title="Proxy Objects,Properties, Scopes, Elements"></a>Proxy Objects,Properties, Scopes, Elements</h4><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Proxy Objects</td>
<td>音频文件,流的代码抽象</td>
</tr>
<tr>
<td>Properties</td>
<td>管理对象的状态或行为</td>
</tr>
<tr>
<td>Scopes</td>
<td>作用域:输入/输出</td>
</tr>
<tr>
<td>Elements</td>
<td>具体的设备,比如蓝牙,有线…</td>
</tr>
</tbody></table>
<p>Properties的key一般是个常量值，比如 kAudioFilePropertyFileFormat或者kAudioQueueDeviceProperty_NumberChannels.</p>
<h4 id="回调函数-与Core-Audio交互"><a href="#回调函数-与Core-Audio交互" class="headerlink" title="回调函数: 与Core Audio交互"></a>回调函数: 与Core Audio交互</h4><p>Core Audio接口通过回调函数与应用交互，一般有下面几种场景</p>
<ul>
<li>音频数据传送到应用程序（例如用于录制;然后通过回调将新数据写入磁盘）</li>
<li>从应用程序请求音频数据（例如用于播放;回调从磁盘/内存读取并提供数据）。</li>
<li>通知应用程序音频对象已更改状态（回调会执行适当操作，比如更新界面）。 </li>
</ul>
<p>回调函数实现分两步: 注册 &amp;&amp; 回调</p>
<h2 id="相关框架"><a href="#相关框架" class="headerlink" title="相关框架"></a>相关框架</h2><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>AVFoundation</td>
<td>提供AVAudioPlayer类,这是一个用于音频播放的简化的原生接口，还提供AVAudioEngine类,用于更复杂的音频处理</td>
</tr>
<tr>
<td>AudioToolbox</td>
<td>为Core Audio中的高级服务提供接口，包括Audio Session服务，用于在iOS管理应用程序的音频行为，允许应用程序使用音频插件，包括音频单元和编解码器</td>
</tr>
<tr>
<td>OpenAL</td>
<td>提供了与OpenAL配合使用的接口</td>
</tr>
<tr>
<td>CoreAudioTypes</td>
<td>提供Core Audio使用的数据类型以及低级服务的接口。</td>
</tr>
</tbody></table>
<p><img src="https://s2.loli.net/2025/04/29/wbSraiz4noTHkNW.png" alt="2025-04-29 08.40.08.png"></p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><h3 id="播放音乐"><a href="#播放音乐" class="headerlink" title="播放音乐"></a>播放音乐</h3><p>使用<code>AudioToolbox.framework</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">play</span>() &#123;</span><br><span class="line">        <span class="keyword">var</span> format <span class="operator">=</span> <span class="keyword">self</span>.audioFormat()</span><br><span class="line">        <span class="keyword">guard</span> format <span class="operator">!=</span> <span class="literal">nil</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 打开音频文件</span></span><br><span class="line">        <span class="keyword">var</span> status <span class="operator">=</span> <span class="type">AudioFileOpenURL</span>(path <span class="keyword">as</span> <span class="type">CFURL</span>, .readPermission, <span class="number">0</span>, <span class="operator">&amp;</span>audioFile)</span><br><span class="line">        <span class="keyword">guard</span> status <span class="operator">==</span> noErr <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> context <span class="operator">=</span> <span class="type">UnsafeMutableRawPointer</span>(<span class="type">Unmanaged</span>.passUnretained(<span class="keyword">self</span>).toOpaque())</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        Audio Queue（音频队列）是 iOS 或 Mac OS X 中用来 录音 或 播放音频 的软件对象。它由 AudioQueueRef 数据类型表示，在 AudioQueue.h 中声明</span></span><br><span class="line"><span class="comment">        音频队列的工作是:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        * 连接音频硬件</span></span><br><span class="line"><span class="comment">        * 管理内存</span></span><br><span class="line"><span class="comment">        * 根据需要，为压缩音频格式使用编解码器</span></span><br><span class="line"><span class="comment">        * 调解录音或回放</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="comment">// 创建输出队列,注册回调函数</span></span><br><span class="line">        status <span class="operator">=</span> <span class="type">AudioQueueNewOutput</span>(<span class="operator">&amp;</span>format<span class="operator">!</span>, playbackCallback, context, <span class="literal">nil</span>, <span class="literal">nil</span>, <span class="number">0</span>, <span class="operator">&amp;</span>queue)</span><br><span class="line">        <span class="keyword">guard</span> status <span class="operator">==</span> noErr <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Create new output queue error&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        status <span class="operator">=</span> <span class="type">AudioFileGetProperty</span>(audioFile<span class="operator">!</span>, kAudioFilePropertyPacketSizeUpperBound, <span class="operator">&amp;</span>size, <span class="operator">&amp;</span>maxPacketSize)</span><br><span class="line">        <span class="keyword">guard</span> status <span class="operator">==</span> noErr <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Get maxPacketSize property error&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 计算缓冲区大小</span></span><br><span class="line">        <span class="comment">// For uncompressed audio, the value is 1. For variable bit-rate formats, the value is a larger fixed number, such as 1024 for AAC. For formats with a variable number of frames per packet, such as Ogg Vorbis, set this field to 0.</span></span><br><span class="line">        <span class="comment">// MP3的值是1152</span></span><br><span class="line">        <span class="keyword">if</span> format<span class="operator">!</span>.mFramesPerPacket <span class="operator">!=</span> <span class="number">0</span> &#123;</span><br><span class="line">            <span class="comment">// 每秒的包的数量 = 采样率/每个包的帧数</span></span><br><span class="line">            <span class="comment">// 比如MP3每秒采样44100次,每个包有1152帧,两者相除就是每秒的包数量</span></span><br><span class="line">            <span class="keyword">let</span> numPacketsPerSecond <span class="operator">=</span> format<span class="operator">!</span>.mSampleRate <span class="operator">/</span> <span class="type">Double</span>(format<span class="operator">!</span>.mFramesPerPacket)</span><br><span class="line">            <span class="comment">// 每秒的包的数量 * 包大小的理论峰值, 即1s内占用内存的峰值</span></span><br><span class="line">            outBufferSize <span class="operator">=</span> <span class="type">UInt32</span>(numPacketsPerSecond <span class="operator">*</span> <span class="type">Double</span>(maxPacketSize))</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            outBufferSize <span class="operator">=</span> <span class="built_in">max</span>(maxBufferSize, maxPacketSize)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 调整缓冲区大小</span></span><br><span class="line">        <span class="keyword">if</span> outBufferSize <span class="operator">&gt;</span> maxBufferSize <span class="operator">&amp;&amp;</span> outBufferSize <span class="operator">&gt;</span> maxPacketSize &#123;</span><br><span class="line">            outBufferSize <span class="operator">=</span> maxBufferSize</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> outBufferSize <span class="operator">&lt;</span> minBufferSize &#123;</span><br><span class="line">            outBufferSize <span class="operator">=</span> minBufferSize</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 计算包数量并分配包描述数组</span></span><br><span class="line">        <span class="comment">// 每次读取的包的数量 = 缓冲区大小 / 包大小的理论峰值</span></span><br><span class="line">        numPacketsToRead <span class="operator">=</span> outBufferSize <span class="operator">/</span> maxPacketSize</span><br><span class="line">        packetDescs <span class="operator">=</span> <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">AudioStreamPacketDescription</span>&gt;.allocate(capacity: <span class="type">Int</span>(numPacketsToRead))</span><br><span class="line">        packetDescs<span class="operator">?</span>.initialize(repeating: <span class="type">AudioStreamPacketDescription</span>(), count: <span class="type">Int</span>(numPacketsToRead))</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 分配3个缓冲区</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span>maxBufferNum &#123;</span><br><span class="line">            <span class="keyword">var</span> buffer: <span class="type">AudioQueueBufferRef</span>?</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             Once allocated, the pointer to the buffer and the buffer&#x27;s size are fixed and cannot be</span></span><br><span class="line"><span class="comment">             changed. The mAudioDataByteSize field in the audio queue buffer structure,</span></span><br><span class="line"><span class="comment">             AudioQueueBuffer, is initially set to 0.</span></span><br><span class="line"><span class="comment">             </span></span><br><span class="line"><span class="comment">             @param      inAQ</span></span><br><span class="line"><span class="comment">             // 分配缓冲区的音频队列</span></span><br><span class="line"><span class="comment">             The audio queue you want to allocate a buffer.</span></span><br><span class="line"><span class="comment">             @param      inBufferByteSize</span></span><br><span class="line"><span class="comment">             // 缓冲区大小</span></span><br><span class="line"><span class="comment">             The desired size of the new buffer, in bytes. An appropriate buffer size depends on the</span></span><br><span class="line"><span class="comment">             processing you will perform on the data as well as on the audio data format.</span></span><br><span class="line"><span class="comment">             @param      outBuffer</span></span><br><span class="line"><span class="comment">             // 指向新创建的缓冲区</span></span><br><span class="line"><span class="comment">             On return, points to the newly created audio buffer. The mAudioDataByteSize field in the</span></span><br><span class="line"><span class="comment">             audio queue buffer structure, AudioQueueBuffer, is initially set to 0.</span></span><br><span class="line"><span class="comment">             @result     An OSStatus result code.</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="type">AudioQueueAllocateBuffer</span>(queue<span class="operator">!</span>, outBufferSize, <span class="operator">&amp;</span>buffer)</span><br><span class="line">            buffers[i] <span class="operator">=</span> buffer</span><br><span class="line">            <span class="comment">// 预先读maxBufferNum个缓冲区</span></span><br><span class="line">            audioQueueOutput(audioQueue: queue<span class="operator">!</span>, queueBuffer: buffer<span class="operator">!</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 启动队列</span></span><br><span class="line">        <span class="type">AudioQueueStart</span>(queue<span class="operator">!</span>, <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>在回调方法中读取音频文件并将数据入队供系统的队列播放</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">let</span> playbackCallback: <span class="type">AudioQueueOutputCallback</span> <span class="operator">=</span> &#123;</span><br><span class="line">        inUserData,          <span class="comment">// UnsafeMutableRawPointer?</span></span><br><span class="line">        inAQ,                <span class="comment">// AudioQueueRef</span></span><br><span class="line">        buffer               <span class="comment">// AudioQueueBufferRef</span></span><br><span class="line">        <span class="keyword">in</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 1. 保护</span></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> inUserData <span class="operator">=</span> inUserData <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 将指针转换为对象实例</span></span><br><span class="line">        <span class="keyword">let</span> player:<span class="type">AudioToolboxTest</span> <span class="operator">=</span> <span class="type">Unmanaged</span>&lt;<span class="type">AudioToolboxTest</span>&gt;.fromOpaque(inUserData).takeUnretainedValue()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 实际处理逻辑</span></span><br><span class="line">        <span class="comment">// 处理音频缓冲区</span></span><br><span class="line">        player.audioQueueOutput(audioQueue: inAQ, queueBuffer: buffer)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">func</span> <span class="title function_">audioQueueOutput</span>(<span class="params">audioQueue</span>: <span class="type">AudioQueueRef</span>, <span class="params">queueBuffer</span> <span class="params">audioQueueBuffer</span>: <span class="type">AudioQueueBufferRef</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> ioNumBytes <span class="operator">=</span> outBufferSize</span><br><span class="line">        <span class="keyword">var</span> ioNumPackets <span class="operator">=</span> numPacketsToRead</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 读取音频文件</span></span><br><span class="line">        <span class="keyword">let</span> status <span class="operator">=</span> <span class="type">AudioFileReadPacketData</span>(</span><br><span class="line">            audioFile<span class="operator">!</span>,  <span class="comment">// 音频文件</span></span><br><span class="line">            <span class="literal">false</span>, <span class="comment">// 是否缓存</span></span><br><span class="line">            <span class="comment">// on input the size of outBuffer in bytes.</span></span><br><span class="line">            <span class="comment">// on output, the number of bytes actually returned.</span></span><br><span class="line">            <span class="comment">// 输入场景等于缓存大小</span></span><br><span class="line">            <span class="comment">// 输出场景:比如播放根据文件的实际情况</span></span><br><span class="line">            <span class="operator">&amp;</span>ioNumBytes, <span class="comment">// 包的长度</span></span><br><span class="line">            packetDescs, <span class="comment">// 音频包信息</span></span><br><span class="line">            packetIndex, <span class="comment">// 索引值</span></span><br><span class="line">            <span class="operator">&amp;</span>ioNumPackets, <span class="comment">// 包的个数</span></span><br><span class="line">            audioQueueBuffer.pointee.mAudioData <span class="comment">// 读取到的数据</span></span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">guard</span> status <span class="operator">==</span> noErr <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Error reading packet data: <span class="subst">\(status)</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> ioNumPackets <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">            <span class="comment">// 设置音频缓冲区数据大小</span></span><br><span class="line">            audioQueueBuffer.pointee.mAudioDataByteSize <span class="operator">=</span> ioNumBytes</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 将音频数据入队列让系统去播放</span></span><br><span class="line">            <span class="type">AudioQueueEnqueueBuffer</span>(</span><br><span class="line">                audioQueue,</span><br><span class="line">                audioQueueBuffer,</span><br><span class="line">                ioNumPackets,</span><br><span class="line">                packetDescs</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 更新包的索引值</span></span><br><span class="line">            <span class="keyword">self</span>.packetIndex <span class="operator">+=</span> <span class="type">Int64</span>(ioNumPackets)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/ishepherdMiner/AVDemo">示例工程</a></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/MusicAudio/Conceptual/CoreAudioOverview/Introduction/Introduction.html#//apple_ref/doc/uid/TP40003577-CH1-SW1">Apple Core Audio Doc</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/audiotoolbox/audiofileopenurl(_:_:_:_:)">AudioFileOpenURL(<em>:</em>:<em>:</em>:)</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/3a92e0c7bf74">iOS音频(1)——AudioToolbox</a></li>
</ol>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Mechanism/" rel="tag"># Mechanism</a>
              <a href="/tags/CoreAudio/" rel="tag"># CoreAudio</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/04/25/Technology-learn-flutter-02/" rel="prev" title="Flutter 环境搭建 (Android)">
      <i class="fa fa-chevron-left"></i> Flutter 环境搭建 (Android)
    </a></div>
      <div class="post-nav-item">
    <a href="/2025/05/02/Technology-learn-flutter-03/" rel="next" title="Flutter - 概览">
      Flutter - 概览 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83"><span class="nav-number">1.</span> <span class="nav-text">环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Core-Audio-%E7%9A%84%E6%9E%B6%E6%9E%84"><span class="nav-number">2.</span> <span class="nav-text">Core Audio 的架构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A3%B0%E9%9F%B3%E6%95%B0%E6%8D%AE%E7%9A%84%E6%8F%8F%E8%BF%B0"><span class="nav-number">2.1.</span> <span class="nav-text">声音数据的描述</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#AudioStreamBasicDescription"><span class="nav-number">2.1.1.</span> <span class="nav-text">AudioStreamBasicDescription</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%A3%B0%E9%9F%B3%E7%9A%84%E6%A0%BC%E5%BC%8F%E4%BF%A1%E6%81%AF"><span class="nav-number">2.1.1.1.</span> <span class="nav-text">获取声音的格式信息</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#AudioStreamPacketDescription"><span class="nav-number">2.1.2.</span> <span class="nav-text">AudioStreamPacketDescription</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Proxy-Objects-Properties-Scopes-Elements"><span class="nav-number">2.1.3.</span> <span class="nav-text">Proxy Objects,Properties, Scopes, Elements</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0-%E4%B8%8ECore-Audio%E4%BA%A4%E4%BA%92"><span class="nav-number">2.1.4.</span> <span class="nav-text">回调函数: 与Core Audio交互</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E6%A1%86%E6%9E%B6"><span class="nav-number">3.</span> <span class="nav-text">相关框架</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B"><span class="nav-number">4.</span> <span class="nav-text">示例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%92%AD%E6%94%BE%E9%9F%B3%E4%B9%90"><span class="nav-number">4.1.</span> <span class="nav-text">播放音乐</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">5.</span> <span class="nav-text">参考</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">忘川三</p>
  <div class="site-description" itemprop="description">404~ ~ ~就多走一步</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">92</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">忘川三</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
